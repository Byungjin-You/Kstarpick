(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5530],{40780:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/tvfilm/edit/[id]",function(){return a(17152)}])},17152:function(e,t,a){"use strict";a.r(t);var r=a(85893),s=a(67294),l=a(2575),n=a(11163),i=a(87066),o=a(5152),d=a.n(o);a(25675);var c=a(82606),m=a(43832),g=a(15928),u=a(62190),x=a(43283),h=a(71707),b=a(33299),p=a(31955),v=a(74128),y=a(62076),f=a(65972),j=a(79731),N=a(86501);d()(()=>Promise.all([a.e(9414),a.e(4966)]).then(a.bind(a,14966)),{loadableGenerated:{webpack:()=>[14966]},ssr:!1});let w=async e=>{let t=new FormData;return t.append("file",e),(await i.default.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data};t.default=function(){let e=(0,n.useRouter)(),{id:t}=e.query,{data:a,status:o}=(0,b.useSession)(),[d,k]=(0,s.useState)(!1),[C,I]=(0,s.useState)(!1),[S,D]=(0,s.useState)(!1),[R,A]=(0,s.useState)(""),[F,T]=(0,s.useState)(""),[P,O]=(0,s.useState)("basic"),[U,E]=(0,s.useState)({title:"",originalTitle:"",category:"",coverImage:null,bannerImage:null,summary:"",network:"",status:"Ongoing",releaseDate:"",rating:"",runtime:"",ageRating:"",director:"",country:"",tags:[],trailerUrl:"",cast:[],watchProviders:[],videos:[],genres:[],productionCountry:"",content:"",reviews:[],reviewRating:0,reviewCount:0,ratingDistribution:[0,0,0,0,0,0,0,0,0,0]}),[L,_]=(0,s.useState)(""),[M,B]=(0,s.useState)(""),[z,V]=(0,s.useState)({}),[W,J]=(0,s.useState)(!1),[K,q]=(0,s.useState)(!1),[G,X]=(0,s.useState)(""),[H,Q]=(0,s.useState)(null),[Y,Z]=(0,s.useState)(null),[$,ee]=(0,s.useState)(""),[et,ea]=(0,s.useState)(""),[er,es]=(0,s.useState)(""),[el,en]=(0,s.useState)(""),[ei,eo]=(0,s.useState)(!1),[ed,ec]=(0,s.useState)(""),[em,eg]=(0,s.useState)(!1),[eu,ex]=(0,s.useState)([]),[eh,eb]=(0,s.useState)(!1),ep=(0,s.useRef)(null),ev=(0,s.useRef)(null);(0,s.useRef)(null),(0,s.useEffect)(()=>{(async()=>{try{var t;if("loading"===o)return;if((null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.role)==="admin"){eo(!0);return}let r=p.default.get("token")||localStorage.getItem("token");if(!r){e.push("/admin/login");return}try{(await i.default.get("/api/auth/check-admin",{headers:{Authorization:"Bearer ".concat(r)},withCredentials:!0})).data.isAdmin?(p.default.get("token")||p.default.set("token",r,{expires:7}),eo(!0)):(p.default.remove("token"),localStorage.removeItem("token"),e.push("/admin/login"))}catch(t){p.default.remove("token"),localStorage.removeItem("token"),e.push("/admin/login")}}catch(t){e.push("/admin/login")}})()},[e,a,o]),(0,s.useEffect)(()=>{t&&ei&&(async()=>{q(!0);try{let e=await i.default.get("/api/tvfilm/".concat(t));if(!e.data||!e.data.data){V({general:"API 응답 형식이 잘못되었습니다. data 필드가 없습니다."}),q(!1);return}let a=e.data.data,r=Array.isArray(a.cast)?a.cast:[],s=Array.isArray(a.watchProviders)?a.watchProviders:[],l=Array.isArray(a.videos)?a.videos:[],n=Array.isArray(a.tags)?a.tags:[],o=Array.isArray(a.genres)?a.genres:[],d=Array.isArray(a.reviews)?a.reviews:[],c={title:a.title||"",originalTitle:a.originalTitle||"",category:a.category||"",coverImage:a.coverImage||null,bannerImage:a.bannerImage||null,summary:a.summary||"",content:a.content||"",network:a.network||"",status:a.status||"Ongoing",releaseDate:a.releaseDate?new Date(a.releaseDate).toISOString().split("T")[0]:"",rating:a.rating||"",runtime:a.runtime||"",ageRating:a.ageRating||"",director:a.director||"",country:a.country||"",tags:n,trailerUrl:a.trailerUrl||"",cast:r,watchProviders:s,videos:l,genres:o,productionCountry:a.productionCountry||"",reviews:d,reviewRating:a.reviewRating||0,reviewCount:a.reviewCount||0,ratingDistribution:a.ratingDistribution||[0,0,0,0,0,0,0,0,0,0]};E(c),ex(JSON.parse(JSON.stringify(d))),eb(!1),a.coverImage&&(_(a.coverImage),a.coverImage.startsWith("http")?Q("/api/proxy?url=".concat(encodeURIComponent(a.coverImage))):Q(a.coverImage)),a.bannerImage&&(B(a.bannerImage),a.bannerImage.startsWith("http")?Z("/api/proxy?url=".concat(encodeURIComponent(a.bannerImage))):Z(a.bannerImage))}catch(r){var e,a;r.response||r.request;let t="TV/Film 데이터를 불러오는데 실패했습니다";(null===(a=r.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)?t+=": ".concat(r.response.data.message):r.message&&(t+=": ".concat(r.message)),V({general:t}),E({title:"",originalTitle:"",category:"",coverImage:null,bannerImage:null,summary:"",content:"",network:"",status:"Ongoing",releaseDate:"",rating:"",runtime:"",ageRating:"",director:"",country:"",tags:[],trailerUrl:"",cast:[],watchProviders:[],videos:[],genres:[],productionCountry:"",reviews:[],reviewRating:0,reviewCount:0,ratingDistribution:[0,0,0,0,0,0,0,0,0,0]})}finally{q(!1)}})()},[t,ei]);let ey=e=>{let{name:t,value:a}=e.target;E(e=>({...e,[t]:a})),z[t]&&V(e=>({...e,[t]:null}))},ef=async()=>{if($)try{if(es(""),!/^(https?:\/\/)/i.test($)){es("Please enter a valid URL starting with http:// or https://");return}let e="/api/proxy?url=".concat(encodeURIComponent($));Q(e),E(e=>({...e,coverImage:$})),ee("")}catch(e){es("Failed to load image from URL")}},ej=e=>{if(e){if(e.type.startsWith("image/")){if(e.size>5242880){es("Image file size must be less than 5MB");return}E({...U,coverImage:e}),es("");let t=new FileReader;t.onloadend=()=>{Q(t.result)},t.readAsDataURL(e)}else es("Please upload an image file")}},eN=e=>{if(e){if(e.type.startsWith("image/")){if(e.size>5242880){en("Image file size must be less than 5MB");return}E({...U,bannerImage:e}),en("");let t=new FileReader;t.onloadend=()=>{Z(t.result)},t.readAsDataURL(e)}else en("Please upload an image file")}},ew=async a=>{a.preventDefault(),J(!0),q(!0),V({});let r=N.toast.loading("TV/Film 수정 중...");try{let a=U.coverImage,s=U.bannerImage;if(U.coverImage instanceof File)try{a=(await w(U.coverImage)).url}catch(e){N.toast.error("커버 이미지 업로드 중 오류가 발생했습니다."),V(e=>({...e,coverImage:"이미지 업로드 중 오류가 발생했습니다."})),J(!1),q(!1);return}if(U.bannerImage instanceof File)try{s=(await w(U.bannerImage)).url}catch(e){N.toast.error("배너 이미지 업로드 중 오류가 발생했습니다."),V(e=>({...e,bannerImage:"이미지 업로드 중 오류가 발생했습니다."})),J(!1),q(!1);return}let l={title:U.title,originalTitle:U.originalTitle,category:U.category,summary:U.summary,content:U.content||U.summary,coverImage:a,bannerImage:s,releaseDate:U.releaseDate||void 0,country:U.country||void 0,runtime:U.runtime||void 0,ageRating:U.ageRating||void 0,director:U.director||void 0,trailerUrl:U.trailerUrl||void 0,network:U.network||void 0,status:U.status||void 0,tags:U.tags&&U.tags.length>0?U.tags:void 0,genres:U.genres&&U.genres.length>0?U.genres:void 0,cast:U.cast&&U.cast.length>0?U.cast:void 0,watchProviders:U.watchProviders&&U.watchProviders.length>0?U.watchProviders:void 0,videos:U.videos&&U.videos.length>0?U.videos:void 0,reviewRating:U.reviewRating,reviewCount:U.reviewCount,ratingDistribution:U.ratingDistribution};if(eh&&U.reviews&&U.reviews.length>0)try{await eC(U.reviews)}catch(e){N.toast.error("리뷰 저장 중 문제가 발생했지만, 계속 진행합니다.")}let n=p.default.get("token")||localStorage.getItem("token");await i.default.put("/api/tvfilm/".concat(t),l,{headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},timeout:6e4}),N.toast.dismiss(r),N.toast.success("TV/Film 수정이 완료되었습니다"),e.push("/admin/tvfilm")}catch(e){N.toast.dismiss(r),i.default.isCancel(e)?N.toast.error("요청이 취소되었습니다."):"ECONNABORTED"===e.code?(N.toast.error("요청 시간이 초과되었습니다. 데이터가 너무 큽니다."),V({general:"요청 시간이 초과되었습니다. 리뷰나 출연진 데이터의 양을 줄여보세요."})):(N.toast.error("TV/Film 수정 중 오류가 발생했습니다."),V({general:"TV/Film 수정 중 오류가 발생했습니다. 다시 시도해주세요."}))}finally{J(!1),q(!1)}},ek=e=>{E(t=>({...t,genres:t.genres.filter((t,a)=>a!==e)}))},eC=async e=>{if(!em)try{var r,s,l,n,o,d;if(eg(!0),V(e=>({...e,reviews:null})),!Array.isArray(e)){V(e=>({...e,reviews:"유효하지 않은 리뷰 데이터 형식입니다."})),eg(!1);return}let c=p.default.get("token")||localStorage.getItem("token"),m={};if((null==a?void 0:null===(r=a.user)||void 0===r?void 0:r.role)==="admin");else if(c)m.Authorization="Bearer ".concat(c);else{V(e=>({...e,reviews:"인증 정보가 없습니다. 다시 로그인해 주세요."})),eg(!1);return}try{let a=await i.default.post("/api/tvfilm/admin/reviews",{tvfilmId:t,reviews:e},{headers:m,timeout:3e4});if(!0===a.data.success){if(N.toast.success("리뷰가 성공적으로 저장되었습니다."),a.data.data&&a.data.data.errors>0){let e="".concat(a.data.data.errors,"개 리뷰에 오류가 있어 처리되지 않았습니다."),t=a.data.data.errorDetails&&a.data.data.errorDetails.length>0?"\n문제: ".concat(a.data.data.errorDetails.slice(0,3).join(", ")).concat(a.data.data.errorDetails.length>3?" 외 여러 문제":""):"";V(a=>({...a,reviews:e+t}))}else V(e=>({...e,reviews:null}));ex(JSON.parse(JSON.stringify(e))),eb(!1)}else throw Error(a.data.message||"리뷰 저장에 실패했습니다.")}catch(a){N.toast.error("리뷰 저장 중 오류가 발생했습니다.");let e=(null===(l=a.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)||a.message||"리뷰 저장 중 오류가 발생했습니다.",t=null===(d=a.response)||void 0===d?void 0:null===(o=d.data)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.errorDetails;t&&Array.isArray(t)?V(a=>({...a,reviews:"".concat(e,"\n문제: ").concat(t.slice(0,3).join(", ")).concat(t.length>3?" 외 여러 문제":"")})):V(t=>({...t,reviews:e}))}}catch(e){N.toast.error("처리 중 오류가 발생했습니다."),V(t=>({...t,reviews:"예상치 못한 오류가 발생했습니다: "+e.message}))}finally{eg(!1)}},eI=(e,t)=>!(Array.isArray(e)&&Array.isArray(t))||e.length!==t.length||JSON.stringify(e)!==JSON.stringify(t);return"loading"!==o&&ei?K?(0,r.jsx)(l.default,{children:(0,r.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,r.jsx)(c.default,{className:"animate-spin mr-2"}),(0,r.jsx)("span",{children:"제출 중..."})]})}):(0,r.jsx)(l.default,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Edit TV/Film"}),(0,r.jsx)("div",{className:"flex space-x-2",children:(0,r.jsx)("button",{type:"button",onClick:()=>{D(!S)},className:"flex items-center px-4 py-2 rounded-md transition ".concat(S?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:S?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.default,{className:"w-4 h-4 mr-1"}),"Edit Mode"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.default,{className:"w-4 h-4 mr-1"}),"Preview"]})})})]}),ed&&(0,r.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:ed}),z.general&&(0,r.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert",children:(0,r.jsx)("p",{children:z.general})}),(0,r.jsxs)("form",{onSubmit:ew,className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsx)("div",{className:"mb-6 border-b border-gray-200 pb-1 overflow-x-auto hide-scrollbar",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-6",children:[(0,r.jsx)("button",{type:"button",onClick:()=>O("basic"),className:"pb-3 px-1 font-medium text-sm ".concat("basic"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"기본 정보"}),(0,r.jsx)("button",{type:"button",onClick:()=>O("media"),className:"pb-3 px-1 font-medium text-sm ".concat("media"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"이미지"}),(0,r.jsx)("button",{type:"button",onClick:()=>O("cast"),className:"pb-3 px-1 font-medium text-sm ".concat("cast"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"출연진"}),(0,r.jsx)("button",{type:"button",onClick:()=>O("providers"),className:"pb-3 px-1 font-medium text-sm ".concat("providers"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"시청 정보"}),(0,r.jsx)("button",{type:"button",onClick:()=>O("videos"),className:"pb-3 px-1 font-medium text-sm ".concat("videos"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"트레일러 및 비디오"}),(0,r.jsx)("button",{type:"button",onClick:()=>O("info"),className:"pb-3 px-1 font-medium text-sm ".concat("info"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"정보"}),(0,r.jsx)("button",{type:"button",onClick:()=>O("reviews"),className:"pb-3 px-1 font-medium text-sm ".concat("reviews"===P?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"리뷰"})]})}),"basic"===P&&(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"title",children:["Title ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",id:"title",name:"title",value:U.title,onChange:ey,className:"w-full px-3 py-2 border rounded-md ".concat(z.title?"border-red-500":"border-gray-300"),placeholder:"Enter TV/Film title",disabled:S}),z.title&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.title})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"category",children:["Category ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{id:"category",name:"category",value:U.category,onChange:ey,className:"w-full px-3 py-2 border rounded-md ".concat(z.category?"border-red-500":"border-gray-300"),disabled:S,children:[(0,r.jsx)("option",{value:"",children:"Select a category"}),(0,r.jsx)("option",{value:"K-Drama",children:"K-Drama"}),(0,r.jsx)("option",{value:"Movie",children:"Movie"}),(0,r.jsx)("option",{value:"Documentary",children:"Documentary"}),(0,r.jsx)("option",{value:"Animation",children:"Animation"}),(0,r.jsx)("option",{value:"Reality Show",children:"Reality Show"}),(0,r.jsx)("option",{value:"Web Series",children:"Web Series"}),(0,r.jsx)("option",{value:"Other",children:"Other"})]}),z.category&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.category})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"genres",children:"Genres"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:U.genres.length>0?U.genres.map((e,t)=>(0,r.jsxs)("div",{className:"bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full flex items-center text-sm",children:[(0,r.jsx)("span",{children:e}),(0,r.jsx)("button",{type:"button",onClick:()=>ek(t),className:"ml-2 text-indigo-500 hover:text-indigo-700",children:(0,r.jsx)(u.default,{className:"w-3 h-3"})})]},t)):(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"No genres selected"})}),!S&&(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2",children:["Romance","Thriller","Comedy","Action","Fantasy","Historical","Medical","Crime","Melodrama","Mystery"].map(e=>(0,r.jsx)("button",{type:"button",className:"px-3 py-2 text-sm rounded-md transition-colors ".concat(U.genres.includes(e)?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>{let t=[...U.genres];if(t.includes(e)){let a=t.indexOf(e);t.splice(a,1)}else t.push(e);E(e=>({...e,genres:t}))},children:e},e))})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"originalTitle",children:"Original Title"}),(0,r.jsx)("input",{type:"text",id:"originalTitle",name:"originalTitle",value:U.originalTitle,onChange:ey,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Enter original title (if different from main title)",disabled:S})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"summary",children:["Summary ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{id:"summary",name:"summary",value:U.summary,onChange:ey,rows:"3",className:"w-full px-3 py-2 border rounded-md ".concat(z.summary?"border-red-500":"border-gray-300"),placeholder:"Enter a brief summary",disabled:S}),z.summary&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.summary})]})]}),"media"===P&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:["Cover Image ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"border-dashed border-2 border-gray-300 p-6 rounded-md mb-3 bg-gray-50 text-center",children:[H?(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)("img",{src:H,alt:"Cover Preview",className:"max-h-48 mx-auto object-contain",onError:e=>{e.target.onerror=null,e.target.src="/images/placeholder-tvfilm.svg"}}),!S&&(0,r.jsx)("button",{type:"button",onClick:()=>{E(e=>({...e,coverImage:null})),Q(null)},className:"absolute top-0 right-0 bg-red-500 rounded-full p-1 text-white hover:bg-red-600",children:(0,r.jsx)(u.default,{className:"w-4 h-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center items-center mb-3",children:(0,r.jsx)(x.default,{className:"w-12 h-12 text-gray-300"})}),(0,r.jsx)("p",{className:"text-gray-500 mb-3",children:"Drag and drop your cover image here, or click to browse"})]}),!S&&(0,r.jsxs)("div",{className:"flex justify-center ".concat(H?"mt-3":""),onDragOver:e=>{e.preventDefault(),k(!0)},onDragLeave:e=>{e.preventDefault(),k(!1)},onDrop:e=>{e.preventDefault(),k(!1),ej(e.dataTransfer.files[0])},children:[(0,r.jsx)("label",{htmlFor:"coverImage",className:"cursor-pointer bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:H?"Change Cover Image":"Select Image"}),(0,r.jsx)("input",{id:"coverImage",type:"file",accept:"image/*",onChange:e=>{ej(e.target.files[0])},className:"hidden",ref:ep})]})]}),!S&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Or enter image URL:"}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"text",value:$,onChange:e=>{ee(e.target.value),es("")},placeholder:"https://example.com/image.jpg",className:"flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("button",{type:"button",onClick:ef,className:"bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600",children:"Use URL"})]})]}),z.coverImage&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.coverImage}),er&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:er}),(0,r.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"This image will be used as the thumbnail in listings and on the detail page. Recommended ratio: 2:3, min size: 500x750px"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Banner Image (메인 배경 이미지)"}),(0,r.jsxs)("div",{className:"border-dashed border-2 border-gray-300 p-6 rounded-md mb-3 bg-gray-50 text-center",children:[Y?(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)("img",{src:Y,alt:"Banner Preview",className:"max-h-48 w-full mx-auto object-cover",onError:e=>{e.target.onerror=null,e.target.src="/images/placeholder-banner.svg"}}),!S&&(0,r.jsx)("button",{type:"button",onClick:()=>{E(e=>({...e,bannerImage:null})),Z(null)},className:"absolute top-0 right-0 bg-red-500 rounded-full p-1 text-white hover:bg-red-600",children:(0,r.jsx)(u.default,{className:"w-4 h-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center items-center mb-3",children:(0,r.jsx)(x.default,{className:"w-12 h-12 text-gray-300"})}),(0,r.jsx)("p",{className:"text-gray-500 mb-3",children:"Drag and drop your banner image here, or click to browse"})]}),!S&&(0,r.jsxs)("div",{className:"flex justify-center ".concat(Y?"mt-3":""),onDragOver:e=>{e.preventDefault(),I(!0)},onDragLeave:e=>{e.preventDefault(),I(!1)},onDrop:e=>{e.preventDefault(),I(!1),eN(e.dataTransfer.files[0])},children:[(0,r.jsx)("label",{htmlFor:"bannerImage",className:"cursor-pointer bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:Y?"Change Banner Image":"Select Image"}),(0,r.jsx)("input",{id:"bannerImage",type:"file",accept:"image/*",onChange:e=>{eN(e.target.files[0])},className:"hidden",ref:ev})]})]}),!S&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Or enter image URL:"}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"text",value:et,onChange:e=>ea(e.target.value),placeholder:"https://example.com/banner.jpg",className:"flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("button",{type:"button",onClick:()=>{if(et)try{if(!/^(https?:\/\/)/i.test(et)){en("Please enter a valid URL starting with http:// or https://");return}let e="/api/proxy?url=".concat(encodeURIComponent(et));E(e=>({...e,bannerImage:et})),Z(e),ea(""),en("")}catch(e){en("Failed to load image from URL")}},className:"bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600",children:"Use URL"})]})]}),el&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:el}),(0,r.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"This image will be used as the background banner on the detail page. Recommended ratio: 16:9, min size: 1920x1080px"})]})]}),"cast"===P&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Cast"}),(0,r.jsx)(v.default,{value:U.cast,onChange:e=>E(t=>({...t,cast:e})),disabled:S})]})}),"providers"===P&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Watch Providers"}),(0,r.jsx)(y.default,{value:U.watchProviders,onChange:e=>E(t=>({...t,watchProviders:e})),disabled:S})]})}),"videos"===P&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Videos"}),(0,r.jsx)(f.default,{videos:U.videos,onChange:e=>E(t=>({...t,videos:e})),readOnly:S})]})}),"info"===P&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Director"}),(0,r.jsx)("input",{type:"text",name:"director",value:U.director,onChange:ey,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Director's name",disabled:S})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Runtime"}),(0,r.jsx)("input",{type:"text",name:"runtime",value:U.runtime,onChange:ey,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g., 2시간 30분",disabled:S})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Release Date"}),(0,r.jsx)("input",{type:"date",name:"releaseDate",value:U.releaseDate,onChange:ey,className:"w-full px-3 py-2 border border-gray-300 rounded-md",disabled:S})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Rating"}),(0,r.jsx)("input",{type:"number",name:"rating",value:U.rating,onChange:ey,min:"0",max:"10",step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"0-10",disabled:S})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Country"}),(0,r.jsx)("input",{type:"text",name:"country",value:U.country,onChange:ey,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g., South Korea",disabled:S})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Age Rating"}),(0,r.jsxs)("select",{name:"ageRating",value:U.ageRating,onChange:ey,className:"w-full px-3 py-2 border border-gray-300 rounded-md",disabled:S,children:[(0,r.jsx)("option",{value:"",children:"Select age rating"}),(0,r.jsx)("option",{value:"ALL",children:"ALL"}),(0,r.jsx)("option",{value:"12",children:"12"}),(0,r.jsx)("option",{value:"15",children:"15"}),(0,r.jsx)("option",{value:"18",children:"18"}),(0,r.jsx)("option",{value:"R",children:"R"})]})]})]})]}),"reviews"===P&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"이 콘텐츠에 대한 사용자 리뷰를 수정할 수 있습니다. 수정된 리뷰는 콘텐츠 상세 페이지에 표시됩니다."}),(0,r.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(h.default,{className:"h-5 w-5 text-yellow-400"})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:"추가한 리뷰는 콘텐츠가 등록된 이후에 API를 통해 관리할 수 있습니다."})})]})}),z.reviews&&(0,r.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-red-700",children:z.reviews})})})}),(0,r.jsxs)("div",{className:"p-5 bg-white rounded-lg shadow space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-pink-600",children:"사용자 리뷰"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[z.reviews&&(0,r.jsx)("button",{type:"button",onClick:()=>{let e=U.reviews||[];if(!Array.isArray(e)){N.toast.error("리뷰 목록 형식이 올바르지 않습니다");return}let t=e.map((e,t)=>{let a=[];e.title&&"string"==typeof e.title&&""!==e.title.trim()||a.push("제목 누락"),e.content&&"string"==typeof e.content&&""!==e.content.trim()||a.push("내용 누락"),e.authorName&&"string"==typeof e.authorName&&""!==e.authorName.trim()||a.push("작성자 누락");let r=parseInt(e.rating,10);return(isNaN(r)||r<1||r>10)&&a.push("별점 오류"),e.tags&&!Array.isArray(e.tags)&&a.push("태그 형식 오류"),a.length>0?{index:t,review:e,issues:a}:null}).filter(Boolean);if(t.length>0){N.toast.error("".concat(t.length,"개 리뷰에 문제가 있습니다. 수정이 필요합니다."));let e=t.map(e=>"리뷰 #".concat(e.index+1," (").concat(e.review.title||"제목 없음","): ").concat(e.issues.join(", "))).join("\n");V(t=>({...t,reviews:"".concat(t.reviews||"","\n\n문제가 있는 리뷰 상세:\n").concat(e)}))}else N.toast.info("모든 리뷰가 기본 유효성 검사를 통과했습니다. 다른 문제가 있을 수 있습니다.")},className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"진단하기"}),(0,r.jsx)("button",{type:"button",onClick:()=>{eC(U.reviews)},disabled:em||K||W||!eh,className:"px-4 py-2 rounded ".concat(em||K||W?"bg-gray-300 cursor-not-allowed":eh?"bg-green-500 hover:bg-green-600":"bg-gray-200 cursor-default"," text-white flex items-center"),children:em?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.default,{className:"animate-spin w-4 h-4 mr-2"}),"저장 중..."]}):eh?"리뷰 저장":"저장됨"})]})]}),(0,r.jsx)(j.default,{reviews:U.reviews,onChange:e=>{if(!Array.isArray(e))return;eb(eI(e,eu));let t=0,a=[0,0,0,0,0,0,0,0,0,0];e.forEach(e=>{let r=parseInt(e.rating,10);!isNaN(r)&&r>=1&&r<=10&&(t+=r,a[Math.min(Math.max(Math.floor(r)-1,0),9)]++)});let r=e.length>0?t/e.length:0;E(t=>({...t,reviews:e,reviewRating:parseFloat(r.toFixed(1)),reviewCount:e.length,ratingDistribution:a}))},tvfilmId:t}),eh&&(0,r.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 mt-2",children:(0,r.jsx)("p",{className:"text-sm text-blue-700",children:"리뷰에 변경사항이 있습니다. '리뷰 저장' 버튼을 클릭하여 변경사항을 저장하세요."})}),!eh&&eu.length>0&&(0,r.jsx)("div",{className:"bg-green-50 border-l-4 border-green-400 p-3 mt-2",children:(0,r.jsx)("p",{className:"text-sm text-green-700",children:"모든 리뷰 변경사항이 저장되었습니다."})})]})]})}),(0,r.jsxs)("div",{className:"flex justify-end mt-8 pt-4 border-t border-gray-200",children:[(0,r.jsx)("button",{type:"button",onClick:()=>e.push("/admin/tvfilm"),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md mr-2 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:W||K||S||em,className:"px-6 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition-colors flex items-center ".concat(W||K||S||em?"opacity-50 cursor-not-allowed":""),children:W||K?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.default,{className:"animate-spin w-4 h-4 mr-2"}),"저장 중..."]}):"Save Changes"})]})]})]})}):(0,r.jsx)(l.default,{children:(0,r.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,r.jsx)(c.default,{className:"animate-spin mr-2"}),(0,r.jsx)("span",{children:"인증 확인 중..."})]})})}}},function(e){e.O(0,[1664,5089,1876,7066,8766,7888,9222,2888,9774,179],function(){return e(e.s=40780)}),_N_E=e.O()}]);