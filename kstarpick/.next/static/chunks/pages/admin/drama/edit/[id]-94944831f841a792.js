(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6122],{50748:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/drama/edit/[id]",function(){return a(91637)}])},91637:function(e,t,a){"use strict";a.r(t);var r=a(85893),s=a(67294),n=a(2575),l=a(11163),i=a(87066),o=a(5152),d=a.n(o);a(25675);var c=a(82606),m=a(43832),g=a(15928),u=a(62190),x=a(43283),h=a(71707),b=a(33299),p=a(31955),v=a(74128),y=a(62076),f=a(65972),j=a(79731),N=a(86501);d()(()=>Promise.all([a.e(9414),a.e(4966)]).then(a.bind(a,14966)),{loadableGenerated:{webpack:()=>[14966]},ssr:!1}),t.default=function(){let e=(0,l.useRouter)(),{id:t}=e.query,{data:a,status:o}=(0,b.useSession)(),[d,w]=(0,s.useState)(!1),[k,I]=(0,s.useState)(!1),[C,D]=(0,s.useState)(!1),[S,R]=(0,s.useState)(""),[A,F]=(0,s.useState)(""),[T,U]=(0,s.useState)("basic"),[P,E]=(0,s.useState)({title:"",originalTitle:"",category:"drama",coverImage:null,bannerImage:null,summary:"",network:"",status:"Ongoing",releaseDate:"",rating:"",runtime:"",ageRating:"",director:"",country:"",tags:[],trailerUrl:"",cast:[],watchProviders:[],videos:[],genres:[],productionCountry:"",content:"",reviews:[],reviewRating:0,reviewCount:0,ratingDistribution:[0,0,0,0,0,0,0,0,0,0]}),[L,O]=(0,s.useState)(""),[_,M]=(0,s.useState)(""),[z,B]=(0,s.useState)({}),[W,J]=(0,s.useState)(!1),[K,q]=(0,s.useState)(!1),[G,X]=(0,s.useState)(""),[H,V]=(0,s.useState)(null),[Q,Y]=(0,s.useState)(null),[Z,$]=(0,s.useState)(""),[ee,et]=(0,s.useState)(""),[ea,er]=(0,s.useState)(""),[es,en]=(0,s.useState)(""),[el,ei]=(0,s.useState)(!1),[eo,ed]=(0,s.useState)(""),[ec,em]=(0,s.useState)(!1),[eg,eu]=(0,s.useState)([]),[ex,eh]=(0,s.useState)(!1),[eb,ep]=(0,s.useState)(null),ev=(0,s.useRef)(null),ey=(0,s.useRef)(null);(0,s.useRef)(null),(0,s.useEffect)(()=>{(async()=>{try{var t;if("loading"===o)return;if((null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.role)==="admin"){ei(!0);return}let r=p.default.get("token")||localStorage.getItem("token");if(!r){e.push("/admin/login");return}try{(await i.default.get("/api/auth/check-admin",{headers:{Authorization:"Bearer ".concat(r)},withCredentials:!0})).data.isAdmin?(p.default.get("token")||p.default.set("token",r,{expires:7}),ei(!0)):(p.default.remove("token"),localStorage.removeItem("token"),e.push("/admin/login"))}catch(t){p.default.remove("token"),localStorage.removeItem("token"),e.push("/admin/login")}}catch(t){e.push("/admin/login")}})()},[e,a,o]),(0,s.useEffect)(()=>{t&&el&&(async()=>{try{q(!0),B({});try{let e=await i.default.get("/api/tvfilm/".concat(t));if(e.data.success){let t=e.data.data;O(t.coverImage||""),M(t.bannerImage||""),E({title:t.title||"",originalTitle:t.originalTitle||"",category:"drama"===t.category?"k-drama":t.category||"k-drama",coverImage:t.coverImage||null,bannerImage:t.bannerImage||null,summary:t.summary||"",content:t.content||"",network:t.network||"",status:t.status||"ongoing",releaseDate:t.releaseDate?new Date(t.releaseDate).toISOString().split("T")[0]:"",rating:t.rating||"",runtime:t.runtime||"",ageRating:t.ageRating||"",director:t.director||"",country:t.country||"",tags:t.tags||[],trailerUrl:t.trailerUrl||"",cast:t.cast||[],watchProviders:t.watchProviders||[],videos:t.videos||[],genres:t.genres||[],reviews:t.reviews||[],reviewRating:t.reviewRating||0,reviewCount:t.reviewCount||0,ratingDistribution:t.ratingDistribution||[0,0,0,0,0,0,0,0,0,0],_id:t._id,slug:t.slug,source:"tvfilm"}),t.coverImage&&(t.coverImage.startsWith("http")?V("/api/proxy?url=".concat(encodeURIComponent(t.coverImage))):V(t.coverImage)),t.bannerImage&&(t.bannerImage.startsWith("http")?Y("/api/proxy?url=".concat(encodeURIComponent(t.bannerImage))):Y(t.bannerImage)),eu(t.reviews||[]),q(!1);return}}catch(e){}try{let e=localStorage.getItem("token")||localStorage.getItem("adminToken"),a=await i.default.get("/api/dramas/".concat(t),{headers:{Authorization:e?"Bearer ".concat(e):""}});if(a.data.success){let e=a.data.data;if(E({_id:e._id,title:e.title||"",originalTitle:e.originalTitle||"",category:"k-drama",coverImage:e.poster||e.coverImage||null,bannerImage:e.bannerImage||null,summary:e.description||"",content:e.content||e.description||"",network:Array.isArray(e.network)?e.network.join(", "):e.network||"",status:"Airing"===e.status?"ongoing":"Completed"===e.status?"completed":"Upcoming"===e.status?"upcoming":"ongoing",releaseDate:e.airDate||e.releaseDate?new Date(e.airDate||e.releaseDate).toISOString().split("T")[0]:"",rating:e.rating||"",runtime:e.runtime||"",director:e.director||"",country:e.country||"",tags:e.tags||[],cast:Array.isArray(e.cast)?e.cast:[],genres:Array.isArray(e.genre)?e.genre:[],watchProviders:[],videos:[],reviews:e.reviews||[],reviewRating:0,reviewCount:0,ratingDistribution:[0,0,0,0,0,0,0,0,0,0],slug:e.slug||"",source:"drama"}),e.coverImage||e.poster){let t=e.coverImage||e.poster;t.startsWith("http")?V("/api/proxy?url=".concat(encodeURIComponent(t))):V(t)}e.bannerImage&&(e.bannerImage.startsWith("http")?Y("/api/proxy?url=".concat(encodeURIComponent(e.bannerImage))):Y(e.bannerImage)),eu(e.reviews||[]),q(!1);return}}catch(e){}B({general:"드라마를 찾을 수 없습니다. ID나 slug를 확인해주세요."}),q(!1)}catch(a){let t="드라마 정보를 불러오는 중 오류가 발생했습니다";if(a.response){var e;t="".concat(t,": ").concat((null===(e=a.response.data)||void 0===e?void 0:e.message)||a.message||"알 수 없는 오류")}else t=a.request?"서버 응답이 없습니다. 네트워크 연결을 확인하세요.":"요청 설정 중 오류가 발생했습니다: ".concat(a.message);B({general:t}),q(!1)}})()},[t,el]);let ef=e=>{let{name:t,value:a}=e.target;E(e=>({...e,[t]:a})),z[t]&&B(e=>({...e,[t]:null}))},ej=async()=>{if(Z)try{if(er(""),!/^(https?:\/\/)/i.test(Z)){er("Please enter a valid URL starting with http:// or https://");return}let e="/api/proxy?url=".concat(encodeURIComponent(Z));V(e),E(e=>({...e,coverImage:Z})),$("")}catch(e){er("Failed to load image from URL")}},eN=e=>{if(e){if(e.type.startsWith("image/")){if(e.size>5242880){er("Image file size must be less than 5MB");return}E({...P,coverImage:e}),er("");let t=new FileReader;t.onloadend=()=>{V(t.result)},t.readAsDataURL(e)}else er("Please upload an image file")}},ew=e=>{if(e){if(e.type.startsWith("image/")){if(e.size>5242880){en("Image file size must be less than 5MB");return}E({...P,bannerImage:e}),en("");let t=new FileReader;t.onloadend=()=>{Y(t.result)},t.readAsDataURL(e)}else en("Please upload an image file")}},ek=async a=>{a.preventDefault(),J(!0);try{let a=["title","summary","category"].filter(e=>!P[e]);if(a.length>0){let e={};a.forEach(t=>{e[t]="".concat(t.charAt(0).toUpperCase()+t.slice(1),"은(는) 필수 항목입니다")}),B(e),J(!1);return}let r={...P};if(P.coverImage instanceof File){let e=new FormData;e.append("file",P.coverImage);let t=await i.default.post("/api/upload",e);if(t.data.success)r.coverImage=t.data.filePath;else throw Error("커버 이미지 업로드에 실패했습니다")}if(P.bannerImage instanceof File){let e=new FormData;e.append("file",P.bannerImage);let t=await i.default.post("/api/upload",e);if(t.data.success)r.bannerImage=t.data.filePath;else throw Error("배너 이미지 업로드에 실패했습니다")}let s={title:r.title,originalTitle:r.originalTitle||r.title,summary:r.summary,content:r.content||r.summary,coverImage:r.coverImage,bannerImage:r.bannerImage,category:"drama"===r.category.toLowerCase()?"k-drama":r.category.toLowerCase(),status:r.status.toLowerCase(),network:r.network,releaseDate:r.releaseDate||new Date().toISOString(),rating:parseFloat(r.rating)||0,runtime:r.runtime,ageRating:r.ageRating,director:r.director,country:r.country,tags:r.tags,genres:r.genres,cast:r.cast,watchProviders:r.watchProviders,videos:r.videos,reviews:r.reviews,reviewRating:r.reviewRating,reviewCount:r.reviewCount,ratingDistribution:r.ratingDistribution},n="";"drama"===P.source?(n="/api/dramas/".concat(t),s.description=s.summary,s.poster=s.coverImage,"ongoing"===s.status?s.status="Airing":"completed"===s.status?s.status="Completed":"upcoming"===s.status&&(s.status="Upcoming")):n="/api/tvfilm/".concat(t);let l=await i.default.put(n,s);if(l.data.success)ed("드라마가 성공적으로 업데이트되었습니다."),setTimeout(()=>{e.push("/admin/drama")},1500);else throw Error(l.data.message||"드라마 업데이트에 실패했습니다")}catch(e){B({general:e.message||"예기치 않은 오류가 발생했습니다"})}finally{J(!1)}},eI=e=>{E(t=>({...t,genres:t.genres.filter((t,a)=>a!==e)}))},eC=async e=>{if(!ec)try{var r,s,n,l,o,d;if(em(!0),B(e=>({...e,reviews:null})),!Array.isArray(e)){B(e=>({...e,reviews:"유효하지 않은 리뷰 데이터 형식입니다."})),em(!1);return}let c=p.default.get("token")||localStorage.getItem("token"),m={};if((null==a?void 0:null===(r=a.user)||void 0===r?void 0:r.role)==="admin");else if(c)m.Authorization="Bearer ".concat(c);else{B(e=>({...e,reviews:"인증 정보가 없습니다. 다시 로그인해 주세요."})),em(!1);return}try{let a=await i.default.post("/api/tvfilm/admin/reviews",{dramaId:t,reviews:e},{headers:m,timeout:3e4});if(!0===a.data.success){if(N.toast.success("리뷰가 성공적으로 저장되었습니다."),a.data.data&&a.data.data.errors>0){let e="".concat(a.data.data.errors,"개 리뷰에 오류가 있어 처리되지 않았습니다."),t=a.data.data.errorDetails&&a.data.data.errorDetails.length>0?"\n문제: ".concat(a.data.data.errorDetails.slice(0,3).join(", ")).concat(a.data.data.errorDetails.length>3?" 외 여러 문제":""):"";B(a=>({...a,reviews:e+t}))}else B(e=>({...e,reviews:null}));eu(JSON.parse(JSON.stringify(e))),eh(!1)}else throw Error(a.data.message||"리뷰 저장에 실패했습니다.")}catch(a){N.toast.error("리뷰 저장 중 오류가 발생했습니다.");let e=(null===(n=a.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||a.message||"리뷰 저장 중 오류가 발생했습니다.",t=null===(d=a.response)||void 0===d?void 0:null===(o=d.data)||void 0===o?void 0:null===(l=o.data)||void 0===l?void 0:l.errorDetails;t&&Array.isArray(t)?B(a=>({...a,reviews:"".concat(e,"\n문제: ").concat(t.slice(0,3).join(", ")).concat(t.length>3?" 외 여러 문제":"")})):B(t=>({...t,reviews:e}))}}catch(e){N.toast.error("처리 중 오류가 발생했습니다."),B(t=>({...t,reviews:"예상치 못한 오류가 발생했습니다: "+e.message}))}finally{em(!1)}},eD=(e,t)=>!(Array.isArray(e)&&Array.isArray(t))||e.length!==t.length||JSON.stringify(e)!==JSON.stringify(t);return"loading"!==o&&el?K?(0,r.jsx)(n.default,{children:(0,r.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,r.jsx)(c.default,{className:"animate-spin mr-2"}),(0,r.jsx)("span",{children:"제출 중..."})]})}):(0,r.jsx)(n.default,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Edit Drama"}),(0,r.jsx)("div",{className:"flex space-x-2",children:(0,r.jsx)("button",{type:"button",onClick:()=>{D(!C)},className:"flex items-center px-4 py-2 rounded-md transition ".concat(C?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.default,{className:"w-4 h-4 mr-1"}),"Edit Mode"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.default,{className:"w-4 h-4 mr-1"}),"Preview"]})})})]}),eo&&(0,r.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:eo}),z.general&&(0,r.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert",children:(0,r.jsx)("p",{children:z.general})}),(0,r.jsxs)("form",{onSubmit:ek,className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsx)("div",{className:"mb-6 border-b border-gray-200 pb-1 overflow-x-auto hide-scrollbar",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-6",children:[(0,r.jsx)("button",{type:"button",onClick:()=>U("basic"),className:"pb-3 px-1 font-medium text-sm ".concat("basic"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"기본 정보"}),(0,r.jsx)("button",{type:"button",onClick:()=>U("media"),className:"pb-3 px-1 font-medium text-sm ".concat("media"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"이미지"}),(0,r.jsx)("button",{type:"button",onClick:()=>U("cast"),className:"pb-3 px-1 font-medium text-sm ".concat("cast"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"출연진"}),(0,r.jsx)("button",{type:"button",onClick:()=>U("providers"),className:"pb-3 px-1 font-medium text-sm ".concat("providers"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"시청 정보"}),(0,r.jsx)("button",{type:"button",onClick:()=>U("videos"),className:"pb-3 px-1 font-medium text-sm ".concat("videos"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"트레일러 및 비디오"}),(0,r.jsx)("button",{type:"button",onClick:()=>U("info"),className:"pb-3 px-1 font-medium text-sm ".concat("info"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"정보"}),(0,r.jsx)("button",{type:"button",onClick:()=>U("reviews"),className:"pb-3 px-1 font-medium text-sm ".concat("reviews"===T?"border-b-2 border-pink-500 text-pink-600":"text-gray-500 hover:text-gray-700 hover:border-b-2 hover:border-gray-300"),children:"리뷰"})]})}),"basic"===T&&(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"title",children:["Title ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",id:"title",name:"title",value:P.title,onChange:ef,className:"w-full px-3 py-2 border rounded-md ".concat(z.title?"border-red-500":"border-gray-300"),placeholder:"Enter Drama title",disabled:C}),z.title&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.title})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"category",children:["Category ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{id:"category",name:"category",value:P.category,onChange:ef,className:"w-full px-3 py-2 border rounded-md ".concat(z.category?"border-red-500":"border-gray-300"),disabled:C,children:[(0,r.jsx)("option",{value:"",children:"Select a category"}),(0,r.jsx)("option",{value:"K-Drama",children:"K-Drama"}),(0,r.jsx)("option",{value:"Movie",children:"Movie"}),(0,r.jsx)("option",{value:"Documentary",children:"Documentary"}),(0,r.jsx)("option",{value:"Animation",children:"Animation"}),(0,r.jsx)("option",{value:"Reality Show",children:"Reality Show"}),(0,r.jsx)("option",{value:"Web Series",children:"Web Series"}),(0,r.jsx)("option",{value:"Other",children:"Other"})]}),z.category&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.category})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"genres",children:"Genres"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:P.genres.length>0?P.genres.map((e,t)=>(0,r.jsxs)("div",{className:"bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full flex items-center text-sm",children:[(0,r.jsx)("span",{children:e}),(0,r.jsx)("button",{type:"button",onClick:()=>eI(t),className:"ml-2 text-indigo-500 hover:text-indigo-700",children:(0,r.jsx)(u.default,{className:"w-3 h-3"})})]},t)):(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"No genres selected"})}),!C&&(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2",children:["Romance","Thriller","Comedy","Action","Fantasy","Historical","Medical","Crime","Melodrama","Mystery"].map(e=>(0,r.jsx)("button",{type:"button",className:"px-3 py-2 text-sm rounded-md transition-colors ".concat(P.genres.includes(e)?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>{let t=[...P.genres];if(t.includes(e)){let a=t.indexOf(e);t.splice(a,1)}else t.push(e);E(e=>({...e,genres:t}))},children:e},e))})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"originalTitle",children:"Original Title"}),(0,r.jsx)("input",{type:"text",id:"originalTitle",name:"originalTitle",value:P.originalTitle,onChange:ef,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Enter original title (if different from main title)",disabled:C})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"summary",children:["Summary ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{id:"summary",name:"summary",value:P.summary,onChange:ef,rows:"3",className:"w-full px-3 py-2 border rounded-md ".concat(z.summary?"border-red-500":"border-gray-300"),placeholder:"Enter a brief summary",disabled:C}),z.summary&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.summary})]})]}),"media"===T&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:["Cover Image ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"border-dashed border-2 border-gray-300 p-6 rounded-md mb-3 bg-gray-50 text-center",children:[H?(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)("img",{src:H,alt:"Cover Preview",className:"max-h-48 mx-auto object-contain",onError:e=>{e.target.onerror=null,e.target.src="/images/placeholder-tvfilm.svg"}}),!C&&(0,r.jsx)("button",{type:"button",onClick:()=>{E(e=>({...e,coverImage:null})),V(null)},className:"absolute top-0 right-0 bg-red-500 rounded-full p-1 text-white hover:bg-red-600",children:(0,r.jsx)(u.default,{className:"w-4 h-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center items-center mb-3",children:(0,r.jsx)(x.default,{className:"w-12 h-12 text-gray-300"})}),(0,r.jsx)("p",{className:"text-gray-500 mb-3",children:"Drag and drop your cover image here, or click to browse"})]}),!C&&(0,r.jsxs)("div",{className:"flex justify-center ".concat(H?"mt-3":""),onDragOver:e=>{e.preventDefault(),w(!0)},onDragLeave:e=>{e.preventDefault(),w(!1)},onDrop:e=>{e.preventDefault(),w(!1),eN(e.dataTransfer.files[0])},children:[(0,r.jsx)("label",{htmlFor:"coverImage",className:"cursor-pointer bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:H?"Change Cover Image":"Select Image"}),(0,r.jsx)("input",{id:"coverImage",type:"file",accept:"image/*",onChange:e=>{eN(e.target.files[0])},className:"hidden",ref:ev})]})]}),!C&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Or enter image URL:"}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"text",value:Z,onChange:e=>{$(e.target.value),er("")},placeholder:"https://example.com/image.jpg",className:"flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("button",{type:"button",onClick:ej,className:"bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600",children:"Use URL"})]})]}),z.coverImage&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:z.coverImage}),ea&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:ea}),(0,r.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"This image will be used as the thumbnail in listings and on the detail page. Recommended ratio: 2:3, min size: 500x750px"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Banner Image (메인 배경 이미지)"}),(0,r.jsxs)("div",{className:"border-dashed border-2 border-gray-300 p-6 rounded-md mb-3 bg-gray-50 text-center",children:[Q?(0,r.jsxs)("div",{className:"relative mb-4",children:[(0,r.jsx)("img",{src:Q,alt:"Banner Preview",className:"max-h-48 w-full mx-auto object-cover",onError:e=>{e.target.onerror=null,e.target.src="/images/placeholder-banner.svg"}}),!C&&(0,r.jsx)("button",{type:"button",onClick:()=>{E(e=>({...e,bannerImage:null})),Y(null)},className:"absolute top-0 right-0 bg-red-500 rounded-full p-1 text-white hover:bg-red-600",children:(0,r.jsx)(u.default,{className:"w-4 h-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center items-center mb-3",children:(0,r.jsx)(x.default,{className:"w-12 h-12 text-gray-300"})}),(0,r.jsx)("p",{className:"text-gray-500 mb-3",children:"Drag and drop your banner image here, or click to browse"})]}),!C&&(0,r.jsxs)("div",{className:"flex justify-center ".concat(Q?"mt-3":""),onDragOver:e=>{e.preventDefault(),I(!0)},onDragLeave:e=>{e.preventDefault(),I(!1)},onDrop:e=>{e.preventDefault(),I(!1),ew(e.dataTransfer.files[0])},children:[(0,r.jsx)("label",{htmlFor:"bannerImage",className:"cursor-pointer bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:Q?"Change Banner Image":"Select Image"}),(0,r.jsx)("input",{id:"bannerImage",type:"file",accept:"image/*",onChange:e=>{ew(e.target.files[0])},className:"hidden",ref:ey})]})]}),!C&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Or enter image URL:"}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"text",value:ee,onChange:e=>et(e.target.value),placeholder:"https://example.com/banner.jpg",className:"flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("button",{type:"button",onClick:()=>{if(ee)try{if(!/^(https?:\/\/)/i.test(ee)){en("Please enter a valid URL starting with http:// or https://");return}let e="/api/proxy?url=".concat(encodeURIComponent(ee));E(e=>({...e,bannerImage:ee})),Y(e),et(""),en("")}catch(e){en("Failed to load image from URL")}},className:"bg-blue-500 text-white px-4 py-2 rounded-r-md hover:bg-blue-600",children:"Use URL"})]})]}),es&&(0,r.jsx)("p",{className:"text-red-500 text-xs mt-1",children:es}),(0,r.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"This image will be used as the background banner on the detail page. Recommended ratio: 16:9, min size: 1920x1080px"})]})]}),"cast"===T&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Cast"}),(0,r.jsx)(v.default,{value:P.cast,onChange:e=>E(t=>({...t,cast:e})),disabled:C})]})}),"providers"===T&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Watch Providers"}),(0,r.jsx)(y.default,{value:P.watchProviders,onChange:e=>E(t=>({...t,watchProviders:e})),disabled:C})]})}),"videos"===T&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Videos"}),(0,r.jsx)(f.default,{videos:P.videos,onChange:e=>E(t=>({...t,videos:e})),readOnly:C})]})}),"info"===T&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Director"}),(0,r.jsx)("input",{type:"text",name:"director",value:P.director,onChange:ef,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Director's name",disabled:C})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Runtime"}),(0,r.jsx)("input",{type:"text",name:"runtime",value:P.runtime,onChange:ef,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g., 2시간 30분",disabled:C})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Release Date"}),(0,r.jsx)("input",{type:"date",name:"releaseDate",value:P.releaseDate,onChange:ef,className:"w-full px-3 py-2 border border-gray-300 rounded-md",disabled:C})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Rating"}),(0,r.jsx)("input",{type:"number",name:"rating",value:P.rating,onChange:ef,min:"0",max:"10",step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"0-10",disabled:C})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Country"}),(0,r.jsx)("input",{type:"text",name:"country",value:P.country,onChange:ef,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g., South Korea",disabled:C})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Age Rating"}),(0,r.jsxs)("select",{name:"ageRating",value:P.ageRating,onChange:ef,className:"w-full px-3 py-2 border border-gray-300 rounded-md",disabled:C,children:[(0,r.jsx)("option",{value:"",children:"Select age rating"}),(0,r.jsx)("option",{value:"ALL",children:"ALL"}),(0,r.jsx)("option",{value:"12",children:"12"}),(0,r.jsx)("option",{value:"15",children:"15"}),(0,r.jsx)("option",{value:"18",children:"18"}),(0,r.jsx)("option",{value:"R",children:"R"})]})]})]})]}),"reviews"===T&&(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"이 콘텐츠에 대한 사용자 리뷰를 수정할 수 있습니다. 수정된 리뷰는 콘텐츠 상세 페이지에 표시됩니다."}),(0,r.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(h.default,{className:"h-5 w-5 text-yellow-400"})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:"추가한 리뷰는 콘텐츠가 등록된 이후에 API를 통해 관리할 수 있습니다."})})]})}),z.reviews&&(0,r.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-red-700",children:z.reviews})})})}),(0,r.jsxs)("div",{className:"p-5 bg-white rounded-lg shadow space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-pink-600",children:"사용자 리뷰"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[z.reviews&&(0,r.jsx)("button",{type:"button",onClick:()=>{let e=P.reviews||[];if(!Array.isArray(e)){N.toast.error("리뷰 목록 형식이 올바르지 않습니다");return}let t=e.map((e,t)=>{let a=[];e.title&&"string"==typeof e.title&&""!==e.title.trim()||a.push("제목 누락"),e.content&&"string"==typeof e.content&&""!==e.content.trim()||a.push("내용 누락"),e.authorName&&"string"==typeof e.authorName&&""!==e.authorName.trim()||a.push("작성자 누락");let r=parseInt(e.rating,10);return(isNaN(r)||r<1||r>10)&&a.push("별점 오류"),e.tags&&!Array.isArray(e.tags)&&a.push("태그 형식 오류"),a.length>0?{index:t,review:e,issues:a}:null}).filter(Boolean);if(t.length>0){N.toast.error("".concat(t.length,"개 리뷰에 문제가 있습니다. 수정이 필요합니다."));let e=t.map(e=>"리뷰 #".concat(e.index+1," (").concat(e.review.title||"제목 없음","): ").concat(e.issues.join(", "))).join("\n");B(t=>({...t,reviews:"".concat(t.reviews||"","\n\n문제가 있는 리뷰 상세:\n").concat(e)}))}else N.toast.info("모든 리뷰가 기본 유효성 검사를 통과했습니다. 다른 문제가 있을 수 있습니다.")},className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"진단하기"}),(0,r.jsx)("button",{type:"button",onClick:()=>{eC(P.reviews)},disabled:ec||K||W||!ex,className:"px-4 py-2 rounded ".concat(ec||K||W?"bg-gray-300 cursor-not-allowed":ex?"bg-green-500 hover:bg-green-600":"bg-gray-200 cursor-default"," text-white flex items-center"),children:ec?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.default,{className:"animate-spin w-4 h-4 mr-2"}),"저장 중..."]}):ex?"리뷰 저장":"저장됨"})]})]}),(0,r.jsx)(j.default,{reviews:P.reviews,onChange:e=>{if(!Array.isArray(e))return;eh(eD(e,eg));let t=0,a=[0,0,0,0,0,0,0,0,0,0];e.forEach(e=>{let r=parseInt(e.rating,10);!isNaN(r)&&r>=1&&r<=10&&(t+=r,a[Math.min(Math.max(Math.floor(r)-1,0),9)]++)});let r=e.length>0?t/e.length:0;E(t=>({...t,reviews:e,reviewRating:parseFloat(r.toFixed(1)),reviewCount:e.length,ratingDistribution:a}))},tvfilmId:t,dramaId:t}),ex&&(0,r.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 mt-2",children:(0,r.jsx)("p",{className:"text-sm text-blue-700",children:"리뷰에 변경사항이 있습니다. '리뷰 저장' 버튼을 클릭하여 변경사항을 저장하세요."})}),!ex&&eg.length>0&&(0,r.jsx)("div",{className:"bg-green-50 border-l-4 border-green-400 p-3 mt-2",children:(0,r.jsx)("p",{className:"text-sm text-green-700",children:"모든 리뷰 변경사항이 저장되었습니다."})})]})]})}),(0,r.jsxs)("div",{className:"flex justify-end mt-8 pt-4 border-t border-gray-200",children:[(0,r.jsx)("button",{type:"button",onClick:()=>e.push("/admin/dramas"),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md mr-2 hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:W||K||C||ec,className:"px-6 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition-colors flex items-center ".concat(W||K||C||ec?"opacity-50 cursor-not-allowed":""),children:W||K?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.default,{className:"animate-spin w-4 h-4 mr-2"}),"저장 중..."]}):"Save Changes"})]})]})]})}):(0,r.jsx)(n.default,{children:(0,r.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,r.jsx)(c.default,{className:"animate-spin mr-2"}),(0,r.jsx)("span",{children:"인증 확인 중..."})]})})}}},function(e){e.O(0,[1664,5089,1876,7066,8766,8796,9222,2888,9774,179],function(){return e(e.s=50748)}),_N_E=e.O()}]);