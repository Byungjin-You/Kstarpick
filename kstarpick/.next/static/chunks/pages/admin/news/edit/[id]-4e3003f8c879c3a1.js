(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{88702:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/news/edit/[id]",function(){return a(74689)}])},2575:function(e,t,a){"use strict";a.r(t);var s=a(85893),r=a(67294),l=a(41664),n=a.n(l),i=a(11163),d=a(33299),c=a(43765),o=a(38361),m=a(2553),x=a(63594),u=a(2287),h=a(89176),g=a(55264),f=a(70095),b=a(77362),p=a(94086),y=a(70088),j=a(70775);t.default=e=>{let{children:t}=e,a=(0,i.useRouter)(),{data:l,status:N}=(0,d.useSession)(),[v,w]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{("unauthenticated"===N||l&&"admin"!==l.user.role)&&a.push("/admin/login")},[l,N,a]),"loading"===N)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,s.jsx)("div",{className:"p-8 bg-white rounded-lg shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-t-[#ff3e8e] rounded-full animate-spin"}),(0,s.jsx)("p",{className:"text-xl font-medium",children:"Loading admin panel..."})]})})}):"unauthenticated"===N||l&&"admin"!==l.user.role?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,s.jsx)("div",{className:"p-8 bg-white rounded-lg shadow-md max-w-md",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4 text-center",children:[(0,s.jsx)(c.default,{size:48,className:"text-red-500"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Unauthorized Access"}),(0,s.jsx)("p",{className:"text-gray-600",children:"You don't have permission to access the admin area."}),(0,s.jsx)(n(),{href:"/",className:"px-4 py-2 mt-4 text-white bg-[#ff3e8e] rounded-md hover:bg-[#e02e7c]",children:"Go to Homepage"})]})})}):(o.default,m.default,x.default,u.default,h.default,g.default,(0,s.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"w-64 min-h-screen bg-white shadow-md",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"관리자 패널"})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("ul",{className:"space-y-2",children:[(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin",className:"flex items-center px-4 py-2 rounded-lg ".concat("/admin"===a.pathname?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(o.default,{className:"mr-3 h-5 w-5"}),"대시보드"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin/content",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/content")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(f.default,{className:"mr-3 h-5 w-5"}),"콘텐츠 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin/news",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/news")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(b.default,{className:"mr-3 h-5 w-5"}),"뉴스 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin/drama",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/drama")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(p.default,{className:"mr-3 h-5 w-5"}),"드라마 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin/music",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/music")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(u.default,{className:"mr-3 h-5 w-5"}),"음악 차트 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin/celeb",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/celeb")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(y.default,{className:"mr-3 h-5 w-5"}),"셀럽 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n(),{href:"/admin/users",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/users")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(h.default,{className:"mr-3 h-5 w-5"}),"사용자 관리"]})})]}),(0,s.jsx)("div",{className:"border-t mt-4 pt-4",children:(0,s.jsxs)("button",{onClick:()=>{localStorage.removeItem("adminToken"),sessionStorage.removeItem("adminToken"),(0,d.signOut)({callbackUrl:"/"})},className:"flex items-center w-full px-4 py-2 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[(0,s.jsx)(j.default,{className:"mr-3 h-5 w-5"}),"로그아웃"]})})]})]}),(0,s.jsx)("div",{className:"flex-1",children:t})]})}))}},74689:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var s=a(85893),r=a(67294),l=a(9008),n=a.n(l),i=a(11163),d=a(33299),c=a(5152),o=a.n(c),m=a(2575),x=a(92761),u=a(15928),h=a(69819),g=a(43765),f=a(68760),b=a(42020),p=a(37864),y=a(92385);let j=o()(()=>Promise.all([a.e(2937),a.e(1876),a.e(1167)]).then(a.t.bind(a,71167,23)),{loadableGenerated:{webpack:()=>[71167]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg h-64 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})})}),N=()=>((0,r.useEffect)(()=>{Promise.all([a.e(9414),a.e(6834)]).then(a.t.bind(a,86834,23))},[]),null);function v(){var e;let t=(0,i.useRouter)(),{id:a}=t.query,{data:l,status:c}=(0,d.useSession)(),[o,v]=(0,r.useState)({title:"",summary:"",content:"",category:"K-POP",tags:[],coverImage:"",featured:!1}),[w,k]=(0,r.useState)(""),[C,S]=(0,r.useState)(!1),[E,P]=(0,r.useState)(!0),[I,z]=(0,r.useState)(!1),[F,T]=(0,r.useState)(null),[D,U]=(0,r.useState)(null),[_,O]=(0,r.useState)(!1),[A,L]=(0,r.useState)(""),[W,G]=(0,r.useState)(!0);(0,r.useEffect)(()=>{a&&(async()=>{P(!0);try{let e=await fetch("/api/news/".concat(a));if(!e.ok)throw Error("Failed to fetch news data");let t=(await e.json()).data;if(!t)throw Error("No data found in the response");let s=[];t.tags&&(s=Array.isArray(t.tags)?t.tags:t.tags.split(",").map(e=>e.trim())),v({title:t.title||"",summary:t.summary||"",content:t.content||"",category:t.category||"K-POP",tags:s,coverImage:t.coverImage||"",featured:t.featured||!1}),t.coverImage&&U({url:t.coverImage,name:t.coverImage.split("/").pop(),size:0})}catch(e){T("Error loading news article: ".concat(e.message))}finally{P(!1)}})()},[a]);let R=e=>{let{name:t,value:a,type:s,checked:r}=e.target;v(e=>({...e,[t]:"checkbox"===s?r:a}))},M=e=>{v(t=>({...t,tags:t.tags.filter(t=>t!==e)}))},B=async e=>{if(e&&e.preventDefault(),S(!0),T(null),!o.title||!o.summary||!o.content){T("Please fill in all required fields"),S(!1);return}try{let e=await fetch("/api/news/".concat(a),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),s=await e.json();if(!e.ok)throw Error(s.message||"Failed to update news article");alert("News article updated successfully"),t.push("/admin/news")}catch(e){T(e.message),window.scrollTo(0,0)}finally{S(!1)}},K=async e=>{if(!e)return;if(!["image/jpeg","image/png","image/webp","image/gif"].includes(e.type)){T("Invalid file type. Only JPEG, PNG, WebP and GIF are allowed");return}if(e.size>5242880){T("File too large. Maximum size is 5MB");return}let t=new FormData;t.append("image",e);try{let a=await fetch("/api/news/upload",{method:"POST",body:t}),s=await a.text(),r=JSON.parse(s);if(!a.ok)throw Error(r.message||"Failed to upload image");v(e=>({...e,coverImage:r.data.url})),U({url:URL.createObjectURL(e),name:e.name,size:e.size})}catch(e){T(e.message)}},q=()=>{G(!W)};return E?(0,s.jsxs)(m.default,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"Edit News Article | Admin"})}),(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})})]}):(0,s.jsxs)(m.default,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"Edit News Article | Admin"})}),(0,s.jsx)(N,{}),(0,s.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:()=>t.back(),className:"mr-4 p-2 text-gray-500 hover:text-gray-700 transition-colors",children:(0,s.jsx)(x.default,{size:20})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Edit News Article"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Update the news article details"})]})]}),(0,s.jsxs)("div",{className:"flex items-center mt-4 md:mt-0 space-x-3",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>{z(!I)},className:"px-4 py-2 flex items-center text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,s.jsx)(u.default,{size:18,className:"mr-2"}),I?"Edit Mode":"Preview"]}),(0,s.jsxs)("button",{type:"button",onClick:B,disabled:C,className:"px-4 py-2 flex items-center bg-[#ff3e8e] text-white rounded-lg hover:bg-[#e02e7c] transition-colors disabled:opacity-50",children:[(0,s.jsx)(h.default,{size:18,className:"mr-2"}),C?"Saving...":"Save Changes"]})]})]}),F&&(0,s.jsxs)("div",{className:"mb-6 flex items-center p-4 bg-red-50 border-l-4 border-red-500 rounded-md",children:[(0,s.jsx)(g.default,{size:24,className:"text-red-500 mr-3"}),(0,s.jsx)("p",{className:"text-red-700",children:F})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:I?(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"mb-8",children:[o.coverImage?(0,s.jsx)("div",{className:"relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden",children:(0,s.jsx)("img",{src:(null==D?void 0:D.url)||o.coverImage,alt:o.title,className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="/images/placeholder.jpg"}})}):(0,s.jsx)("div",{className:"w-full h-96 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-gray-400",children:[(0,s.jsx)(f.default,{size:48,className:"mx-auto mb-2"}),(0,s.jsx)("p",{children:"No cover image"})]})}),(0,s.jsxs)("div",{className:"mt-6 mb-4",children:[o.category&&(0,s.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded",children:o.category}),o.featured&&(0,s.jsx)("span",{className:"inline-block bg-green-100 text-green-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded",children:"Featured"})]}),(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:o.title||"Untitled Article"}),(0,s.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:o.summary||"No summary provided"}),(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-500 mb-8",children:[(0,s.jsx)(b.default,{size:16,className:"mr-2"}),(0,s.jsxs)("span",{children:["Published: ",new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),(0,s.jsx)("div",{className:"prose prose-lg max-w-none",children:o.content?(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:o.content}}):(0,s.jsx)("p",{className:"text-gray-400",children:"No content provided"})}),o.tags.length>0&&(0,s.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-100",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-3",children:"Tags"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:o.tags.map(e=>(0,s.jsxs)("span",{className:"inline-block bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full",children:["#",e]},e))})]})]})}):(0,s.jsx)("form",{onSubmit:B,className:"p-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:["Title ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",value:o.title,onChange:R,className:"block w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#ff3e8e]/50 focus:border-[#ff3e8e] outline-none transition-colors",placeholder:"Enter article title",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"summary",className:"block text-sm font-medium text-gray-700 mb-1",children:["Summary ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("textarea",{id:"summary",name:"summary",value:o.summary,onChange:R,rows:"3",className:"block w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#ff3e8e]/50 focus:border-[#ff3e8e] outline-none transition-colors",placeholder:"Enter a brief summary of the article",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-1",children:["Content ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg",style:{height:"400px"},children:(0,s.jsx)(j,{theme:"snow",value:o.content,onChange:e=>{v(t=>({...t,content:e}))},modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["link","image","video"],["clean"]],clipboard:{matchVisual:!1}},formats:["header","bold","italic","underline","strike","list","bullet","indent","align","link","image","video"],placeholder:"Write your article content here...",style:{height:"358px"}})}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Use the formatting toolbar to style your content, add links, and insert images."})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Cover Image ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-3",children:[(0,s.jsx)("button",{type:"button",onClick:q,className:"px-3 py-1.5 text-sm rounded-md ".concat(W?"bg-[#ff3e8e] text-white":"bg-gray-100 text-gray-700"),children:"Upload Image"}),(0,s.jsx)("button",{type:"button",onClick:q,className:"px-3 py-1.5 text-sm rounded-md ".concat(W?"bg-gray-100 text-gray-700":"bg-[#ff3e8e] text-white"),children:"Image URL"})]}),D?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative w-full h-48 bg-gray-100 rounded-lg overflow-hidden",children:[(0,s.jsx)("img",{src:D.url,alt:"Cover preview",className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="/images/placeholder.jpg"}}),(0,s.jsx)("button",{type:"button",onClick:()=>{v(e=>({...e,coverImage:""})),U(null)},className:"absolute top-2 right-2 p-1 bg-white rounded-full shadow-sm hover:bg-gray-100 transition-colors",children:(0,s.jsx)(p.default,{size:16,className:"text-red-500"})})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,s.jsx)("p",{children:D.name}),D.size>0&&(0,s.jsx)("p",{children:(e=D.size)<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"})]})]}):W?(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center ".concat(_?"border-[#ff3e8e] bg-[#ff3e8e]/5":"border-gray-300"),onDragOver:e=>{e.preventDefault(),O(!0)},onDragLeave:e=>{e.preventDefault(),O(!1)},onDrop:e=>{e.preventDefault(),O(!1),e.dataTransfer.files&&0!==e.dataTransfer.files.length&&K(e.dataTransfer.files[0])},children:[(0,s.jsx)(f.default,{size:36,className:"mx-auto text-gray-400 mb-3"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Drag & drop an image here, or"," ",(0,s.jsxs)("label",{htmlFor:"file-upload",className:"text-[#ff3e8e] cursor-pointer",children:["browse",(0,s.jsx)("input",{id:"file-upload",type:"file",className:"sr-only",accept:"image/*",onChange:e=>{e.target.files&&0!==e.target.files.length&&K(e.target.files[0])}})]})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG, WEBP or GIF (max. 5MB)"})]}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("input",{type:"text",value:A,onChange:e=>L(e.target.value),placeholder:"Enter image URL",className:"block w-full px-4 py-2 border border-gray-200 rounded-l-lg focus:ring-2 focus:ring-[#ff3e8e]/50 focus:border-[#ff3e8e] outline-none transition-colors"}),(0,s.jsx)("button",{type:"button",onClick:e=>{if(e.preventDefault(),A.trim()){if(!(e=>{try{return new URL(e),!0}catch(e){return!1}})(A)){T("Please enter a valid URL");return}v(e=>({...e,coverImage:A})),U({url:A,name:A.split("/").pop(),size:0}),L("")}},className:"px-4 py-2 bg-[#ff3e8e] text-white rounded-r-lg",children:(0,s.jsx)(y.default,{size:18})})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Enter a direct link to an image (https://example.com/image.jpg)"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,s.jsx)("select",{id:"category",name:"category",value:o.category,onChange:R,className:"block w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#ff3e8e]/50 focus:border-[#ff3e8e] outline-none transition-colors",children:[{value:"kpop",label:"K-POP"},{value:"drama",label:"K-Drama"},{value:"movie",label:"Movie"},{value:"variety",label:"Variety Show"},{value:"celeb",label:"Celebrity"},{value:"other",label:"Other"}].map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),(0,s.jsxs)("div",{className:"flex mb-2",children:[(0,s.jsx)("input",{type:"text",id:"tagInput",value:w,onChange:e=>{k(e.target.value)},className:"block w-full px-4 py-3 border border-gray-200 rounded-l-lg focus:ring-2 focus:ring-[#ff3e8e]/50 focus:border-[#ff3e8e] outline-none transition-colors",placeholder:"Add a tag"}),(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),w.trim()&&!o.tags.includes(w.trim())&&(v(e=>({...e,tags:[...e.tags,w.trim()]})),k(""))},className:"px-4 py-3 bg-gray-100 text-gray-700 rounded-r-lg hover:bg-gray-200 transition-colors",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:o.tags.map(e=>(0,s.jsxs)("span",{className:"inline-flex items-center bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full",children:["#",e,(0,s.jsx)("button",{type:"button",onClick:()=>M(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"featured",name:"featured",checked:o.featured,onChange:R,className:"w-4 h-4 text-[#ff3e8e] border-gray-300 rounded focus:ring-[#ff3e8e]"}),(0,s.jsx)("label",{htmlFor:"featured",className:"ml-2 block text-sm text-gray-700",children:"Featured Article"})]})]})]})})})]})}}},function(e){e.O(0,[1664,4294,2888,9774,179],function(){return e(e.s=88702)}),_N_E=e.O()}]);