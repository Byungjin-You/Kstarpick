(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1347],{47976:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/content/reviews-crawler",function(){return a(24345)}])},2575:function(e,t,a){"use strict";a.r(t);var s=a(85893),l=a(67294),r=a(41664),i=a.n(r),n=a(11163),d=a(33299),c=a(43765),u=a(38361),m=a(2553),h=a(63594),x=a(2287),o=a(89176),f=a(55264),j=a(70095),g=a(77362),p=a(94086),b=a(70088),v=a(70775);t.default=e=>{let{children:t}=e,a=(0,n.useRouter)(),{data:r,status:y}=(0,d.useSession)(),[w,N]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{("unauthenticated"===y||r&&"admin"!==r.user.role)&&a.push("/admin/login")},[r,y,a]),"loading"===y)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,s.jsx)("div",{className:"p-8 bg-white rounded-lg shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-t-[#ff3e8e] rounded-full animate-spin"}),(0,s.jsx)("p",{className:"text-xl font-medium",children:"Loading admin panel..."})]})})}):"unauthenticated"===y||r&&"admin"!==r.user.role?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,s.jsx)("div",{className:"p-8 bg-white rounded-lg shadow-md max-w-md",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4 text-center",children:[(0,s.jsx)(c.default,{size:48,className:"text-red-500"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Unauthorized Access"}),(0,s.jsx)("p",{className:"text-gray-600",children:"You don't have permission to access the admin area."}),(0,s.jsx)(i(),{href:"/",className:"px-4 py-2 mt-4 text-white bg-[#ff3e8e] rounded-md hover:bg-[#e02e7c]",children:"Go to Homepage"})]})})}):(u.default,m.default,h.default,x.default,o.default,f.default,(0,s.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"w-64 min-h-screen bg-white shadow-md",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"관리자 패널"})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("ul",{className:"space-y-2",children:[(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin",className:"flex items-center px-4 py-2 rounded-lg ".concat("/admin"===a.pathname?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(u.default,{className:"mr-3 h-5 w-5"}),"대시보드"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin/content",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/content")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(j.default,{className:"mr-3 h-5 w-5"}),"콘텐츠 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin/news",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/news")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(g.default,{className:"mr-3 h-5 w-5"}),"뉴스 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin/drama",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/drama")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(p.default,{className:"mr-3 h-5 w-5"}),"드라마 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin/music",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/music")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(x.default,{className:"mr-3 h-5 w-5"}),"음악 차트 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin/celeb",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/celeb")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(b.default,{className:"mr-3 h-5 w-5"}),"셀럽 관리"]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(i(),{href:"/admin/users",className:"flex items-center px-4 py-2 rounded-lg ".concat(a.pathname.startsWith("/admin/users")?"bg-blue-600 text-white":"text-gray-800 hover:bg-blue-100"),children:[(0,s.jsx)(o.default,{className:"mr-3 h-5 w-5"}),"사용자 관리"]})})]}),(0,s.jsx)("div",{className:"border-t mt-4 pt-4",children:(0,s.jsxs)("button",{onClick:()=>{localStorage.removeItem("adminToken"),sessionStorage.removeItem("adminToken"),(0,d.signOut)({callbackUrl:"/"})},className:"flex items-center w-full px-4 py-2 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[(0,s.jsx)(v.default,{className:"mr-3 h-5 w-5"}),"로그아웃"]})})]})]}),(0,s.jsx)("div",{className:"flex-1",children:t})]})}))}},24345:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return D}});var s=a(85893),l=a(67294),r=a(33299),i=a(2575),n=a(13536),d=a(84653),c=a(27178),u=a(732),m=a(50447),h=a(83254),x=a(92137),o=a(52058),f=a(63559),j=a(7620),g=a(92180),p=a(44490),b=a(9247),v=a(78738),y=a(63970),w=a(37057),N=a(63809),k=a(47975),S=a(3742),_=a(45881),C=a(88776),I=a(65291),W=a(11163),T=a(9008),E=a.n(T),O=a(61535);let z=async e=>{let t=localStorage.getItem("token")||localStorage.getItem("adminToken"),a=await fetch(e,{headers:{Authorization:t?"Bearer ".concat(t):""}});if(!a.ok)throw Error("드라마 데이터를 가져오는 중 오류가 발생했습니다.");return a.json()};function D(){var e;let{data:t,status:a}=(0,r.useSession)(),T=(0,W.useRouter)(),[D,B]=(0,l.useState)(""),[L,M]=(0,l.useState)(""),[R,U]=(0,l.useState)(""),[P,q]=(0,l.useState)(""),[A,X]=(0,l.useState)(!1),[F,G]=(0,l.useState)([]),{data:H,error:J}=(0,O.default)("/api/dramas?limit=100",z);if("loading"===a)return(0,s.jsx)(i.default,{children:(0,s.jsx)(n.default,{children:(0,s.jsx)(d.default,{sx:{display:"flex",justifyContent:"center",my:5},children:(0,s.jsx)(c.default,{})})})});if("unauthenticated"===a)return T.push("/auth/signin"),null;if((null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role)!=="admin")return(0,s.jsx)(i.default,{children:(0,s.jsx)(n.default,{children:(0,s.jsx)(u.default,{severity:"error",sx:{mt:3},children:"이 페이지는 관리자만 접근할 수 있습니다."})})});let Y=async()=>{if(!D){U("URL을 입력해주세요.");return}if(!L){U("드라마를 선택해주세요.");return}if(!D.includes("mydramalist.com")){U("MyDramalist 웹사이트 URL이어야 합니다.");return}try{X(!0),U(""),q(""),G([]);let e=await fetch("/api/crawler/reviews-stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:D,dramaId:L})}),t=await e.json();if(!e.ok)throw Error(t.message||t.error||"크롤링 중 오류가 발생했습니다.");q("".concat(t.message||"리뷰 크롤링이 성공적으로 완료되었습니다.")),t.data&&t.data.reviews&&G(t.data.reviews)}catch(e){U(e.message||"리뷰 크롤링 중 오류가 발생했습니다.")}finally{X(!1)}};return(0,s.jsxs)(i.default,{children:[(0,s.jsx)(E(),{children:(0,s.jsx)("title",{children:"MyDramalist 리뷰 스텔스 크롤러 | 관리자"})}),(0,s.jsxs)(n.default,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,s.jsx)(m.default,{variant:"h4",component:"h1",gutterBottom:!0,children:"MyDramalist 리뷰 스텔스 크롤러"}),(0,s.jsxs)(h.default,{sx:{p:3,mb:4},children:[(0,s.jsx)(m.default,{variant:"h6",gutterBottom:!0,children:"리뷰 크롤링"}),(0,s.jsx)(m.default,{color:"text.secondary",paragraph:!0,children:"MyDramalist에서 드라마/영화 리뷰를 스텔스 크롤링합니다. Cloudflare 보호를 우회하여 리뷰를 수집합니다."}),(0,s.jsxs)(x.default,{container:!0,spacing:3,children:[(0,s.jsx)(x.default,{item:!0,xs:12,md:6,children:(0,s.jsx)(o.default,{fullWidth:!0,label:"MyDramalist 드라마 URL",placeholder:"https://mydramalist.com/702271-weak-hero-season-2",helperText:"예: https://mydramalist.com/702271-weak-hero-season-2 (리뷰 페이지는 자동으로 추가됩니다)",value:D,onChange:e=>{B(e.target.value),U(""),q("")},margin:"normal",required:!0,disabled:A})}),(0,s.jsx)(x.default,{item:!0,xs:12,md:6,children:(0,s.jsxs)(f.default,{fullWidth:!0,margin:"normal",required:!0,children:[(0,s.jsx)(j.default,{id:"drama-select-label",children:"드라마 선택"}),(0,s.jsx)(g.default,{labelId:"drama-select-label",value:L,onChange:e=>{M(e.target.value)},label:"드라마 선택",disabled:A||!H,children:J?(0,s.jsx)(p.default,{value:"",children:(0,s.jsx)("em",{children:"드라마 목록을 불러오는데 실패했습니다"})}):H?H.map(e=>(0,s.jsx)(p.default,{value:e._id,children:e.title},e._id)):(0,s.jsx)(p.default,{value:"",children:(0,s.jsx)("em",{children:"로딩 중..."})})}),(0,s.jsx)(b.default,{children:"리뷰를 연결할 드라마를 선택하세요"})]})})]}),(0,s.jsx)(d.default,{sx:{mt:3,display:"flex",justifyContent:"flex-start"},children:(0,s.jsx)(v.default,{variant:"contained",color:"primary",startIcon:A?(0,s.jsx)(c.default,{size:20,color:"inherit"}):(0,s.jsx)(I.default,{}),onClick:Y,disabled:A,children:A?"크롤링 중...":"스텔스 크롤링 시작"})}),R&&(0,s.jsx)(u.default,{severity:"error",sx:{mt:2},children:R}),P&&(0,s.jsx)(u.default,{severity:"success",sx:{mt:2},icon:(0,s.jsx)(C.default,{}),children:P})]}),F.length>0&&(0,s.jsxs)(h.default,{sx:{p:3},children:[(0,s.jsxs)(m.default,{variant:"h6",gutterBottom:!0,children:["수집된 리뷰 (",F.length,"개)"]}),(0,s.jsx)(y.default,{children:F.map((e,t)=>(0,s.jsxs)(d.default,{children:[(0,s.jsx)(w.default,{alignItems:"flex-start",children:(0,s.jsx)(N.default,{primary:(0,s.jsxs)(d.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(m.default,{variant:"subtitle1",children:e.title}),e.rating>0&&(0,s.jsxs)(d.default,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(k.default,{value:e.rating/2,precision:.5,readOnly:!0}),(0,s.jsxs)(m.default,{variant:"body2",sx:{ml:1},children:["(",e.rating,"/10)"]})]})]}),secondary:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.default,{sx:{mb:1,mt:1},children:[(0,s.jsx)(S.default,{size:"small",label:"작성자: ".concat(e.username),sx:{mr:1,mb:1}}),e.reviewDate&&(0,s.jsx)(S.default,{size:"small",label:"작성일: ".concat(e.reviewDate),sx:{mr:1,mb:1}}),e.helpfulCount>0&&(0,s.jsx)(S.default,{size:"small",label:"좋아요: ".concat(e.helpfulCount),sx:{mb:1}})]}),(0,s.jsx)(m.default,{variant:"body2",color:"text.primary",sx:{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:3,textOverflow:"ellipsis",whiteSpace:"pre-line"},children:e.reviewText})]})})}),t<F.length-1&&(0,s.jsx)(_.default,{})]},e.reviewId||"review-".concat(t)))})]})]})]})}}},function(e){e.O(0,[1664,2807,3072,7277,2888,9774,179],function(){return e(e.s=47976)}),_N_E=e.O()}]);