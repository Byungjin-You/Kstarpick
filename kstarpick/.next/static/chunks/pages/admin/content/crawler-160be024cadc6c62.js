(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7867],{40578:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/content/crawler",function(){return a(84971)}])},4270:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return r}});let r=(0,a(63759).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},84971:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return p},default:function(){return y}});var r=a(85893),s=a(67294),l=a(2575),n=a(44976),i=a(78865),o=a(43765),c=a(4270),d=a(69819),m=a(63759);let u=(0,m.default)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),g=(0,m.default)("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);var h=a(41664),x=a.n(h);a(39513),a(37677),a(25675);var p=!0;function y(){let[e,t]=(0,s.useState)("https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1"),[a,m]=(0,s.useState)(""),[h,p]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1),[f,w]=(0,s.useState)(null),[v,j]=(0,s.useState)([]),[N,S]=(0,s.useState)(null),[C,k]=(0,s.useState)({visible:!1,message:"",type:""}),[T,A]=(0,s.useState)({}),[E,M]=(0,s.useState)({}),[P,q]=(0,s.useState)(!1),[I,R]=(0,s.useState)(""),[O,L]=(0,s.useState)(null),[D,H]=(0,s.useState)(!1),[B,_]=(0,s.useState)([]),[z,J]=(0,s.useState)(!1),[F,U]=(0,s.useState)("https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1"),[Z,V]=(0,s.useState)(1),[$,K]=(0,s.useState)(!1),[W,X]=(0,s.useState)({page:0,totalPages:0,dramas:0}),[G,Q]=(0,s.useState)(!1),[Y,ee]=(0,s.useState)([]),[et,ea]=(0,s.useState)(0),[er,es]=(0,s.useState)(!0),[el,en]=(0,s.useState)({current:0,total:0}),[ei,eo]=(0,s.useState)(!1),[ec,ed]=(0,s.useState)(null),em=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;k({visible:!0,message:e,type:t}),setTimeout(()=>k({visible:!1,message:"",type:""}),a)},eu=e=>{let t=new DOMParser().parseFromString(e,"text/html"),a=[];t.querySelectorAll('div[id^="mdl-"]').forEach(e=>{var t,r;let s=e.id.replace("mdl-",""),l=e.querySelector("h6.text-primary.title a");if(!l)return;let n=l.textContent.trim(),i="https://mydramalist.com"+l.getAttribute("href"),o=e.querySelector("span.text-muted"),c=(o?o.textContent.trim():"").split(" - "),d=(null===(t=c[0])||void 0===t?void 0:t.includes("Drama"))?"drama":(null===(r=c[0])||void 0===r?void 0:r.includes("Movie"))?"movie":"other",m=null,u=null;if(c[1]){let e=c[1].match(/(\d{4})/);e&&(m=parseInt(e[1]));let t=c[1].match(/(\d+) episodes/);t&&(u=parseInt(t[1]))}let g=e.querySelector("img.img-responsive.cover"),h=g?g.getAttribute("src")||g.getAttribute("data-src"):null,x=e.querySelector("span.p-l-xs.score"),p=(null==x?void 0:x.textContent)?parseFloat(x.textContent):0,y=e.querySelectorAll("p"),b="";y.forEach(e=>{!e.querySelector("span")&&e.textContent.trim()&&!e.className.includes("rating")&&(b=e.textContent.trim())}),a.push({id:s,url:i,title:n,category:d,year:m,episodes:u,imageUrl:h,rating:p,summary:b})});let r=t.querySelector(".pagination .page-item.next a");return{dramas:a,nextPage:r?"https://mydramalist.com"+r.getAttribute("href"):null}},eg=(e,t,a)=>{var r,s;let l=new DOMParser().parseFromString(e,"text/html"),n=(null===(r=l.querySelector("h1.film-title"))||void 0===r?void 0:r.textContent.trim())||"",i="",o=l.querySelector('.show-detailsxss .list-item:has(b:contains("Native Title")) a');o&&(i=o.textContent.trim());let c="";for(let e of[".show-synopsis p span",".show-synopsis p",".show-synopsis",".film-description",".box-body .box-inset",".show-synopsis .synopsis",'div.box:contains("Synopsis") .box-body']){let t=l.querySelector(e);if(t&&t.textContent.trim()){c=t.textContent.trim().replace(/\s+/g," ");let e=t.querySelectorAll(".read-more-hidden");if(e.length>0)for(let t of e){let e=t.textContent.trim();e&&!c.includes(e)&&(c+=" "+e)}break}}if(c&&(c=(c=(c=(c=(c=(c=(c=(c=(c=c.replace(/Edit Translation/g,"").trim()).replace(/\(Source:.+?\)/g,"").trim()).replace(RegExp("English한국어हिन्दीEspa\xf1ol.+","s"),"").trim()).replace(RegExp("English[\\s\\n]+한국어[\\s\\n]+हिन्दी[\\s\\n]+Espa\xf1ol.+","s"),"").trim()).replace(RegExp("English[\\s\\n]*ภาษาไทย[\\s\\n]*Arabic[\\s\\n]*Русский.+","s"),"").trim()).replace(/Expand$/g,"").trim()).replace(/Show\s+Less$/g,"").trim()).replace(/Synopsis\s+/g,"").trim()).replace(/Edit$/g,"").trim()),!c||c.length<10){let e=l.querySelector('meta[name="description"]');e&&(c=e.getAttribute("content")||"")}let d="",m=l.querySelector('.show-detailsxss .list-item:has(b:contains("Director")) a');m&&(d=m.textContent.trim());let u=[];l.querySelectorAll(".show-genres a").forEach(e=>{u.push(e.textContent.trim())});let g=[];l.querySelectorAll(".show-tags a").forEach(e=>{let t=e.textContent.trim();t&&!t.includes("Vote or add tags")&&g.push(t)});let h="South Korea",x=l.querySelector('.list-item:has(b:contains("Country"))');if(x){let e=x.textContent.replace("Country:","").trim();e&&(h=e)}let p="",y=l.querySelector('.list-item:has(b:contains("Type"))');y&&(p=y.textContent.replace("Type:","").trim());let b=null,f=l.querySelector('.list-item:has(b:contains("Episodes"))');if(f){let e=f.textContent.replace("Episodes:","").trim();e&&!isNaN(parseInt(e))&&(b=parseInt(e))}let w="",v="",j="",N=l.querySelector('.list-item:has(b:contains("Aired"))')||l.querySelector('.list-item:has(b:contains("Airs"))');if(N&&!N.textContent.includes("Airs On")){let e=N.querySelector("b"),t=e?e.textContent.trim():"";if("Aired:"===t||"Airs:"===t){let e=(w=N.textContent.replace(t,"").trim()).match(/([A-Za-z]+\s+\d+,\s+\d{4})\s*-\s*([A-Za-z]+\s+\d+,\s+\d{4})/),a=w.match(/([A-Za-z]+\s+\d+,\s+\d{4})/),r=w.match(/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/),s=w.match(/(\d{4})/);if(e)v=e[1],j=e[2];else if(a)v=a[1];else if(r)v=r[1],j=r[2];else if(s)v=s[1];else{let e=w.match(/([A-Za-z]+\s+\d{4})/);if(e)v=e[1];else{let e=w.match(/(\d{4})\s*-\s*(\d{4})/);e?(v=e[1],j=e[2]):v=w}}}}let S="",C=l.querySelector('.list-item:has(b:contains("Airs On"))');C&&(S=C.textContent.replace("Airs On:","").trim());let k="",T=l.querySelector('.list-item:has(b:contains("Original Network")) a');T&&(k=T.textContent.trim());let A="",E=l.querySelector('.list-item:has(b:contains("Content Rating"))');E&&(A=E.textContent.replace("Content Rating:","").trim());let M=(null===(s=l.querySelector(".film-cover img.img-responsive"))||void 0===s?void 0:s.getAttribute("src"))||"",P=a.split("/"),q=P[P.length-1],I=0,R=l.querySelector('.box[itemtype="http://schema.org/AggregateRating"] .list-item:has(b:contains("Score"))');if(R){let e=R.textContent.match(/(\d+\.\d+)/);e&&(I=parseFloat(e[1]))}let O={mainRoles:[],supportRoles:[]};return(()=>{let e=(e,t)=>{let a=l.querySelector('h3.header.b-b.p-b:contains("'.concat(e,'")'));if(a){let e=a.nextElementSibling;return!!e&&"UL"===e.tagName&&(e.querySelectorAll("li.list-item").forEach(e=>{var a,r,s;let l=(null===(a=e.querySelector("a.text-primary b"))||void 0===a?void 0:a.textContent.trim())||"",n="",i=e.querySelector("small[title]");if(i&&(n=i.textContent.trim()||(null===(s=i.getAttribute("title"))||void 0===s?void 0:s.trim())||""),!n){let t=e.querySelector("small:not(.text-muted)");t&&(n=t.textContent.trim())}let o=(null===(r=e.querySelector("img"))||void 0===r?void 0:r.getAttribute("src"))||"";l&&(t?O.mainRoles.push({name:l,role:n||"주연",image:o}):O.supportRoles.push({name:l,role:n||"조연",image:o}))}),!0)}let r=l.querySelector('h3.header:contains("'.concat(e,'")'));if(r){let e=r.nextElementSibling;if(e&&"UL"===e.tagName)return e.querySelectorAll("li.list-item").forEach(e=>{var a,r,s,l;let n=(null===(a=e.querySelector("a.text-primary b"))||void 0===a?void 0:a.textContent.trim())||"",i=(null===(r=e.querySelector("small[title]"))||void 0===r?void 0:r.textContent.trim())||"";i||(i=(null===(l=e.querySelector("small:not(.text-muted)"))||void 0===l?void 0:l.textContent.trim())||"");let o=(null===(s=e.querySelector("img"))||void 0===s?void 0:s.getAttribute("src"))||"";n&&(t?O.mainRoles.push({name:n,role:i||"주연",image:o}):O.supportRoles.push({name:n,role:i||"조연",image:o}))}),!0}return!1};e("Main Role",!0),e("Support Role",!1),e("Guest Role",!1),0===O.mainRoles.length&&0===O.supportRoles.length&&l.querySelectorAll(".list-item").forEach(e=>{var t,a,r,s,l;let n=(null===(t=e.querySelector("a.text-primary b"))||void 0===t?void 0:t.textContent.trim())||"",i=(null===(a=e.querySelector("small.text-muted"))||void 0===a?void 0:a.textContent.trim())||"",o=(null===(r=e.querySelector("small[title]"))||void 0===r?void 0:r.textContent.trim())||"";o||(o=(null===(l=e.querySelector("small:not(.text-muted)"))||void 0===l?void 0:l.textContent.trim())||"");let c=(null===(s=e.querySelector("img"))||void 0===s?void 0:s.getAttribute("src"))||"";n&&(i.includes("Role")||i.includes("Cast"))&&(i.includes("Main")?O.mainRoles.push({name:n,role:o||"주연",image:c}):O.supportRoles.push({name:n,role:o||"조연",image:c}))})})(),{title:n,originalTitle:i||"",description:c,synopsis:c,summary:c,content:c,directorName:d,director:d,genres:u,tags:g,country:h,type:p,episodes:b,rating:I,releaseDate:v,startDate:v,endDate:j,airTime:S,airsOn:S,airsInfo:w,network:k,contentRating:A,coverImage:M,posterUrl:M,slug:q,mdlId:t,mdlUrl:a,category:p&&p.toLowerCase().includes("movie")?"movie":"drama",cast:{mainRoles:O.mainRoles||[],supportRoles:O.supportRoles||[]},_sourceUrl:a,_dateString:v}},eh=e=>{E[e.id]||(L(e),R(""),q(!0))},ex=async()=>{if(!I.trim()||!O){em("HTML 콘텐츠를 입력해주세요.","error");return}q(!1);try{if(em("HTML 처리 중... (".concat(I.length," 바이트)"),"info"),"auto-list"===O.id){let e=await fetch("/api/crawler/auto-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:O.url,mode:"list",htmlContent:I})});if(!e.ok){let t=await e.json();throw Error(t.message||"HTML 파싱 실패")}let t=await e.json();if(!t.success)throw Error(t.message||"HTML 파싱 결과 처리 실패");let a=t.data.dramas;j(e=>[...e,...a]),X(e=>({...e,dramas:e.dramas+a.length})),ee(e=>[...e,...a]),t.data.nextPage&&W.page<W.totalPages?(em("다음 페이지로 이동합니다: ".concat(W.page+1,"/").concat(W.totalPages),"info"),window.open(t.data.nextPage,"_blank"),setTimeout(()=>{crawlNextPage(t.data.nextPage)},1e3)):(em("총 ".concat(W.dramas,"개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다."),"success"),startAutoDetailCrawling());return}if("auto-detail"===O.id){let e=await fetch("/api/crawler/auto-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:O.url,mode:"detail",htmlContent:I})});if(!e.ok){let t=await e.json();throw Error(t.message||"HTML 파싱 실패")}let t=await e.json();if(!t.success)throw Error(t.message||"HTML 파싱 결과 처리 실패");let a=localStorage.getItem("token")||localStorage.getItem("adminToken"),r=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:a?"Bearer ".concat(a):""},body:JSON.stringify({data:t.data})});if(!r.ok){let e=await r.json();throw Error(e.message||"저장 실패")}let s=O.originalDrama;s&&(M(e=>({...e,[s.id]:"saved"})),ea(e=>e+1)),setTimeout(()=>{processNextDramaDetail()},500*Math.random()+500);return}M(e=>({...e,[O.id]:"loading"}));try{let e=eg(I,O.id,O.url);if(ep(e,O),D){let e=B.filter(e=>e.id!==O.id);_(e),e.length>0?setTimeout(()=>{eh(e[0])},500):(H(!1),em("선택한 모든 드라마 저장이 완료되었습니다.","success"))}}catch(e){if(M(e=>({...e,[O.id]:"error"})),em("'".concat(O.title,"' 파싱 실패: ").concat(e.message),"error"),D){let e=B.filter(e=>e.id!==O.id);_(e),e.length>0?setTimeout(()=>{eh(e[0])},500):(H(!1),em("선택한 모든 드라마 저장이 완료되었습니다.","success"))}}}catch(e){em("HTML 처리 오류: ".concat(e.message),"error"),"auto-detail"===O.id&&setTimeout(()=>{processNextDramaDetail()},1e3)}},ep=async(e,t)=>{try{let a=localStorage.getItem("token")||localStorage.getItem("adminToken");if(!a)throw Error("인증 토큰이 없습니다. 다시 로그인해주세요.");let r=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({data:e})}),s=await r.json();if(!r.ok)throw Error(s.message||"저장 실패");M(e=>({...e,[t.id]:"saved"})),em("'".concat(t.title,"' 저장 완료"),"success")}catch(e){M(e=>({...e,[t.id]:"error"})),em("'".concat(t.title,"' 저장 실패: ").concat(e.message),"error")}},ey=async e=>{try{if(!$)return;X(e=>({...e,page:e.page+1})),em("".concat(W.page+1,"/").concat(W.totalPages," 페이지 스텔스 크롤링 중..."),"info");let t=await fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,mode:"list",usePuppeteer:!0})});if(!t.ok){let e=await t.json(),a=e.message||"크롤링 실패";throw e.error&&(a+=": ".concat(e.error)),Error(a)}let a=await t.json();if(!a.success)throw Error(a.message||"크롤링 데이터 처리 실패");let r=a.data.dramas;j(e=>[...e,...r]),X(e=>({...e,dramas:e.dramas+r.length})),ee(e=>[...e,...r]),a.data.nextPage&&W.page<W.totalPages?setTimeout(()=>{ey(a.data.nextPage)},500*Math.random()+500):(em("총 ".concat(W.dramas,"개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다."),"success"),eb())}catch(e){K(!1),em("페이지 스텔스 크롤링 오류: ".concat(e.message),"error")}},eb=async()=>{if(!G&&0!==Y.length)try{Q(!0),ef()}catch(e){Q(!1),em("상세 정보 스텔스 크롤링 오류: ".concat(e.message),"error")}},ef=async()=>{try{if(!G||0===Y.length){Q(!1),K(!1),em("모든 드라마 크롤링 및 저장이 완료되었습니다.","success");return}let e=Y[0];if(ee(e=>e.slice(1)),"saved"===E[e.id]){ef();return}M(t=>({...t,[e.id]:"loading"}));let t=await fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,mode:"detail",usePuppeteer:!0})});if(!t.ok){let e=await t.json();throw Error(e.message||"상세 정보 스텔스 크롤링 실패")}let a=await t.json();if(!a.success)throw Error(a.message||"상세 정보 처리 실패");let r=localStorage.getItem("token")||localStorage.getItem("adminToken");if(!r)throw Error("인증 토큰이 없습니다. 다시 로그인해주세요.");let s=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({data:a.data})});if(!s.ok){let e=await s.json();throw Error(e.message||"저장 실패")}M(t=>({...t,[e.id]:"saved"})),ea(e=>e+1),setTimeout(()=>{ef()},500*Math.random()+500)}catch(e){if(Y.length>0){let e=Y[0];M(t=>({...t,[e.id]:"error"}))}em("상세 정보 크롤링 오류: ".concat(e.message,", 다음 항목으로 진행합니다."),"error"),setTimeout(()=>{ef()},1e3)}},ew=async()=>{let e=Object.keys(T).filter(e=>T[e]);if(0===e.length){em("저장할 드라마를 선택해주세요.","info");return}let t=e.map(e=>v.find(t=>t.id===e)).filter(e=>e);_(t),H(!0),t.length>0&&eh(t[0])},ev=e=>{A(t=>({...t,[e]:!t[e]}))},ej=e=>{switch(E[e]){case"loading":return(0,r.jsx)(n.default,{size:16,className:"animate-spin text-blue-500"});case"saved":return(0,r.jsx)(i.default,{size:16,className:"text-green-500"});case"error":return(0,r.jsx)(o.default,{size:16,className:"text-red-500"});default:return(0,r.jsx)(c.default,{size:16})}};(0,s.useEffect)(()=>{setTimeout(()=>{document.getElementById("stealth-mode-button"),document.getElementById("start-stealth-crawling-button")},1e3)},[]);let eN=e=>{try{var t,a;e.mdlId||e.summary||E[e.id],M(t=>({...t,[e.id]:"loading"})),em("'".concat(e.title,"' 등록 중..."),"info");let r=e.releaseDate||e.startDate||"",s=e.summary||e.description||e.synopsis||"",l="";e.genres&&(Array.isArray(e.genres)?l=e.genres.join(", "):"string"==typeof e.genres&&(l=e.genres));let n=e.contentRating||e.ageRating||"",i={...e,title:e.title||"",originalTitle:e.originalTitle||e.nativeTitle||"",summary:s,content:s,description:s,network:e.network||"",status:e.status||"ongoing",releaseDate:r,endDate:e.endDate||"",rating:e.rating||e.reviewRating||0,runtime:e.runtime||"",ageRating:n,contentRating:n,genres:e.genres||[],genresText:l,director:e.director||"",directors:e.directors||[],screenwriters:e.screenwriters||[],castingDirectors:e.castingDirectors||[],producers:e.producers||[],country:e.country||"KOREA",coverImage:e.posterImage||e.posterUrl||e.coverImage||"",posterImage:e.posterImage||e.posterUrl||e.coverImage||"",backgroundImage:e.backgroundImage||e.bannerImage||"",bannerImage:e.backgroundImage||e.bannerImage||"",mdlId:e.mdlId||null,mdlRating:e.rating||null,mdlVotes:e.votes||null,category:e.category||"drama",cast:(()=>{if(e.cast&&(Array.isArray(e.cast.mainRoles)||Array.isArray(e.cast.supportRoles))){let t=Array.isArray(e.cast.mainRoles)?e.cast.mainRoles.map((e,t)=>({name:e.name||"",role:e.role||"",profileImage:e.profileImage||e.image||"",order:t})):[],a=Array.isArray(e.cast.supportRoles)?e.cast.supportRoles.map((e,a)=>({name:e.name||"",role:e.role||"",profileImage:e.profileImage||e.image||"",order:t.length+a})):[];return[...t,...a]}return Array.isArray(e.cast)?e.cast.map((e,t)=>({name:e.name||"",role:e.role||"",profileImage:e.profileImage||e.image||"",order:t})):[]})(),watchProviders:e.whereToWatch||[],createdAt:new Date,updatedAt:new Date,originalData:{...e}},o=Array.isArray(i.cast)?i.cast.length:0,c=(null===(t=i.cast)||void 0===t?void 0:t.mainRoles)||[],d=(null===(a=i.cast)||void 0===a?void 0:a.supportRoles)||[];o>0||(c.length>0||d.length>0)&&(c.length,d.length);let m=localStorage.getItem("token")||localStorage.getItem("adminToken");fetch("/api/dramas",{method:"POST",headers:{"Content-Type":"application/json",Authorization:m?"Bearer ".concat(m):""},body:JSON.stringify(i)}).then(e=>e.json()).then(t=>{t.success?(M(t=>({...t,[e.id]:"saved"})),em("'".concat(e.title,"'이(가) 성공적으로 등록되었습니다."),"success")):(M(t=>({...t,[e.id]:"error"})),em("'".concat(e.title,"' 등록 실패: ").concat(t.message),"error"))}).catch(t=>{M(t=>({...t,[e.id]:"error"})),em("'".concat(e.title,"' 등록 중 오류 발생"),"error")})}catch(t){M(t=>({...t,[e.id]:"error"})),em("등록 중 오류가 발생했습니다: ".concat(t.message),"error")}},eS=async()=>{try{p(!0),em("드라마 데이터 백업 중...","info");let e=await fetch("/api/crawler/backup-dramas",{method:"POST"});if(!e.ok){let t=await e.json();throw Error(t.message||"백업 중 오류가 발생했습니다.")}let t=await e.json();return em("".concat(t.data.count,"개의 드라마가 성공적으로 백업되었습니다."),"success"),!0}catch(e){return em("백업 중 오류: ".concat(e.message),"error"),!1}finally{p(!1)}};return(0,r.jsxs)(l.default,{children:[(0,r.jsxs)("div",{className:"container mx-auto p-6",children:[(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"MyDramalist 크롤러"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{id:"debug-button",onClick:()=>{alert("디버그 버튼 클릭됨!"),fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1",mode:"list"})}).then(e=>e.json()).then(e=>{alert("API 테스트 결과: ".concat(e.success?"성공":"실패"))}).catch(e=>{alert("API 테스트 오류: ".concat(e.message))})},className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 rounded-md text-white",children:"디버그 테스트"}),(0,r.jsx)(x(),{href:"/admin/content",className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-800",children:"콘텐츠 목록으로 돌아가기"})]})]}),(0,r.jsx)("script",{dangerouslySetInnerHTML:{__html:"\n          // 페이지 로드 완료 후 실행\n          document.addEventListener('DOMContentLoaded', function() {\n            console.log('디버깅 스크립트 로드됨');\n            \n            // 스텔스 모드 버튼에 이벤트 리스너 직접 추가\n            const stealthModeBtn = document.getElementById('stealth-mode-button');\n            if (stealthModeBtn) {\n              stealthModeBtn.addEventListener('click', function() {\n                console.log('스텔스 모드 버튼 클릭 - 직접 이벤트 리스너');\n              });\n            }\n            \n            // 크롤링 시작 버튼에 이벤트 리스너 직접 추가\n            const startCrawlingBtn = document.getElementById('start-stealth-crawling-button');\n            if (startCrawlingBtn) {\n              startCrawlingBtn.addEventListener('click', function() {\n                console.log('스텔스 크롤링 시작 버튼 클릭 - 직접 이벤트 리스너');\n                // 이벤트 발생 확인용 알림창\n                alert('스텔스 크롤링 버튼 클릭됨 (직접 이벤트 리스너에서 감지)');\n              });\n            }\n          });\n          \n          // 진단 함수\n          function diagnoseCrawler() {\n            console.log('크롤러 진단 시작');\n            \n            // 버튼 요소 확인\n            const stealthModeBtn = document.getElementById('stealth-mode-button');\n            const startCrawlingBtn = document.getElementById('start-stealth-crawling-button');\n            \n            console.log('스텔스 모드 버튼 존재:', !!stealthModeBtn);\n            console.log('스텔스 크롤링 시작 버튼 존재:', !!startCrawlingBtn);\n            \n            // window에 노출된 함수 확인\n            console.log('startAutoCrawling 함수 노출 여부:', typeof window.startAutoCrawling === 'function');\n            console.log('debugState 객체 노출 여부:', !!window.debugState);\n            \n            if (window.debugState) {\n              console.log('현재 상태:', {\n                autoMode: window.debugState.getAutoMode(),\n                puppeteerEnabled: window.debugState.getPuppeteerEnabled(),\n                autoCrawling: window.debugState.getAutoCrawling()\n              });\n            }\n            \n            // 직접 함수 호출 테스트\n            console.log('직접 함수 호출을 시도하려면 브라우저 콘솔에서 window.startAutoCrawling()을 실행하세요.');\n          }\n          \n          // 전역 객체에 진단 함수 노출\n          window.diagnoseCrawler = diagnoseCrawler;\n          \n          // 1초 후 자동 실행\n          setTimeout(diagnoseCrawler, 1000);\n        "}}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center",children:[(0,r.jsx)(u,{size:20,className:"mr-2 text-purple-600"}),"스텔스 크롤링 모드"]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"URL을 입력하고 페이지 수를 설정한 후 시작하면 자동으로 드라마 목록과 상세 정보를 크롤링하고 저장합니다."}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)(()=>(0,r.jsx)("button",{onClick:eS,disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.default,{size:18,className:"inline-block mr-2 animate-spin"}),"백업 중..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.default,{size:18,className:"inline-block mr-2"}),"드라마 백업"]})}),{}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"크롤링 중 문제가 생길 경우를 대비해 데이터를 백업합니다. 크롤링 시작 전에도 자동으로 백업됩니다."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-medium mb-1",children:"시작 URL"}),(0,r.jsx)("input",{type:"text",value:F,onChange:e=>U(e.target.value),placeholder:"https://mydramalist.com/search?...",className:"w-full border border-gray-300 rounded-md px-3 py-2",disabled:$})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-medium mb-1",children:"최대 페이지 수"}),(0,r.jsx)("input",{type:"number",min:"1",max:"10",value:Z,onChange:e=>V(parseInt(e.target.value)||1),className:"w-full border border-gray-300 rounded-md px-3 py-2",disabled:$})]}),(0,r.jsx)("div",{className:"flex items-end",children:$?(0,r.jsxs)("button",{onClick:()=>{eo(!0),ec&&(ec.abort(),ed(null)),K(!1),Q(!1),ee([]),en({current:0,total:0}),alert("크롤링이 중지되었습니다. 모든 진행 중인 요청이 취소되었습니다."),em("자동 크롤링이 중지되었습니다.","info"),confirm("페이지를 새로고침하여 모든 크롤링 작업을 강제 종료하시겠습니까?")&&window.location.reload()},className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center justify-center",children:[(0,r.jsx)(g,{size:18,className:"mr-2"}),"크롤링 중지"]}):(0,r.jsxs)("button",{id:"start-stealth-crawling-button",onClick:()=>{J(!0),es(!0),eo(!1),X({page:0,totalPages:parseInt(Z),dramas:0}),ea(0),K(!0),ed(new AbortController),setTimeout(()=>{fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:F,mode:"list",usePuppeteer:!0})}).then(e=>e.json()).then(e=>{if(!e.success)throw Error(e.message||"크롤링 데이터 처리 실패");let t=e.data.dramas;j(e=>[...e,...t]),X(e=>({...e,page:e.page+1,dramas:e.dramas+t.length})),ee(e=>[...e,...t]),e.data.nextPage&&W.page<W.totalPages?ey(e.data.nextPage):(em("총 ".concat(W.dramas,"개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다."),"success"),eb())}).catch(e=>{K(!1),em("스텔스 크롤링 오류: ".concat(e.message),"error")})},100)},className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md flex items-center justify-center",children:[(0,r.jsx)(u,{size:18,className:"mr-2"}),"스텔스 크롤링 시작"]})})]}),(0,r.jsxs)("div",{className:"mb-4 hidden",children:[(0,r.jsxs)("label",{className:"flex items-center mb-1",children:[(0,r.jsx)("input",{type:"checkbox",checked:er,onChange:e=>es(e.target.checked),className:"mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 rounded",disabled:$}),(0,r.jsx)("span",{className:"text-gray-700 text-sm font-medium",children:"Puppeteer 사용 (자동화된 브라우저를 통한 크롤링)"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 ml-6",children:er?"Puppeteer를 사용하면 Cloudflare 보호를 우회하여 자동으로 크롤링할 수 있습니다. 서버 부하가 높을 수 있습니다.":"비활성화된 경우 HTML을 수동으로 입력해야 합니다."})]}),$&&(0,r.jsxs)("div",{className:"bg-gray-100 p-4 rounded-md",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800 mb-2",children:"스텔스 크롤링 진행 상태"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"페이지:"}),(0,r.jsxs)("span",{className:"ml-2 font-medium",children:[W.page," / ",W.totalPages]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"불러온 드라마:"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:W.dramas})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"저장된 드라마:"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:et})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"목록 크롤링:"}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-1",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(Math.min(100,Math.round(W.page/W.totalPages*100)),"%")}})})]}),G&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["상세 정보 크롤링: ",el.current," / ",el.total]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-1",children:(0,r.jsx)("div",{className:"bg-green-600 h-2.5 rounded-full",style:{width:"".concat(Math.min(100,Math.round(el.current/el.total*100)),"%")}})})]})]})]})}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"MyDramalist HTML 코드 입력"}),(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsx)("textarea",{rows:"10",value:a,onChange:e=>{m(e.target.value)},placeholder:"MyDramalist 검색 결과 페이지의 HTML 코드를 붙여넣으세요.",className:"w-full border border-gray-300 rounded-md px-4 py-2 font-mono text-sm"})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"MyDramalist 사이트에서 검색 결과 페이지의 HTML 코드를 복사하여 붙여넣으세요."}),(0,r.jsx)("button",{onClick:()=>{if(!a.trim()){em("HTML 콘텐츠를 입력해주세요.","error");return}try{b(!0);let e=eu(a);j(e.dramas),S(e.nextPage),em("".concat(e.dramas.length,"개의 드라마를 찾았습니다."),"success")}catch(e){w(e.message),em("HTML 파싱 중 오류가 발생했습니다: "+e.message,"error")}},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:"HTML 파싱하기"})]})]})}),f&&(0,r.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded",children:(0,r.jsx)("p",{children:f})}),y&&(0,r.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold",children:["크롤링 결과 (",v.length,")"]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{if(v.every(e=>T[e.id]))A({});else{let e={};v.forEach(t=>{e[t.id]=!0}),A(e)}},className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded text-sm",children:v.every(e=>T[e.id])?"전체 선택 해제":"전체 선택"}),(0,r.jsxs)("button",{onClick:ew,disabled:0===Object.keys(T).filter(e=>T[e]).length,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center disabled:opacity-50",children:[(0,r.jsx)(d.default,{size:16,className:"mr-1"}),"선택 항목 저장"]})]})]}),v.length>0&&(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10",children:"선택"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"이미지"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"제목"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"카테고리"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"방영년도"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"에피소드"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"평점"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"작업"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,r.jsx)("input",{type:"checkbox",checked:!!T[e.id],onChange:()=>ev(e.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:e.imageUrl&&(0,r.jsx)("div",{className:"w-12 h-16 relative",children:(0,r.jsx)("img",{src:e.imageUrl,alt:e.title,className:"object-cover w-full h-full rounded"})})}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,r.jsx)("div",{className:"text-xs text-gray-500 max-w-md line-clamp-2",children:e.summary})]}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:"drama"===e.category?"드라마":"movie"===e.category?"영화":e.category}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.year||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.episodes||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.rating>0?e.rating.toFixed(1):"-"}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>eh(e),disabled:"loading"===E[e.id]||"saved"===E[e.id],className:"inline-flex items-center px-2 py-1 border rounded-md text-xs font-medium\n                              ".concat("saved"===E[e.id]?"bg-green-100 text-green-800 border-green-200":"error"===E[e.id]?"bg-red-100 text-red-800 border-red-200 hover:bg-red-200":"bg-blue-100 text-blue-800 border-blue-200 hover:bg-blue-200"),children:[ej(e.id),(0,r.jsx)("span",{className:"ml-1",children:"loading"===E[e.id]?"저장 중...":"saved"===E[e.id]?"저장됨":"error"===E[e.id]?"재시도":"상세 HTML 입력"})]}),(0,r.jsx)("button",{onClick:()=>{try{alert("'".concat(e.title,"' 상세 정보를 크롤링합니다.")),M(t=>({...t,[e.id]:"loading"})),fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,mode:"detail"})}).then(e=>e.json()).then(t=>{if(t.success){Object.assign(e,t.data);let a=localStorage.getItem("token")||localStorage.getItem("adminToken");return fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:a?"Bearer ".concat(a):""},body:JSON.stringify({data:t.data})})}throw Error(t.message||"상세 정보 크롤링 실패")}).then(e=>e.json()).then(t=>{M(t=>({...t,[e.id]:"saved"})),em("'".concat(e.title,"' 저장 완료"),"success")}).catch(t=>{M(t=>({...t,[e.id]:"error"})),em("'".concat(e.title,"' 처리 중 오류: ").concat(t.message),"error")})}catch(e){alert("처리 중 오류: ".concat(e.message))}},disabled:"loading"===E[e.id]||"saved"===E[e.id],className:"ml-2 text-purple-600 hover:text-purple-800 text-xs hover:underline disabled:opacity-50 disabled:hover:no-underline",children:"스텔스 크롤링"}),"saved"===E[e.id]&&(0,r.jsx)("button",{onClick:()=>eN(e),className:"ml-2 text-green-600 hover:text-green-800 text-xs hover:underline",children:"드라마 등록"}),(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:text-blue-800 text-xs",children:"상세"})]})})]},e.id))})]})})}),(0,r.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mt-6 rounded-md",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"사용 가이드"}),(0,r.jsxs)("ol",{className:"list-decimal pl-5 text-blue-800",children:[(0,r.jsxs)("li",{className:"mb-2",children:[(0,r.jsx)("a",{href:"https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"MyDramalist"}),"에서 검색 결과 페이지를 열고 웹 브라우저 개발자 도구를 엽니다 (F12 또는 마우스 우클릭 후 '검사')."]}),(0,r.jsx)("li",{className:"mb-2",children:"결과 목록이 있는 부분 (box 클래스가 있는 요소)을 우클릭하고 '복사' > 'OuterHTML'을 선택합니다."}),(0,r.jsx)("li",{className:"mb-2",children:"복사한 HTML을 위의 텍스트 영역에 붙여넣고 '파싱하기' 버튼을 클릭합니다."}),(0,r.jsx)("li",{className:"mb-2",children:"상세 정보를 저장하려면 드라마 상세 페이지를 열고 같은 방식으로 HTML을 복사한 후 '상세 HTML 입력' 버튼을 클릭하세요."})]})]}),C.visible&&(0,r.jsx)("div",{className:"fixed bottom-4 right-4 px-4 py-2 rounded-md shadow-lg ".concat("success"===C.type?"bg-green-500 text-white":"error"===C.type?"bg-red-500 text-white":"bg-blue-500 text-white"),children:C.message})]}),P&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold",children:['"',null==O?void 0:O.title,'"']}),(0,r.jsx)("button",{onClick:()=>q(!1),className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:(null==O?void 0:O.id)==="auto-list"?(0,r.jsxs)(r.Fragment,{children:["MyDramalist 목록 페이지에서 ",(0,r.jsx)("code",{children:"<body>"})," 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."]}):(null==O?void 0:O.id)==="auto-detail"?(0,r.jsxs)(r.Fragment,{children:["MyDramalist 상세 페이지에서 ",(0,r.jsx)("code",{children:"<body>"})," 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."]}):(0,r.jsx)(r.Fragment,{children:"MyDramalist 사이트에서 드라마 상세 페이지에 접속한 후, 개발자 도구를 열고 <body> 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."})}),(0,r.jsx)("textarea",{rows:"10",value:I,onChange:e=>R(e.target.value),placeholder:"HTML 코드를 붙여넣으세요.",className:"w-full border border-gray-300 rounded-md px-4 py-2 font-mono text-sm"}),(0,r.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,r.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100",children:"취소"}),(0,r.jsx)("button",{onClick:ex,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:(null==O?void 0:O.id)==="auto-list"||(null==O?void 0:O.id)==="auto-detail"?"계속하기":"저장"})]})]})})]})}}},function(e){e.O(0,[1664,5089,628,9643,2888,9774,179],function(){return e(e.s=40578)}),_N_E=e.O()}]);