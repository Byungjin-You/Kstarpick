"use strict";exports.id=9778,exports.ids=[9778],exports.modules={56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},44756:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var n=r(11185),a=r.n(n);r(25142).config({path:".env.production"});let i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";i||(i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),i.includes("localhost")||(i.includes("mongodb://")&&!i.includes("authSource=")&&(i.includes("?")?i+="&authSource=admin":i+="?authSource=admin"),!i.includes("docdb.amazonaws.com")||i.includes("authMechanism=")||(i.includes("?")?i+="&authMechanism=SCRAM-SHA-1":i+="?authMechanism=SCRAM-SHA-1"));let o=i.includes("localhost")||i.includes("127.0.0.1"),l=global.mongoose;async function u(){if(l.conn&&1===a().connection.readyState)return l.conn;if(0===a().connection.readyState||3===a().connection.readyState){l.conn=null,l.promise=null;try{await a().connection.close()}catch(e){}}if(!l.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};o||(i.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),l.promise=a().connect(i,e).then(e=>(e.connection.on("error",e=>{l.conn=null,l.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{l.conn=null,l.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw l.promise=null,e})}try{return l.conn=await l.promise,l.conn}catch(e){throw l.promise=null,e}}l||(l=global.mongoose={conn:null,promise:null});let d=u},12277:(e,t,r)=>{let n;r.r(t),r.d(t,{validateToken:()=>h});var a=r(99344),i=r.n(a),o=r(84802),l=r(81075),u=r(44756),d=r(38013);{let e=r(25142);e.config({path:"./.env.local"}),e.config({path:"./.env.production"})}let c="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",s=c.includes("localhost")||c.includes("127.0.0.1"),m={maxPoolSize:10,minPoolSize:2,serverSelectionTimeoutMS:1e4,socketTimeoutMS:3e4,connectTimeoutMS:1e4,family:4,maxIdleTimeMS:6e4,retryWrites:!1,readPreference:"primary",compressors:["zlib"],heartbeatFrequencyMS:3e4,monitorCommands:!1};if(s||(m.authMechanism="SCRAM-SHA-1",m.tls=!0,m.tlsAllowInvalidCertificates=!0,m.tlsAllowInvalidHostnames=!0,m.retryWrites=!1,m.tlsCAFile=void 0,m.tlsCertificateKeyFile=void 0),!c)throw Error("Please define the MONGODB_URI environment variable inside .env.local");n=(async function(){let e=0;for(;e<3;)try{let e=new d.MongoClient(c,m);return await e.connect(),await e.db("kstarpick").admin().ping(),e.on("error",e=>{}),e.on("close",()=>{}),e.on("reconnect",()=>{}),e}catch(r){if(++e>=3)throw r;let t=1e3*Math.pow(2,e);await new Promise(e=>setTimeout(e,t))}})().then(e=>e).catch(e=>{throw e});let p=null;async function y(){if(p)try{return await p.client.db("kstarpick").admin().ping(),p}catch(e){p=null}try{let e=await n,t=e.db("kstarpick");return await t.admin().ping(),p={client:e,db:t}}catch(e){throw p=null,e}}var f=r(60614);async function h(e){let t;try{let t=await (0,f.getToken)({req:e,secret:"kstarpick_nextauth_secret_key_2024_production"});if(t){await (0,u.default)();let e=await l.default.findById(t.id||t.sub);if(e)return{_id:e._id,id:e._id,name:e.name,email:e.email,role:e.role,isAdmin:"admin"===e.role}}}catch(e){}let r=function(e){if(e.headers.authorization&&e.headers.authorization.startsWith("Bearer "))return e.headers.authorization.split(" ")[1];if(e.headers.cookie){let t=(0,o.parse)(e.headers.cookie);if(t.token)return t.token}return null}(e);if(!r)return null;try{t=i().verify(r,"kstarpick_jwt_secret_key_2024_production")}catch(e){return null}let n=await g(t.id);return n?{_id:n._id,id:n._id,name:n.name,email:n.email,role:n.role,isAdmin:"admin"===n.role}:null}async function g(e){try{await (0,u.default)();let t=await l.default.findById(e);if(t)return t}catch(e){}try{let{db:t}=await y();return await t.collection("users").findOne({_id:new d.ObjectId(e)})}catch(e){return null}}},74053:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(11185),a=r.n(n);let i=new(a()).Schema({title:{type:String,required:[!0,"Please provide a title for this TV/Film"],maxlength:[200,"Title cannot be more than 200 characters"]},originalTitle:{type:String,required:!1},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this TV/Film"]},summary:{type:String,required:[!0,"Please provide a summary for this TV/Film"],maxlength:[1e3,"Summary cannot be more than 1000 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this TV/Film"]},bannerImage:{type:String,required:!1,default:""},trailerUrl:{type:String,required:!1,default:""},category:{type:String,required:[!0,"Please select a category for this TV/Film"],enum:["drama","movie","variety","documentary","other"]},status:{type:String,required:[!0,"Please select a status for this TV/Film"],enum:["ongoing","completed","upcoming","canceled"],default:"ongoing"},network:{type:String,required:!1},releaseDate:{type:Date,required:[!0,"Please provide a release date for this TV/Film"]},rating:{type:Number,required:!1,min:[0,"Rating cannot be less than 0"],max:[10,"Rating cannot be more than 10"],default:0},reviewRating:{type:Number,min:[0,"Review rating cannot be less than 0"],max:[10,"Review rating cannot be more than 10"],default:0},reviewCount:{type:Number,default:0},ratingDistribution:{type:[Number],default:[0,0,0,0,0,0,0,0,0,0],validate:{validator:function(e){return 10===e.length},message:"Rating distribution must have exactly 10 values"}},runtime:{type:String,required:!1},ageRating:{type:String,required:!1,enum:["ALL","12","15","18","R"]},director:{type:String,required:!1},country:{type:String,required:!1},tags:{type:[String],default:[]},genres:{type:[String],default:[]},cast:{type:[{name:{type:String,required:!0},role:{type:String},image:{type:String},order:{type:Number,default:0}}],default:[]},watchProviders:{type:[{name:{type:String,required:!0},logo:{type:String},type:{type:String,enum:["subscription","rental","purchase","free"],required:!0},price:{type:String},quality:[String],url:{type:String},order:{type:Number,default:0}}],default:[]},videos:{type:[{title:{type:String},type:{type:String,enum:["trailer","teaser","ad","making-of","clip","interview","other"],required:!0},url:{type:String,required:!0},order:{type:Number,default:0}}],default:[]},author:{type:a().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},orderNumber:{type:Number,default:0,index:!0},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"en"},translationOf:{type:a().Schema.Types.ObjectId,ref:"TVFilm",default:null},views:{type:Number,default:0},likes:{type:Number,default:0},dislikes:{type:Number,default:0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),o=a().models.TVFilm||a().model("TVFilm",i)},81075:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(11185),a=r.n(n);let i=new(a()).Schema({name:{type:String,required:[!0,"Please provide a name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0},password:{type:String,required:[!0,"Please provide a password"]},image:{type:String,default:"/images/default-avatar.png"},role:{type:String,enum:["user","admin","editor"],default:"user"},likes:{type:[{contentId:{type:a().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},dislikes:{type:[{contentId:{type:a().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},bookmarks:{type:[{contentId:{type:a().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),o=a().models.User||a().model("User",i)},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};