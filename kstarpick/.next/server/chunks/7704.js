"use strict";exports.id=7704,exports.ids=[7704],exports.modules={56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},85787:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{default:()=>C,fetchArticleDetail:()=>$});var r=a(99648),l=a(20295),o=a(35968);a(38013),a(92048);var n=a(65462),s=e([r,l,n]);function c(e,t=null){t&&JSON.stringify(t)}function p(e){let t=new Date().toISOString(),i=`[FORCE LOG] ${t}: ${e}`,r=a(92048);try{r.appendFileSync("/tmp/news-crawl-debug.log",i+"\n")}catch(e){}}function g(e){if(!e)return!0;let t=e.toLowerCase();for(let a of["quiz:","soompi"])if(t.includes(a))return c(`ë‰´ìŠ¤ ì œì™¸: "${e}" (í‚¤ì›Œë“œ: "${a}")`),!0;return!1}[r,l,n]=s.then?(await s)():s;let S=a(84770);async function d(e,t){try{let{db:a}=await (0,o.connectToDatabase)(),i=a.collection("image_hashes");await i.findOne({hash:t})||await i.insertOne({hash:t,url:e,createdAt:new Date})}catch(e){}}async function m(e){if(!e)return null;if(e.startsWith("/api/proxy/")||e.startsWith("/images/"))return e;if(e.startsWith("http://")||e.startsWith("https://")){let t=S.createHash("sha256").update(e).digest("hex").substring(0,16);return await d(e,t),`/api/proxy/hash-image?hash=${t}`}return e}function h(e){if(!e)return e;let t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<\/p>\s*<p>/g,"</p>\n\n<p>")).replace(/<p>\s*<\/p>/gi,"")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p><br\s*\/?><\/p>/gi,"")).replace(/<p>([^<]*)<br\s*\/?>\s*([^<]*)<\/p>/gi,"<p>$1 $2</p>")).replace(/<\/ol>\s*<p>/g,"</ol>\n\n<p>")).replace(/<\/p>\s*<ol>/g,"</p>\n\n<ol>")).replace(/<\/ul>\s*<p>/g,"</ul>\n\n<p>")).replace(/<\/p>\s*<ul>/g,"</p>\n\n<ul>")).replace(/<hr[^>]*>/gi,"")).replace(/<hr\s*\/?>/gi,"")).replace(/<hr>/gi,"")).replace(/\s*<hr[^>]*>\s*$/gi,"")).replace(/\s*<hr\s*\/?>\s*$/gi,"")).replace(/\n{3,}/g,"\n\n")).trim()}function u(e){let t={kpop:["Sarah","Michael","Jessica","David","Emma","Ryan"],drama:["Jennifer","James","Sophie","Daniel","Grace","Alex"],movie:["Rachel","Kevin","Lily","Steven","Mia","Eric"],variety:["Chloe","Tyler","Zoe","Noah","Aria","Lucas"],celeb:["Olivia","Ethan","Ava","Mason","Isabella","Logan"]},a=t[e]||t.kpop,i=Math.floor(Math.random()*a.length);return a[i]}function f(e){if(!e)return e;let t=e,a=[...t.matchAll(/https?:\/\/(?:www\.)?instagram\.com\/(?:p|reel)\/([A-Za-z0-9_-]+)/g)];return 0===a.length?t:(a.forEach((e,a)=>{let i=e[0];e[1];let r=`<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-permalink="${i}" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);">
<div style="padding:16px;">
<a href="${i}" style="background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank">
<div style=" display: flex; flex-direction: row; align-items: center;">
<div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div>
<div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;">
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div>
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div>
</div>
</div>
<div style="padding: 19% 0;"></div>
<div style="display:block; height:50px; margin:0 auto 12px; width:50px;">
<svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g transform="translate(-511.000000, -20.000000)" fill="#000000">
<g>
<path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path>
</g>
</g>
</g>
</svg>
</div>
<div style="padding-top: 8px;">
<div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;"></div>
</div>
<div style="padding: 12.5% 0;"></div>
<div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;">
<div>
<div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div>
<div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div>
<div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div>
</div>
<div style="margin-left: 8px;">
<div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div>
<div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div>
</div>
<div style="margin-left: auto;">
<div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div>
<div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div>
<div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div>
</div>
</div>
<div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;">
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div>
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div>
</div>
</a>
<p><a href="${i}" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"></a></p>
<p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="${i}" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank"></a></p>
</div>
</blockquote>`;if(t.includes("instagram-media"))return t=(t=t.replace(/View this post on Instagram/gi,"")).replace(/A post shared by[^<\n\)]*[\)\n]?/gi,"");let l=[/<blockquote[^>]*>[\s\S]*?View this post on Instagram[\s\S]*?<\/blockquote>/gi,/>\s*View this post on Instagram[\s\S]*?A post shared by[^<\n]*[\)\n]/gi,/View this post on Instagram[\s\S]*?A post shared by[^\n\)]*[\)\n]?/gi,/<p[^>]*>\s*View this post on Instagram\s*<\/p>[\s\S]*?<p[^>]*>\s*A post shared by[^<]*<\/p>/gi,/<p[^>]*>\s*View this post on Instagram[\s\S]*?A post shared by[^<]*<\/p>/gi],o=!1;for(let e=0;e<l.length;e++){let a=l[e],i=t.match(a);if(i&&i.length>0){t=t.replace(a,r),o=!0;break}}if(!o){let e=t.indexOf(i);if(-1!==e){let a=t.substring(Math.max(0,e-500),e),l=t.substring(e+i.length,Math.min(t.length,e+i.length+500)),n=a.lastIndexOf("View this post"),s=l.match(/A post shared by[^<\n\)]*[\)\n]?/);if(-1!==n&&s){let l=e-(a.length-n),c=e+i.length+s.index+s[0].length,p=t.substring(0,l),g=t.substring(c);t=p+r+g,o=!0}}}}),(t=(t=(t=(t=t.replace(/View this post on Instagram/gi,"")).replace(/A post shared by[^<\n\)]*[\)\n]?/gi,"")).replace(/<p[^>]*>\s*<\/p>/gi,"")).replace(/\s*\n\s*\n\s*/g,"\n\n")).trim())}function w(e){if(!e)return e;let t=e;return t=(t=t.replace(/<p[^>]*>Source(?:\s*\(\d+\))?:?.*?<\/p>/gi,"<!-- Source information removed for readability -->")).replace(/<p[^>]*>Source:.*?<\/p>/gi,"<!-- Source information removed for readability -->")}async function y(e=50){let t;p(`!!!!! í•¨ìˆ˜ ì§„ì… í™•ì¸: maxItemsLimit=${e} !!!!!`),p(`!!!!! maxItemsLimit íƒ€ì…: ${typeof e} !!!!!`),p(`!!!!! maxItemsLimit ê°’: ${JSON.stringify(e)} !!!!!`);try{c("Puppeteer í¬ë¡¤ë§ ì‹œì‘..."),p("=== Puppeteer í¬ë¡¤ë§ ì‹œì‘ ==="),p(`=== DEBUG: Puppeteer í•¨ìˆ˜ ì§„ì…, maxItemsLimit=${e} ===`),t=await n.default.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--disable-gpu"]});let a=await t.newPage();await a.setUserAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36"),c("https://www.soompi.com/ ì ‘ì† ì‹œë„..."),p("https://www.soompi.com/ ì ‘ì† ì‹œë„..."),await a.goto("https://www.soompi.com/",{waitUntil:"networkidle2",timeout:3e4}),c("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ"),p("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");let i=await a.title();p(`í˜ì´ì§€ ì œëª©: ${i}`);let r=[],l=await a.evaluate(()=>{let e=[];for(let t of['a[href*="/article/"]','a[href*="soompi.com/article"]',"h4.media-heading a","h3 a","h2 a",".entry-title a",".post-title a","article a",".news-item a",".article-title a"])document.querySelectorAll(t).forEach((a,i)=>{let r=a.textContent.trim(),l=a.href;if(r&&l&&l.includes("soompi.com")&&l.includes("/article/")&&r.length>5&&!e.some(e=>e.url===l)){let o="",n=a.querySelector("img");if(n&&n.src&&(o=n.src),!o){let e=a.closest('article, .post, .news-item, div[class*="article"], div[class*="post"]');if(e){let t=e.querySelector("img");t&&t.src&&(o=t.src)}}if(!o&&a.previousElementSibling){let e=a.previousElementSibling.querySelector("img");e&&e.src&&(o=e.src)}if(!o&&a.nextElementSibling){let e=a.nextElementSibling.querySelector("img");e&&e.src&&(o=e.src)}e.push({title:r,url:l,thumbnailUrl:o||"",index:i,selector:t})}});return e});p(`currentNewsLinks ê°œìˆ˜: ${l.length}`),c(`currentNewsLinks ê°œìˆ˜: ${l.length}`),c(`í˜„ì¬ í˜ì´ì§€ì—ì„œ ${l.length}ê°œ ë‰´ìŠ¤ ë§í¬ ë°œê²¬`);let o=Math.min(2*e,100),s=l.slice(0,o);for(let t of(l.length>o&&p(`ì²« í˜ì´ì§€ ë§í¬ë¥¼ ${l.length}ê°œì—ì„œ ${o}ê°œë¡œ ì œí•œ`),s)){if(r.length>=e)break;if(g(t.title)){p(`ë‰´ìŠ¤ ì œì™¸ë¨: "${t.title}"`);continue}if(!r.some(e=>e.articleUrl===t.url)){let e="";t.thumbnailUrl&&(e=`/api/proxy/image?url=${encodeURIComponent(t.thumbnailUrl)}`,p(`ğŸ–¼ï¸ í™ˆí˜ì´ì§€ ì´ë¯¸ì§€ í”„ë¡ì‹œ ë³€í™˜: ${t.thumbnailUrl} â†’ ${e}`));let a="";if(t.url&&t.url.includes("/category/")){let e=t.url.match(/\/category\/([^\/]+)/);e&&e[1]&&(a=e[1])}try{let i=await k(t.title,t.url,e,a,"Recently",r.length);r.push(i),c(`ë‰´ìŠ¤ ë§í¬ ì¶”ê°€: title="${t.title}", slug="${i.slug}"`),p(`ë‰´ìŠ¤ ë§í¬ ì¶”ê°€: "${t.title}"`)}catch(e){c(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì‹¤íŒ¨: ${t.title}`,e),p(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì‹¤íŒ¨: ${t.title} - ${e.message}`)}}}if(c(`ì´ ${r.length}ê°œì˜ ë‰´ìŠ¤ í•­ëª©ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`),p(`ì´ ${r.length}ê°œì˜ ë‰´ìŠ¤ í•­ëª©ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`),p(`=== ì¶”ê°€ ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹œì‘ ===`),p(`í˜„ì¬ newsItems.length: ${r.length}, maxItemsLimit: ${e}`),p(`ì¡°ê±´ ì²´í¬: newsItems.length < maxItemsLimit = ${r.length<e}`),r.length<e){p(`=== /latest í˜ì´ì§€ Load More í¬ë¡¤ë§ ì‹œì‘ ===`);try{await a.goto("https://www.soompi.com/latest",{waitUntil:"networkidle2",timeout:3e4}),p("/latest í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");let t=0,i=Math.ceil((e-r.length)/15);for(p(`/latest Load More ì‹œì‘: í˜„ì¬ ${r.length}ê°œ, ëª©í‘œ ${e}ê°œ, ìµœëŒ€ ${i}ë²ˆ ì‹œë„`);t<i&&r.length<e;){t++;let l=await a.evaluate(()=>{let e=[];document.querySelectorAll("a").forEach(t=>{if(t.href&&t.href.includes("soompi.com")&&t.href.includes("/article/")){let a=t.textContent?.trim()||"";if(a.length>3){let i="",r=t.querySelector("img");if(r&&r.src&&(i=r.src),!i){let e=t.closest('article, .post, .news-item, div[class*="article"], div[class*="post"]');if(e){let t=e.querySelector("img");t&&t.src&&(i=t.src)}}if(!i&&t.previousElementSibling){let e=t.previousElementSibling.querySelector("img");e&&e.src&&(i=e.src)}if(!i&&t.nextElementSibling){let e=t.nextElementSibling.querySelector("img");e&&e.src&&(i=e.src)}e.push({title:a,url:t.href,thumbnailUrl:i||""})}}});let t=[];return e.forEach(e=>{t.some(t=>t.url===e.url)||t.push(e)}),t});p(`/latest ì‹œë„ ${t}: ${l.length}ê°œ ë‰´ìŠ¤ ë§í¬ ë°œê²¬`);let o=0;for(let t of l){if(r.length>=e)break;if(g(t.title)){p(`/latestì—ì„œ ë‰´ìŠ¤ ì œì™¸ë¨: "${t.title}"`);continue}if(!r.some(e=>e.articleUrl===t.url))try{let e="";t.thumbnailUrl&&(e=`/api/proxy/image?url=${encodeURIComponent(t.thumbnailUrl)}`,p(`ğŸ–¼ï¸ ì´ë¯¸ì§€ í”„ë¡ì‹œ ë³€í™˜: ${t.thumbnailUrl} â†’ ${e}`));let a=await k(t.title,t.url,e,"","Recently",r.length);r.push(a),o++,p(`/latestì—ì„œ ìƒˆ ë‰´ìŠ¤ ì¶”ê°€ [ì´ ${r.length}ê°œ]: "${t.title}"`)}catch(e){p(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì‹¤íŒ¨: ${t.title} - ${e.message}`)}}if(p(`/latest ì‹œë„ ${t}ì—ì„œ ${o}ê°œ ìƒˆ ë‰´ìŠ¤ ì¶”ê°€ë¨ (ì´ ${r.length}ê°œ)`),r.length>=e||t>=i){p(`/latest í¬ë¡¤ë§ ì™„ë£Œ: ${r.length}ê°œ (ëª©í‘œ: ${e}ê°œ)`);break}await a.evaluate(()=>{window.scrollTo(0,document.body.scrollHeight)}),await new Promise(e=>setTimeout(e,2e3));let n=await a.evaluate(()=>{for(let e of Array.from(document.querySelectorAll('button, a, div[role="button"]'))){let t=e.textContent?.toLowerCase()||"";if((t.includes("load more")||t.includes("load")&&t.includes("more"))&&null!==e.offsetParent&&"none"!==e.style.display)return e.click(),`Load More í´ë¦­ ì„±ê³µ: "${e.textContent.trim()}"`}return!1});if(n){p(`ğŸ¯ /latest ${n}`),await new Promise(e=>setTimeout(e,5e3));try{await a.waitForFunction(e=>document.querySelectorAll('a[href*="/article/"]').length>e,{timeout:1e4},l.length),p("âœ… /latest ìƒˆ ì½˜í…ì¸  ë¡œë”© ì™„ë£Œ")}catch(e){p("â° /latest ìƒˆ ì½˜í…ì¸  ë¡œë”© ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼")}}else{p("âŒ /latest Load More ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ - ì™„ë£Œ");break}}p(`/latest Load More í¬ë¡¤ë§ ì™„ë£Œ: ì´ ${r.length}ê°œ ë‰´ìŠ¤ ìˆ˜ì§‘`)}catch(e){p(`/latest í˜ì´ì§€ í¬ë¡¤ë§ ì‹¤íŒ¨: ${e.message}`)}}if(p(`=== ì¶”ê°€ í˜ì´ì§€ í¬ë¡¤ë§ ì‹œì‘ ===`),r.length<e){for(let t of(p(`ì¶”ê°€ í˜ì´ì§€ í¬ë¡¤ë§ ì‹œì‘: í˜„ì¬ ${r.length}ê°œ, ëª©í‘œ ${e}ê°œ`),["https://www.soompi.com/k-pop","https://www.soompi.com/k-dramas","https://www.soompi.com/page/2","https://www.soompi.com/page/3"])){if(r.length>=e)break;p(`=== ${t} í˜ì´ì§€ í¬ë¡¤ë§ ì‹œì‘ ===`);try{await a.goto(t,{waitUntil:"networkidle2",timeout:3e4}),p(`${t} í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ`);let i=await a.evaluate(()=>{let e=[];document.querySelectorAll("a").forEach(t=>{if(t.href&&t.href.includes("soompi.com")&&t.href.includes("/article/")){let a=t.textContent?.trim()||"",i=t.href;a.length>3&&e.push({title:a,url:i})}});let t=[];return e.forEach(e=>{t.some(t=>t.url===e.url)||t.push(e)}),t});p(`${t}ì—ì„œ ${i.length}ê°œ ë‰´ìŠ¤ ë§í¬ ë°œê²¬`);let l=0;for(let a of i){if(r.length>=e)break;if(g(a.title)){p(`${t}ì—ì„œ ë‰´ìŠ¤ ì œì™¸ë¨: "${a.title}"`);continue}if(!r.some(e=>e.articleUrl===a.url))try{let e=await k(a.title,a.url,"","","Recently",r.length);r.push(e),l++,p(`${t}ì—ì„œ ìƒˆ ë‰´ìŠ¤ ì¶”ê°€ [ì´ ${r.length}ê°œ]: "${a.title}"`)}catch(e){p(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì‹¤íŒ¨: ${a.title} - ${e.message}`)}}p(`${t}ì—ì„œ ${l}ê°œ ìƒˆ ë‰´ìŠ¤ ì¶”ê°€ë¨ (ì´ ${r.length}ê°œ)`)}catch(e){p(`${t} í¬ë¡¤ë§ ì‹¤íŒ¨: ${e.message}`)}}p(`ì¶”ê°€ í˜ì´ì§€ í¬ë¡¤ë§ ì™„ë£Œ: ìµœì¢… ${r.length}ê°œ ë‰´ìŠ¤ ìˆ˜ì§‘`)}else p(`ëª©í‘œ ë‹¬ì„±: ${r.length}ê°œ >= ${e}ê°œ`);if(t)try{await t.close(),c("Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ"),p("Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){c("ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜:",e),p(`ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`)}return r}catch(e){if(c("Puppeteer í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜:",e),p(`Puppeteer í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜: ${e.message}`),t)try{await t.close(),c("ì—ëŸ¬ ë°œìƒ ì‹œ Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ"),p("ì—ëŸ¬ ë°œìƒ ì‹œ Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){c("ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜:",e),p(`ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`)}return[]}}async function b(e=50){try{c("ì •ì  í¬ë¡¤ë§ ì‹œì‘..."),p("=== ì •ì  í¬ë¡¤ë§ ì‹œì‘ ==="),c("https://www.soompi.com/latest ì ‘ì† ì‹œë„..."),p("https://www.soompi.com/latest ì ‘ì† ì‹œë„...");try{let t=await r.default.get("https://www.soompi.com/latest",{headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5"},timeout:1e4});p("axios ìš”ì²­ ì„±ê³µ");let a=t.data;if(c(`HTML ë°ì´í„° ê°€ì ¸ì˜´, ê¸¸ì´: ${a?.length}`),p(`HTML ë°ì´í„° ê°€ì ¸ì˜´, ê¸¸ì´: ${a?.length}`),!a||a.length<1e3)return c("HTML ë°ì´í„°ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ì°¨ë‹¨ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."),p("HTML ë°ì´í„°ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ì°¨ë‹¨ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."),[];p("cheerio ë¡œë“œ ì‹œì‘...");let i=l.load(a);p("cheerio ë¡œë“œ ì™„ë£Œ"),c("í˜ì´ì§€ ì œëª©: "+i("title").text()),p("í˜ì´ì§€ ì œëª©: "+i("title").text());let o=[];p("ë‰´ìŠ¤ ë§í¬ ê²€ìƒ‰ ì‹œì‘...");let n=i(".col-sm-12.col-md-4 .media-heading a");if(c(`ë‰´ìŠ¤ ë§í¬ ìˆ˜: ${n.length}`),p(`ë‰´ìŠ¤ ë§í¬ ìˆ˜: ${n.length}`),n.length>0){c("=== ê°œë³„ ë‰´ìŠ¤ ë§í¬ ì²˜ë¦¬ ì‹œì‘ ==="),p("=== ê°œë³„ ë‰´ìŠ¤ ë§í¬ ì²˜ë¦¬ ì‹œì‘ ===");let t=n.toArray();for(let a=0;a<t.length;a++)try{let r=t[a],l=i(r),n=l.text().trim(),s=l.attr("href");if(c(`ë§í¬ ${a+1}: title="${n}", url="${s}"`),g(n)){p(`ì •ì  í¬ë¡¤ë§ì—ì„œ ë‰´ìŠ¤ ì œì™¸ë¨: "${n}"`);continue}if(s&&n&&!o.some(e=>e.articleUrl===s)){let e=l.closest(".col-sm-12.col-md-4"),t=e.find(".date-time").text().trim()||"Recently",i=e.find(".thumbnail-wrapper img").attr("src")||"",r="";if(s&&s.includes("/category/")){let e=s.match(/\/category\/([^\/]+)/);e&&e[1]&&(r=e[1])}let g=await k(n,s,i,r,t,a);o.push(g),c(`ë‰´ìŠ¤ ë§í¬ ì¶”ê°€ (í•­ëª© ${a+1}): title="${n}", slug="${g.slug}"`),p(`ë‰´ìŠ¤ ë§í¬ ì¶”ê°€ (í•­ëª© ${a+1}): title="${n}", slug="${g.slug}"`)}else c(`ë§í¬ ${a+1} ìŠ¤í‚µ: ${s&&n?"ì¤‘ë³µ URL":"ì œëª© ë˜ëŠ” URL ì—†ìŒ"}`);if(o.length>=e){c(`ìµœëŒ€ ì•„ì´í…œ ìˆ˜(${e}) ë„ë‹¬, ë£¨í”„ ì¤‘ë‹¨`),p(`ìµœëŒ€ ì•„ì´í…œ ìˆ˜(${e}) ë„ë‹¬, ë£¨í”„ ì¤‘ë‹¨`);break}}catch(e){c("ë‰´ìŠ¤ ë§í¬ íŒŒì‹± ì¤‘ ì˜¤ë¥˜:",e),p("ë‰´ìŠ¤ ë§í¬ íŒŒì‹± ì¤‘ ì˜¤ë¥˜: "+e.message)}c("=== ê°œë³„ ë‰´ìŠ¤ ë§í¬ ì²˜ë¦¬ ì™„ë£Œ ==="),p("=== ê°œë³„ ë‰´ìŠ¤ ë§í¬ ì²˜ë¦¬ ì™„ë£Œ ===")}else{c(".col-sm-12.col-md-4 .media-heading a ì…€ë ‰í„°ë¡œ ë‰´ìŠ¤ ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),p(".col-sm-12.col-md-4 .media-heading a ì…€ë ‰í„°ë¡œ ë‰´ìŠ¤ ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ");let t=i("h4.media-heading a");if(c(`ë°±ì—… ì…€ë ‰í„°ë¡œ ì°¾ì€ ë‰´ìŠ¤ ë§í¬ ìˆ˜: ${t.length}`),p(`ë°±ì—… ì…€ë ‰í„°ë¡œ ì°¾ì€ ë‰´ìŠ¤ ë§í¬ ìˆ˜: ${t.length}`),t.length>0){let a=t.toArray();for(let t=0;t<a.length;t++)try{let r=a[t],l=i(r),n=l.text().trim(),s=l.attr("href");if(g(n)){p(`ë°±ì—… ì…€ë ‰í„°ì—ì„œ ë‰´ìŠ¤ ì œì™¸ë¨: "${n}"`);continue}if(s&&n&&!o.some(e=>e.articleUrl===s)){let e="";if(s&&s.includes("/category/")){let t=s.match(/\/category\/([^\/]+)/);t&&t[1]&&(e=t[1])}let a=await k(n,s,"",e,"Recently",t);o.push(a),p(`ë°±ì—… ì…€ë ‰í„°ë¡œ ë‰´ìŠ¤ ë§í¬ ì¶”ê°€ (í•­ëª© ${t+1}): title="${n}"`)}if(o.length>=e)break}catch(e){p("ë°±ì—… ì…€ë ‰í„° íŒŒì‹± ì¤‘ ì˜¤ë¥˜: "+e.message)}}}return c(`ì´ ${o.length}ê°œì˜ ë‰´ìŠ¤ í•­ëª©ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`),p(`ì´ ${o.length}ê°œì˜ ë‰´ìŠ¤ í•­ëª©ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`),o}catch(e){throw p("axios ìš”ì²­ ì‹¤íŒ¨: "+e.message),e}}catch(e){return c("ì •ì  ë‰´ìŠ¤ í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜:",e),p("ì •ì  ë‰´ìŠ¤ í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜: "+e.message),p("ì˜¤ë¥˜ ìŠ¤íƒ: "+e.stack),[]}}async function $(e){let t;p(`[fetchArticleDetail ì‹œì‘] ${e}`),c(`[fetchArticleDetail] ìƒì„¸ í˜ì´ì§€ í¬ë¡¤ë§ ì‹œì‘: ${e}`),p(`[fetchArticleDetail] ìƒì„¸ í˜ì´ì§€ í¬ë¡¤ë§ ì‹œì‘: ${e}`);try{let t=await v(e);if(t&&t.content&&t.content.length>100)return t}catch(e){}try{let a=Math.floor(2e3*Math.random())+500;await new Promise(e=>setTimeout(e,a)),t=await n.default.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-gpu","--disable-software-rasterizer","--disable-web-security","--disable-features=VizDisplayCompositor","--disable-features=IsolateOrigins,site-per-process","--disable-images","--disable-extensions","--disable-plugins","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-renderer-backgrounding","--no-first-run","--no-default-browser-check","--disable-default-apps","--disable-sync","--disable-translate","--disable-background-networking","--disable-component-extensions-with-background-pages","--disable-ipc-flooding-protection","--memory-pressure-off","--max_old_space_size=2048","--single-process","--no-zygote","--disable-accelerated-2d-canvas","--disable-accelerated-jpeg-decoding","--disable-accelerated-mjpeg-decode","--disable-accelerated-video-decode","--disable-canvas-aa","--disable-2d-canvas-clip-aa","--disable-gl-drawing-for-tests"],timeout:6e4,ignoreHTTPSErrors:!0,ignoreDefaultArgs:["--disable-extensions"],defaultViewport:{width:1024,height:768},pipe:!0});let i=await t.newPage();await i.setRequestInterception(!0),i.on("request",e=>{let t=e.resourceType();"image"===t||"stylesheet"===t||"font"===t||"media"===t?e.abort():e.continue()}),await i.setUserAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"),await i.setExtraHTTPHeaders({Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en;q=0.8","Accept-Encoding":"gzip, deflate, br","Cache-Control":"no-cache",Pragma:"no-cache","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Upgrade-Insecure-Requests":"1"}),await i.evaluateOnNewDocument(()=>{Object.defineProperty(navigator,"webdriver",{get:()=>!1}),window.chrome={runtime:{},loadTimes:function(){},csi:function(){},app:{}},Object.defineProperty(navigator,"plugins",{get:()=>[1,2,3,4,5]}),Object.defineProperty(navigator,"languages",{get:()=>["ko-KR","ko","en"]})});let r=0;for(;r<3;)try{await i.goto(e,{waitUntil:["networkidle0","domcontentloaded"],timeout:9e4}),await i.waitForTimeout(5e3);let t=await i.content();if(t&&t.length>1e3)break;throw Error("í˜ì´ì§€ ë‚´ìš©ì´ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")}catch(e){if(++r>=3)throw e;await i.waitForTimeout(3e3)}let o=await i.content(),s=l.load(o),g=s(".tags-container").length>0;if(c(`[fetchArticleDetail] tags-container ì¡´ì¬: ${g}`),!g){let e=o.substring(0,500);c(`[fetchArticleDetail] HTML ìƒ˜í”Œ: ${e}`);let t=s(".article-info").html();t&&c(`[fetchArticleDetail] article-info HTML: ${t.substring(0,300)}`)}let d="",y=s(".article-info h1, .article-wrapper h1, .article-section h1").first();if(y.length&&(d=y.text().trim(),c(`h1 íƒœê·¸ì—ì„œ ì¶”ì¶œí•œ ê¸°ì‚¬ ì œëª©: ${d}`)),!d){let e=s("title").text().trim().split(" - ");e.length>0&&(d=e[0].trim(),c(`í˜ì´ì§€ titleì—ì„œ ì¶”ì¶œí•œ ê¸°ì‚¬ ì œëª©: ${d}`))}if(!d||"Trending Now"===d){let e=s('meta[property="og:title"]').attr("content");e&&(d=e.trim(),c(`meta íƒœê·¸ì—ì„œ ì¶”ì¶œí•œ ê¸°ì‚¬ ì œëª©: ${d}`))}("Trending Now"===d||"Latest Articles"===d||"Popular Articles"===d)&&(d="",c("ì„¹ì…˜ ì œëª© ê°ì§€: ì œëª©ì„ ì¬ì„¤ì •í•©ë‹ˆë‹¤"));let b=[];if(s(".article-tags .tag-item a").each((e,t)=>{let a=s(t).text().trim();a&&b.push(a)}),0===b.length&&s(".tags-container .uppercase.badges.tags a, .tags-container .badges.tags a").each((e,t)=>{let a=s(t).text().trim();a&&!a.includes("category")&&(b.push(a),c(`ìƒˆë¡œìš´ êµ¬ì¡°ì—ì„œ íƒœê·¸ ì¶”ì¶œ: ${a}`))}),0===b.length&&s(".tags-container a").each((e,t)=>{let a=s(t).text().trim();a&&!a.includes("category")&&(b.push(a),c(`ì¼ë°˜ êµ¬ì¡°ì—ì„œ íƒœê·¸ ì¶”ì¶œ: ${a}`))}),0===b.length&&e.includes("/tag/")){let t=e.match(/\/tag\/([^\/]+)/);t&&t[1]&&b.push(t[1].replace(/-/g," "))}c(`ì¶”ì¶œëœ íƒœê·¸: ${b.join(", ")}`);let $="",v=s('.info-emphasis.right a, .author-date a[href*="/author/"]').first();v.length&&($=v.text().trim());let k="",C=s(".article-section .image-wrapper img, .article-wrapper img").first();if(C.length){let e=C.attr("src")||C.attr("data-src")||"";k=await m(e)}c("ê¸°ì‚¬ ë‚´ìš© ì¶”ì¶œ ì‹œë„...");let S="",M=s(".article-wrapper");if(M.length){c("article-wrapper ìš”ì†Œ ë°œê²¬: "+M.length);let e=M.find("> div").first();if(e.length){c("article-wrapper > div ìš”ì†Œ ë°œê²¬");let t=e.clone();t.find("iframe").each((e,t)=>{let a=s(t).attr("src")||"";a.includes("youtube.com/embed/")||a.includes("youtu.be/")||s(t).remove()}),t.find('p > a[target="_blank"][rel="noopener noreferrer"] > img[class*="wp-image-"], hr + p > a > img').each((e,t)=>{c("í•˜ë‹¨ ë°°ë„ˆ ì´ë¯¸ì§€ ì œê±°"),s(t).parent().parent().remove()}),t.find("hr").each((e,t)=>{c("í•˜ë‹¨ íšŒìƒ‰ ì¤„(HR íƒœê·¸) ì œê±°"),s(t).remove()}),t.find("hr, HR").remove(),t.find('p:contains("ì›ë³¸ ê¸°ì‚¬:")').remove(),t.find("hr").next("p").each((e,t)=>{let a=s(t);a.find('img, a[target="_blank"]').length>0&&(c("hr íƒœê·¸ ë‹¤ìŒ ë°°ë„ˆ ì œê±°"),a.remove())}),t.find('p[style*="text-align: center"], p[style*="text-align:center"]').each((e,t)=>{let a=s(t);c("ì¤‘ì•™ ì •ë ¬ p íƒœê·¸ ì œê±°:",a.text().trim().substring(0,50)),a.remove()}),t.find('a[href*="viki.com"]').each((e,t)=>{let a=s(t),i=a.text().trim();(a.attr("href")||"").includes("utm_source=soompi")?c(`Viki UTM ë§í¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜: "${i}"`):c(`Viki ë§í¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜: "${i}"`),a.replaceWith(i)}),S=t.html(),c("ì¶”ì¶œëœ HTML ë‚´ìš© (ì²˜ìŒ 100ì): "+S?.substring(0,100))}}if(!S){c("ì‹œë„ 2: article-paragraphì—ì„œ ì¶”ì¶œ");let e=s(".article-paragraph");if(e.length){let t=e.clone();t.find(".social-share-container, .article-reactions, .article-footer, script, .ad, .disqus_thread, .comment-container").remove(),t.find("iframe").each((e,t)=>{let a=s(t).attr("src")||"";a.includes("youtube.com/embed/")||a.includes("youtu.be/")||s(t).remove()}),t.find('p > a[target="_blank"][rel="noopener noreferrer"] > img[class*="wp-image-"], hr + p > a > img').each((e,t)=>{c("í•˜ë‹¨ ë°°ë„ˆ ì´ë¯¸ì§€ ì œê±°"),s(t).parent().parent().remove()}),t.find("hr").each((e,t)=>{c("í•˜ë‹¨ íšŒìƒ‰ ì¤„(HR íƒœê·¸) ì œê±°"),s(t).remove()}),t.find("hr, HR").remove(),t.find('p:contains("ì›ë³¸ ê¸°ì‚¬:")').remove(),t.find("hr").next("p").each((e,t)=>{let a=s(t);a.find('img, a[target="_blank"]').length>0&&(c("hr íƒœê·¸ ë‹¤ìŒ ë°°ë„ˆ ì œê±°"),a.remove())}),t.find('p[style*="text-align: center"], p[style*="text-align:center"]').each((e,t)=>{let a=s(t);c("ì¤‘ì•™ ì •ë ¬ p íƒœê·¸ ì œê±° (paragraph):",a.text().trim().substring(0,50)),a.remove()}),t.find('a[href*="viki.com"]').each((e,t)=>{let a=s(t),i=a.text().trim();(a.attr("href")||"").includes("utm_source=soompi")?c(`Viki UTM ë§í¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (paragraph): "${i}"`):c(`Viki ë§í¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (paragraph): "${i}"`),a.replaceWith(i)}),S=t.html(),c("article-paragraphì—ì„œ HTML ì¶”ì¶œë¨")}}if(!S){c("ì‹œë„ 3: article-sectionì—ì„œ ì¶”ì¶œ");let e=s(".article-section");if(e.length){let t=e.clone();t.find(".social-share-container, .article-reactions, .article-footer, script, .ad, .disqus_thread, .comment-container").remove(),t.find("iframe").each((e,t)=>{let a=s(t).attr("src")||"";a.includes("youtube.com/embed/")||a.includes("youtu.be/")||s(t).remove()}),t.find('p > a[target="_blank"][rel="noopener noreferrer"] > img[class*="wp-image-"], hr + p > a > img').each((e,t)=>{c("í•˜ë‹¨ ë°°ë„ˆ ì´ë¯¸ì§€ ì œê±°"),s(t).parent().parent().remove()}),t.find("hr").each((e,t)=>{c("í•˜ë‹¨ íšŒìƒ‰ ì¤„(HR íƒœê·¸) ì œê±°"),s(t).remove()}),t.find("hr, HR").remove(),t.find('p:contains("ì›ë³¸ ê¸°ì‚¬:")').remove(),t.find("hr").next("p").each((e,t)=>{let a=s(t);a.find('img, a[target="_blank"]').length>0&&(c("hr íƒœê·¸ ë‹¤ìŒ ë°°ë„ˆ ì œê±°"),a.remove())}),t.find('p[style*="text-align: center"], p[style*="text-align:center"]').each((e,t)=>{let a=s(t);c("ì¤‘ì•™ ì •ë ¬ p íƒœê·¸ ì œê±° (section):",a.text().trim().substring(0,50)),a.remove()}),t.find('a[href*="viki.com"]').each((e,t)=>{let a=s(t),i=a.text().trim();(a.attr("href")||"").includes("utm_source=soompi")?c(`Viki UTM ë§í¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (section): "${i}"`):c(`Viki ë§í¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (section): "${i}"`),a.replaceWith(i)}),S=t.html(),c("article-sectionì—ì„œ HTML ì¶”ì¶œë¨")}}S||(c("HTML ë‚´ìš© ì¶”ì¶œ ì‹¤íŒ¨"),S="<p>ìƒì„¸ ë‚´ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì›ë³¸ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•´ ì£¼ì„¸ìš”.</p>"),S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=S.replace(/src="\/wp-content/g,'src="https://www.soompi.com/wp-content')).replace(/<p>.*?ì›ë³¸ ê¸°ì‚¬.*?<\/p>/g,"")).replace(/ì›ë³¸ ê¸°ì‚¬: Soompi/g,"")).replace(/<p[^>]*>.*?Watch.*?(on Viki|below).*?<\/p>/gi,"")).replace(/<p[^>]*>.*?<a[^>]*class="btn-watch-now"[^>]*>.*?<\/a>.*?<\/p>/gi,"")).replace(/<p[^>]*>.*?<a[^>]*href="[^"]*viki\.com[^"]*"[^>]*>.*?<\/a>.*?<\/p>/gi,"")).replace(/<p[^>]*>.*?[Ww]atch.*?on\s+[Vv]iki.*?<\/p>/gi,"")).replace(/<p[^>]*>.*?Watch.*?on\s+"[^"]*".*?on\s+Viki.*?<\/p>/gi,"")).replace(/<a[^>]*href="[^"]*viki\.com[^"]*"[^>]*>.*?<\/a>/gi,"")).replace(/<a[^>]*href="[^"]*utm_source=soompi[^"]*viki\.com[^"]*"[^>]*>.*?<\/a>/gi,"")).replace(/<hr[^>]*>/gi,"")).replace(/<hr\s*\/?>/gi,"")).replace(/<hr>/gi,"")).replace(/\s*<hr[^>]*>\s*$/gi,"")).replace(/<a[^>]*href="https?:\/\/(?:www\.)?viki\.com[^"]*"[^>]*>(.*?)<\/a>/gi,"$1")).replace(/(.*?)(<p[^>]*>Source(?:\s*\(\d+\))?:?.*?<\/p>)/is,"$1<p>&nbsp;</p>$2"),S=f(S),S=function(e){if(!e)return e;let t=e,a=[...t.matchAll(/https?:\/\/(?:www\.)?(?:twitter\.com|x\.com)\/(?:#!\/)?(?:@)?([A-Za-z0-9_]+)\/status(?:es)?\/(\d+)/g)];return 0===a.length?t:(a.forEach((e,a)=>{let i=e[0];e[1],e[2];let r=`<blockquote class="twitter-tweet" data-lang="ko" data-theme="light" data-dnt="true" style="margin: 20px auto; max-width: 550px;">
<p lang="ko" dir="ltr">íŠ¸ìœ„í„° ê²Œì‹œë¬¼ì„ ë¡œë“œí•˜ëŠ” ì¤‘...</p>
<a href="${i}" target="_blank" rel="noopener noreferrer">íŠ¸ìœ„í„°ì—ì„œ ë³´ê¸°</a>
</blockquote>`;t=t.replace(i,r)}),t.trim())}(S),S=w(S),S=h(S),(S=function(e){try{let t=l.load(e);return t("p").each(function(e,a){let i=t(this).html();if(!i)return;let r=[],l=!1,o="";for(let e=0;e<i.length;e++){let t=i[e];o+=t,"<"===t?l=!0:">"===t&&(l=!1),"."===t&&!l&&(e+1>=i.length||" "===i[e+1]||"	"===i[e+1]||"<"===i[e+1])&&(r.push(o),o="")}if(o.trim()&&r.push(o),r.length>1){let e=r.map(e=>`<p>${e.trim()}</p>`).join("\n\n");t(this).replaceWith(e)}}),t.html()}catch(t){return e}}(S))||(c("HTML ë‚´ìš© ì¶”ì¶œ ì‹¤íŒ¨"),S="<p>ìƒì„¸ ë‚´ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì›ë³¸ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•´ ì£¼ì„¸ìš”.</p>"),S=S.replace(/src="\/wp-content/g,'src="https://www.soompi.com/wp-content');let A=l.load(S);for(let e of A("img").toArray()){let t=A(e).attr("src");if(t&&t.startsWith("http")){let a=await m(t);A(e).attr("src",a),c(`ì´ë¯¸ì§€ URL ë³€í™˜: ${t} â†’ ${a}`)}}S=A.html();let F="";if(s('script[type="application/ld+json"]').each((t,a)=>{if(F)return;let i=s(a).text();if(i)try{let t=JSON.parse(i);t.articleSection&&(F=t.articleSection.trim(),c(`[ìš°ì„ ìˆœìœ„ 1-0] JSON-LDì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F}`),p(`[JSON-LD ì¹´í…Œê³ ë¦¬] "${e}" â†’ "${F}"`))}catch(e){c(`JSON-LD íŒŒì‹± ì˜¤ë¥˜ (ìŠ¤í¬ë¦½íŠ¸ ${t}):`,e.message)}}),!F){let e=s('meta[property="article:section"]').attr("content");e&&(F=e.trim(),c(`[ìš°ì„ ìˆœìœ„ 1-1] ë©”íƒ€ íƒœê·¸ì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F}`))}if(!F){let t=null;for(let e of[".tags-container .uppercase.badges.tags a",".tags-container .badges.tags a",".tags-container .badges a",'.tags-container a[href*="/category/"]',".article-info .tags-container a","div.tags-container a"])if((t=s(e).first()).length)break;if(t&&t.length){let a=t.attr("href")||"",i=t.text().trim(),r=t.attr("title")||"";if(a.includes("/category/")){let t=a.match(/\/category\/([^\/]+)/);t&&t[1]&&(F=t[1],c(`[ìš°ì„ ìˆœìœ„ 1-2] tags-container hrefì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F} (í…ìŠ¤íŠ¸: ${i}, title: ${r})`),p(`[ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ] "${e}" â†’ "${F}" (from href)`))}else r?(F=r.toLowerCase(),c(`[ìš°ì„ ìˆœìœ„ 1-2] tags-container titleì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F}`),p(`[ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ] "${e}" â†’ "${F}" (from title)`)):i&&(F=i.toLowerCase(),c(`[ìš°ì„ ìˆœìœ„ 1-2] tags-container í…ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F}`),p(`[ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ] "${e}" â†’ "${F}" (from text)`))}else s(".tags-container").first().length}if(F||s(".breadcrumbs a, .breadcrumb a, .nav-breadcrumb a").each((e,t)=>{let a=s(t).attr("href")||"";if(a.includes("/category/")){let e=a.match(/\/category\/([^\/]+)/);if(e&&e[1])return F=e[1].replace("-"," "),c(`[ìš°ì„ ìˆœìœ„ 1-3] ë¸Œë ˆë“œí¬ëŸ¼ì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F}`),!1}}),!F&&e&&e.includes("/category/")){let t=e.match(/\/category\/([^\/]+)/);t&&t[1]&&(F=t[1].replace("-"," "),c(`[ìš°ì„ ìˆœìœ„ 1-4] URLì—ì„œ ì¶”ì¶œí•œ ì¹´í…Œê³ ë¦¬: ${F}`))}if(!F&&b.length>0){let e={"K-Drama":"drama",Drama:"drama","Korean Drama":"drama","K-Pop":"kpop",Music:"kpop","Korean Music":"kpop",Movie:"movie",Film:"movie","Korean Movie":"movie",Variety:"variety","Variety Show":"variety",Celebrity:"celeb",Interview:"celeb",Fashion:"celeb",Style:"celeb"};for(let t of b){let a=t.trim();if(e[a]){F=a,c(`[ìš°ì„ ìˆœìœ„ 1-5] íƒœê·¸ì—ì„œ ì¶”ë¡ í•œ ì¹´í…Œê³ ë¦¬: ${F}`);break}}}let L="";if(F?(L=x(F),c(`[Soompi ì¹´í…Œê³ ë¦¬ ë§¤í•‘] '${F}' â†’ '${L}'`),p(`[Soompi ì¹´í…Œê³ ë¦¬ ë°œê²¬] "${e}" â†’ ì›ë³¸: "${F}", ë§¤í•‘: "${L}"`)):(c(`[Soompi ì¹´í…Œê³ ë¦¬ ì—†ìŒ] ìƒì„¸ í˜ì´ì§€ì—ì„œ ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`),p(`[Soompi ì¹´í…Œê³ ë¦¬ ì—†ìŒ] "${e}" - ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`)),!$||"Admin"===$||"By Admin"===$||"admin"===$||"by admin"===$||$.toLowerCase().includes("admin")||$.toLowerCase().includes("soompi")||""===$.trim()||"Staff"===$){let e=L||"kpop";$=u(e),c(`[ì‘ì„±ì ìƒì„±] ì¹´í…Œê³ ë¦¬ "${e}"ì— ëŒ€í•´ ì‘ì„±ì "${$}" ìƒì„±`)}if(c(`ìƒì„¸ í˜ì´ì§€ íŒŒì‹± ì™„ë£Œ: íƒœê·¸ ${b.length}ê°œ, ì¹´í…Œê³ ë¦¬: ${F||"ì—†ìŒ"}, ì‘ì„±ì: ${$||"ì—†ìŒ"}`),p(`[fetchArticleDetail ì™„ë£Œ] "${e}" - ì¹´í…Œê³ ë¦¬: ${F||"ì—†ìŒ"}, ë§¤í•‘: ${L||"ì—†ìŒ"}`),t)try{await t.close(),c("Puppeteer ë¸Œë¼ìš°ì € ì •ìƒ ì¢…ë£Œ")}catch(e){c("ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜:",e)}return{content:S,tags:b,author:{name:$,id:"soompi-crawler",email:"crawler@soompi.com",image:"/images/default-avatar.png"},coverImage:k,title:d,detailCategory:F,mappedCategory:L}}catch(t){c("ê¸°ì‚¬ ìƒì„¸ í˜ì´ì§€ í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜:",t),t.name;try{let t=await v(e,!0);if(t&&t.content&&t.content.length>100)return t}catch(e){}return{content:"<p>ìƒì„¸ ê¸°ì‚¬ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì›ë³¸ í˜ì´ì§€ë¥¼ ë°©ë¬¸í•´ ì£¼ì„¸ìš”.</p>",tags:[],author:"",coverImage:"",title:"",detailCategory:"",mappedCategory:""}}finally{if(t)try{let e=await t.pages();await Promise.all(e.map(e=>e.close())),await t.close(),c("ì—ëŸ¬ ë°œìƒ ì‹œ Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ"),p("ì—ëŸ¬ ë°œìƒ ì‹œ Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){c("ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜:",e),p(`ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`);try{let e=t.process();e&&e.kill("SIGKILL")}catch(e){c("ë¸Œë¼ìš°ì € í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ ì‹¤íŒ¨:",e)}}}}async function v(e,t=!1){try{let a=t?["Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Mobile/15E148 Safari/604.1","Mozilla/5.0 (Android 11; Mobile; rv:68.0) Gecko/68.0 Firefox/88.0","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/121.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/121.0"]:["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/121.0"],i=a[Math.floor(Math.random()*a.length)],o=Math.floor(2e3*Math.random())+1e3;await new Promise(e=>setTimeout(e,o));let n=(await r.default.get(e,{headers:{"User-Agent":i,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en;q=0.8","Accept-Encoding":"gzip, deflate, br","Cache-Control":"no-cache",Pragma:"no-cache","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Upgrade-Insecure-Requests":"1",Connection:"keep-alive"},timeout:3e4,maxRedirects:5,validateStatus:function(e){return e>=200&&e<400}})).data;if(!n||n.length<1e3)return null;let s=l.load(n),c="",p=s(".article-info h1, .article-wrapper h1, .article-section h1").first();if(p.length&&(c=p.text().trim()),!c){let e=s("title").text().trim().split(" - ");e.length>0&&(c=e[0].trim())}let g=[];s(".article-tags .tag-item a").each((e,t)=>{let a=s(t).text().trim();a&&g.push(a)});let d="",y=s('.info-emphasis.right a, .author-date a[href*="/author/"]').first();y.length&&(d=y.text().trim());let b="",$=s(".article-section .image-wrapper img, .article-wrapper img").first();if($.length){let e=$.attr("src")||$.attr("data-src")||"";b=await m(e)}let v="",k=s(".article-wrapper");if(k.length){let e=k.find("> div").first();if(e.length){let t=e.clone();t.find("script, .ad, .social-share-container, .article-reactions, .article-footer").remove(),t.find("iframe").each((e,t)=>{let a=s(t).attr("src")||"";a.includes("youtube.com/embed/")||a.includes("youtu.be/")||s(t).remove()}),t.find('p[style*="text-align: center"], p[style*="text-align:center"]').each((e,t)=>{s(t).remove()}),t.find('a[href*="viki.com"]').each((e,t)=>{let a=s(t),i=a.text().trim();(a.attr("href")||"").includes("utm_source=soompi"),a.replaceWith(i)}),v=t.html()}}if(!v){let e=s(".article-section");if(e.length){let t=e.clone();t.find("script, .ad, .social-share-container").remove(),t.find("p").each((e,t)=>{let a=s(t);a.find('a[href*="viki.com"]').length>0&&a.remove()}),t.find("a.btn-watch-now").each((e,t)=>{s(t).closest("p").remove()}),t.find('a[href*="viki.com"]').each((e,t)=>{s(t).remove()}),t.find('a[href*="utm_source=soompi"]').each((e,t)=>{let a=s(t);(a.attr("href")||"").includes("viki.com")&&a.remove()}),v=t.html()}}if(!v)return null;v=v.replace(/src="\/wp-content/g,'src="https://www.soompi.com/wp-content'),v=(v=(v=(v=(v=(v=(v=f(v)).replace(/<p[^>]*>.*?<a[^>]*href="[^"]*viki\.com[^"]*"[^>]*>.*?<\/a>.*?<\/p>/gi,"")).replace(/<p[^>]*>.*?Watch.*?on\s+Viki.*?<\/p>/gi,"")).replace(/<p[^>]*>.*?<a[^>]*class="btn-watch-now"[^>]*>.*?<\/a>.*?<\/p>/gi,"")).replace(/<p[^>]*>.*?Watch.*?on\s+"[^"]*".*?on\s+Viki.*?<\/p>/gi,"")).replace(/<a[^>]*href="[^"]*viki\.com[^"]*"[^>]*>.*?<\/a>/gi,"")).replace(/<a[^>]*href="[^"]*utm_source=soompi[^"]*viki\.com[^"]*"[^>]*>.*?<\/a>/gi,"");let C=l.load(v);for(let e of C("img").toArray()){let t=C(e).attr("src");if(t&&t.startsWith("http")){let a=await m(t);C(e).attr("src",a)}}v=C.html();let S="",M=s('meta[property="article:section"]').attr("content");if(M&&(S=M.trim()),!S){let e=null;for(let t of[".tags-container .uppercase.badges.tags a",".tags-container .badges.tags a",".tags-container .badges a",'.tags-container a[href*="/category/"]',".article-info .tags-container a","div.tags-container a"])if((e=s(t).first()).length)break;if(e&&e.length){let t=e.attr("href")||"",a=e.text().trim(),i=e.attr("title")||"";if(t.includes("/category/")){let e=t.match(/\/category\/([^\/]+)/);e&&e[1]&&(S=e[1])}else i?S=i.toLowerCase():a&&(S=a.toLowerCase())}}let A=x(S);return(!d||"Admin"===d||"By Admin"===d||"admin"===d||"by admin"===d||d.toLowerCase().includes("admin")||d.toLowerCase().includes("soompi")||""===d.trim()||"Staff"===d)&&(d=u(A||"kpop")),v=w(v),{content:v=h(v),tags:g,author:{name:d,id:"soompi-crawler",email:"crawler@soompi.com",image:"/images/default-avatar.png"},coverImage:b,title:c,detailCategory:S,mappedCategory:A}}catch(e){return null}}function x(e){if(!e)return"kpop";let t=e.toLowerCase().trim().replace(/[-_\s]/g,""),a={drama:"drama",kdrama:"drama",koreandrama:"drama",dramapreview:"drama",previewdrama:"drama",previewdramas:"drama",dramapreviews:"drama",tv:"drama",tvfilm:"movie",television:"drama",music:"kpop",kpop:"kpop",koreanmusic:"kpop",idol:"kpop",comeback:"kpop",album:"kpop",mv:"kpop",musicvideo:"kpop",song:"kpop",concert:"kpop",performance:"kpop",tour:"kpop",movie:"movie",film:"movie",cinema:"movie",koreanfilm:"movie",koreanmovie:"movie",variety:"variety",varietyshow:"variety",show:"variety",entertainment:"variety",reality:"variety",realityshow:"variety",celeb:"celeb",celebrity:"celeb",celebrities:"celeb",actor:"celeb",actress:"celeb",star:"celeb",stars:"celeb",style:"celeb",fashion:"celeb",culture:"celeb",features:"celeb",interview:"celeb",lifestyle:"celeb",personal:"celeb",news:"celeb",announcement:"celeb",update:"celeb",wedding:"celeb",marriage:"celeb",married:"celeb",relationship:"celeb",dating:"celeb",couple:"celeb",family:"celeb",birth:"celeb",birthday:"celeb",death:"celeb",dies:"celeb",passed:"celeb",passaway:"celeb",cancer:"celeb",illness:"celeb",health:"celeb",social:"celeb",instagram:"celeb",twitter:"celeb",sns:"celeb"};if(a[t])return a[t];for(let[e,i]of Object.entries(a))if(t.includes(e))return i;return"kpop"}async function k(e,t,a,i,r,l){let o=t.startsWith("http")?t:`https://www.soompi.com${t.startsWith("/")?"":"/"}${t}`,n=i;if(!n&&o){if(o.includes("/category/")){let e=o.match(/\/category\/([^\/]+)/);e&&e[1]&&(n=e[1],c(`URLì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ: ${n}`))}!n&&(o.includes("drama")||o.includes("k-drama")?n="drama":o.includes("music")||o.includes("k-pop")||o.includes("kpop")?n="kpop":o.includes("movie")||o.includes("film")?n="movie":o.includes("variety")||o.includes("show")?n="variety":(o.includes("celeb")||o.includes("actor")||o.includes("style"))&&(n="celeb"),n&&c(`URL í‚¤ì›Œë“œì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ë¡ : ${n}`))}if(!n&&e){let t=e.toLowerCase();t.includes("drama")||t.includes("series")?n="drama":t.includes("comeback")||t.includes("mv")||t.includes("album")||t.includes("music")||t.includes("song")||t.includes("concert")?n="kpop":t.includes("movie")||t.includes("film")?n="movie":(t.includes("variety")||t.includes("show"))&&(n="variety"),n&&c(`ì œëª©ì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ë¡ : ${n}`)}let s=x(n);n!==i&&c(`ì¹´í…Œê³ ë¦¬ í–¥ìƒ: '${i||"none"}' â†’ '${n}' â†’ '${s}'`);let p="";if(e){if(!(p=e.toLowerCase().replace(/[^a-z0-9ã„±-ã…ã…-ã…£ê°€-í£\s]+/g,"").replace(/\s+/g,"-").replace(/^-|-$/g,""))||p.length<3){let e=Date.now().toString().slice(-6);p=`soompi-news-${e}`}}else{let e=Date.now().toString().slice(-6);p=`soompi-news-${e}`}c(`Slug ìƒì„±: ì œëª©="${e}", ìƒì„±ëœ slug="${p}"`);let g={title:e,slug:p,thumbnailUrl:a,articleUrl:o,timeText:r||"Recently",summary:`${e} - From Soompi ${n?`(${n})`:""}${r?` (${r})`:""}`,category:s,source:"Soompi",sourceUrl:"https://www.soompi.com",coverImage:await m(a)||"/images/default-news.jpg",tags:["K-POP","News","Soompi"].concat(n?[n]:[]),author:{name:u(s),id:"soompi-crawler",email:"crawler@soompi.com",image:"/images/default-avatar.png"},createdAt:new Date,publishedAt:new Date,updatedAt:new Date,featured:l<5,viewCount:0,content:"",needsDetailFetch:!0,detailCategory:"",mappedCategory:""};return c(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì™„ë£Œ: slug="${g.slug}", title="${g.title}"`),g}async function C(e,t){if(p("=== API ROUTE START ==="),p(`ìš”ì²­ ë©”ì„œë“œ: ${e.method}`),p(`ìš”ì²­ ë°”ë””: ${JSON.stringify(e.body)}`),p(`ìš”ì²­ URL: ${e.url}`),p(`ìš”ì²­ í—¤ë”: ${JSON.stringify(e.headers)}`),c("=== API ROUTE START ==="),c("ìš”ì²­ ë©”ì„œë“œ:",e.method),c("ìš”ì²­ ë°”ë””:",e.body),c("ìš”ì²­ URL:",e.url),"POST"!==e.method)return c("ì˜ëª»ëœ ë©”ì„œë“œ ìš”ì²­:",e.method),p(`ì˜ëª»ëœ ë©”ì„œë“œ ìš”ì²­: ${e.method}`),t.status(405).json({success:!1,message:"Method not allowed"});try{let a;p("=== í¬ë¡¤ë§ ì‹œì‘ ===");let i=parseInt(e.body.maxItems)||15;c(`ìµœëŒ€ í¬ë¡¤ë§ ì•„ì´í…œ ìˆ˜: ${i}`),p(`ìµœëŒ€ í¬ë¡¤ë§ ì•„ì´í…œ ìˆ˜: ${i}`);let r=parseInt(e.body.concurrentRequests)||3;c(`ë™ì‹œ ìƒì„¸ í˜ì´ì§€ ìš”ì²­ ìˆ˜: ${r}`),p(`ë™ì‹œ ìƒì„¸ í˜ì´ì§€ ìš”ì²­ ìˆ˜: ${r}`),c("=== SOOMPI í¬ë¡¤ë§ ì‹œì‘ ==="),p("=== SOOMPI í¬ë¡¤ë§ ì‹œì‘ ===");let l=!1!==e.body.useDynamicCrawling;c(`í¬ë¡¤ë§ ë°©ì‹: ${l?"ë™ì (Puppeteer)":"ì •ì (Cheerio)"}`),p(`í¬ë¡¤ë§ ë°©ì‹: ${l?"ë™ì (Puppeteer)":"ì •ì (Cheerio)"}`);try{p("=== í¬ë¡¤ë§ í•¨ìˆ˜ í˜¸ì¶œ ì‹œì‘ ==="),l?(p("=== Puppeteer í¬ë¡¤ë§ ì‹œì‘ ==="),a=await y(i),p("=== Puppeteer í¬ë¡¤ë§ ì™„ë£Œ ===")):(p("=== ì •ì  í¬ë¡¤ë§ ì‹œì‘ ==="),a=await b(i),p("=== ì •ì  í¬ë¡¤ë§ ì™„ë£Œ ===")),p("=== í¬ë¡¤ë§ í•¨ìˆ˜ í˜¸ì¶œ ì™„ë£Œ ===")}catch(e){return p("í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: "+e.message),p("í¬ë¡¤ë§ ì˜¤ë¥˜ ìŠ¤íƒ: "+e.stack),t.status(500).json({success:!1,message:"í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+e.message})}if(c("=== SOOMPI í¬ë¡¤ë§ ì™„ë£Œ ==="),c("í¬ë¡¤ë§ëœ ë‰´ìŠ¤ ì•„ì´í…œ ìˆ˜:",a.length),p(`í¬ë¡¤ë§ëœ ë‰´ìŠ¤ ì•„ì´í…œ ìˆ˜: ${a.length}`),c("í¬ë¡¤ë§ëœ ë‰´ìŠ¤ ì•„ì´í…œë“¤:",a.map(e=>({title:e.title,slug:e.slug,articleUrl:e.articleUrl}))),0===a.length)return c("í¬ë¡¤ë§í•  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),p("í¬ë¡¤ë§í•  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),t.status(404).json({success:!1,message:"í¬ë¡¤ë§í•  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."});p("=== ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹œì‘ ===");try{c("MongoDB ì—°ê²° ì‹œë„..."),p("MongoDB ì—°ê²° ì‹œë„...");let{db:i}=await (0,o.connectToDatabase)();p("MongoDB ì—°ê²° ì„±ê³µ");let l=i.collection("news");p("ì¤‘ë³µ URL í™•ì¸ ì‹œì‘...");let n=await l.find({articleUrl:{$in:a.map(e=>e.articleUrl)}}).project({articleUrl:1}).toArray(),s=new Set(n.map(e=>e.articleUrl));c(`ê¸°ì¡´ URL ${s.size}ê°œ í•„í„°ë§`),p(`ê¸°ì¡´ URL ${s.size}ê°œ í•„í„°ë§`);let g=a.filter(e=>!s.has(e.articleUrl));c(`ìƒˆ ì•„ì´í…œ ìˆ˜: ${g.length}`),p(`ìƒˆ ì•„ì´í…œ ìˆ˜: ${g.length}`);let d=e.body.updateExistingCategories||!1,m=0;if(p(`[DEBUG] updateExistingCategories ì˜µì…˜: ${d}, req.body: ${JSON.stringify(e.body)}`),d){p("=== ê¸°ì¡´ ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ ì‹œì‘ ===");let e=await l.find({source:"Soompi",$or:[{detailCategory:{$exists:!1}},{detailCategory:""},{mappedCategory:{$exists:!1}},{mappedCategory:""},{$expr:{$and:[{$ne:["$detailCategory",""]},{$ne:["$category","$mappedCategory"]}]}}]}).limit(50).toArray();p(`ì—…ë°ì´íŠ¸ ëŒ€ìƒ ë‰´ìŠ¤ ìˆ˜: ${e.length}ê°œ`);for(let t=0;t<e.length;t+=5){let a=e.slice(t,t+5).map(async e=>{try{p(`[ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸] "${e.title}" ì²˜ë¦¬ ì¤‘...`);let t=await $(e.articleUrl);if(t.detailCategory&&t.mappedCategory){let a={detailCategory:t.detailCategory,mappedCategory:t.mappedCategory,category:t.mappedCategory,updatedAt:new Date};if(t.tags&&t.tags.length>0&&(a.tags=t.tags),(await l.updateOne({_id:e._id},{$set:a})).modifiedCount>0)return p(`[ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ ì„±ê³µ] "${e.title}": ${e.category} â†’ ${t.mappedCategory} (Soompi: ${t.detailCategory})`),!0}return!1}catch(t){return p(`[ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨] "${e.title}": ${t.message}`),!1}}),i=await Promise.all(a);m+=i.filter(e=>!0===e).length,t+5<e.length&&await new Promise(e=>setTimeout(e,1e3))}p(`=== ê¸°ì¡´ ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${m}ê°œ ì—…ë°ì´íŠ¸ë¨ ===`)}if(0===g.length){p("ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì—†ìŒ");let e=d&&m>0?`ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ${m}ê°œì˜ ê¸°ì¡´ ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.`:"ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.";return t.status(200).json({success:!0,message:e,total:a.length,new:0,updated:d?m:void 0})}c(`${g.length}ê°œ í•­ëª©ì˜ ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° ì‹œì‘...`),p(`${g.length}ê°œ í•­ëª©ì˜ ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° ì‹œì‘...`),p(`[DEBUG] newItems ìˆ˜: ${g.length}, ì²«ë²ˆì§¸ ì•„ì´í…œ: ${g[0]?.title}`);let h=0,u=[];for(let e=0;e<g.length;e+=r){let t=g.slice(e,e+r);c(`ë°°ì¹˜ ${Math.floor(e/r)+1} ì²˜ë¦¬ ì¤‘: ${t.length}ê°œ í•­ëª©`),p(`ë°°ì¹˜ ${Math.floor(e/r)+1} ì²˜ë¦¬ ì¤‘: ${t.length}ê°œ í•­ëª©`);let a=t.map(async e=>{try{if(e.needsDetailFetch){let t=await $(e.articleUrl);if(t.mappedCategory){let a=e.category;e.category=t.mappedCategory,a!==t.mappedCategory?(c(`[ìš°ì„ ìˆœìœ„ 1] Soompi ì¹´í…Œê³ ë¦¬ ë§¤í•‘ ì ìš©: '${a}' â†’ '${t.mappedCategory}' (ì›ë³¸: ${t.detailCategory})`),p(`[ì¹´í…Œê³ ë¦¬ ìµœì¢… ê²°ì •] "${e.title}" â†’ ${t.mappedCategory} (Soompi: ${t.detailCategory})`)):c(`[ìš°ì„ ìˆœìœ„ 1] ì¹´í…Œê³ ë¦¬ ì¼ì¹˜ í™•ì¸: '${t.mappedCategory}' (ì›ë³¸: ${t.detailCategory})`),t.detailCategory&&!e.tags.includes(t.detailCategory)&&e.tags.push(t.detailCategory)}else c(`[ìš°ì„ ìˆœìœ„ 2-3] ìƒì„¸ í˜ì´ì§€ ì¹´í…Œê³ ë¦¬ ì—†ìŒ, ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ ìœ ì§€: '${e.category}'`);return{...e,...t,needsDetailFetch:!1,detailCategory:t.detailCategory||"",mappedCategory:t.mappedCategory||""}}return e}catch(t){return p(`[ERROR] fetchArticleDetail ì˜¤ë¥˜: ${e.articleUrl} - ${t.message}`),c(`ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${e.articleUrl}`,t),e}}),i=await Promise.all(a);u=[...u,...i],h+=t.length,c(`ì§„í–‰ ìƒí™©: ${h}/${g.length} í•­ëª© ì²˜ë¦¬ë¨`),p(`ì§„í–‰ ìƒí™©: ${h}/${g.length} í•­ëª© ì²˜ë¦¬ë¨`),e+r<g.length&&await new Promise(e=>setTimeout(e,1500))}c(`${u.length}ê°œ í•­ëª©ì˜ ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ`),p(`${u.length}ê°œ í•­ëª©ì˜ ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ`);let f={};if(u.forEach(e=>{f[e.category]=(f[e.category]||0)+1}),c("ì¹´í…Œê³ ë¦¬ ë¶„í¬:",f),p(`ì¹´í…Œê³ ë¦¬ ë¶„í¬: ${JSON.stringify(f)}`),u.length>0){p("=== ë°ì´í„°ë² ì´ìŠ¤ ì‚½ì… ì‹œì‘ ==="),u.forEach((e,t)=>{if(c(`=== ì•„ì´í…œ ${t} ê²€ì¦ ì‹œì‘ ===`),c(`ì›ë³¸ ì•„ì´í…œ êµ¬ì¡°:`,JSON.stringify(e,null,2)),!e.slug||null===e.slug||void 0===e.slug){c(`ê²½ê³ : ì¸ë±ìŠ¤ ${t}ì˜ ì•„ì´í…œì— slugê°€ ì—†ìŠµë‹ˆë‹¤. ì œëª©: "${e.title}"`);let a=Date.now().toString().slice(-6);e.slug=`soompi-news-${a}-${t}`,c(`ì„ì‹œ slug ìƒì„±: "${e.slug}"`)}if(!e.slug||null===e.slug||void 0===e.slug){let a=`soompi-fallback-${Date.now()}-${t}`;e.slug=a,c(`ê°•ì œ fallback slug ì„¤ì •: "${a}"`)}c(`ìµœì¢… ì•„ì´í…œ ${t}: slug="${e.slug}", title="${e.title}"`),c(`=== ì•„ì´í…œ ${t} ê²€ì¦ ì™„ë£Œ ===`)}),c(`ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì‹œì‘: ${u.length}ê°œ í•­ëª©`);let e=u.filter(e=>e.slug&&null!==e.slug&&void 0!==e.slug);if(c(`slugê°€ ìˆëŠ” ì•„ì´í…œ ìˆ˜: ${e.length}/${u.length}`),e.length!==u.length)return c("ê²½ê³ : ì¼ë¶€ ì•„ì´í…œì— slugê°€ ì—†ìŠµë‹ˆë‹¤!"),c("slugê°€ ì—†ëŠ” ì•„ì´í…œë“¤:",u.filter(e=>!e.slug||null===e.slug||void 0===e.slug)),t.status(500).json({success:!1,message:"ì¼ë¶€ ë‰´ìŠ¤ í•­ëª©ì— slugê°€ ì—†ì–´ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",error:"Slug validation failed"});c("ì €ì¥í•  ì•„ì´í…œë“¤:",e.map(e=>({title:e.title,slug:e.slug})));let i=await l.insertMany(e);c(`${i.insertedCount}ê°œ í•­ëª©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì¶”ê°€`);let r=d&&m>0?`${i.insertedCount}ê°œì˜ ìƒˆ ë‰´ìŠ¤ í•­ëª©ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ${m}ê°œì˜ ê¸°ì¡´ ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.`:`${i.insertedCount}ê°œì˜ ìƒˆ ë‰´ìŠ¤ í•­ëª©ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`;return t.status(200).json({success:!0,message:r,total:a.length,new:i.insertedCount,updated:d?m:void 0})}{let e=d&&m>0?`í¬ë¡¤ë§ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ${m}ê°œì˜ ê¸°ì¡´ ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.`:"í¬ë¡¤ë§ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";return t.status(200).json({success:!0,message:e,total:a.length,new:0,updated:d?m:void 0})}}catch(e){return c("ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ì¤‘ ì˜¤ë¥˜:",e),t.status(500).json({success:!1,message:"ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+e.message,error:e.toString()})}}catch(e){return c("ì „ì²´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:",e),p("ì „ì²´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: "+e.message),p("ì „ì²´ ì˜¤ë¥˜ ìŠ¤íƒ: "+e.stack),t.status(500).json({success:!1,message:"ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+e.message})}}i()}catch(e){i(e)}})},35968:(e,t,a)=>{let i;a.r(t),a.d(t,{connectToDatabase:()=>c,dbConnect:()=>p,default:()=>g});var r=a(38013),l=a(92048),o=a.n(l),n=a(55315),s=a.n(n);{let e=a(25142),t=s().resolve(process.cwd(),".env.production");o().existsSync(t)&&e.config({path:t}).error}async function c(){try{let e=await i,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}i=new r.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let p=c,g=i},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};