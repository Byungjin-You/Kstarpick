"use strict";(()=>{var e={};e.id=7867,e.ids=[7867],e.modules={79303:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>x,default:()=>m,getServerSideProps:()=>g,getStaticPaths:()=>h,getStaticProps:()=>u,reportWebVitals:()=>p,routeModule:()=>S,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>y});var r=a(87093),l=a(35244),i=a(1323),n=a(65949),o=a(81928),d=a(17857),c=e([d]);d=(c.then?(await c)():c)[0];let m=(0,i.hoist)(d,"default"),u=(0,i.hoist)(d,"getStaticProps"),h=(0,i.hoist)(d,"getStaticPaths"),g=(0,i.hoist)(d,"getServerSideProps"),x=(0,i.hoist)(d,"config"),p=(0,i.hoist)(d,"reportWebVitals"),y=(0,i.hoist)(d,"unstable_getStaticProps"),f=(0,i.hoist)(d,"unstable_getStaticPaths"),b=(0,i.hoist)(d,"unstable_getStaticParams"),w=(0,i.hoist)(d,"unstable_getServerProps"),j=(0,i.hoist)(d,"unstable_getServerSideProps"),S=new r.PagesRouteModule({definition:{kind:l.RouteKind.PAGES,page:"/admin/content/crawler",pathname:"/admin/content/crawler",bundlePath:"",filename:""},components:{App:o.default,Document:n.default},userland:d});s()}catch(e){s(e)}})},44556:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});let s=(0,a(64370).default)("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]])},68453:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});let s=(0,a(64370).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},96390:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});let s=(0,a(64370).default)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},17857:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>b,getServerSideProps:()=>w});var r=a(20997),l=a(16689),i=a(41649),n=a(79046),o=a(40220),d=a(3785),c=a(83364),m=a(68453),u=a(96390),h=a(44556),g=a(55809),x=a(41664),p=a.n(x),y=a(3590);a(88819),a(25675);var f=e([y]);function b(){let[e,t]=(0,l.useState)("https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1"),[a,s]=(0,l.useState)(""),[i,x]=(0,l.useState)(!1),[y,f]=(0,l.useState)(!1),[b,w]=(0,l.useState)(null),[j,S]=(0,l.useState)([]),[N,v]=(0,l.useState)(null),[C,k]=(0,l.useState)({visible:!1,message:"",type:""}),[P,T]=(0,l.useState)({}),[q,E]=(0,l.useState)({}),[M,A]=(0,l.useState)(!1),[$,O]=(0,l.useState)(""),[L,R]=(0,l.useState)(null),[B,z]=(0,l.useState)(!1),[I,_]=(0,l.useState)([]),[D,H]=(0,l.useState)(!1),[J,U]=(0,l.useState)("https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1"),[F,V]=(0,l.useState)(1),[Z,W]=(0,l.useState)(!1),[G,K]=(0,l.useState)({page:0,totalPages:0,dramas:0}),[X,Q]=(0,l.useState)(!1),[Y,ee]=(0,l.useState)([]),[et,ea]=(0,l.useState)(0),[es,er]=(0,l.useState)(!0),[el,ei]=(0,l.useState)({current:0,total:0}),[en,eo]=(0,l.useState)(!1),[ed,ec]=(0,l.useState)(null),em=(e,t="info",a=3e3)=>{k({visible:!0,message:e,type:t}),setTimeout(()=>k({visible:!1,message:"",type:""}),a)},eu=(e,t,a)=>{let s=new DOMParser().parseFromString(e,"text/html"),r=s.querySelector("h1.film-title")?.textContent.trim()||"",l="",i=s.querySelector('.show-detailsxss .list-item:has(b:contains("Native Title")) a');i&&(l=i.textContent.trim());let n="";for(let e of[".show-synopsis p span",".show-synopsis p",".show-synopsis",".film-description",".box-body .box-inset",".show-synopsis .synopsis",'div.box:contains("Synopsis") .box-body']){let t=s.querySelector(e);if(t&&t.textContent.trim()){n=t.textContent.trim().replace(/\s+/g," ");let e=t.querySelectorAll(".read-more-hidden");if(e.length>0)for(let t of e){let e=t.textContent.trim();e&&!n.includes(e)&&(n+=" "+e)}break}}if(n&&(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace(/Edit Translation/g,"").trim()).replace(/\(Source:.+?\)/g,"").trim()).replace(/English한국어हिन्दीEspañol.+/s,"").trim()).replace(/English[\s\n]+한국어[\s\n]+हिन्दी[\s\n]+Español.+/s,"").trim()).replace(/English[\s\n]*ภาษาไทย[\s\n]*Arabic[\s\n]*Русский.+/s,"").trim()).replace(/Expand$/g,"").trim()).replace(/Show\s+Less$/g,"").trim()).replace(/Synopsis\s+/g,"").trim()).replace(/Edit$/g,"").trim()),!n||n.length<10){let e=s.querySelector('meta[name="description"]');e&&(n=e.getAttribute("content")||"")}let o="",d=s.querySelector('.show-detailsxss .list-item:has(b:contains("Director")) a');d&&(o=d.textContent.trim());let c=[];s.querySelectorAll(".show-genres a").forEach(e=>{c.push(e.textContent.trim())});let m=[];s.querySelectorAll(".show-tags a").forEach(e=>{let t=e.textContent.trim();t&&!t.includes("Vote or add tags")&&m.push(t)});let u="South Korea",h=s.querySelector('.list-item:has(b:contains("Country"))');if(h){let e=h.textContent.replace("Country:","").trim();e&&(u=e)}let g="",x=s.querySelector('.list-item:has(b:contains("Type"))');x&&(g=x.textContent.replace("Type:","").trim());let p=null,y=s.querySelector('.list-item:has(b:contains("Episodes"))');if(y){let e=y.textContent.replace("Episodes:","").trim();e&&!isNaN(parseInt(e))&&(p=parseInt(e))}let f="",b="",w="",j=s.querySelector('.list-item:has(b:contains("Aired"))')||s.querySelector('.list-item:has(b:contains("Airs"))');if(j&&!j.textContent.includes("Airs On")){let e=j.querySelector("b"),t=e?e.textContent.trim():"";if("Aired:"===t||"Airs:"===t){let e=(f=j.textContent.replace(t,"").trim()).match(/([A-Za-z]+\s+\d+,\s+\d{4})\s*-\s*([A-Za-z]+\s+\d+,\s+\d{4})/),a=f.match(/([A-Za-z]+\s+\d+,\s+\d{4})/),s=f.match(/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/),r=f.match(/(\d{4})/);if(e)b=e[1],w=e[2];else if(a)b=a[1];else if(s)b=s[1],w=s[2];else if(r)b=r[1];else{let e=f.match(/([A-Za-z]+\s+\d{4})/);if(e)b=e[1];else{let e=f.match(/(\d{4})\s*-\s*(\d{4})/);e?(b=e[1],w=e[2]):b=f}}}}let S="",N=s.querySelector('.list-item:has(b:contains("Airs On"))');N&&(S=N.textContent.replace("Airs On:","").trim());let v="",C=s.querySelector('.list-item:has(b:contains("Original Network")) a');C&&(v=C.textContent.trim());let k="",P=s.querySelector('.list-item:has(b:contains("Content Rating"))');P&&(k=P.textContent.replace("Content Rating:","").trim());let T=s.querySelector(".film-cover img.img-responsive")?.getAttribute("src")||"",q=a.split("/"),E=q[q.length-1],M=0,A=s.querySelector('.box[itemtype="http://schema.org/AggregateRating"] .list-item:has(b:contains("Score"))');if(A){let e=A.textContent.match(/(\d+\.\d+)/);e&&(M=parseFloat(e[1]))}let $={mainRoles:[],supportRoles:[]};return(()=>{let e=(e,t)=>{let a=s.querySelector(`h3.header.b-b.p-b:contains("${e}")`);if(a){let e=a.nextElementSibling;return!!e&&"UL"===e.tagName&&(e.querySelectorAll("li.list-item").forEach(e=>{let a=e.querySelector("a.text-primary b")?.textContent.trim()||"",s="",r=e.querySelector("small[title]");if(r&&(s=r.textContent.trim()||r.getAttribute("title")?.trim()||""),!s){let t=e.querySelector("small:not(.text-muted)");t&&(s=t.textContent.trim())}let l=e.querySelector("img")?.getAttribute("src")||"";a&&(t?$.mainRoles.push({name:a,role:s||"주연",image:l}):$.supportRoles.push({name:a,role:s||"조연",image:l}))}),!0)}let r=s.querySelector(`h3.header:contains("${e}")`);if(r){let e=r.nextElementSibling;if(e&&"UL"===e.tagName)return e.querySelectorAll("li.list-item").forEach(e=>{let a=e.querySelector("a.text-primary b")?.textContent.trim()||"",s=e.querySelector("small[title]")?.textContent.trim()||"";s||(s=e.querySelector("small:not(.text-muted)")?.textContent.trim()||"");let r=e.querySelector("img")?.getAttribute("src")||"";a&&(t?$.mainRoles.push({name:a,role:s||"주연",image:r}):$.supportRoles.push({name:a,role:s||"조연",image:r}))}),!0}return!1};e("Main Role",!0),e("Support Role",!1),e("Guest Role",!1),0===$.mainRoles.length&&0===$.supportRoles.length&&s.querySelectorAll(".list-item").forEach(e=>{let t=e.querySelector("a.text-primary b")?.textContent.trim()||"",a=e.querySelector("small.text-muted")?.textContent.trim()||"",s=e.querySelector("small[title]")?.textContent.trim()||"";s||(s=e.querySelector("small:not(.text-muted)")?.textContent.trim()||"");let r=e.querySelector("img")?.getAttribute("src")||"";t&&(a.includes("Role")||a.includes("Cast"))&&(a.includes("Main")?$.mainRoles.push({name:t,role:s||"주연",image:r}):$.supportRoles.push({name:t,role:s||"조연",image:r}))})})(),{title:r,originalTitle:l||"",description:n,synopsis:n,summary:n,content:n,directorName:o,director:o,genres:c,tags:m,country:u,type:g,episodes:p,rating:M,releaseDate:b,startDate:b,endDate:w,airTime:S,airsOn:S,airsInfo:f,network:v,contentRating:k,coverImage:T,posterUrl:T,slug:E,mdlId:t,mdlUrl:a,category:g&&g.toLowerCase().includes("movie")?"movie":"drama",cast:{mainRoles:$.mainRoles||[],supportRoles:$.supportRoles||[]},_sourceUrl:a,_dateString:b}},eh=e=>{q[e.id]||(R(e),O(""),A(!0))},eg=async()=>{if(!$.trim()||!L){em("HTML 콘텐츠를 입력해주세요.","error");return}A(!1);try{if(em(`HTML 처리 중... (${$.length} 바이트)`,"info"),"auto-list"===L.id){let e=await fetch("/api/crawler/auto-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:L.url,mode:"list",htmlContent:$})});if(!e.ok){let t=await e.json();throw Error(t.message||"HTML 파싱 실패")}let t=await e.json();if(!t.success)throw Error(t.message||"HTML 파싱 결과 처리 실패");let a=t.data.dramas;S(e=>[...e,...a]),K(e=>({...e,dramas:e.dramas+a.length})),ee(e=>[...e,...a]),t.data.nextPage&&G.page<G.totalPages?(em(`다음 페이지로 이동합니다: ${G.page+1}/${G.totalPages}`,"info"),window.open(t.data.nextPage,"_blank"),setTimeout(()=>{crawlNextPage(t.data.nextPage)},1e3)):(em(`총 ${G.dramas}개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다.`,"success"),startAutoDetailCrawling());return}if("auto-detail"===L.id){let e=await fetch("/api/crawler/auto-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:L.url,mode:"detail",htmlContent:$})});if(!e.ok){let t=await e.json();throw Error(t.message||"HTML 파싱 실패")}let t=await e.json();if(!t.success)throw Error(t.message||"HTML 파싱 결과 처리 실패");let a=localStorage.getItem("token")||localStorage.getItem("adminToken"),s=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},body:JSON.stringify({data:t.data})});if(!s.ok){let e=await s.json();throw Error(e.message||"저장 실패")}let r=L.originalDrama;r&&(E(e=>({...e,[r.id]:"saved"})),ea(e=>e+1)),setTimeout(()=>{processNextDramaDetail()},500*Math.random()+500);return}E(e=>({...e,[L.id]:"loading"}));try{let e=eu($,L.id,L.url);if(ex(e,L),B){let e=I.filter(e=>e.id!==L.id);_(e),e.length>0?setTimeout(()=>{eh(e[0])},500):(z(!1),em("선택한 모든 드라마 저장이 완료되었습니다.","success"))}}catch(e){if(E(e=>({...e,[L.id]:"error"})),em(`'${L.title}' 파싱 실패: ${e.message}`,"error"),B){let e=I.filter(e=>e.id!==L.id);_(e),e.length>0?setTimeout(()=>{eh(e[0])},500):(z(!1),em("선택한 모든 드라마 저장이 완료되었습니다.","success"))}}}catch(e){em(`HTML 처리 오류: ${e.message}`,"error"),"auto-detail"===L.id&&setTimeout(()=>{processNextDramaDetail()},1e3)}},ex=async(e,t)=>{try{let a,s=localStorage.getItem("token")||localStorage.getItem("adminToken")||sessionStorage.getItem("token")||sessionStorage.getItem("adminToken"),r=!1;try{let e=await fetch("/api/auth/session"),t=await e.json();t?.user?.role!=="admin"||(r=!0,s||(s="session-based-auth"))}catch(e){}if(!r)try{let e=await fetch("/api/auth/check-admin",{headers:s?{Authorization:`Bearer ${s}`}:{}});(await e.json()).isAdmin&&(r=!0)}catch(e){}if(!r&&!s)throw Error("인증되지 않은 사용자입니다. 어드민으로 로그인해주세요.");let l=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({data:e})});try{a=await l.json()}catch(e){throw Error(`서버 응답 파싱 실패 (상태: ${l.status})`)}if(!l.ok)throw Error(a.message||`저장 실패 (상태: ${l.status})`);E(e=>({...e,[t.id]:"saved"})),em(`'${t.title}' 저장 완료`,"success")}catch(e){E(e=>({...e,[t.id]:"error"})),em(`'${t.title}' 저장 실패: ${e.message}`,"error")}},ep=async e=>{try{if(!Z)return;K(e=>({...e,page:e.page+1})),em(`${G.page+1}/${G.totalPages} 페이지 스텔스 크롤링 중...`,"info");let t=await fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,mode:"list",usePuppeteer:!0})});if(!t.ok){let e=await t.json(),a=e.message||"크롤링 실패";throw e.error&&(a+=`: ${e.error}`),Error(a)}let a=await t.json();if(!a.success)throw Error(a.message||"크롤링 데이터 처리 실패");let s=a.data.dramas;S(e=>[...e,...s]),K(e=>({...e,dramas:e.dramas+s.length})),ee(e=>[...e,...s]),a.data.nextPage&&G.page<G.totalPages?setTimeout(()=>{ep(a.data.nextPage)},500*Math.random()+500):(em(`총 ${G.dramas}개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다.`,"success"),ey())}catch(e){W(!1),em(`페이지 스텔스 크롤링 오류: ${e.message}`,"error")}},ey=async()=>{if(!X&&0!==Y.length)try{Q(!0),ef()}catch(e){Q(!1),em(`상세 정보 스텔스 크롤링 오류: ${e.message}`,"error")}},ef=async()=>{try{if(!X||0===Y.length){Q(!1),W(!1),em("모든 드라마 크롤링 및 저장이 완료되었습니다.","success");return}let e=Y[0];if(ee(e=>e.slice(1)),"saved"===q[e.id]){ef();return}E(t=>({...t,[e.id]:"loading"}));let t=await fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,mode:"detail",usePuppeteer:!0})});if(!t.ok){let e=await t.json();throw Error(e.message||"상세 정보 스텔스 크롤링 실패")}let a=await t.json();if(!a.success)throw Error(a.message||"상세 정보 처리 실패");let s=localStorage.getItem("token")||localStorage.getItem("adminToken");if(!s)throw Error("인증 토큰이 없습니다. 다시 로그인해주세요.");let r=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({data:a.data})});if(!r.ok){let e=await r.json();throw Error(e.message||"저장 실패")}E(t=>({...t,[e.id]:"saved"})),ea(e=>e+1),setTimeout(()=>{ef()},500*Math.random()+500)}catch(e){if(Y.length>0){let e=Y[0];E(t=>({...t,[e.id]:"error"}))}em(`상세 정보 크롤링 오류: ${e.message}, 다음 항목으로 진행합니다.`,"error"),setTimeout(()=>{ef()},1e3)}},eb=async()=>{let e=Object.keys(P).filter(e=>P[e]);if(0===e.length){em("저장할 드라마를 선택해주세요.","info");return}let t=e.map(e=>j.find(t=>t.id===e)).filter(e=>e);_(t),z(!0),t.length>0&&eh(t[0])},ew=e=>{T(t=>({...t,[e]:!t[e]}))},ej=e=>{switch(q[e]){case"loading":return r.jsx(o.default,{size:16,className:"animate-spin text-blue-500"});case"saved":return r.jsx(d.default,{size:16,className:"text-green-500"});case"error":return r.jsx(c.default,{size:16,className:"text-red-500"});default:return r.jsx(m.default,{size:16})}};return(0,r.jsxs)(n.default,{children:[(0,r.jsxs)("div",{className:"container mx-auto p-6",children:[(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"MyDramalist 크롤러"}),r.jsx(p(),{href:"/admin/content",className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-800",children:"콘텐츠 목록으로 돌아가기"})]}),r.jsx("script",{dangerouslySetInnerHTML:{__html:`
          // 페이지 로드 완료 후 실행
          document.addEventListener('DOMContentLoaded', function() {
            console.log('디버깅 스크립트 로드됨');
            
            // 스텔스 모드 버튼에 이벤트 리스너 직접 추가
            const stealthModeBtn = document.getElementById('stealth-mode-button');
            if (stealthModeBtn) {
              stealthModeBtn.addEventListener('click', function() {
                console.log('스텔스 모드 버튼 클릭 - 직접 이벤트 리스너');
              });
            }
            
            // 크롤링 시작 버튼에 이벤트 리스너 직접 추가
            const startCrawlingBtn = document.getElementById('start-stealth-crawling-button');
            if (startCrawlingBtn) {
              startCrawlingBtn.addEventListener('click', function() {
                console.log('스텔스 크롤링 시작 버튼 클릭 - 직접 이벤트 리스너');
                // 이벤트 발생 확인용 알림창
                alert('스텔스 크롤링 버튼 클릭됨 (직접 이벤트 리스너에서 감지)');
              });
            }
          });
          
          // 진단 함수
          function diagnoseCrawler() {
            console.log('크롤러 진단 시작');
            
            // 버튼 요소 확인
            const stealthModeBtn = document.getElementById('stealth-mode-button');
            const startCrawlingBtn = document.getElementById('start-stealth-crawling-button');
            
            console.log('스텔스 모드 버튼 존재:', !!stealthModeBtn);
            console.log('스텔스 크롤링 시작 버튼 존재:', !!startCrawlingBtn);
            
            // window에 노출된 함수 확인
            console.log('startAutoCrawling 함수 노출 여부:', typeof window.startAutoCrawling === 'function');
            console.log('debugState 객체 노출 여부:', !!window.debugState);
            
            if (window.debugState) {
              console.log('현재 상태:', {
                autoMode: window.debugState.getAutoMode(),
                puppeteerEnabled: window.debugState.getPuppeteerEnabled(),
                autoCrawling: window.debugState.getAutoCrawling()
              });
            }
            
            // 직접 함수 호출 테스트
            console.log('직접 함수 호출을 시도하려면 브라우저 콘솔에서 window.startAutoCrawling()을 실행하세요.');
          }
          
          // 전역 객체에 진단 함수 노출
          window.diagnoseCrawler = diagnoseCrawler;
          
          // 1초 후 자동 실행
          setTimeout(diagnoseCrawler, 1000);
        `}}),r.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center",children:[r.jsx(u.default,{size:20,className:"mr-2 text-purple-600"}),"스텔스 크롤링 모드"]}),r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"URL을 입력하고 페이지 수를 설정한 후 시작하면 자동으로 드라마 목록과 상세 정보를 크롤링하고 저장합니다."}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-1",children:"최대 페이지 수"}),r.jsx("input",{type:"number",min:"1",max:"10",value:F,onChange:e=>V(parseInt(e.target.value)||1),className:"w-full border border-gray-300 rounded-md px-3 py-2",disabled:Z})]}),r.jsx("div",{className:"flex items-end",children:Z?(0,r.jsxs)("button",{onClick:()=>{eo(!0),ed&&(ed.abort(),ec(null)),W(!1),Q(!1),ee([]),ei({current:0,total:0}),alert("크롤링이 중지되었습니다. 모든 진행 중인 요청이 취소되었습니다."),em("자동 크롤링이 중지되었습니다.","info"),confirm("페이지를 새로고침하여 모든 크롤링 작업을 강제 종료하시겠습니까?")&&window.location.reload()},className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center justify-center",children:[r.jsx(h.default,{size:18,className:"mr-2"}),"크롤링 중지"]}):(0,r.jsxs)("button",{id:"start-stealth-crawling-button",onClick:()=>{H(!0),er(!0),eo(!1),K({page:0,totalPages:parseInt(F),dramas:0}),ea(0),W(!0);let e=new AbortController;ec(e),setTimeout(()=>{fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:J,mode:"list",usePuppeteer:!0})}).then(e=>e.json()).then(e=>{if(!e.success)throw Error(e.message||"크롤링 데이터 처리 실패");let t=e.data.dramas;S(e=>[...e,...t]),K(e=>({...e,page:e.page+1,dramas:e.dramas+t.length})),ee(e=>[...e,...t]),e.data.nextPage&&G.page<G.totalPages?ep(e.data.nextPage):(em(`총 ${G.dramas}개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다.`,"success"),ey())}).catch(e=>{W(!1),em(`스텔스 크롤링 오류: ${e.message}`,"error")})},100)},className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center justify-center",children:[r.jsx(u.default,{size:18,className:"mr-2"}),"스텔스 크롤링 시작"]})})]}),(0,r.jsxs)("div",{className:"mb-4 hidden",children:[(0,r.jsxs)("label",{className:"flex items-center mb-1",children:[r.jsx("input",{type:"checkbox",checked:es,onChange:e=>er(e.target.checked),className:"mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 rounded",disabled:Z}),r.jsx("span",{className:"text-gray-700 text-sm font-medium",children:"Puppeteer 사용 (자동화된 브라우저를 통한 크롤링)"})]}),r.jsx("p",{className:"text-xs text-gray-500 ml-6",children:es?"Puppeteer를 사용하면 Cloudflare 보호를 우회하여 자동으로 크롤링할 수 있습니다. 서버 부하가 높을 수 있습니다.":"비활성화된 경우 HTML을 수동으로 입력해야 합니다."})]}),Z&&(0,r.jsxs)("div",{className:"bg-gray-100 p-4 rounded-md",children:[r.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"스텔스 크롤링 진행 상태"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-600",children:"페이지:"}),(0,r.jsxs)("span",{className:"ml-2 font-medium",children:[G.page," / ",G.totalPages]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-600",children:"불러온 드라마:"}),r.jsx("span",{className:"ml-2 font-medium",children:G.dramas})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm text-gray-600",children:"저장된 드라마:"}),r.jsx("span",{className:"ml-2 font-medium",children:et})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"목록 크롤링:"}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-1",children:r.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${Math.min(100,Math.round(G.page/G.totalPages*100))}%`}})})]}),X&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["상세 정보 크롤링: ",el.current," / ",el.total]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-1",children:r.jsx("div",{className:"bg-green-600 h-2.5 rounded-full",style:{width:`${Math.min(100,Math.round(el.current/el.total*100))}%`}})})]})]})]})}),b&&r.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded",children:r.jsx("p",{children:b})}),y&&(0,r.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold",children:["크롤링 결과 (",j.length,")"]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[r.jsx("button",{onClick:()=>{if(j.every(e=>P[e.id]))T({});else{let e={};j.forEach(t=>{e[t.id]=!0}),T(e)}},className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded text-sm",children:j.every(e=>P[e.id])?"전체 선택 해제":"전체 선택"}),(0,r.jsxs)("button",{onClick:eb,disabled:0===Object.keys(P).filter(e=>P[e]).length,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center disabled:opacity-50",children:[r.jsx(g.default,{size:16,className:"mr-1"}),"선택 항목 저장"]})]})]}),j.length>0&&r.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10",children:"선택"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"이미지"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"제목"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"카테고리"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"방영년도"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"에피소드"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"평점"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"작업"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("input",{type:"checkbox",checked:!!P[e.id],onChange:()=>ew(e.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.imageUrl&&r.jsx("div",{className:"w-12 h-16 relative",children:r.jsx("img",{src:e.imageUrl,alt:e.title,className:"object-cover w-full h-full rounded"})})}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.title}),r.jsx("div",{className:"text-xs text-gray-500 max-w-md line-clamp-2",children:e.summary})]}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:"drama"===e.category?"드라마":"movie"===e.category?"영화":e.category}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.year||"-"}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.episodes||"-"}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.rating>0?e.rating.toFixed(1):"-"}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>eh(e),disabled:"loading"===q[e.id]||"saved"===q[e.id],className:`inline-flex items-center px-2 py-1 border rounded-md text-xs font-medium
                              ${"saved"===q[e.id]?"bg-green-100 text-green-800 border-green-200":"error"===q[e.id]?"bg-red-100 text-red-800 border-red-200 hover:bg-red-200":"bg-blue-100 text-blue-800 border-blue-200 hover:bg-blue-200"}`,children:[ej(e.id),r.jsx("span",{className:"ml-1",children:"loading"===q[e.id]?"저장 중...":"saved"===q[e.id]?"저장됨":"error"===q[e.id]?"재시도":"상세 HTML 입력"})]}),r.jsx("button",{onClick:()=>{try{alert(`'${e.title}' 상세 정보를 크롤링합니다.`),E(t=>({...t,[e.id]:"loading"})),fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,mode:"detail"})}).then(e=>e.json()).then(t=>{if(t.success){Object.assign(e,t.data);let a=localStorage.getItem("token")||localStorage.getItem("adminToken");return fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},body:JSON.stringify({data:t.data})})}throw Error(t.message||"상세 정보 크롤링 실패")}).then(e=>e.json()).then(t=>{E(t=>({...t,[e.id]:"saved"})),em(`'${e.title}' 저장 완료`,"success")}).catch(t=>{E(t=>({...t,[e.id]:"error"})),em(`'${e.title}' 처리 중 오류: ${t.message}`,"error")})}catch(e){alert(`처리 중 오류: ${e.message}`)}},disabled:"loading"===q[e.id]||"saved"===q[e.id],className:"ml-2 text-purple-600 hover:text-purple-800 text-xs hover:underline disabled:opacity-50 disabled:hover:no-underline",children:"스텔스 크롤링"}),r.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:text-blue-800 text-xs",children:"상세"})]})})]},e.id))})]})})}),C.visible&&r.jsx("div",{className:`fixed bottom-4 right-4 px-4 py-2 rounded-md shadow-lg ${"success"===C.type?"bg-green-500 text-white":"error"===C.type?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:C.message})]}),M&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold",children:['"',L?.title,'"']}),r.jsx("button",{onClick:()=>A(!1),className:"text-gray-500 hover:text-gray-700",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx("p",{className:"text-sm text-gray-500 mb-2",children:L?.id==="auto-list"?(0,r.jsxs)(r.Fragment,{children:["MyDramalist 목록 페이지에서 ",r.jsx("code",{children:"<body>"})," 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."]}):L?.id==="auto-detail"?(0,r.jsxs)(r.Fragment,{children:["MyDramalist 상세 페이지에서 ",r.jsx("code",{children:"<body>"})," 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."]}):r.jsx(r.Fragment,{children:"MyDramalist 사이트에서 드라마 상세 페이지에 접속한 후, 개발자 도구를 열고 <body> 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."})}),r.jsx("textarea",{rows:"10",value:$,onChange:e=>O(e.target.value),placeholder:"HTML 코드를 붙여넣으세요.",className:"w-full border border-gray-300 rounded-md px-4 py-2 font-mono text-sm"}),(0,r.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[r.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100",children:"취소"}),r.jsx("button",{onClick:eg,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:L?.id==="auto-list"||L?.id==="auto-detail"?"계속하기":"저장"})]})]})})]})}async function w(e){let t=await (0,i.getSession)(e);return t&&"admin"===t.user.role?{props:{session:t}}:{redirect:{destination:"/admin/login",permanent:!1}}}y=(f.then?(await f)():f)[0],s()}catch(e){s(e)}})},41649:e=>{e.exports=require("next-auth/react")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},40968:e=>{e.exports=require("next/head")},16689:e=>{e.exports=require("react")},66405:e=>{e.exports=require("react-dom")},20997:e=>{e.exports=require("react/jsx-runtime")},99816:e=>{e.exports=require("styled-jsx/style")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},71568:e=>{e.exports=require("zlib")},3590:e=>{e.exports=import("react-toastify")}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[3393,1859,6859,8559,6870,8505,6014],()=>a(79303));module.exports=s})();