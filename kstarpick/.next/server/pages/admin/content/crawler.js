"use strict";(()=>{var e={};e.id=7867,e.ids=[7867],e.modules={79303:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>m,getServerSideProps:()=>h,getStaticPaths:()=>g,getStaticProps:()=>u,reportWebVitals:()=>p,routeModule:()=>S,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>f,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>y});var s=r(87093),l=r(35244),i=r(1323),n=r(65949),o=r(81928),d=r(17857),c=e([d]);d=(c.then?(await c)():c)[0];let m=(0,i.hoist)(d,"default"),u=(0,i.hoist)(d,"getStaticProps"),g=(0,i.hoist)(d,"getStaticPaths"),h=(0,i.hoist)(d,"getServerSideProps"),x=(0,i.hoist)(d,"config"),p=(0,i.hoist)(d,"reportWebVitals"),y=(0,i.hoist)(d,"unstable_getStaticProps"),b=(0,i.hoist)(d,"unstable_getStaticPaths"),f=(0,i.hoist)(d,"unstable_getStaticParams"),w=(0,i.hoist)(d,"unstable_getServerProps"),j=(0,i.hoist)(d,"unstable_getServerSideProps"),S=new s.PagesRouteModule({definition:{kind:l.RouteKind.PAGES,page:"/admin/content/crawler",pathname:"/admin/content/crawler",bundlePath:"",filename:""},components:{App:o.default,Document:n.default},userland:d});a()}catch(e){a(e)}})},44556:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});let a=(0,r(64370).default)("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]])},68453:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});let a=(0,r(64370).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},96390:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});let a=(0,r(64370).default)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},17857:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>f,getServerSideProps:()=>w});var s=r(20997),l=r(16689),i=r(41649),n=r(79046),o=r(40220),d=r(3785),c=r(83364),m=r(68453),u=r(55809),g=r(96390),h=r(44556),x=r(41664),p=r.n(x),y=r(3590);r(88819),r(25675);var b=e([y]);function f(){let[e,t]=(0,l.useState)("https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1"),[r,a]=(0,l.useState)(""),[i,x]=(0,l.useState)(!1),[y,b]=(0,l.useState)(!1),[f,w]=(0,l.useState)(null),[j,S]=(0,l.useState)([]),[v,N]=(0,l.useState)(null),[C,k]=(0,l.useState)({visible:!1,message:"",type:""}),[T,P]=(0,l.useState)({}),[A,M]=(0,l.useState)({}),[q,$]=(0,l.useState)(!1),[E,I]=(0,l.useState)(""),[R,L]=(0,l.useState)(null),[O,D]=(0,l.useState)(!1),[H,z]=(0,l.useState)([]),[B,_]=(0,l.useState)(!1),[J,F]=(0,l.useState)("https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1"),[U,V]=(0,l.useState)(1),[W,Z]=(0,l.useState)(!1),[K,G]=(0,l.useState)({page:0,totalPages:0,dramas:0}),[X,Q]=(0,l.useState)(!1),[Y,ee]=(0,l.useState)([]),[et,er]=(0,l.useState)(0),[ea,es]=(0,l.useState)(!0),[el,ei]=(0,l.useState)({current:0,total:0}),[en,eo]=(0,l.useState)(!1),[ed,ec]=(0,l.useState)(null),em=(e,t="info",r=3e3)=>{k({visible:!0,message:e,type:t}),setTimeout(()=>k({visible:!1,message:"",type:""}),r)},eu=e=>{let t=new DOMParser().parseFromString(e,"text/html"),r=[];t.querySelectorAll('div[id^="mdl-"]').forEach(e=>{let t=e.id.replace("mdl-",""),a=e.querySelector("h6.text-primary.title a");if(!a)return;let s=a.textContent.trim(),l="https://mydramalist.com"+a.getAttribute("href"),i=e.querySelector("span.text-muted"),n=(i?i.textContent.trim():"").split(" - "),o=n[0]?.includes("Drama")?"drama":n[0]?.includes("Movie")?"movie":"other",d=null,c=null;if(n[1]){let e=n[1].match(/(\d{4})/);e&&(d=parseInt(e[1]));let t=n[1].match(/(\d+) episodes/);t&&(c=parseInt(t[1]))}let m=e.querySelector("img.img-responsive.cover"),u=m?m.getAttribute("src")||m.getAttribute("data-src"):null,g=e.querySelector("span.p-l-xs.score"),h=g?.textContent?parseFloat(g.textContent):0,x=e.querySelectorAll("p"),p="";x.forEach(e=>{!e.querySelector("span")&&e.textContent.trim()&&!e.className.includes("rating")&&(p=e.textContent.trim())}),r.push({id:t,url:l,title:s,category:o,year:d,episodes:c,imageUrl:u,rating:h,summary:p})});let a=t.querySelector(".pagination .page-item.next a"),s=a?"https://mydramalist.com"+a.getAttribute("href"):null;return{dramas:r,nextPage:s}},eg=(e,t,r)=>{let a=new DOMParser().parseFromString(e,"text/html"),s=a.querySelector("h1.film-title")?.textContent.trim()||"",l="",i=a.querySelector('.show-detailsxss .list-item:has(b:contains("Native Title")) a');i&&(l=i.textContent.trim());let n="";for(let e of[".show-synopsis p span",".show-synopsis p",".show-synopsis",".film-description",".box-body .box-inset",".show-synopsis .synopsis",'div.box:contains("Synopsis") .box-body']){let t=a.querySelector(e);if(t&&t.textContent.trim()){n=t.textContent.trim().replace(/\s+/g," ");let e=t.querySelectorAll(".read-more-hidden");if(e.length>0)for(let t of e){let e=t.textContent.trim();e&&!n.includes(e)&&(n+=" "+e)}break}}if(n&&(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace(/Edit Translation/g,"").trim()).replace(/\(Source:.+?\)/g,"").trim()).replace(/English한국어हिन्दीEspañol.+/s,"").trim()).replace(/English[\s\n]+한국어[\s\n]+हिन्दी[\s\n]+Español.+/s,"").trim()).replace(/English[\s\n]*ภาษาไทย[\s\n]*Arabic[\s\n]*Русский.+/s,"").trim()).replace(/Expand$/g,"").trim()).replace(/Show\s+Less$/g,"").trim()).replace(/Synopsis\s+/g,"").trim()).replace(/Edit$/g,"").trim()),!n||n.length<10){let e=a.querySelector('meta[name="description"]');e&&(n=e.getAttribute("content")||"")}let o="",d=a.querySelector('.show-detailsxss .list-item:has(b:contains("Director")) a');d&&(o=d.textContent.trim());let c=[];a.querySelectorAll(".show-genres a").forEach(e=>{c.push(e.textContent.trim())});let m=[];a.querySelectorAll(".show-tags a").forEach(e=>{let t=e.textContent.trim();t&&!t.includes("Vote or add tags")&&m.push(t)});let u="South Korea",g=a.querySelector('.list-item:has(b:contains("Country"))');if(g){let e=g.textContent.replace("Country:","").trim();e&&(u=e)}let h="",x=a.querySelector('.list-item:has(b:contains("Type"))');x&&(h=x.textContent.replace("Type:","").trim());let p=null,y=a.querySelector('.list-item:has(b:contains("Episodes"))');if(y){let e=y.textContent.replace("Episodes:","").trim();e&&!isNaN(parseInt(e))&&(p=parseInt(e))}let b="",f="",w="",j=a.querySelector('.list-item:has(b:contains("Aired"))')||a.querySelector('.list-item:has(b:contains("Airs"))');if(j&&!j.textContent.includes("Airs On")){let e=j.querySelector("b"),t=e?e.textContent.trim():"";if("Aired:"===t||"Airs:"===t){let e=(b=j.textContent.replace(t,"").trim()).match(/([A-Za-z]+\s+\d+,\s+\d{4})\s*-\s*([A-Za-z]+\s+\d+,\s+\d{4})/),r=b.match(/([A-Za-z]+\s+\d+,\s+\d{4})/),a=b.match(/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/),s=b.match(/(\d{4})/);if(e)f=e[1],w=e[2];else if(r)f=r[1];else if(a)f=a[1],w=a[2];else if(s)f=s[1];else{let e=b.match(/([A-Za-z]+\s+\d{4})/);if(e)f=e[1];else{let e=b.match(/(\d{4})\s*-\s*(\d{4})/);e?(f=e[1],w=e[2]):f=b}}}}let S="",v=a.querySelector('.list-item:has(b:contains("Airs On"))');v&&(S=v.textContent.replace("Airs On:","").trim());let N="",C=a.querySelector('.list-item:has(b:contains("Original Network")) a');C&&(N=C.textContent.trim());let k="",T=a.querySelector('.list-item:has(b:contains("Content Rating"))');T&&(k=T.textContent.replace("Content Rating:","").trim());let P=a.querySelector(".film-cover img.img-responsive")?.getAttribute("src")||"",A=r.split("/"),M=A[A.length-1],q=0,$=a.querySelector('.box[itemtype="http://schema.org/AggregateRating"] .list-item:has(b:contains("Score"))');if($){let e=$.textContent.match(/(\d+\.\d+)/);e&&(q=parseFloat(e[1]))}let E={mainRoles:[],supportRoles:[]};return(()=>{let e=(e,t)=>{let r=a.querySelector(`h3.header.b-b.p-b:contains("${e}")`);if(r){let e=r.nextElementSibling;return!!e&&"UL"===e.tagName&&(e.querySelectorAll("li.list-item").forEach(e=>{let r=e.querySelector("a.text-primary b")?.textContent.trim()||"",a="",s=e.querySelector("small[title]");if(s&&(a=s.textContent.trim()||s.getAttribute("title")?.trim()||""),!a){let t=e.querySelector("small:not(.text-muted)");t&&(a=t.textContent.trim())}let l=e.querySelector("img")?.getAttribute("src")||"";r&&(t?E.mainRoles.push({name:r,role:a||"주연",image:l}):E.supportRoles.push({name:r,role:a||"조연",image:l}))}),!0)}let s=a.querySelector(`h3.header:contains("${e}")`);if(s){let e=s.nextElementSibling;if(e&&"UL"===e.tagName)return e.querySelectorAll("li.list-item").forEach(e=>{let r=e.querySelector("a.text-primary b")?.textContent.trim()||"",a=e.querySelector("small[title]")?.textContent.trim()||"";a||(a=e.querySelector("small:not(.text-muted)")?.textContent.trim()||"");let s=e.querySelector("img")?.getAttribute("src")||"";r&&(t?E.mainRoles.push({name:r,role:a||"주연",image:s}):E.supportRoles.push({name:r,role:a||"조연",image:s}))}),!0}return!1};e("Main Role",!0),e("Support Role",!1),e("Guest Role",!1),0===E.mainRoles.length&&0===E.supportRoles.length&&a.querySelectorAll(".list-item").forEach(e=>{let t=e.querySelector("a.text-primary b")?.textContent.trim()||"",r=e.querySelector("small.text-muted")?.textContent.trim()||"",a=e.querySelector("small[title]")?.textContent.trim()||"";a||(a=e.querySelector("small:not(.text-muted)")?.textContent.trim()||"");let s=e.querySelector("img")?.getAttribute("src")||"";t&&(r.includes("Role")||r.includes("Cast"))&&(r.includes("Main")?E.mainRoles.push({name:t,role:a||"주연",image:s}):E.supportRoles.push({name:t,role:a||"조연",image:s}))})})(),{title:s,originalTitle:l||"",description:n,synopsis:n,summary:n,content:n,directorName:o,director:o,genres:c,tags:m,country:u,type:h,episodes:p,rating:q,releaseDate:f,startDate:f,endDate:w,airTime:S,airsOn:S,airsInfo:b,network:N,contentRating:k,coverImage:P,posterUrl:P,slug:M,mdlId:t,mdlUrl:r,category:h&&h.toLowerCase().includes("movie")?"movie":"drama",cast:{mainRoles:E.mainRoles||[],supportRoles:E.supportRoles||[]},_sourceUrl:r,_dateString:f}},eh=e=>{A[e.id]||(L(e),I(""),$(!0))},ex=async()=>{if(!E.trim()||!R){em("HTML 콘텐츠를 입력해주세요.","error");return}$(!1);try{if(em(`HTML 처리 중... (${E.length} 바이트)`,"info"),"auto-list"===R.id){let e=await fetch("/api/crawler/auto-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:R.url,mode:"list",htmlContent:E})});if(!e.ok){let t=await e.json();throw Error(t.message||"HTML 파싱 실패")}let t=await e.json();if(!t.success)throw Error(t.message||"HTML 파싱 결과 처리 실패");let r=t.data.dramas;S(e=>[...e,...r]),G(e=>({...e,dramas:e.dramas+r.length})),ee(e=>[...e,...r]),t.data.nextPage&&K.page<K.totalPages?(em(`다음 페이지로 이동합니다: ${K.page+1}/${K.totalPages}`,"info"),window.open(t.data.nextPage,"_blank"),setTimeout(()=>{crawlNextPage(t.data.nextPage)},1e3)):(em(`총 ${K.dramas}개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다.`,"success"),startAutoDetailCrawling());return}if("auto-detail"===R.id){let e=await fetch("/api/crawler/auto-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:R.url,mode:"detail",htmlContent:E})});if(!e.ok){let t=await e.json();throw Error(t.message||"HTML 파싱 실패")}let t=await e.json();if(!t.success)throw Error(t.message||"HTML 파싱 결과 처리 실패");let r=localStorage.getItem("token")||localStorage.getItem("adminToken"),a=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:r?`Bearer ${r}`:""},body:JSON.stringify({data:t.data})});if(!a.ok){let e=await a.json();throw Error(e.message||"저장 실패")}let s=R.originalDrama;s&&(M(e=>({...e,[s.id]:"saved"})),er(e=>e+1)),setTimeout(()=>{processNextDramaDetail()},500*Math.random()+500);return}M(e=>({...e,[R.id]:"loading"}));try{let e=eg(E,R.id,R.url);if(ep(e,R),O){let e=H.filter(e=>e.id!==R.id);z(e),e.length>0?setTimeout(()=>{eh(e[0])},500):(D(!1),em("선택한 모든 드라마 저장이 완료되었습니다.","success"))}}catch(e){if(M(e=>({...e,[R.id]:"error"})),em(`'${R.title}' 파싱 실패: ${e.message}`,"error"),O){let e=H.filter(e=>e.id!==R.id);z(e),e.length>0?setTimeout(()=>{eh(e[0])},500):(D(!1),em("선택한 모든 드라마 저장이 완료되었습니다.","success"))}}}catch(e){em(`HTML 처리 오류: ${e.message}`,"error"),"auto-detail"===R.id&&setTimeout(()=>{processNextDramaDetail()},1e3)}},ep=async(e,t)=>{try{let r=localStorage.getItem("token")||localStorage.getItem("adminToken");if(!r)throw Error("인증 토큰이 없습니다. 다시 로그인해주세요.");let a=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({data:e})}),s=await a.json();if(!a.ok)throw Error(s.message||"저장 실패");M(e=>({...e,[t.id]:"saved"})),em(`'${t.title}' 저장 완료`,"success")}catch(e){M(e=>({...e,[t.id]:"error"})),em(`'${t.title}' 저장 실패: ${e.message}`,"error")}},ey=async e=>{try{if(!W)return;G(e=>({...e,page:e.page+1})),em(`${K.page+1}/${K.totalPages} 페이지 스텔스 크롤링 중...`,"info");let t=await fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,mode:"list",usePuppeteer:!0})});if(!t.ok){let e=await t.json(),r=e.message||"크롤링 실패";throw e.error&&(r+=`: ${e.error}`),Error(r)}let r=await t.json();if(!r.success)throw Error(r.message||"크롤링 데이터 처리 실패");let a=r.data.dramas;S(e=>[...e,...a]),G(e=>({...e,dramas:e.dramas+a.length})),ee(e=>[...e,...a]),r.data.nextPage&&K.page<K.totalPages?setTimeout(()=>{ey(r.data.nextPage)},500*Math.random()+500):(em(`총 ${K.dramas}개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다.`,"success"),eb())}catch(e){Z(!1),em(`페이지 스텔스 크롤링 오류: ${e.message}`,"error")}},eb=async()=>{if(!X&&0!==Y.length)try{Q(!0),ef()}catch(e){Q(!1),em(`상세 정보 스텔스 크롤링 오류: ${e.message}`,"error")}},ef=async()=>{try{if(!X||0===Y.length){Q(!1),Z(!1),em("모든 드라마 크롤링 및 저장이 완료되었습니다.","success");return}let e=Y[0];if(ee(e=>e.slice(1)),"saved"===A[e.id]){ef();return}M(t=>({...t,[e.id]:"loading"}));let t=await fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,mode:"detail",usePuppeteer:!0})});if(!t.ok){let e=await t.json();throw Error(e.message||"상세 정보 스텔스 크롤링 실패")}let r=await t.json();if(!r.success)throw Error(r.message||"상세 정보 처리 실패");let a=localStorage.getItem("token")||localStorage.getItem("adminToken");if(!a)throw Error("인증 토큰이 없습니다. 다시 로그인해주세요.");let s=await fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({data:r.data})});if(!s.ok){let e=await s.json();throw Error(e.message||"저장 실패")}M(t=>({...t,[e.id]:"saved"})),er(e=>e+1),setTimeout(()=>{ef()},500*Math.random()+500)}catch(e){if(Y.length>0){let e=Y[0];M(t=>({...t,[e.id]:"error"}))}em(`상세 정보 크롤링 오류: ${e.message}, 다음 항목으로 진행합니다.`,"error"),setTimeout(()=>{ef()},1e3)}},ew=async()=>{let e=Object.keys(T).filter(e=>T[e]);if(0===e.length){em("저장할 드라마를 선택해주세요.","info");return}let t=e.map(e=>j.find(t=>t.id===e)).filter(e=>e);z(t),D(!0),t.length>0&&eh(t[0])},ej=e=>{P(t=>({...t,[e]:!t[e]}))},eS=e=>{switch(A[e]){case"loading":return s.jsx(o.default,{size:16,className:"animate-spin text-blue-500"});case"saved":return s.jsx(d.default,{size:16,className:"text-green-500"});case"error":return s.jsx(c.default,{size:16,className:"text-red-500"});default:return s.jsx(m.default,{size:16})}},ev=e=>{try{e.mdlId||e.summary||A[e.id],M(t=>({...t,[e.id]:"loading"})),em(`'${e.title}' 등록 중...`,"info");let t=e.releaseDate||e.startDate||"",r=e.summary||e.description||e.synopsis||"",a="";e.genres&&(Array.isArray(e.genres)?a=e.genres.join(", "):"string"==typeof e.genres&&(a=e.genres));let s=e.contentRating||e.ageRating||"",l={...e,title:e.title||"",originalTitle:e.originalTitle||e.nativeTitle||"",summary:r,content:r,description:r,network:e.network||"",status:e.status||"ongoing",releaseDate:t,endDate:e.endDate||"",rating:e.rating||e.reviewRating||0,runtime:e.runtime||"",ageRating:s,contentRating:s,genres:e.genres||[],genresText:a,director:e.director||"",directors:e.directors||[],screenwriters:e.screenwriters||[],castingDirectors:e.castingDirectors||[],producers:e.producers||[],country:e.country||"KOREA",coverImage:e.posterImage||e.posterUrl||e.coverImage||"",posterImage:e.posterImage||e.posterUrl||e.coverImage||"",backgroundImage:e.backgroundImage||e.bannerImage||"",bannerImage:e.backgroundImage||e.bannerImage||"",mdlId:e.mdlId||null,mdlRating:e.rating||null,mdlVotes:e.votes||null,category:e.category||"drama",cast:(()=>{if(e.cast&&(Array.isArray(e.cast.mainRoles)||Array.isArray(e.cast.supportRoles))){let t=Array.isArray(e.cast.mainRoles)?e.cast.mainRoles.map((e,t)=>({name:e.name||"",role:e.role||"",profileImage:e.profileImage||e.image||"",order:t})):[],r=Array.isArray(e.cast.supportRoles)?e.cast.supportRoles.map((e,r)=>({name:e.name||"",role:e.role||"",profileImage:e.profileImage||e.image||"",order:t.length+r})):[];return[...t,...r]}return Array.isArray(e.cast)?e.cast.map((e,t)=>({name:e.name||"",role:e.role||"",profileImage:e.profileImage||e.image||"",order:t})):[]})(),watchProviders:e.whereToWatch||[],createdAt:new Date,updatedAt:new Date,originalData:{...e}},i=Array.isArray(l.cast)?l.cast.length:0,n=l.cast?.mainRoles||[],o=l.cast?.supportRoles||[];i>0||(n.length>0||o.length>0)&&(n.length,o.length);let d=localStorage.getItem("token")||localStorage.getItem("adminToken");fetch("/api/dramas",{method:"POST",headers:{"Content-Type":"application/json",Authorization:d?`Bearer ${d}`:""},body:JSON.stringify(l)}).then(e=>e.json()).then(t=>{t.success?(M(t=>({...t,[e.id]:"saved"})),em(`'${e.title}'이(가) 성공적으로 등록되었습니다.`,"success")):(M(t=>({...t,[e.id]:"error"})),em(`'${e.title}' 등록 실패: ${t.message}`,"error"))}).catch(t=>{M(t=>({...t,[e.id]:"error"})),em(`'${e.title}' 등록 중 오류 발생`,"error")})}catch(t){M(t=>({...t,[e.id]:"error"})),em(`등록 중 오류가 발생했습니다: ${t.message}`,"error")}},eN=async()=>{try{x(!0),em("드라마 데이터 백업 중...","info");let e=await fetch("/api/crawler/backup-dramas",{method:"POST"});if(!e.ok){let t=await e.json();throw Error(t.message||"백업 중 오류가 발생했습니다.")}let t=await e.json();return em(`${t.data.count}개의 드라마가 성공적으로 백업되었습니다.`,"success"),!0}catch(e){return em(`백업 중 오류: ${e.message}`,"error"),!1}finally{x(!1)}};return(0,s.jsxs)(n.default,{children:[(0,s.jsxs)("div",{className:"container mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"MyDramalist 크롤러"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[s.jsx("button",{id:"debug-button",onClick:()=>{alert("디버그 버튼 클릭됨!"),fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1",mode:"list"})}).then(e=>e.json()).then(e=>{alert(`API 테스트 결과: ${e.success?"성공":"실패"}`)}).catch(e=>{alert(`API 테스트 오류: ${e.message}`)})},className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 rounded-md text-white",children:"디버그 테스트"}),s.jsx(p(),{href:"/admin/content",className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-800",children:"콘텐츠 목록으로 돌아가기"})]})]}),s.jsx("script",{dangerouslySetInnerHTML:{__html:`
          // 페이지 로드 완료 후 실행
          document.addEventListener('DOMContentLoaded', function() {
            console.log('디버깅 스크립트 로드됨');
            
            // 스텔스 모드 버튼에 이벤트 리스너 직접 추가
            const stealthModeBtn = document.getElementById('stealth-mode-button');
            if (stealthModeBtn) {
              stealthModeBtn.addEventListener('click', function() {
                console.log('스텔스 모드 버튼 클릭 - 직접 이벤트 리스너');
              });
            }
            
            // 크롤링 시작 버튼에 이벤트 리스너 직접 추가
            const startCrawlingBtn = document.getElementById('start-stealth-crawling-button');
            if (startCrawlingBtn) {
              startCrawlingBtn.addEventListener('click', function() {
                console.log('스텔스 크롤링 시작 버튼 클릭 - 직접 이벤트 리스너');
                // 이벤트 발생 확인용 알림창
                alert('스텔스 크롤링 버튼 클릭됨 (직접 이벤트 리스너에서 감지)');
              });
            }
          });
          
          // 진단 함수
          function diagnoseCrawler() {
            console.log('크롤러 진단 시작');
            
            // 버튼 요소 확인
            const stealthModeBtn = document.getElementById('stealth-mode-button');
            const startCrawlingBtn = document.getElementById('start-stealth-crawling-button');
            
            console.log('스텔스 모드 버튼 존재:', !!stealthModeBtn);
            console.log('스텔스 크롤링 시작 버튼 존재:', !!startCrawlingBtn);
            
            // window에 노출된 함수 확인
            console.log('startAutoCrawling 함수 노출 여부:', typeof window.startAutoCrawling === 'function');
            console.log('debugState 객체 노출 여부:', !!window.debugState);
            
            if (window.debugState) {
              console.log('현재 상태:', {
                autoMode: window.debugState.getAutoMode(),
                puppeteerEnabled: window.debugState.getPuppeteerEnabled(),
                autoCrawling: window.debugState.getAutoCrawling()
              });
            }
            
            // 직접 함수 호출 테스트
            console.log('직접 함수 호출을 시도하려면 브라우저 콘솔에서 window.startAutoCrawling()을 실행하세요.');
          }
          
          // 전역 객체에 진단 함수 노출
          window.diagnoseCrawler = diagnoseCrawler;
          
          // 1초 후 자동 실행
          setTimeout(diagnoseCrawler, 1000);
        `}}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center",children:[s.jsx(g.default,{size:20,className:"mr-2 text-purple-600"}),"스텔스 크롤링 모드"]}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"URL을 입력하고 페이지 수를 설정한 후 시작하면 자동으로 드라마 목록과 상세 정보를 크롤링하고 저장합니다."}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx(()=>s.jsx("button",{onClick:eN,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,s.jsxs)(s.Fragment,{children:[s.jsx(o.default,{size:18,className:"inline-block mr-2 animate-spin"}),"백업 중..."]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(u.default,{size:18,className:"inline-block mr-2"}),"드라마 백업"]})}),{}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"크롤링 중 문제가 생길 경우를 대비해 데이터를 백업합니다. 크롤링 시작 전에도 자동으로 백업됩니다."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-1",children:"시작 URL"}),s.jsx("input",{type:"text",value:J,onChange:e=>F(e.target.value),placeholder:"https://mydramalist.com/search?...",className:"w-full border border-gray-300 rounded-md px-3 py-2",disabled:W})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-1",children:"최대 페이지 수"}),s.jsx("input",{type:"number",min:"1",max:"10",value:U,onChange:e=>V(parseInt(e.target.value)||1),className:"w-full border border-gray-300 rounded-md px-3 py-2",disabled:W})]}),s.jsx("div",{className:"flex items-end",children:W?(0,s.jsxs)("button",{onClick:()=>{eo(!0),ed&&(ed.abort(),ec(null)),Z(!1),Q(!1),ee([]),ei({current:0,total:0}),alert("크롤링이 중지되었습니다. 모든 진행 중인 요청이 취소되었습니다."),em("자동 크롤링이 중지되었습니다.","info"),confirm("페이지를 새로고침하여 모든 크롤링 작업을 강제 종료하시겠습니까?")&&window.location.reload()},className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center justify-center",children:[s.jsx(h.default,{size:18,className:"mr-2"}),"크롤링 중지"]}):(0,s.jsxs)("button",{id:"start-stealth-crawling-button",onClick:()=>{_(!0),es(!0),eo(!1),G({page:0,totalPages:parseInt(U),dramas:0}),er(0),Z(!0);let e=new AbortController;ec(e),setTimeout(()=>{fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:J,mode:"list",usePuppeteer:!0})}).then(e=>e.json()).then(e=>{if(!e.success)throw Error(e.message||"크롤링 데이터 처리 실패");let t=e.data.dramas;S(e=>[...e,...t]),G(e=>({...e,page:e.page+1,dramas:e.dramas+t.length})),ee(e=>[...e,...t]),e.data.nextPage&&K.page<K.totalPages?ey(e.data.nextPage):(em(`총 ${K.dramas}개의 드라마 목록을 불러왔습니다. 상세 정보 크롤링을 시작합니다.`,"success"),eb())}).catch(e=>{Z(!1),em(`스텔스 크롤링 오류: ${e.message}`,"error")})},100)},className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md flex items-center justify-center",children:[s.jsx(g.default,{size:18,className:"mr-2"}),"스텔스 크롤링 시작"]})})]}),(0,s.jsxs)("div",{className:"mb-4 hidden",children:[(0,s.jsxs)("label",{className:"flex items-center mb-1",children:[s.jsx("input",{type:"checkbox",checked:ea,onChange:e=>es(e.target.checked),className:"mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 rounded",disabled:W}),s.jsx("span",{className:"text-gray-700 text-sm font-medium",children:"Puppeteer 사용 (자동화된 브라우저를 통한 크롤링)"})]}),s.jsx("p",{className:"text-xs text-gray-500 ml-6",children:ea?"Puppeteer를 사용하면 Cloudflare 보호를 우회하여 자동으로 크롤링할 수 있습니다. 서버 부하가 높을 수 있습니다.":"비활성화된 경우 HTML을 수동으로 입력해야 합니다."})]}),W&&(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded-md",children:[s.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"스텔스 크롤링 진행 상태"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-2",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-sm text-gray-600",children:"페이지:"}),(0,s.jsxs)("span",{className:"ml-2 font-medium",children:[K.page," / ",K.totalPages]})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-sm text-gray-600",children:"불러온 드라마:"}),s.jsx("span",{className:"ml-2 font-medium",children:K.dramas})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-sm text-gray-600",children:"저장된 드라마:"}),s.jsx("span",{className:"ml-2 font-medium",children:et})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"목록 크롤링:"}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-1",children:s.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${Math.min(100,Math.round(K.page/K.totalPages*100))}%`}})})]}),X&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:["상세 정보 크롤링: ",el.current," / ",el.total]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-1",children:s.jsx("div",{className:"bg-green-600 h-2.5 rounded-full",style:{width:`${Math.min(100,Math.round(el.current/el.total*100))}%`}})})]})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"MyDramalist HTML 코드 입력"}),s.jsx("div",{className:"mb-2",children:s.jsx("textarea",{rows:"10",value:r,onChange:e=>{a(e.target.value)},placeholder:"MyDramalist 검색 결과 페이지의 HTML 코드를 붙여넣으세요.",className:"w-full border border-gray-300 rounded-md px-4 py-2 font-mono text-sm"})}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"MyDramalist 사이트에서 검색 결과 페이지의 HTML 코드를 복사하여 붙여넣으세요."}),s.jsx("button",{onClick:()=>{if(!r.trim()){em("HTML 콘텐츠를 입력해주세요.","error");return}try{b(!0);let e=eu(r);S(e.dramas),N(e.nextPage),em(`${e.dramas.length}개의 드라마를 찾았습니다.`,"success")}catch(e){w(e.message),em("HTML 파싱 중 오류가 발생했습니다: "+e.message,"error")}},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:"HTML 파싱하기"})]})]})}),f&&s.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded",children:s.jsx("p",{children:f})}),y&&(0,s.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:["크롤링 결과 (",j.length,")"]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>{if(j.every(e=>T[e.id]))P({});else{let e={};j.forEach(t=>{e[t.id]=!0}),P(e)}},className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded text-sm",children:j.every(e=>T[e.id])?"전체 선택 해제":"전체 선택"}),(0,s.jsxs)("button",{onClick:ew,disabled:0===Object.keys(T).filter(e=>T[e]).length,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center disabled:opacity-50",children:[s.jsx(u.default,{size:16,className:"mr-1"}),"선택 항목 저장"]})]})]}),j.length>0&&s.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10",children:"선택"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"이미지"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"제목"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"카테고리"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"방영년도"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"에피소드"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"평점"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"작업"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsx("input",{type:"checkbox",checked:!!T[e.id],onChange:()=>ej(e.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.imageUrl&&s.jsx("div",{className:"w-12 h-16 relative",children:s.jsx("img",{src:e.imageUrl,alt:e.title,className:"object-cover w-full h-full rounded"})})}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.title}),s.jsx("div",{className:"text-xs text-gray-500 max-w-md line-clamp-2",children:e.summary})]}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:"drama"===e.category?"드라마":"movie"===e.category?"영화":e.category}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.year||"-"}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.episodes||"-"}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.rating>0?e.rating.toFixed(1):"-"}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>eh(e),disabled:"loading"===A[e.id]||"saved"===A[e.id],className:`inline-flex items-center px-2 py-1 border rounded-md text-xs font-medium
                              ${"saved"===A[e.id]?"bg-green-100 text-green-800 border-green-200":"error"===A[e.id]?"bg-red-100 text-red-800 border-red-200 hover:bg-red-200":"bg-blue-100 text-blue-800 border-blue-200 hover:bg-blue-200"}`,children:[eS(e.id),s.jsx("span",{className:"ml-1",children:"loading"===A[e.id]?"저장 중...":"saved"===A[e.id]?"저장됨":"error"===A[e.id]?"재시도":"상세 HTML 입력"})]}),s.jsx("button",{onClick:()=>{try{alert(`'${e.title}' 상세 정보를 크롤링합니다.`),M(t=>({...t,[e.id]:"loading"})),fetch("/api/crawler/stealth-crawler",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,mode:"detail"})}).then(e=>e.json()).then(t=>{if(t.success){Object.assign(e,t.data);let r=localStorage.getItem("token")||localStorage.getItem("adminToken");return fetch("/api/crawler/save-drama",{method:"POST",headers:{"Content-Type":"application/json",Authorization:r?`Bearer ${r}`:""},body:JSON.stringify({data:t.data})})}throw Error(t.message||"상세 정보 크롤링 실패")}).then(e=>e.json()).then(t=>{M(t=>({...t,[e.id]:"saved"})),em(`'${e.title}' 저장 완료`,"success")}).catch(t=>{M(t=>({...t,[e.id]:"error"})),em(`'${e.title}' 처리 중 오류: ${t.message}`,"error")})}catch(e){alert(`처리 중 오류: ${e.message}`)}},disabled:"loading"===A[e.id]||"saved"===A[e.id],className:"ml-2 text-purple-600 hover:text-purple-800 text-xs hover:underline disabled:opacity-50 disabled:hover:no-underline",children:"스텔스 크롤링"}),"saved"===A[e.id]&&s.jsx("button",{onClick:()=>ev(e),className:"ml-2 text-green-600 hover:text-green-800 text-xs hover:underline",children:"드라마 등록"}),s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:text-blue-800 text-xs",children:"상세"})]})})]},e.id))})]})})}),(0,s.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mt-6 rounded-md",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"사용 가이드"}),(0,s.jsxs)("ol",{className:"list-decimal pl-5 text-blue-800",children:[(0,s.jsxs)("li",{className:"mb-2",children:[s.jsx("a",{href:"https://mydramalist.com/search?adv=titles&ty=68,83&co=3&so=newest&or=asc&page=1",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"MyDramalist"}),"에서 검색 결과 페이지를 열고 웹 브라우저 개발자 도구를 엽니다 (F12 또는 마우스 우클릭 후 '검사')."]}),s.jsx("li",{className:"mb-2",children:"결과 목록이 있는 부분 (box 클래스가 있는 요소)을 우클릭하고 '복사' > 'OuterHTML'을 선택합니다."}),s.jsx("li",{className:"mb-2",children:"복사한 HTML을 위의 텍스트 영역에 붙여넣고 '파싱하기' 버튼을 클릭합니다."}),s.jsx("li",{className:"mb-2",children:"상세 정보를 저장하려면 드라마 상세 페이지를 열고 같은 방식으로 HTML을 복사한 후 '상세 HTML 입력' 버튼을 클릭하세요."})]})]}),C.visible&&s.jsx("div",{className:`fixed bottom-4 right-4 px-4 py-2 rounded-md shadow-lg ${"success"===C.type?"bg-green-500 text-white":"error"===C.type?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:C.message})]}),q&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:['"',R?.title,'"']}),s.jsx("button",{onClick:()=>$(!1),className:"text-gray-500 hover:text-gray-700",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:R?.id==="auto-list"?(0,s.jsxs)(s.Fragment,{children:["MyDramalist 목록 페이지에서 ",s.jsx("code",{children:"<body>"})," 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."]}):R?.id==="auto-detail"?(0,s.jsxs)(s.Fragment,{children:["MyDramalist 상세 페이지에서 ",s.jsx("code",{children:"<body>"})," 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."]}):s.jsx(s.Fragment,{children:"MyDramalist 사이트에서 드라마 상세 페이지에 접속한 후, 개발자 도구를 열고 <body> 요소를 우클릭하여 Copy > outerHTML을 선택해 붙여넣으세요."})}),s.jsx("textarea",{rows:"10",value:E,onChange:e=>I(e.target.value),placeholder:"HTML 코드를 붙여넣으세요.",className:"w-full border border-gray-300 rounded-md px-4 py-2 font-mono text-sm"}),(0,s.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[s.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100",children:"취소"}),s.jsx("button",{onClick:ex,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:R?.id==="auto-list"||R?.id==="auto-detail"?"계속하기":"저장"})]})]})})]})}async function w(e){let t=await (0,i.getSession)(e);return t&&"admin"===t.user.role?{props:{session:t}}:{redirect:{destination:"/admin/login",permanent:!1}}}y=(b.then?(await b)():b)[0],a()}catch(e){a(e)}})},41649:e=>{e.exports=require("next-auth/react")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},40968:e=>{e.exports=require("next/head")},16689:e=>{e.exports=require("react")},66405:e=>{e.exports=require("react-dom")},20997:e=>{e.exports=require("react/jsx-runtime")},99816:e=>{e.exports=require("styled-jsx/style")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},71568:e=>{e.exports=require("zlib")},3590:e=>{e.exports=import("react-toastify")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3393,1859,6859,8559,6870,8505,6014],()=>r(79303));module.exports=a})();