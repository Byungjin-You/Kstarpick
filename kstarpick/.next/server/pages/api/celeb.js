"use strict";(()=>{var e={};e.id=2986,e.ids=[2986],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},84543:(e,t,a)=>{a.r(t),a.d(t,{config:()=>m,default:()=>d,routeModule:()=>p});var o={};a.r(o),a.d(o,{default:()=>l});var r=a(71802),n=a(47153),i=a(56249),u=a(44756),s=a(18867),c=a(41649);async function l(e,t){let{method:a}=e;switch(await (0,u.default)(),a){case"GET":try{let a={};e.query.category&&(a.category=e.query.category),"true"===e.query.featured&&(a.isFeatured=!0),"true"===e.query.active&&(a.isActive=!0);let o={};if(e.query.sort){let t=e.query.sort,a="true"===e.query.desc?-1:1;o[t]=a}else o.createdAt=-1;let r=parseInt(e.query.page)||1,n=parseInt(e.query.limit)||50,i=(r-1)*n,u=await s.default.find(a).sort(o).skip(i).limit(n),c=await s.default.countDocuments(a);t.status(200).json({success:!0,data:{celebrities:u,pagination:{total:c,page:r,limit:n,pages:Math.ceil(c/n)}}})}catch(e){t.status(400).json({success:!1,error:e.message})}break;case"POST":try{let a=await (0,c.getSession)({req:e});if(!a||"admin"!==a.user.role)return t.status(401).json({success:!1,error:"Unauthorized"});if(!e.body.name)return t.status(400).json({success:!1,error:"이름이 필요합니다."});!e.body.slug&&e.body.name&&(e.body.slug=e.body.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").replace(/-+/g,"-")),e.body.socialMedia||(e.body.socialMedia={}),e.body.socialMediaFollowers||(e.body.socialMediaFollowers={}),e.body.socialMediaRankings||(e.body.socialMediaRankings={}),e.body.socialMediaChanges||(e.body.socialMediaChanges={}),e.body.createdAt=new Date,e.body.updatedAt=new Date,e.body.socialMediaUpdatedAt=new Date;let o=await s.default.create(e.body);t.status(201).json({success:!0,data:o})}catch(e){t.status(400).json({success:!1,error:e.message})}break;default:t.status(400).json({success:!1,error:"Invalid method"})}}let d=(0,i.hoist)(o,"default"),m=(0,i.hoist)(o,"config"),p=new r.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/celeb",pathname:"/api/celeb",bundlePath:"",filename:""},userland:o})},44756:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var o=a(11185),r=a.n(o);a(25142).config({path:".env.production"});let n="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";n||(n="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),n.includes("localhost")||(n.includes("mongodb://")&&!n.includes("authSource=")&&(n.includes("?")?n+="&authSource=admin":n+="?authSource=admin"),!n.includes("docdb.amazonaws.com")||n.includes("authMechanism=")||(n.includes("?")?n+="&authMechanism=SCRAM-SHA-1":n+="?authMechanism=SCRAM-SHA-1"));let i=n.includes("localhost")||n.includes("127.0.0.1"),u=global.mongoose;async function s(){if(u.conn&&1===r().connection.readyState)return u.conn;if(0===r().connection.readyState||3===r().connection.readyState){u.conn=null,u.promise=null;try{await r().connection.close()}catch(e){}}if(!u.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};i||(n.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),u.promise=r().connect(n,e).then(e=>(e.connection.on("error",e=>{u.conn=null,u.promise=null,setTimeout(()=>{s().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{u.conn=null,u.promise=null,setTimeout(()=>{s().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw u.promise=null,e})}try{return u.conn=await u.promise,u.conn}catch(e){throw u.promise=null,e}}u||(u=global.mongoose={conn:null,promise:null});let c=s},18867:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(11185),r=a.n(o);let n=new(r()).Schema({name:{type:String,required:[!0,"Please provide celebrity name"],maxlength:[100,"Name cannot be more than 100 characters"]},koreanName:{type:String,maxlength:[100,"Korean name cannot be more than 100 characters"]},slug:{type:String,unique:!0,lowercase:!0},profileImage:{type:String,default:"/images/placeholder.jpg"},coverImage:{type:String},category:{type:String,enum:["idol","actor","actress","model","solo","band","rookie","other"],default:"idol"},role:{type:String,required:[!0,"Please provide celebrity role"],maxlength:[100,"Role cannot be more than 100 characters"]},agency:{type:String,maxlength:[100,"Agency cannot be more than 100 characters"]},debutDate:{type:Date},birthDate:{type:Date},socialMedia:{instagram:String,twitter:String,youtube:String,weverse:String,melon:String,spotify:String,tiktok:String,fancafe:String},socialMediaFollowers:{instagram:{type:Number,default:0},twitter:{type:Number,default:0},youtube:{type:Number,default:0},spotify:{type:Number,default:0},tiktok:{type:Number,default:0},fancafe:{type:Number,default:0}},socialMediaRankings:{instagram:{type:Number,default:0},twitter:{type:Number,default:0},youtube:{type:Number,default:0},spotify:{type:Number,default:0},tiktok:{type:Number,default:0},fancafe:{type:Number,default:0}},socialMediaChanges:{instagram:{count:{type:Number,default:0},percent:{type:Number,default:0}},twitter:{count:{type:Number,default:0},percent:{type:Number,default:0}},youtube:{count:{type:Number,default:0},percent:{type:Number,default:0}},spotify:{count:{type:Number,default:0},percent:{type:Number,default:0}},tiktok:{count:{type:Number,default:0},percent:{type:Number,default:0}},fancafe:{count:{type:Number,default:0},percent:{type:Number,default:0}}},socialMediaUpdatedAt:{type:Date,default:Date.now},musicVideos:[{title:String,youtubeUrl:String,views:Number,dailyViews:Number,publishedAt:Date,likes:Number,thumbnails:{default:{url:String,width:Number,height:Number},medium:{url:String,width:Number,height:Number},high:{url:String,width:Number,height:Number}},artists:[String]}],bio:{type:String,maxlength:[2e3,"Bio cannot be more than 2000 characters"]},followers:{type:Number,default:0},group:{type:String,maxlength:[100,"Group name cannot be more than 100 characters"]},position:{type:String,maxlength:[100,"Position cannot be more than 100 characters"]},isFeatured:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});n.pre("save",function(e){this.slug=this.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").replace(/-+/g,"-"),this.updatedAt=Date.now(),e()});let i=r().models.Celebrity||r().model("Celebrity",n)},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=84543);module.exports=a})();