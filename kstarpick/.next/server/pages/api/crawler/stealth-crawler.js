"use strict";(()=>{var e={};e.id=3358,e.ids=[3358],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},19828:e=>{e.exports=require("puppeteer-extra")},43199:e=>{e.exports=require("puppeteer-extra-plugin-stealth")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},99648:e=>{e.exports=import("axios")},20295:e=>{e.exports=import("cheerio")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},93949:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.r(t),i.d(t,{config:()=>c,default:()=>m,routeModule:()=>d});var a=i(71802),s=i(47153),l=i(56249),n=i(14835),o=e([n]);n=(o.then?(await o)():o)[0];let m=(0,l.hoist)(n,"default"),c=(0,l.hoist)(n,"config"),d=new a.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/crawler/stealth-crawler",pathname:"/api/crawler/stealth-crawler",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},14835:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.r(t),i.d(t,{default:()=>d}),i(41649);var a=i(19828),s=i.n(a),l=i(43199),n=i.n(l),o=i(20295);i(92048),i(55315),i(35968);var m=i(99648),c=e([o,m]);[o,m]=c.then?(await c)():c,s().use(n()());let b=()=>{let e=Math.floor(1500*Math.random())+500;return new Promise(t=>setTimeout(t,e))};async function d(e,t){let i;if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});try{let r;let{url:a,mode:s="list"}=e.body;if(!a)return t.status(400).json({success:!1,message:"URL이 필요합니다."});let{browser:l,page:n}=await h();i=l;let o=new Promise((e,t)=>{setTimeout(()=>{t(Error("페이지 로딩 타임아웃"))},6e4)});try{await Promise.race([n.goto(a,{waitUntil:"domcontentloaded",timeout:3e4}),o])}catch(e){}await b();try{await u(n)}catch(e){}try{await p(n)}catch(e){}let m=await n.content();if(!m||m.length<1e3)throw Error("HTML이 비어있거나 너무 짧습니다. 크롤링에 실패했습니다.");if("list"===s)return r=await g(m,a),t.status(200).json({success:!0,message:`${r.dramas.length}개의 드라마를 찾았습니다.`,data:{dramas:r.dramas,nextPage:r.nextPage}});if("detail"===s){let e=await f(m,a),i=function(e){if(!e)return null;if(e.endsWith("/cast"))return e;try{let t=e.trim();return`${t}/cast`}catch(e){return null}}(a);if(i&&i!==a)try{await n.goto(i,{waitUntil:"domcontentloaded",timeout:3e4}),await b(),await u(n);let t=await n.content();t&&t.length>1e3&&await x(e,t,i)}catch(e){}try{let t=await y(m,a);t&&t.length>0?(e.streamingServices=t,e.whereToWatch=t.map(e=>({name:e.name,link:e.url,imageUrl:e.logo,type:e.type}))):e.streamingServices=[]}catch(t){e.streamingServices=[]}return t.status(200).json({success:!0,message:`드라마 "${e.title}" 정보를 크롤링했습니다.`,data:e})}if("episodes"===s){let e=await w(m,a);return t.status(200).json({success:!0,message:`${e.length}개의 에피소드 정보를 크롤링했습니다.`,data:{episodes:e}})}{if("streaming"!==s)return t.status(400).json({success:!1,message:"유효하지 않은 크롤링 모드입니다."});let e=await y(m,a),i=e.map(e=>({name:e.name,link:e.url,imageUrl:e.logo,type:e.type}));return t.status(200).json({success:!0,message:`${e.length}개의 스트리밍 서비스 정보를 크롤링했습니다.`,data:{streamingServices:e,whereToWatch:i}})}}catch(e){return t.status(500).json({success:!1,message:"크롤링 중 오류가 발생했습니다.",error:e.message,stack:e.stack})}finally{if(i)try{await i.close()}catch(e){}}}async function u(e){await e.evaluate(async()=>{let e=document.body.scrollHeight,t=window.innerHeight,i=0;for(;i<e;){let e=Math.floor(400*Math.random())+100;i+=e,.1>Math.random()&&i>t&&(window.scrollTo(0,i-Math.floor(100*Math.random())),await new Promise(e=>setTimeout(e,400*Math.random()+100))),window.scrollTo(0,i),await new Promise(e=>setTimeout(e,800*Math.random()+300)),.2>Math.random()&&await new Promise(e=>setTimeout(e,2e3*Math.random()+500))}window.scrollTo(0,0)})}async function p(e){let t=await e.title();if(t.includes("Just a moment")||t.includes("Cloudflare")){await e.waitForTimeout(1e4);let t=await e.title();if(t.includes("Just a moment")||t.includes("Cloudflare"))throw Error("Cloudflare 보호를 우회하지 못했습니다.");return t}return t}async function h(){let e=await s().launch({headless:"new",args:["--no-sandbox","--disable-setuid-sandbox","--disable-web-security","--disable-features=IsolateOrigins,site-per-process","--disable-blink-features=AutomationControlled","--window-size=1920,1080","--disable-extensions","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--single-process","--disable-gpu"],ignoreHTTPSErrors:!0,slowMo:20,timeout:12e4}),t=await e.newPage();return await t.setViewport({width:1920+Math.floor(100*Math.random()),height:1080+Math.floor(100*Math.random()),deviceScaleFactor:.5>Math.random()?1:2,isMobile:!1,hasTouch:!1,isLandscape:!0}),await t.setDefaultNavigationTimeout(12e4),await t.setDefaultTimeout(12e4),await t.setRequestInterception(!0),t.on("request",e=>{let t=e.resourceType();["image","font","media"].includes(t)?e.abort():e.continue()}),await t.evaluateOnNewDocument(()=>{Object.defineProperty(navigator,"webdriver",{get:()=>!1}),window.navigator.chrome={runtime:{}},Object.defineProperty(navigator,"plugins",{get:()=>[{name:"Chrome PDF Plugin",filename:"internal-pdf-viewer"},{name:"Chrome PDF Viewer",filename:"mhjfbmdgcfjbbpaeojofohoefgiehjai"},{name:"Native Client",filename:"internal-nacl-plugin"}]})}),await t.evaluateOnNewDocument(()=>{localStorage.setItem("random_item",Math.random().toString(36))}),await t.setUserAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36"),await t.setExtraHTTPHeaders({"Accept-Language":"en-US,en;q=0.9,ko-KR;q=0.8,ko;q=0.7",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",Referer:"https://mydramalist.com/","sec-ch-ua":'"Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"'}),{browser:e,page:t}}async function g(e,t=""){try{let t=o.load(e),i=[],r=t('div[id^="mdl-"]');0===r.length&&t(".mdl-card").length>0&&t(".mdl-card").each((e,r)=>{let a=(t(r).attr("id")||"").replace("mdl-","")||`unknown-${e}`,s=t(r).find(".title a");if(!s.length)return;let l=s.text().trim(),n=s.attr("href")||"",o=n.startsWith("http")?n:"https://mydramalist.com"+n;i.push({id:a,url:o,title:l,category:"drama",imageUrl:t(r).find("img").attr("src")||null,summary:t(r).find(".content").text().trim()||""})}),t('div[id^="mdl-"]').each((e,r)=>{let a=t(r).attr("id").replace("mdl-",""),s=t(r).find("h6.text-primary.title a");if(!s.length)return;let l=s.text().trim(),n="https://mydramalist.com"+s.attr("href"),o=t(r).find("span.text-muted"),m=(o.length?o.text().trim():"").split(" - "),c=m[0]?.includes("Drama")?"drama":m[0]?.includes("Movie")?"movie":"other",d=null,u=null;if(m[1]){let e=m[1].match(/(\d{4})/);e&&(d=parseInt(e[1]));let t=m[1].match(/(\d+) episodes/);t&&(u=parseInt(t[1]))}let p=t(r).find("img.img-responsive.cover"),h=p.length?p.attr("src")||p.attr("data-src"):null,g=t(r).find("span.p-l-xs.score"),f=g.length?parseFloat(g.text()):0,x="";t(r).find("p").each((e,i)=>{!t(i).find("span").length&&t(i).text().trim()&&!t(i).hasClass("rating")&&(x=t(i).text().trim())}),i.push({id:a,url:n,title:l,category:c,year:d,episodes:u,imageUrl:h,rating:f,summary:x})});let a=t(".pagination .page-item.next a"),s=a.length?"https://mydramalist.com"+a.attr("href"):null;return{dramas:i,nextPage:s}}catch(e){throw e}}async function f(e,t){try{let i=t.split("/"),r=i[i.length-2],a=i[i.length-1],s=o.load(e),l=s("h1.film-title").text().trim()||"",n="";s(".show-detailsxss .list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Native Title:"===i&&(n=s(t).find("a").text().trim()||s(t).clone().children().remove().end().text().trim())});let m="",c=s(".v-image-wrap img.img-responsive");c.length&&(m=c.attr("src")||"");let d="",u=s(".box-body .film-poster img.img-responsive, .box-body .box-poster img.img-responsive");if(u.length&&(d=u.attr("src")||""),d&&(m=d),!d){let e=s(".box-body img.img-responsive");e.length&&(m=d=e.attr("src")||"")}let p="";for(let e of[".show-synopsis p span",".show-synopsis p",".show-synopsis",".film-description",".box-body .box-inset",".show-synopsis .synopsis",'div.box:contains("Synopsis") .box-body']){let t=s(e);if(t.length&&t.text().trim()){p=t.text().trim().replace(/\s+/g," ");let e=t.find(".read-more-hidden").text().trim();e&&!p.includes(e)&&(p+=" "+e);break}}if(p&&(p=(p=(p=(p=(p=(p=(p=(p=(p=p.replace(/Edit Translation/g,"").trim()).replace(/\(Source:.+?\)/g,"").trim()).replace(/English한국어हिन्दीEspañol.+/s,"").trim()).replace(/English[\s\n]+한국어[\s\n]+हिन्दी[\s\n]+Español.+/s,"").trim()).replace(/English[\s\n]*ภาษาไทย[\s\n]*Arabic[\s\n]*Русский.+/s,"").trim()).replace(/Expand$/g,"").trim()).replace(/Show\s+Less$/g,"").trim()).replace(/Synopsis\s+/g,"").trim()).replace(/Edit$/g,"").trim()),!p||p.length<10){let e=s('meta[name="description"]').attr("content");e&&(p=e.trim())}let h="";s(".show-detailsxss .list-item").each((e,t)=>{let i=s(t).find("b").text().trim();if("Director:"===i){let e=[];s(t).find("a").each((t,i)=>{let r=s(i).text().trim();r&&e.push(r)}),h=e.join(", ")}});let g=[];s(".show-genres a").each((e,t)=>{g.push(s(t).text().trim())});let f=[];s(".show-tags a").each((e,t)=>{let i=s(t).text().trim();i&&!i.includes("Vote or add tags")&&f.push(i)});let x="South Korea";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Country:"===i&&(x=s(t).text().replace("Country:","").trim())});let w="";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Type:"===i&&(w=s(t).text().replace("Type:","").trim())});let y=null;s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();if("Episodes:"===i){let e=s(t).text().replace("Episodes:","").trim();e&&!isNaN(parseInt(e))&&(y=parseInt(e))}});let b="",R="",M="";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();if("Aired:"===i||"Airs:"===i){let e=(b=s(t).clone().children("b").remove().end().text().trim()).match(/([A-Za-z]+\s+\d+,\s+\d{4})\s*-\s*([A-Za-z]+\s+\d+,\s+\d{4})/),i=b.match(/([A-Za-z]+\s+\d+,\s+\d{4})/),r=b.match(/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/),a=b.match(/(\d{4})/);if(e)R=e[1],M=e[2];else if(i)R=i[1];else if(r)R=r[1],M=r[2];else if(a)R=a[1];else{let e=b.match(/([A-Za-z]+\s+\d{4})/);if(e)R=e[1];else{let e=b.match(/(\d{4})\s*-\s*(\d{4})/);e?(R=e[1],M=e[2]):R=b}}}});let P="";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Airs On:"===i&&(P=s(t).text().replace("Airs On:","").trim())});let C="";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Original Network:"===i&&(C=s(t).find("a").text().trim())});let S="";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Content Rating:"===i&&(S=s(t).text().replace("Content Rating:","").trim())});let A="";s(".list-item").each((e,t)=>{let i=s(t).find("b").text().trim();"Duration:"===i&&(A=s(t).text().replace("Duration:","").trim())});let k=(s(".film-rating-vote").text().trim()||"").match(/(\d+(?:\.\d+)?)/),T=k?parseFloat(k[1]):0,E={mainRoles:[],supportRoles:[]},j=e=>e?e.replace(/<\/?[^>]+(>|$)/g,"").trim():"",q=e=>{if(!e)return"";let t=e.replace(/Main Role/gi,"").replace(/Support Role/gi,"").replace(/Guest Role/gi,"").replace(/Cameo/gi,"").replace(/Supporting Role/gi,"").trim(),i=t.match(/\[([^\]]+)\]/);if(i)return i[1].trim();if(t){let e=t.split(",");return e.length>1?e[1].trim():t.includes(" as ")?t.split(" as ")[1].trim():t}return""},D=e=>{if(!e)return!0;let t=e.toLowerCase();return!(t.includes("director")||t.includes("producer")||t.includes("screenwriter")||t.includes("writer")||t.includes("original author")||t.includes("casting director"))},_={directors:[],screenwriters:[],castingDirectors:[],producers:[]};s("h3.header.b-b.p-b").each((e,t)=>{let i=s(t).text().trim(),r=s(t).next("ul.list");"Director"===i||i.includes("Director")?r.find("li.list-item").each((e,t)=>{let i=s(t).find("a.text-primary b").text().trim(),r=s(t).find("img.img-responsive").attr("src")||"";i&&_.directors.push({name:i,image:r})}):"Screenwriter"===i||i.includes("Screenwriter")||"Writer"===i||i.includes("Writer")?r.find("li.list-item").each((e,t)=>{let i=s(t).find("a.text-primary b").text().trim(),r=s(t).find("img.img-responsive").attr("src")||"";i&&_.screenwriters.push({name:i,image:r})}):"Casting Director"===i||i.includes("Casting")?r.find("li.list-item").each((e,t)=>{let i=s(t).find("a.text-primary b").text().trim(),r=s(t).find("img.img-responsive").attr("src")||"";i&&_.castingDirectors.push({name:i,image:r})}):("Producer"===i||i.includes("Producer"))&&r.find("li.list-item").each((e,t)=>{let i=s(t).find("a.text-primary b").text().trim(),r=s(t).find("img.img-responsive").attr("src")||"";i&&_.producers.push({name:i,image:r})})}),(()=>{let e=(e,t)=>{let i=s(`h3.header:contains("${e}")`);return!!i.length&&(i.next("ul.list").find("li.list-item").each((e,i)=>{let r=s(i).find("a.text-primary b").text().trim(),a=s(i).find("small[title]").text().trim();a||(a=s(i).find("small:not(.text-muted)").text().trim());let l=s(i).find("img.img-responsive"),n=l.length?l.attr("src"):"";r&&(t?E.mainRoles.push({name:r,role:a||"주연",image:n}):E.supportRoles.push({name:r,role:a||"조연",image:n}))}),!0)};s("h3.header.b-b.p-b").each((e,t)=>{let i=s(t).text().trim(),r="Main Role"===i;(r||"Support Role"===i)&&s(t).next("ul.list").find("li.list-item").each((e,t)=>{let i=s(t).find("a.text-primary b").text().trim(),a="",l=s(t).find("small[title]");l.length&&(a=l.text().trim(),""===a&&l.attr("title")&&(a=l.attr("title").trim()));let n=s(t).find("img.img-responsive"),o=n.length?n.attr("src"):"";if(i){let e={name:i,role:a||(r?"주연":"조연"),image:o};r?E.mainRoles.push(e):E.supportRoles.push(e)}})}),E.mainRoles.length>0||E.supportRoles.length>0||(e("Main Role",!0),e("Support Role",!1),e("Guest Role",!1),e("Unknown",!1)),0===E.mainRoles.length&&0===E.supportRoles.length&&s(".list-item").each((e,t)=>{let i=s(t).find("a.text-primary b").text().trim(),r=s(t).find("img").attr("src")||"",a=s(t).find("small.text-muted").text().trim(),l=s(t).find("small[title]").text().trim();if(l||(l=s(t).find("small:not(.text-muted)").text().trim()),i&&(a.includes("Main")||a.includes("Support")||a.includes("Guest")||a.includes("Cameo"))){let e=a.includes("Main"),t=l||(e?"주연":"조연");e&&!E.mainRoles.some(e=>e.name===i)?E.mainRoles.push({name:i,role:t,image:r}):e||E.supportRoles.some(e=>e.name===i)||E.supportRoles.push({name:i,role:t,image:r})}}),E.mainRoles.length>0&&E.mainRoles.slice(0,3).forEach((e,t)=>{}),E.supportRoles.length>0&&E.supportRoles.slice(0,3).forEach((e,t)=>{})})(),0===E.mainRoles.length&&0===E.supportRoles.length&&(s('.box-header:contains("Cast")').closest(".box").find(".list li").each((e,t)=>{let i=s(t).find("a.text-primary").text().trim()||"",r=s(t).find(".text-muted").html()||"",a=j(r),l=q(a),n=s(t).find("img").attr("src")||"",o=s(t).closest("ul.list").prev("h3.header").text().trim();if(i&&(o.includes("Main Role")||o.includes("Support Role")||o.includes("Guest Role")||o.includes("Cameo"))&&D(a)){let e=l;e&&0!==e.length||(e=o.includes("Main Role")?"주연":"조연");let t={name:i,role:e,image:n};o.includes("Main Role")?E.mainRoles.push(t):E.supportRoles.push(t)}}),0===E.mainRoles.length&&0===E.supportRoles.length&&s("div.col-lg-8 li.list-item").each((e,t)=>{if(s(t).find("img").length>0){let e=s(t).find("a").text().trim()||"",i=s(t).find(".text-muted").html()||"",r=j(i),a=q(r),l=s(t).find("img").attr("src")||"",n=s(t).closest("ul.list").prev("h3.header").text().trim();if(e&&(n.includes("Main Role")||n.includes("Support Role")||n.includes("Guest Role")||n.includes("Cameo"))&&D(r)){let t=a;t&&0!==t.length||(t=n.includes("Main Role")?"주연":"조연");let i={name:e,role:t,image:l};n.includes("Main Role")?E.mainRoles.push(i):E.supportRoles.push(i)}}})),(E.mainRoles.length>0||E.supportRoles.length>0)&&(E.mainRoles.length>0&&E.mainRoles.forEach((e,t)=>{}),E.supportRoles.length>0&&E.supportRoles.forEach((e,t)=>{})),(_.directors.length>0||_.screenwriters.length>0)&&(_.directors.length,_.screenwriters.length);let I={title:l,nativeTitle:n,slug:a||"",mdlId:r||"",mdlUrl:t,link:t,synopsis:p,director:h||(_.directors.length>0?_.directors[0].name:""),directors:_.directors,screenwriters:_.screenwriters,castingDirectors:_.castingDirectors,producers:_.producers,genres:g,tags:f,country:x,type:w,episodes:y,airsInfo:b,airsOn:P,startDate:R,endDate:M,rating:T,network:C,contentRating:S,runtime:A,cast:{mainRoles:E.mainRoles,supportRoles:E.supportRoles},backgroundImage:m,posterImage:d,category:"drama",createdAt:new Date};try{let e=await v(I.title,I.nativeTitle);e&&e.length>0&&(I.videos=e,!I.trailerUrl&&e[0]&&(I.trailerUrl=e[0].url))}catch(e){}return I}catch(e){throw e}}async function x(e,t,i){if(e&&t)try{let i=o.load(t),r=new Set;e.cast&&e.cast.mainRoles&&e.cast.mainRoles.forEach(e=>{r.add(e.name.trim().toLowerCase())}),e.cast&&e.cast.supportRoles&&e.cast.supportRoles.forEach(e=>{r.add(e.name.trim().toLowerCase())}),i('h3.header:contains("Main Role")').next("ul.list").find("li.list-item").each((t,a)=>{let s=i(a).find("a.text-primary b").text().trim();if(!s||r.has(s.toLowerCase()))return;let l="",n=i(a).find("small[title]");n.length&&(l=n.text().trim(),""===l&&n.attr("title")&&(l=n.attr("title").trim()));let o=i(a).find("img.img-responsive"),m=o.length?o.attr("src"):"";e.cast.mainRoles||(e.cast.mainRoles=[]),e.cast.mainRoles.push({name:s,role:l||"주연",image:m}),r.add(s.toLowerCase())}),i('h3.header:contains("Support Role")').next("ul.list").find("li.list-item").each((t,a)=>{let s=i(a).find("a.text-primary b").text().trim();if(!s||r.has(s.toLowerCase()))return;let l="",n=i(a).find("small[title]");n.length&&(l=n.text().trim(),""===l&&n.attr("title")&&(l=n.attr("title").trim()));let o=i(a).find("img.img-responsive"),m=o.length?o.attr("src"):"";e.cast.supportRoles||(e.cast.supportRoles=[]),e.cast.supportRoles.push({name:s,role:l||"조연",image:m}),r.add(s.toLowerCase())}),i('h3.header:contains("Guest Role")').next("ul.list").find("li.list-item").each((t,a)=>{let s=i(a).find("a.text-primary b").text().trim();if(!s||r.has(s.toLowerCase()))return;let l="",n=i(a).find("small[title]");n.length&&(l=n.text().trim(),""===l&&n.attr("title")&&(l=n.attr("title").trim()));let o=i(a).find("img.img-responsive"),m=o.length?o.attr("src"):"";e.cast.supportRoles||(e.cast.supportRoles=[]),e.cast.supportRoles.push({name:s,role:l||"게스트",image:m}),r.add(s.toLowerCase())})}catch(e){}}async function w(e,t){try{let t=o.load(e),i=[];return t(".box.episode-list table.table tbody tr").each((e,r)=>{try{let a=t(r).find("td.text-center").first().text().trim(),s=parseInt(a)||e+1,l=t(r).find("td.title"),n=l.text().trim(),o=l.find("a").attr("href"),m=null,c=t(r).find("td:nth-child(3)").text().trim();if(c&&"?"!==c)try{m=new Date(c),isNaN(m.getTime())&&(m=null)}catch(e){m=null}let d=null,u=t(r).find("td:nth-child(4)").text().trim();u&&"?"!==u&&(d=parseFloat(u));let p=null,h=t(r).find("td:nth-child(5)").text().trim();h&&"?"!==h&&"N/A"!==h&&(p=parseFloat(h.replace("%",""))),i.push({number:s,title:n,airDate:m,rating:d,viewerRating:p,image:"",mdlUrl:o,runtime:60,summary:""})}catch(e){}}),i.sort((e,t)=>e.number-t.number),i}catch(e){return[]}}async function y(e,t){try{let t=o.load(e),i=[],r=t(".box-body.wts");if(!r.length)return[];return r.find(".row .col-xs-12.col-lg-4.m-b-sm").each((e,r)=>{try{let e=t(r),a=e.find('a[rel="external nofollow"]').first();if(!a.length)return;let s=a.attr("href")||"",l="";if(s.includes("/redirect?q=")){let e=s.match(/\/redirect\?q=([^&]+)/);e&&e[1]&&(l=decodeURIComponent(e[1]))}else l=s;let n=e.find("a.text-primary b").text().trim(),o=e.find(".p-l div:nth-child(2)").text().trim(),m=e.find("img.img-responsive"),c=m.length?m.attr("src"):"";if("wavve"===n.toLowerCase()?c="https://i.mydramalist.com/pgAd8_3m.jpg":"viki"===n.toLowerCase()&&(c="https://i.mydramalist.com/kEBdrm.jpg"),n&&l){let e=c?.startsWith("http")?c:`https://i.mydramalist.com${c?.startsWith("/")?"":"/"}${c}`,t={name:n,url:l,type:o,logo:e};switch(n.toLowerCase()){case"netflix":t.providerKey="netflix";break;case"apple tv+":case"apple tv":t.providerKey="apple";break;case"disney+":t.providerKey="disney";break;case"viki":t.providerKey="viki",t.logo="https://i.mydramalist.com/kEBdrm.jpg";break;case"wavve":t.providerKey="wavve",t.logo="https://i.mydramalist.com/pgAd8_3m.jpg";break;default:t.providerKey=n.toLowerCase().replace(/\s+/g,"_")}i.push(t)}}catch(e){}}),i}catch(e){return[]}}let v=async(e,t)=>{try{if(!process.env.YOUTUBE_API_KEY)return[];let i=await m.default.get("http://43.202.38.79:13001/api/youtube/search-videos",{params:{title:t||e,maxResults:5}});if(!i.data.success||!i.data.data)return[];return i.data.data.map((e,t)=>({title:e.title,type:"trailer",url:e.url,thumbnailUrl:e.thumbnailUrl,viewCount:e.viewCount,likeCount:e.likeCount,publishedAt:e.publishedAt,order:t}))}catch(e){return[]}};r()}catch(e){r(e)}})},35968:(e,t,i)=>{let r;i.r(t),i.d(t,{connectToDatabase:()=>m,dbConnect:()=>c,default:()=>d});var a=i(38013),s=i(92048),l=i.n(s),n=i(55315),o=i.n(n);{let e=i(25142),t=o().resolve(process.cwd(),".env.production");l().existsSync(t)&&e.config({path:t}).error}async function m(){try{let e=await r,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}r=new a.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let c=m,d=r},47153:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},71802:(e,t,i)=>{e.exports=i(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=93949);module.exports=i})();