"use strict";(()=>{var e={};e.id=718,e.ids=[718],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},99648:e=>{e.exports=import("axios")},20295:e=>{e.exports=import("cheerio")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},18897:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>m,default:()=>l,routeModule:()=>u});var i=a(71802),n=a(47153),s=a(56249),o=a(90049),c=e([o]);o=(c.then?(await c)():c)[0];let l=(0,s.hoist)(o,"default"),m=(0,s.hoist)(o,"config"),u=new i.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/crawler/mydramalist",pathname:"/api/crawler/mydramalist",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},90049:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>o});var i=a(99648),n=a(20295);a(35968);var s=e([i,n]);async function o(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});try{let{url:a}=e.body;if(!a||!a.includes("mydramalist.com"))return t.status(400).json({success:!1,message:"유효한 MyDramalist URL이 필요합니다."});let r=await i.default.get(a,{headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"no-cache",Referer:"https://mydramalist.com/","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="113", "Google Chrome";v="113"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"'},timeout:1e4}),s=n.default.load(r.data),o=[];s('div[id^="mdl-"]').each((e,t)=>{let a=s(t).find("h6.text-primary.title a").first(),r=a.attr("href"),i=a.text().trim(),n=s(t).find("span.text-muted").text().trim().split(" - "),c=n[0]?.includes("Drama")?"drama":n[0]?.includes("Movie")?"movie":"other",l=null,m=null;if(n[1]){let e=n[1].match(/(\d{4})/);e&&(l=parseInt(e[1]));let t=n[1].match(/(\d+) episodes/);t&&(m=parseInt(t[1]))}let u=s(t).find("img.img-responsive.cover"),d=u.attr("src")||u.attr("data-src"),p=s(t).find("span.p-l-xs.score"),h=p.text()?parseFloat(p.text()):0,f=s(t).find("p").not(":has(span)").not(":empty"),g="";f.length>0&&(g=f.text().trim()),r&&o.push({id:s(t).attr("id").replace("mdl-",""),url:"https://mydramalist.com"+r,title:i,category:c,year:l,episodes:m,imageUrl:d,rating:h,summary:g})});let c=s(".pagination .page-item.next a").attr("href");return t.status(200).json({success:!0,data:{dramas:o,nextPage:c?"https://mydramalist.com"+c:null,total:o.length,source:a}})}catch(e){return t.status(500).json({success:!1,message:"크롤링 중 오류가 발생했습니다.",error:e.message})}}[i,n]=s.then?(await s)():s,r()}catch(e){r(e)}})},35968:(e,t,a)=>{let r;a.r(t),a.d(t,{connectToDatabase:()=>l,dbConnect:()=>m,default:()=>u});var i=a(38013),n=a(92048),s=a.n(n),o=a(55315),c=a.n(o);{let e=a(25142),t=c().resolve(process.cwd(),".env.production");s().existsSync(t)&&e.config({path:t}).error}async function l(){try{let e=await r,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}r=new i.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let m=l,u=r},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=18897);module.exports=a})();