"use strict";(()=>{var e={};e.id=4379,e.ids=[4379],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},99648:e=>{e.exports=import("axios")},20295:e=>{e.exports=import("cheerio")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},30075:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>l,routeModule:()=>m});var i=a(71802),o=a(47153),s=a(56249),n=a(77015),c=e([n]);n=(c.then?(await c)():c)[0];let l=(0,s.hoist)(n,"default"),d=(0,s.hoist)(n,"config"),m=new i.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/crawler/mydramalist-detail",pathname:"/api/crawler/mydramalist-detail",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},77015:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>n});var i=a(99648),o=a(20295);a(35968);var s=e([i,o]);async function n(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});try{let{url:a,mdlId:r}=e.body;if(!a||!a.includes("mydramalist.com"))return t.status(400).json({success:!1,message:"유효한 MyDramalist URL이 필요합니다."});let s=await i.default.get(a,{headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"no-cache",Referer:"https://mydramalist.com/","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="113", "Google Chrome";v="113"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"'},timeout:1e4}),n=o.default.load(s.data),c=n("h1.film-title").text().trim(),l=n("p.film-aka").text().trim(),d=n(".film-cover img.img-responsive").attr("src"),m=a.split("/").pop(),u=n(".film-rating-vote").text().trim().match(/(\d+(?:\.\d+)?)/),p=u?parseFloat(u[1]):0,h=n(".show-synopsis").text().trim(),f={};n(".box-body.light-b dl.dl-horizontal").each((e,t)=>{n(t).find("dt").each((e,t)=>{let a=n(t).text().trim().toLowerCase(),r=n(t).next("dd").text().trim();f[a]=r})});let g=[];n(".show-genres a").each((e,t)=>{g.push(n(t).text().trim())});let x=[];n(".box-body ul.list li.cast-item").each((e,t)=>{let a=n(t).find(".text-primary.text-ellipsis a").text().trim(),r=n(t).find(".text-muted").text().trim(),i=n(t).find("img").attr("src");a&&x.push({name:a,role:r,image:i})});let y=[];n(".show-tags a").each((e,t)=>{y.push(n(t).text().trim())});let v=f.status||"",P=f.aired||f.released||"",b=f.country||"South Korea",A=f.episodes?parseInt(f.episodes):null,w=f.duration||"",S={mdlId:r,mdlUrl:a,mdlSlug:m,title:c,originalTitle:l,coverImage:d,bannerImage:d,summary:h,description:h,reviewRating:p,genres:g,cast:x,tags:y,status:v.toLowerCase(),releaseDate:P,country:b,episodes:A,runtime:w,category:A?"drama":"movie",createdAt:new Date,updatedAt:new Date};return t.status(200).json({success:!0,data:S})}catch(e){return t.status(500).json({success:!1,message:"크롤링 중 오류가 발생했습니다.",error:e.message})}}[i,o]=s.then?(await s)():s,r()}catch(e){r(e)}})},35968:(e,t,a)=>{let r;a.r(t),a.d(t,{connectToDatabase:()=>l,dbConnect:()=>d,default:()=>m});var i=a(38013),o=a(92048),s=a.n(o),n=a(55315),c=a.n(n);{let e=a(25142),t=c().resolve(process.cwd(),".env.production");s().existsSync(t)&&e.config({path:t}).error}async function l(){try{let e=await r,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}r=new i.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let d=l,m=r},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=30075);module.exports=a})();