"use strict";(()=>{var e={};e.id=7373,e.ids=[7373],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},12398:(e,t,a)=>{a.r(t),a.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var n={};a.r(n),a.d(n,{default:()=>d});var r=a(71802),s=a(47153),i=a(56249),o=a(35968);async function d(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});try{let a;let{data:n}=e.body;if(!n||!n.title)return t.status(400).json({success:!1,message:"유효한 드라마 데이터가 필요합니다."});let{db:r}=await (0,o.connectToDatabase)(),s={...n,updatedAt:new Date};if(s.synopsis&&!s.summary&&(s.summary=s.synopsis),s.posterImage&&!s.coverImage&&(s.coverImage=s.posterImage),s.nativeTitle&&!s.originalTitle&&(s.originalTitle=s.nativeTitle),s.airsInfo&&!s.releaseDate&&(s.releaseDate=s.airsInfo),s.contentRating&&!s.ageRating&&(s.ageRating=s.contentRating),s.backgroundImage&&!s.bannerImage&&(s.bannerImage=s.backgroundImage),!s.watchProviders&&(s.whereToWatch&&s.whereToWatch.length>0?s.watchProviders=s.whereToWatch:s.streamingServices&&s.streamingServices.length>0&&(s.watchProviders=s.streamingServices.map(e=>({name:e.name,link:e.url,imageUrl:e.logo,type:e.type})))),!s.status&&s.airsInfo){let e=s.airsInfo.toLowerCase(),t=new Date;e.includes("upcoming")||s.startDate&&new Date(s.startDate)>t?s.status="Upcoming":e.includes("airing")||e.includes("ongoing")||s.startDate&&new Date(s.startDate)<=t&&(!s.endDate||new Date(s.endDate)>=t)?s.status="Airing":(s.endDate&&s.endDate,s.status="Completed")}let i={};s.mdlUrl?i.mdlUrl=s.mdlUrl:s.slug&&"mydramalist.com"!==s.slug?i.slug=s.slug:s.title&&(i.title=s.title);let d=await r.collection("dramas").findOne(i);if(d){let e={...s,_id:d._id,createdAt:d.createdAt||new Date,updatedAt:new Date};for(let t in d)t in s||"_id"===t||(e[t]=d[t]);return a=await r.collection("dramas").updateOne({_id:d._id},{$set:e}),t.status(200).json({success:!0,message:"드라마 정보가 업데이트되었습니다.",data:{acknowledged:a.acknowledged,modifiedCount:a.modifiedCount,matchedCount:a.matchedCount,isUpdate:!0}})}if(!s.slug){let e=s.title.toLowerCase().replace(/[^a-z0-9ㄱ-ㅎㅏ-ㅣ가-힣]+/g,"-").replace(/^-|-$/g,""),t=Date.now().toString().slice(-6);s.slug=`${e}-${t}`}return s.createdAt=new Date,a=await r.collection("dramas").insertOne(s),t.status(201).json({success:!0,message:"새 드라마가 등록되었습니다.",data:{acknowledged:a.acknowledged,insertedId:a.insertedId,isNew:!0}})}catch(e){return t.status(500).json({success:!1,message:"드라마 저장 중 오류가 발생했습니다.",error:e.message})}}let c=(0,i.hoist)(n,"default"),l=(0,i.hoist)(n,"config"),u=new r.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/crawler/save-drama",pathname:"/api/crawler/save-drama",bundlePath:"",filename:""},userland:n})},35968:(e,t,a)=>{let n;a.r(t),a.d(t,{connectToDatabase:()=>c,dbConnect:()=>l,default:()=>u});var r=a(38013),s=a(92048),i=a.n(s),o=a(55315),d=a.n(o);{let e=a(25142),t=d().resolve(process.cwd(),".env.production");i().existsSync(t)&&e.config({path:t}).error}async function c(){try{let e=await n,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}n=new r.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let l=c,u=n},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=12398);module.exports=a})();