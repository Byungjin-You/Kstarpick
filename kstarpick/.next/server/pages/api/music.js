"use strict";(()=>{var e={};e.id=6624,e.ids=[6624],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},96185:(e,t,s)=>{s.r(t),s.d(t,{config:()=>m,default:()=>p,routeModule:()=>f});var r={};s.r(r),s.d(r,{default:()=>u});var i=s(71802),n=s(47153),a=s(56249),o=s(35968);s(38013);var c=s(1241);async function u(e,t){return"GET"===e.method?l(e,t):"POST"===e.method?d(e,t):t.status(405).json({success:!1,message:"Method Not Allowed"})}async function l(e,t){try{let{db:s}=await (0,o.dbConnect)(),{limit:r=10,page:i=1}=e.query,n=parseInt(r),a=parseInt(i),u=await s.collection("musics").find({}).sort({createdAt:-1}).limit(n).skip((a-1)*n).toArray(),l=await s.collection("musics").countDocuments({});u.length;let d=u.map((e,t)=>{let s=(e,t=0)=>{if("number"==typeof e)return e;let s=parseInt(e);return isNaN(s)?t:s},r=s(e.dailyViews||e.dailyview||e.dailyView,Math.round(.02*s(e.views))),i=s(e.position,t+1),n=s(e.previousPosition,i);return{_id:e._id,title:(0,c.decodeHtmlEntities)(e.title)||"",artist:(0,c.decodeHtmlEntities)(e.artist)||"",position:i,previousPosition:n,coverImage:e.coverImage||"",dailyViews:r,totalViews:s(e.views),releaseDate:e.releaseDate,slug:e.slug||"",youtubeUrl:e.musicVideo||"",album:e.album||""}});return t.status(200).json({success:!0,currentPage:a,totalPages:Math.ceil(l/n),totalItems:l,musics:d})}catch(e){return t.status(500).json({success:!1,message:"서버 오류가 발생했습니다.",error:e.message})}}async function d(e,t){try{let{db:s}=await (0,o.dbConnect)(),{title:r,artist:i,album:n,position:a=999,previousPosition:u,youtubeUrl:l,musicVideo:d,dailyViews:p=0,totalViews:m=0,views:f,releaseDate:g,featured:w=!1,coverImage:y,description:P,genre:v=["kpop"]}=e.body;if(!r||!i)return t.status(400).json({success:!1,message:"제목과 아티스트는 필수 입력 항목입니다."});if(await s.collection("musics").findOne({title:r,artist:i}))return t.status(409).json({success:!1,message:"동일한 제목과 아티스트의 음악이 이미 존재합니다."});let b=(e,t)=>`${e}-${t}`.toLowerCase().replace(/[^a-z0-9가-힣\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,100)||`music-${Date.now()}`,h=b(r,i),A=1;for(;await s.collection("musics").findOne({slug:h});)h=`${b(r,i)}-${A}`,A++;let I={title:(0,c.decodeHtmlEntities)(r),artist:(0,c.decodeHtmlEntities)(i),slug:h,album:n||"",position:parseInt(a)||999,previousPosition:parseInt(u)||parseInt(a)||999,youtubeUrl:l||d||"",musicVideo:l||d||"",dailyViews:parseInt(p)||0,views:parseInt(f)||parseInt(m)||0,totalViews:parseInt(m)||parseInt(f)||0,releaseDate:g||new Date().toISOString(),featured:!!w,coverImage:y||"",description:P||"",genre:Array.isArray(v)?v:[v],status:"active",createdAt:new Date,updatedAt:new Date},S=await s.collection("musics").insertOne(I);if(S.insertedId){let e=await s.collection("musics").findOne({_id:S.insertedId});return t.status(201).json({success:!0,message:"음악이 성공적으로 추가되었습니다.",music:e})}throw Error("음악 추가에 실패했습니다.")}catch(e){return t.status(500).json({success:!1,message:"음악 추가 중 오류가 발생했습니다.",error:e.message})}}let p=(0,a.hoist)(r,"default"),m=(0,a.hoist)(r,"config"),f=new i.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/music",pathname:"/api/music",bundlePath:"",filename:""},userland:r})},1241:(e,t,s)=>{function r(e){if(!e)return"";if("undefined"==typeof document)return e.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");{let t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}s.r(t),s.d(t,{decodeHtmlEntities:()=>r})},35968:(e,t,s)=>{let r;s.r(t),s.d(t,{connectToDatabase:()=>u,dbConnect:()=>l,default:()=>d});var i=s(38013),n=s(92048),a=s.n(n),o=s(55315),c=s.n(o);{let e=s(25142),t=c().resolve(process.cwd(),".env.production");a().existsSync(t)&&e.config({path:t}).error}async function u(){try{let e=await r,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}r=new i.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let l=u,d=r},47153:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},71802:(e,t,s)=>{e.exports=s(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=96185);module.exports=s})();