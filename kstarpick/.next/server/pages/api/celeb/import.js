"use strict";(()=>{var e={};e.id=931,e.ids=[931],e.modules={98432:e=>{e.exports=require("bcryptjs")},25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},11185:e=>{e.exports=require("mongoose")},73227:e=>{e.exports=require("next-auth")},62113:e=>{e.exports=require("next-auth/next")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},17547:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>m,routeModule:()=>f});var i={};a.r(i),a.d(i,{default:()=>d});var r=a(71802),n=a(47153),o=a(56249),s=a(44756),l=a(18867),u=a(62113),c=a(69097);async function d(e,t){let{method:a}=e;if(await (0,s.default)(),"POST"!==a)return t.status(405).json({success:!1,error:"허용되지 않는 메소드입니다."});try{await (0,u.unstable_getServerSession)(e,t,c.authOptions);let{artists:a}=e.body;if(!a||!Array.isArray(a)||0===a.length)return t.status(400).json({success:!1,error:"유효한 아티스트 데이터가 없습니다."});a.length;let i={imported:0,updated:0,failed:0,details:[]};for(let e of a)try{if(!e.name&&!e.engName){i.failed++,i.details.push({name:"Unknown",status:"failed",error:"아티스트 이름이 없습니다."});continue}let t={};e.socialMedia&&(e.socialMedia.instagram&&e.socialMedia.instagram.includes("instagram.com")&&(t.instagram=e.socialMedia.instagram),e.socialMedia.twitter&&e.socialMedia.twitter.includes("twitter.com")&&(t.twitter=e.socialMedia.twitter),e.socialMedia.youtube&&e.socialMedia.youtube.includes("youtube.com")&&(t.youtube=e.socialMedia.youtube),e.socialMedia.spotify&&e.socialMedia.spotify.includes("spotify.com")&&(t.spotify=e.socialMedia.spotify),e.socialMedia.tiktok&&e.socialMedia.tiktok.includes("tiktok.com")&&(t.tiktok=e.socialMedia.tiktok),e.socialMedia.fancafe&&e.socialMedia.fancafe.includes("cafe.daum.net")&&(t.fancafe=e.socialMedia.fancafe));let a={};if(e.socialMediaStats||e.todayStats){let t=e.socialMediaStats||e.todayStats||{};["instagram","twitter","youtube","spotify","tiktok","fancafe"].forEach(e=>{let i=t[e]||"0";"string"==typeof i&&(i=(i=i.trim().replace(/,/g,"")).includes("M")?1e6*parseFloat(i.replace("M","")):i.includes("K")?1e3*parseFloat(i.replace("K","")):parseInt(i)||0),a[e]=i})}let r=[];e.musicVideos&&Array.isArray(e.musicVideos)&&(r=e.musicVideos.filter(e=>e&&e.youtubeUrl&&e.youtubeUrl.includes("youtube.com")).map(e=>{let t=Array.isArray(e.artists)?e.artists:[];return{title:e.title||"",youtubeUrl:e.youtubeUrl||"",views:e.viewCount||e.views||0,dailyViews:e.dailyViews||0,publishedAt:e.publishedAt?new Date(e.publishedAt):null,likes:e.likeCount||e.likes||0,thumbnails:{default:{url:e.thumbnail||e.thumbnails?.default?.url||""},medium:{url:e.thumbnail||e.thumbnails?.medium?.url||""},high:{url:e.thumbnail||e.thumbnails?.high?.url||""}},artists:t}}));let n={name:e.engName||e.name,koreanName:e.name||"",profileImage:e.image||e.thumbnail||"",category:"solo"===e.groupType?"solo":"idol",role:"solo"===e.groupType?"Singer":"Group",agency:e.agency||"",debutDate:e.debutDate?new Date(e.debutDate):null,followers:parseInt(String(e.followers).replace(/[^0-9]/g,""))||0,socialMedia:t,socialMediaFollowers:a,musicVideos:r,isFeatured:!0,isActive:!0,updatedAt:new Date},o=await l.default.findOne({$or:[{name:{$regex:RegExp(e.engName||e.name,"i")}},{koreanName:{$regex:RegExp(e.name||"","i")}}]});if(o){let t=await l.default.findByIdAndUpdate(o._id,{$set:{...n,updatedAt:new Date}},{new:!0});i.updated++,i.details.push({name:e.name,engName:e.engName,status:"updated",id:t._id})}else{let t=await l.default.create(n);i.imported++,i.details.push({name:e.name,engName:e.engName,status:"imported",id:t._id})}}catch(t){i.failed++,i.details.push({name:e.name,engName:e.engName,status:"failed",error:t.message})}return t.status(200).json({success:!0,data:i})}catch(e){return t.status(500).json({success:!1,error:e.message})}}let m=(0,o.hoist)(i,"default"),p=(0,o.hoist)(i,"config"),f=new r.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/celeb/import",pathname:"/api/celeb/import",bundlePath:"",filename:""},userland:i})},44756:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var i=a(11185),r=a.n(i);a(25142).config({path:".env.production"});let n="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";n||(n="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),n.includes("localhost")||(n.includes("mongodb://")&&!n.includes("authSource=")&&(n.includes("?")?n+="&authSource=admin":n+="?authSource=admin"),!n.includes("docdb.amazonaws.com")||n.includes("authMechanism=")||(n.includes("?")?n+="&authMechanism=SCRAM-SHA-1":n+="?authMechanism=SCRAM-SHA-1"));let o=n.includes("localhost")||n.includes("127.0.0.1"),s=global.mongoose;async function l(){if(s.conn&&1===r().connection.readyState)return s.conn;if(0===r().connection.readyState||3===r().connection.readyState){s.conn=null,s.promise=null;try{await r().connection.close()}catch(e){}}if(!s.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};o||(n.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),s.promise=r().connect(n,e).then(e=>(e.connection.on("error",e=>{s.conn=null,s.promise=null,setTimeout(()=>{l().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{s.conn=null,s.promise=null,setTimeout(()=>{l().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw s.promise=null,e})}try{return s.conn=await s.promise,s.conn}catch(e){throw s.promise=null,e}}s||(s=global.mongoose={conn:null,promise:null});let u=l},18867:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var i=a(11185),r=a.n(i);let n=new(r()).Schema({name:{type:String,required:[!0,"Please provide celebrity name"],maxlength:[100,"Name cannot be more than 100 characters"]},koreanName:{type:String,maxlength:[100,"Korean name cannot be more than 100 characters"]},slug:{type:String,unique:!0,lowercase:!0},profileImage:{type:String,default:"/images/placeholder.jpg"},coverImage:{type:String},category:{type:String,enum:["idol","actor","actress","model","solo","band","rookie","other"],default:"idol"},role:{type:String,required:[!0,"Please provide celebrity role"],maxlength:[100,"Role cannot be more than 100 characters"]},agency:{type:String,maxlength:[100,"Agency cannot be more than 100 characters"]},debutDate:{type:Date},birthDate:{type:Date},socialMedia:{instagram:String,twitter:String,youtube:String,weverse:String,melon:String,spotify:String,tiktok:String,fancafe:String},socialMediaFollowers:{instagram:{type:Number,default:0},twitter:{type:Number,default:0},youtube:{type:Number,default:0},spotify:{type:Number,default:0},tiktok:{type:Number,default:0},fancafe:{type:Number,default:0}},socialMediaRankings:{instagram:{type:Number,default:0},twitter:{type:Number,default:0},youtube:{type:Number,default:0},spotify:{type:Number,default:0},tiktok:{type:Number,default:0},fancafe:{type:Number,default:0}},socialMediaChanges:{instagram:{count:{type:Number,default:0},percent:{type:Number,default:0}},twitter:{count:{type:Number,default:0},percent:{type:Number,default:0}},youtube:{count:{type:Number,default:0},percent:{type:Number,default:0}},spotify:{count:{type:Number,default:0},percent:{type:Number,default:0}},tiktok:{count:{type:Number,default:0},percent:{type:Number,default:0}},fancafe:{count:{type:Number,default:0},percent:{type:Number,default:0}}},socialMediaUpdatedAt:{type:Date,default:Date.now},musicVideos:[{title:String,youtubeUrl:String,views:Number,dailyViews:Number,publishedAt:Date,likes:Number,thumbnails:{default:{url:String,width:Number,height:Number},medium:{url:String,width:Number,height:Number},high:{url:String,width:Number,height:Number}},artists:[String]}],bio:{type:String,maxlength:[2e3,"Bio cannot be more than 2000 characters"]},followers:{type:Number,default:0},group:{type:String,maxlength:[100,"Group name cannot be more than 100 characters"]},position:{type:String,maxlength:[100,"Position cannot be more than 100 characters"]},isFeatured:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});n.pre("save",function(e){this.slug=this.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").replace(/-+/g,"-"),this.updatedAt=Date.now(),e()});let o=r().models.Celebrity||r().model("Celebrity",n)},69097:(e,t,a)=>{a.r(t),a.d(t,{authOptions:()=>c,default:()=>d});var i=a(73227),r=a.n(i);let n=require("next-auth/providers/credentials");var o=a.n(n),s=a(35968),l=a(98432),u=a.n(l);let c={providers:[o()({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){try{let{db:t}=await (0,s.connectToDatabase)(),a=await t.collection("users").findOne({email:e.email});if(!a||!await u().compare(e.password,a.password))return null;return{id:a._id.toString(),name:a.name,email:a.email,role:a.role}}catch(e){return null}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},debug:!1,secret:"kstarpick_nextauth_secret_key_2024_production"},d=r()(c)},35968:(e,t,a)=>{let i;a.r(t),a.d(t,{connectToDatabase:()=>u,dbConnect:()=>c,default:()=>d});var r=a(38013),n=a(92048),o=a.n(n),s=a(55315),l=a.n(s);{let e=a(25142),t=l().resolve(process.cwd(),".env.production");o().existsSync(t)&&e.config({path:t}).error}async function u(){try{let e=await i,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}i=new r.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let c=u,d=i},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=17547);module.exports=a})();