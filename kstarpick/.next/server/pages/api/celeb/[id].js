"use strict";(()=>{var e={};e.id=6099,e.ids=[6099],e.modules={98432:e=>{e.exports=require("bcryptjs")},25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},11185:e=>{e.exports=require("mongoose")},62113:e=>{e.exports=require("next-auth/next")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},44854:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>m,routeModule:()=>f});var r={};a.r(r),a.d(r,{default:()=>d});var n=a(71802),o=a(47153),s=a(56249),i=a(44756),u=a(18867),c=a(62113),l=a(57309);async function d(e,t){let{method:a}=e,{id:r}=e.query;switch(await (0,i.default)(),a){case"GET":try{let e=await u.default.findById(r);if(!e)return t.status(404).json({success:!1,error:"셀럽을 찾을 수 없습니다."});e.socialMediaFollowers||(e.socialMediaFollowers={instagram:0,twitter:0,youtube:0,spotify:0,tiktok:0,fancafe:0}),e.musicVideos&&e.musicVideos.length;let a={...e.toObject(),musicVideos:e.musicVideos||[]};t.status(200).json({success:!0,data:a})}catch(e){t.status(500).json({success:!1,error:"서버 오류가 발생했습니다."})}break;case"PUT":try{let a=await (0,c.unstable_getServerSession)(e,t,l.authOptions);if(!a)return t.status(401).json({success:!1,error:"로그인이 필요합니다."});if("admin"!==a.user.role)return t.status(403).json({success:!1,error:"관리자 권한이 필요합니다."});let n=e.body;if(!n.name)return t.status(400).json({success:!1,error:"Celebrity name is required"});!n.slug&&n.name&&(n.slug=n.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").replace(/-+/g,"-")),n.socialMedia||(n.socialMedia={}),n.socialMediaFollowers||(n.socialMediaFollowers={}),n.socialMediaRankings||(n.socialMediaRankings={}),n.socialMediaChanges||(n.socialMediaChanges={}),n.updatedAt=new Date,n.socialMediaUpdatedAt||(n.socialMediaUpdatedAt=new Date);let o=await u.default.findByIdAndUpdate(r,n,{new:!0,runValidators:!0});if(!o)return t.status(404).json({success:!1,error:"Celebrity not found"});return t.status(200).json({success:!0,data:o})}catch(e){t.status(400).json({success:!1,error:e.message})}break;case"DELETE":try{let a=await (0,c.unstable_getServerSession)(e,t,l.authOptions);if(!a)return t.status(401).json({success:!1,error:"로그인이 필요합니다."});if("admin"!==a.user.role)return t.status(403).json({success:!1,error:"관리자 권한이 필요합니다."});let n=await u.default.deleteOne({_id:r});if(0===n.deletedCount)return t.status(404).json({success:!1,error:"셀럽을 찾을 수 없습니다."});t.status(200).json({success:!0,data:{}})}catch(e){t.status(400).json({success:!1,error:e.message})}break;default:t.status(405).json({success:!1,error:"허용되지 않는 메소드입니다."})}}let m=(0,s.hoist)(r,"default"),p=(0,s.hoist)(r,"config"),f=new n.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/celeb/[id]",pathname:"/api/celeb/[id]",bundlePath:"",filename:""},userland:r})},44756:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var r=a(11185),n=a.n(r);a(25142).config({path:".env.production"});let o="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";o||(o="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),o.includes("localhost")||(o.includes("mongodb://")&&!o.includes("authSource=")&&(o.includes("?")?o+="&authSource=admin":o+="?authSource=admin"),!o.includes("docdb.amazonaws.com")||o.includes("authMechanism=")||(o.includes("?")?o+="&authMechanism=SCRAM-SHA-1":o+="?authMechanism=SCRAM-SHA-1"));let s=o.includes("localhost")||o.includes("127.0.0.1"),i=global.mongoose;async function u(){if(i.conn&&1===n().connection.readyState)return i.conn;if(0===n().connection.readyState||3===n().connection.readyState){i.conn=null,i.promise=null;try{await n().connection.close()}catch(e){}}if(!i.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};s||(o.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),i.promise=n().connect(o,e).then(e=>(e.connection.on("error",e=>{i.conn=null,i.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{i.conn=null,i.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw i.promise=null,e})}try{return i.conn=await i.promise,i.conn}catch(e){throw i.promise=null,e}}i||(i=global.mongoose={conn:null,promise:null});let c=u},18867:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});var r=a(11185),n=a.n(r);let o=new(n()).Schema({name:{type:String,required:[!0,"Please provide celebrity name"],maxlength:[100,"Name cannot be more than 100 characters"]},koreanName:{type:String,maxlength:[100,"Korean name cannot be more than 100 characters"]},slug:{type:String,unique:!0,lowercase:!0},profileImage:{type:String,default:"/images/placeholder.jpg"},coverImage:{type:String},category:{type:String,enum:["idol","actor","actress","model","solo","band","rookie","other"],default:"idol"},role:{type:String,required:[!0,"Please provide celebrity role"],maxlength:[100,"Role cannot be more than 100 characters"]},agency:{type:String,maxlength:[100,"Agency cannot be more than 100 characters"]},debutDate:{type:Date},birthDate:{type:Date},socialMedia:{instagram:String,twitter:String,youtube:String,weverse:String,melon:String,spotify:String,tiktok:String,fancafe:String},socialMediaFollowers:{instagram:{type:Number,default:0},twitter:{type:Number,default:0},youtube:{type:Number,default:0},spotify:{type:Number,default:0},tiktok:{type:Number,default:0},fancafe:{type:Number,default:0}},socialMediaRankings:{instagram:{type:Number,default:0},twitter:{type:Number,default:0},youtube:{type:Number,default:0},spotify:{type:Number,default:0},tiktok:{type:Number,default:0},fancafe:{type:Number,default:0}},socialMediaChanges:{instagram:{count:{type:Number,default:0},percent:{type:Number,default:0}},twitter:{count:{type:Number,default:0},percent:{type:Number,default:0}},youtube:{count:{type:Number,default:0},percent:{type:Number,default:0}},spotify:{count:{type:Number,default:0},percent:{type:Number,default:0}},tiktok:{count:{type:Number,default:0},percent:{type:Number,default:0}},fancafe:{count:{type:Number,default:0},percent:{type:Number,default:0}}},socialMediaUpdatedAt:{type:Date,default:Date.now},musicVideos:[{title:String,youtubeUrl:String,views:Number,dailyViews:Number,publishedAt:Date,likes:Number,thumbnails:{default:{url:String,width:Number,height:Number},medium:{url:String,width:Number,height:Number},high:{url:String,width:Number,height:Number}},artists:[String]}],bio:{type:String,maxlength:[2e3,"Bio cannot be more than 2000 characters"]},followers:{type:Number,default:0},group:{type:String,maxlength:[100,"Group name cannot be more than 100 characters"]},position:{type:String,maxlength:[100,"Position cannot be more than 100 characters"]},isFeatured:{type:Boolean,default:!1},isActive:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});o.pre("save",function(e){this.slug=this.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,"-").replace(/-+/g,"-"),this.updatedAt=Date.now(),e()});let s=n().models.Celebrity||n().model("Celebrity",o)},57309:(e,t,a)=>{a.r(t),a.d(t,{authOptions:()=>l,default:()=>d});let r=require("next-auth");var n=a.n(r);let o=require("next-auth/providers/credentials");var s=a.n(o),i=a(35968),u=a(98432),c=a.n(u);let l={providers:[s()({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){try{let{db:t}=await (0,i.connectToDatabase)(),a=await t.collection("users").findOne({email:e.email});if(!a||!await c().compare(e.password,a.password))return null;return{id:a._id.toString(),name:a.name,email:a.email,role:a.role}}catch(e){return null}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},debug:!1,secret:"kstarpick_nextauth_secret_key_2024_production"},d=n()(l)},35968:(e,t,a)=>{let r;a.r(t),a.d(t,{connectToDatabase:()=>c,dbConnect:()=>l,default:()=>d});var n=a(38013),o=a(92048),s=a.n(o),i=a(55315),u=a.n(i);{let e=a(25142),t=u().resolve(process.cwd(),".env.production");s().existsSync(t)&&e.config({path:t}).error}async function c(){try{let e=await r,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}r=new n.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let l=c,d=r},47153:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},71802:(e,t,a)=>{e.exports=a(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=44854);module.exports=a})();