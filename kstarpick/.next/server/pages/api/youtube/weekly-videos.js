"use strict";(()=>{var t={};t.id=6311,t.ids=[6311],t.modules={20145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:t=>{t.exports=import("axios")},56249:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"hoist",{enumerable:!0,get:function(){return function t(e,i){return i in e?e[i]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,i)):"function"==typeof e&&"default"===i?e:void 0}}})},56599:(t,e,i)=>{i.a(t,async(t,s)=>{try{i.r(e),i.d(e,{config:()=>p,default:()=>l,routeModule:()=>d});var n=i(71802),u=i(47153),o=i(56249),r=i(87583),a=t([r]);r=(a.then?(await a)():a)[0];let l=(0,o.hoist)(r,"default"),p=(0,o.hoist)(r,"config"),d=new n.PagesAPIRouteModule({definition:{kind:u.RouteKind.PAGES_API,page:"/api/youtube/weekly-videos",pathname:"/api/youtube/weekly-videos",bundlePath:"",filename:""},userland:r});s()}catch(t){s(t)}})},87583:(t,e,i)=>{i.a(t,async(t,s)=>{try{i.r(e),i.d(e,{default:()=>o});var n=i(41736),u=t([n]);async function o(t,e){if("POST"!==t.method)return e.status(405).json({success:!1,message:"Method Not Allowed"});try{let{playlistUrl:i}=t.body;if(!i)return e.status(400).json({success:!1,message:"플레이리스트 URL이 필요합니다."});if(!process.env.YOUTUBE_API_KEY)return e.status(500).json({success:!1,message:"YouTube API 키가 설정되지 않았습니다."});let s=await (0,n.getPlaylistVideos)(i);if(!s||0===s.length)return e.status(404).json({success:!1,message:"플레이리스트에서 비디오를 찾을 수 없습니다."});return e.status(200).json({success:!0,count:s.length,data:s})}catch(t){return e.status(500).json({success:!1,message:"서버 오류가 발생했습니다.",error:t.message,errorType:t.constructor.name})}}n=(u.then?(await u)():u)[0],s()}catch(t){s(t)}})},41736:(t,e,i)=>{i.a(t,async(t,s)=>{try{i.r(e),i.d(e,{extractPlaylistId:()=>d,extractYoutubeVideoId:()=>a,getPlaylistVideos:()=>o,getTrendingMusicVideos:()=>r,getYoutubeVideoDetails:()=>p,getYoutubeVideoStats:()=>l});var n=i(99648),u=t([n]);n=(u.then?(await u)():u)[0];let a=t=>{if(!t)return null;let e=t.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return e&&11===e[7].length?e[7]:null},l=async t=>{try{let e=a(t);if(!e)throw Error("유효한 YouTube URL이 아닙니다.");let i=process.env.YOUTUBE_API_KEY;if(!i)throw Error("YouTube API 키가 설정되지 않았습니다.");let s=await n.default.get(`https://www.googleapis.com/youtube/v3/videos?id=${e}&part=statistics&key=${i}`);if(!s.data.items||0===s.data.items.length)throw Error("동영상을 찾을 수 없습니다.");let u=s.data.items[0].statistics;return{viewCount:u.viewCount||"0",likeCount:u.likeCount||"0",commentCount:u.commentCount||"0"}}catch(t){return{viewCount:"0",likeCount:"0",commentCount:"0"}}},p=async t=>{try{let e=a(t);if(!e)throw Error("유효한 YouTube URL이 아닙니다.");let i=process.env.YOUTUBE_API_KEY;if(!i)throw Error("YouTube API 키가 설정되지 않았습니다.");let s=await n.default.get(`https://www.googleapis.com/youtube/v3/videos?id=${e}&part=snippet&key=${i}`);if(!s.data.items||0===s.data.items.length)throw Error("동영상을 찾을 수 없습니다.");let u=s.data.items[0].snippet,o=u.title,r="",l=o,p=o.split("-");return p.length>1&&(r=p[0].trim(),l=p.slice(1).join("-").trim()),{title:l,artist:r,description:u.description,thumbnailUrl:u.thumbnails?.high?.url||u.thumbnails?.default?.url,publishedAt:u.publishedAt}}catch(t){return null}},d=t=>t?new URLSearchParams(t.split("?")[1]||"").get("list"):null;async function o(t){try{let e=process.env.YOUTUBE_API_KEY;if(!e)return[];let i=d(t);if(!i)return[];let s=`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${i}&maxResults=50&key=${e}`,n=await fetch(s);if(!n.ok)throw await n.text(),Error(`YouTube Playlist API 오류: ${n.statusText}`);let u=await n.json();if(!u.items||0===u.items.length)return[];u.items[0];let o=u.items.map(t=>t.snippet?.resourceId?.videoId).filter(Boolean).join(",");if(o){let t=`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${o}&key=${e}`,i=await fetch(t);if(i.ok){let t=await i.json(),e={};return t.items&&t.items.forEach(t=>{e[t.id]={viewCount:t.statistics?.viewCount||"0",likeCount:t.statistics?.likeCount||"0"}}),u.items.map(t=>{let i=t.snippet?.resourceId?.videoId,s=e[i]||{viewCount:"0",likeCount:"0"};return{videoId:i,title:t.snippet?.title||"",channelTitle:t.snippet?.channelTitle||"",publishedAt:t.snippet?.publishedAt||"",thumbnailUrl:t.snippet?.thumbnails?.high?.url||t.snippet?.thumbnails?.default?.url,viewCount:parseInt(s.viewCount,10),likeCount:parseInt(s.likeCount,10),youtubeUrl:`https://www.youtube.com/watch?v=${i}`}})}}return u.items.map(t=>({videoId:t.snippet?.resourceId?.videoId,title:t.snippet?.title||"",channelTitle:t.snippet?.channelTitle||"",publishedAt:t.snippet?.publishedAt||"",thumbnailUrl:t.snippet?.thumbnails?.high?.url||t.snippet?.thumbnails?.default?.url,viewCount:0,likeCount:0,youtubeUrl:`https://www.youtube.com/watch?v=${t.snippet?.resourceId?.videoId}`}))}catch(t){return[]}}async function r(){try{let t=process.env.YOUTUBE_API_KEY;if(!t)return[];let e=new Date,i=new Date(e);i.setDate(e.getDate()-7),i.setHours(0,0,0,0);let s=i.toISOString(),n=`https://www.googleapis.com/youtube/v3/search?part=snippet&q=kpop+music&type=video&videoCategoryId=10&regionCode=KR&order=viewCount&publishedAfter=${s}&maxResults=20&key=${t}`,u=await fetch(n);if(!u.ok)throw await u.text(),Error(`YouTube API 오류: ${u.statusText}`);let o=await u.json();if(!o.items||0===o.items.length)return[];o.items[0];let r=o.items.map(t=>t.id?.videoId).filter(Boolean).join(",");if(r){let e=`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${r}&key=${t}`,i=await fetch(e);if(i.ok){let t=await i.json(),e={};return t.items&&t.items.forEach(t=>{e[t.id]={viewCount:t.statistics?.viewCount||"0",likeCount:t.statistics?.likeCount||"0"}}),o.items.map(t=>{let i=t.id?.videoId,s=e[i]||{viewCount:"0",likeCount:"0"};return{videoId:i,title:t.snippet?.title||"",channelTitle:t.snippet?.channelTitle||"",publishedAt:t.snippet?.publishedAt||"",thumbnailUrl:t.snippet?.thumbnails?.high?.url||t.snippet?.thumbnails?.default?.url,viewCount:parseInt(s.viewCount,10),likeCount:parseInt(s.likeCount,10),youtubeUrl:`https://www.youtube.com/watch?v=${i}`}})}}return o.items.map(t=>({videoId:t.id?.videoId,title:t.snippet?.title||"",channelTitle:t.snippet?.channelTitle||"",publishedAt:t.snippet?.publishedAt||"",thumbnailUrl:t.snippet?.thumbnails?.high?.url||t.snippet?.thumbnails?.default?.url,viewCount:0,likeCount:0,youtubeUrl:`https://www.youtube.com/watch?v=${t.id?.videoId}`}))}catch(t){return[]}}s()}catch(t){s(t)}})},47153:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"RouteKind",{enumerable:!0,get:function(){return i}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(i||(i={}))},71802:(t,e,i)=>{t.exports=i(20145)}};var e=require("../../../webpack-api-runtime.js");e.C(t);var i=e(e.s=56599);module.exports=i})();