"use strict";(()=>{var e={};e.id=3284,e.ids=[3284],e.modules={11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},65462:e=>{e.exports=import("puppeteer")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},5782:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>u,routeModule:()=>d});var n=r(71802),o=r(47153),i=r(56249),l=r(48419),s=e([l]);l=(s.then?(await s)():s)[0];let u=(0,i.hoist)(l,"default"),c=(0,i.hoist)(l,"config"),d=new n.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/news/crawl-new-loadmore",pathname:"/api/news/crawl-new-loadmore",bundlePath:"",filename:""},userland:l});a()}catch(e){a(e)}})},61367:(e,t,r)=>{r.r(t),r.d(t,{NewsSchema:()=>o,default:()=>u,normalizeNews:()=>l,validateNews:()=>i});var a=r(11185),n=r.n(a);let o={title:String,summary:String,content:String,category:String,coverImage:String,tags:Array,viewCount:Number,featured:Boolean,createdAt:Date,updatedAt:Date,source:String,sourceUrl:String,articleUrl:String,thumbnailUrl:String,timeText:String,authorId:String,relatedCelebs:Array};function i(e){let t={};return e.title||(t.title="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),e.content||(t.content="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),e.category||(t.category="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"),{valid:0===Object.keys(t).length,errors:t}}function l(e){return{...e,featured:!!e.featured,viewCount:Number(e.viewCount||0),tags:Array.isArray(e.tags)?e.tags:e.tags?e.tags.split(",").map(e=>e.trim()):[],createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:new Date}}let s=new(n()).Schema({title:{type:String,required:[!0,"Please provide a title for this news"],maxlength:[200,"Title cannot be more than 200 characters"]},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this news"]},summary:{type:String,required:[!0,"Please provide a summary for this news"],maxlength:[500,"Summary cannot be more than 500 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this news"]},tags:{type:[String],default:[]},category:{type:String,required:[!0,"Please select a category for this news"],enum:["kpop","drama","movie","variety","celeb","other"]},author:{type:n().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"en"},translationOf:{type:n().Schema.Types.ObjectId,ref:"News",default:null},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),u=n().models.News||n().model("News",s)},48419:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>g});var n=r(65462),o=r(11185),i=r.n(o),l=r(61367),s=e([n]);function u(e){new Date().toISOString()}async function c(){try{return await i().connect("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{useNewUrlParser:!0,useUnifiedTopology:!0}),u("MongoDB ì—°ê²° ì„±ê³µ"),!0}catch(e){return u(`MongoDB ì—°ê²° ì‹¤íŒ¨: ${e.message}`),!1}}async function d(e=300){let t;try{u("=== Soompi /latest Load More í¬ë¡¤ë§ ì‹œì‘ ==="),t=await n.default.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--single-process","--disable-gpu"]});let r=await t.newPage();u("https://www.soompi.com/latest ì ‘ì† ì‹œë„..."),await r.goto("https://www.soompi.com/latest",{waitUntil:"networkidle2",timeout:3e4}),u("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");let a=await r.title();u(`í˜ì´ì§€ ì œëª©: ${a}`);let o=[],i=0,l=Math.ceil(e/15);for(u(`Load More í¬ë¡¤ë§ ì‹œì‘: ëª©í‘œ ${e}ê°œ, ìµœëŒ€ ${l}ë²ˆ ì‹œë„`);i<l&&o.length<e;){i++;let t=await r.evaluate(()=>{let e=[];document.querySelectorAll("a").forEach(t=>{if(t.href&&t.href.includes("soompi.com")&&t.href.includes("/article/")){let r=t.textContent?.trim()||"";r.length>3&&e.push({title:r,url:t.href})}});let t=[];return e.forEach(e=>{t.some(t=>t.url===e.url)||t.push(e)}),t});for(let r of(u(`ì‹œë„ ${i}: í˜„ì¬ ${t.length}ê°œ ë‰´ìŠ¤ ë§í¬ ë°œê²¬`),t)){if(o.length>=e)break;if(!o.some(e=>e.articleUrl===r.url))try{let e=function(e,t,r,a,n,o){let i=new Date,l=e.toLowerCase().replace(/[^a-z0-9ê°€-í£\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,100);return{title:e.trim(),content:"",author:"Soompi Crawler",publishedAt:i,tags:["í¬ë¡¤ë§","General"].filter(Boolean),category:"General",slug:l||`news-${i.getTime()}`,featuredImage:"",articleUrl:t,source:"Soompi",status:"published",views:0,likes:0,createdAt:i,updatedAt:i,order:o||0}}(r.title,r.url,0,0,0,o.length);o.push(e),u(`ë‰´ìŠ¤ ë§í¬ ì¶”ê°€: "${r.title}"`)}catch(e){u(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì‹¤íŒ¨: ${r.title} - ${e.message}`)}}if(u(`í˜„ì¬ê¹Œì§€ ìˆ˜ì§‘ëœ ë‰´ìŠ¤: ${o.length}ê°œ`),o.length>=e||i>=l){u(`ìˆ˜ì§‘ ì™„ë£Œ: ${o.length}ê°œ (ëª©í‘œ: ${e}ê°œ)`);break}await r.evaluate(()=>{window.scrollTo(0,document.body.scrollHeight)}),await new Promise(e=>setTimeout(e,2e3));let a=await r.evaluate(()=>{for(let e of Array.from(document.querySelectorAll('button, a, div[role="button"]'))){let t=e.textContent?.toLowerCase()||"";if((t.includes("load more")||t.includes("load")&&t.includes("more"))&&null!==e.offsetParent&&"none"!==e.style.display)return e.click(),`Load More í´ë¦­ ì„±ê³µ: "${e.textContent.trim()}"`}return!1});if(a){u(`ğŸ¯ ${a}`),await new Promise(e=>setTimeout(e,5e3));try{await r.waitForFunction(e=>document.querySelectorAll('a[href*="/article/"]').length>e,{timeout:1e4},t.length),u("âœ… ìƒˆ ì½˜í…ì¸  ë¡œë”© ì™„ë£Œ")}catch(e){u("â° ìƒˆ ì½˜í…ì¸  ë¡œë”© ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼")}}else{u("âŒ Load More ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ - í¬ë¡¤ë§ ì™„ë£Œ");break}}if(u(`ì´ ${o.length}ê°œì˜ ë‰´ìŠ¤ í•­ëª©ì„ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤.`),t)try{await t.close(),u("Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){u(`ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`)}return o}catch(e){if(u(`Puppeteer í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜: ${e.message}`),t)try{await t.close(),u("ì—ëŸ¬ ë°œìƒ ì‹œ Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){u(`ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`)}return[]}}async function g(e,t){if("POST"!==e.method)return t.status(405).json({error:"í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤."});try{u("=== ìƒˆë¡œìš´ Load More í¬ë¡¤ëŸ¬ API í˜¸ì¶œ ===");let{maxItems:r=300}=e.body;if(u(`ìš”ì²­ëœ ìµœëŒ€ ì•„ì´í…œ ìˆ˜: ${r}`),!await c())return t.status(500).json({error:"MongoDB ì—°ê²° ì‹¤íŒ¨"});let a=await d(r);if(!a||0===a.length)return u("í¬ë¡¤ë§ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤."),t.status(200).json({message:"í¬ë¡¤ë§í•  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",newNewsCount:0,totalNews:0});u(`í¬ë¡¤ë§ ì™„ë£Œ: ${a.length}ê°œ ë‰´ìŠ¤ ìˆ˜ì§‘`);let n=0;for(let e of a)try{if(await l.default.findOne({$or:[{articleUrl:e.articleUrl},{title:e.title}]}))u(`ê¸°ì¡´ ë‰´ìŠ¤ ìŠ¤í‚µ: "${e.title}"`);else{let t=new l.default(e);await t.save(),n++,u(`ìƒˆ ë‰´ìŠ¤ ì €ì¥: "${e.title}"`)}}catch(t){u(`ë‰´ìŠ¤ ì €ì¥ ì‹¤íŒ¨: "${e.title}" - ${t.message}`)}let o=await l.default.countDocuments();u(`=== í¬ë¡¤ë§ ì™„ë£Œ ===`),u(`ìˆ˜ì§‘ëœ ë‰´ìŠ¤: ${a.length}ê°œ`),u(`ìƒˆë¡œ ì €ì¥ëœ ë‰´ìŠ¤: ${n}ê°œ`),u(`ì „ì²´ ë‰´ìŠ¤: ${o}ê°œ`),t.status(200).json({message:`í¬ë¡¤ë§ ì™„ë£Œ: ${a.length}ê°œ ë‰´ìŠ¤ ì¤‘ ${n}ê°œ ìƒˆ ë‰´ìŠ¤ ì¶”ê°€`,scrapedCount:a.length,newNewsCount:n,totalNews:o})}catch(e){u(`API í•¸ë“¤ëŸ¬ ì˜¤ë¥˜: ${e.message}`),t.status(500).json({error:"í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",details:e.message})}}n=(s.then?(await s)():s)[0],a()}catch(e){a(e)}})},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=5782);module.exports=r})();