"use strict";(()=>{var e={};e.id=1399,e.ids=[1399],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},99648:e=>{e.exports=import("axios")},20295:e=>{e.exports=import("cheerio")},65462:e=>{e.exports=import("puppeteer")},73127:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>g,default:()=>p,routeModule:()=>u});var s=a(71802),o=a(47153),i=a(56249),d=a(91158),n=e([d]);d=(n.then?(await n)():n)[0];let p=(0,i.hoist)(d,"default"),g=(0,i.hoist)(d,"config"),u=new s.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/news/update-single-category",pathname:"/api/news/update-single-category",bundlePath:"",filename:""},userland:d});r()}catch(e){r(e)}})},91158:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>d});var s=a(35968),o=a(85787),i=e([o]);async function d(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,message:"Method not allowed"});try{let{articleUrl:r,newsId:i}=e.body;if(!r&&!i)return t.status(400).json({success:!1,message:"articleUrl 또는 newsId가 필요합니다."});let{db:d}=await (0,s.connectToDatabase)(),n=d.collection("news"),p={};if(i){let{ObjectId:e}=a(38013);p._id=new e(i)}else r&&(p.articleUrl=r);let g=await n.findOne(p);if(!g)return t.status(404).json({success:!1,message:"뉴스를 찾을 수 없습니다."});let u=await (0,o.fetchArticleDetail)(g.articleUrl);if(!u.detailCategory||!u.mappedCategory)return t.status(200).json({success:!1,message:"상세 페이지에서 카테고리 정보를 찾을 수 없습니다.",detailContent:{detailCategory:u.detailCategory,mappedCategory:u.mappedCategory}});{let e={detailCategory:u.detailCategory,mappedCategory:u.mappedCategory,category:u.mappedCategory,updatedAt:new Date};if(u.tags&&u.tags.length>0&&(e.tags=u.tags),!((await n.updateOne({_id:g._id},{$set:e})).modifiedCount>0))return t.status(200).json({success:!0,message:"이미 최신 카테고리입니다.",current:{category:g.category,detailCategory:g.detailCategory,mappedCategory:g.mappedCategory}});{let e=await n.findOne({_id:g._id});return t.status(200).json({success:!0,message:`카테고리가 ${g.category}에서 ${u.mappedCategory}로 업데이트되었습니다.`,original:{category:g.category,detailCategory:g.detailCategory,mappedCategory:g.mappedCategory},updated:{category:e.category,detailCategory:e.detailCategory,mappedCategory:e.mappedCategory}})}}}catch(e){return t.status(500).json({success:!1,message:"서버 오류가 발생했습니다: "+e.message})}}o=(i.then?(await i)():i)[0],r()}catch(e){r(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[7704],()=>a(73127));module.exports=r})();