"use strict";(()=>{var e={};e.id=8300,e.ids=[8300],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},45616:e=>{e.exports=import("next-connect")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},62571:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t),n.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var r=n(71802),o=n(47153),i=n(56249),s=n(71448),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,i.hoist)(s,"default"),u=(0,i.hoist)(s,"config"),d=new r.PagesAPIRouteModule({definition:{kind:o.RouteKind.PAGES_API,page:"/api/news/search",pathname:"/api/news/search",bundlePath:"",filename:""},userland:s});a()}catch(e){a(e)}})},44756:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(11185),r=n.n(a);n(25142).config({path:".env.production"});let o="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";o||(o="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),o.includes("localhost")||(o.includes("mongodb://")&&!o.includes("authSource=")&&(o.includes("?")?o+="&authSource=admin":o+="?authSource=admin"),!o.includes("docdb.amazonaws.com")||o.includes("authMechanism=")||(o.includes("?")?o+="&authMechanism=SCRAM-SHA-1":o+="?authMechanism=SCRAM-SHA-1"));let i=o.includes("localhost")||o.includes("127.0.0.1"),s=global.mongoose;async function c(){if(s.conn&&1===r().connection.readyState)return s.conn;if(0===r().connection.readyState||3===r().connection.readyState){s.conn=null,s.promise=null;try{await r().connection.close()}catch(e){}}if(!s.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};i||(o.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),s.promise=r().connect(o,e).then(e=>(e.connection.on("error",e=>{s.conn=null,s.promise=null,setTimeout(()=>{c().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{s.conn=null,s.promise=null,setTimeout(()=>{c().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw s.promise=null,e})}try{return s.conn=await s.promise,s.conn}catch(e){throw s.promise=null,e}}s||(s=global.mongoose={conn:null,promise:null});let l=c},61367:(e,t,n)=>{n.r(t),n.d(t,{NewsSchema:()=>o,default:()=>l,normalizeNews:()=>s,validateNews:()=>i});var a=n(11185),r=n.n(a);let o={title:String,summary:String,content:String,category:String,coverImage:String,tags:Array,viewCount:Number,featured:Boolean,createdAt:Date,updatedAt:Date,source:String,sourceUrl:String,articleUrl:String,thumbnailUrl:String,timeText:String,authorId:String,relatedCelebs:Array};function i(e){let t={};return e.title||(t.title="제목을 입력해주세요"),e.content||(t.content="내용을 입력해주세요"),e.category||(t.category="카테고리를 선택해주세요"),{valid:0===Object.keys(t).length,errors:t}}function s(e){return{...e,featured:!!e.featured,viewCount:Number(e.viewCount||0),tags:Array.isArray(e.tags)?e.tags:e.tags?e.tags.split(",").map(e=>e.trim()):[],createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:new Date}}let c=new(r()).Schema({title:{type:String,required:[!0,"Please provide a title for this news"],maxlength:[200,"Title cannot be more than 200 characters"]},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this news"]},summary:{type:String,required:[!0,"Please provide a summary for this news"],maxlength:[500,"Summary cannot be more than 500 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this news"]},tags:{type:[String],default:[]},category:{type:String,required:[!0,"Please select a category for this news"],enum:["kpop","drama","movie","variety","celeb","other"]},author:{type:r().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"en"},translationOf:{type:r().Schema.Types.ObjectId,ref:"News",default:null},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),l=r().models.News||r().model("News",c)},71448:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t),n.d(t,{default:()=>l});var r=n(45616),o=n(44756),i=n(61367),s=e([r]);r=(s.then?(await s)():s)[0];let c=(0,r.createRouter)();c.get(async(e,t)=>{try{await (0,o.default)();let{q:n,page:a=1,limit:r=10,category:s,tags:c,sort:l="createdAt",order:u="desc",fields:d,adminMode:m="false"}=e.query,p=parseInt(a),g=parseInt(r);if(isNaN(p)||p<1)return t.status(400).json({success:!1,message:"Invalid page number"});if(isNaN(g)||g<1||g>100)return t.status(400).json({success:!1,message:"Invalid limit (must be between 1 and 100)"});let h={},f="true"!==m?{$and:[{$or:[{title:{$exists:!0,$ne:"",$ne:null}},{title:{$exists:!1}}]},{$or:[{content:{$exists:!1}},{content:{$ne:"<p>상세 기사를 가져오는 중 오류가 발생했습니다. 원본 페이지를 방문해 주세요.</p>"}},{content:{$not:{$regex:"^<p>상세 기사를 가져오는 중 오류가 발생했습니다"}}}]}]}:null;if(n){let e=RegExp(n,"i");h.$or=[{title:e},{summary:e},{content:e},{slug:e}]}if(s){let e=s.split(",").map(e=>e.trim());1===e.length?h.category=s:h.category={$in:e}}if(c){let e=c.split(",").map(e=>e.trim());1===e.length?h.tags=c:h.tags={$in:e}}f&&(Object.keys(h).length>0?h.$and=h.$and?[...h.$and,...f.$and]:f.$and:Object.assign(h,f));let y={};d&&d.split(",").map(e=>e.trim()).forEach(e=>{y[e]=1});let S=(p-1)*g,w=["title","createdAt","updatedAt","publishedAt","viewCount"].includes(l)?l:"createdAt",A={};A[w]="asc"===u?1:-1;let v=await i.default.find(h,y).sort(A).skip(S).limit(g),b=await i.default.countDocuments(h);return t.status(200).json({success:!0,data:{news:v,pagination:{total:b,page:p,limit:g,pages:Math.ceil(b/g)},query:{searchTerm:n||null,category:s||null,tags:c||null,sort:w,order:u}}})}catch(e){return t.status(500).json({success:!1,message:"Server error during search",error:void 0})}});let l=c.handler({onError:(e,t,n)=>{n.status(500).json({success:!1,message:"서버 오류가 발생했습니다",error:void 0})},onNoMatch:(e,t)=>{t.status(405).json({success:!1,message:`지원하지 않는 메소드: ${e.method}`})}});a()}catch(e){a(e)}})},47153:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},71802:(e,t,n)=>{e.exports=n(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=62571);module.exports=n})();