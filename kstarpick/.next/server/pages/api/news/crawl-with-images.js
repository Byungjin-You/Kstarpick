"use strict";(()=>{var e={};e.id=1698,e.ids=[1698],e.modules={11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},65462:e=>{e.exports=import("puppeteer")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},95190:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>u,routeModule:()=>d});var n=r(71802),i=r(47153),o=r(56249),l=r(57933),s=e([l]);l=(s.then?(await s)():s)[0];let u=(0,o.hoist)(l,"default"),c=(0,o.hoist)(l,"config"),d=new n.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/news/crawl-with-images",pathname:"/api/news/crawl-with-images",bundlePath:"",filename:""},userland:l});a()}catch(e){a(e)}})},61367:(e,t,r)=>{r.r(t),r.d(t,{NewsSchema:()=>i,default:()=>u,normalizeNews:()=>l,validateNews:()=>o});var a=r(11185),n=r.n(a);let i={title:String,summary:String,content:String,category:String,coverImage:String,tags:Array,viewCount:Number,featured:Boolean,createdAt:Date,updatedAt:Date,source:String,sourceUrl:String,articleUrl:String,thumbnailUrl:String,timeText:String,authorId:String,relatedCelebs:Array};function o(e){let t={};return e.title||(t.title="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),e.content||(t.content="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),e.category||(t.category="ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"),{valid:0===Object.keys(t).length,errors:t}}function l(e){return{...e,featured:!!e.featured,viewCount:Number(e.viewCount||0),tags:Array.isArray(e.tags)?e.tags:e.tags?e.tags.split(",").map(e=>e.trim()):[],createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:new Date}}let s=new(n()).Schema({title:{type:String,required:[!0,"Please provide a title for this news"],maxlength:[200,"Title cannot be more than 200 characters"]},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this news"]},summary:{type:String,required:[!0,"Please provide a summary for this news"],maxlength:[500,"Summary cannot be more than 500 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this news"]},tags:{type:[String],default:[]},category:{type:String,required:[!0,"Please select a category for this news"],enum:["kpop","drama","movie","variety","celeb","other"]},author:{type:n().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"en"},translationOf:{type:n().Schema.Types.ObjectId,ref:"News",default:null},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),u=n().models.News||n().model("News",s)},57933:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>m});var n=r(65462),i=r(11185),o=r.n(i),l=r(61367),s=r(20912),u=e([n]);function c(e){new Date().toISOString()}async function d(){try{return await o().connect("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{useNewUrlParser:!0,useUnifiedTopology:!0}),c("MongoDB ì—°ê²° ì„±ê³µ"),!0}catch(e){return c(`MongoDB ì—°ê²° ì‹¤íŒ¨: ${e.message}`),!1}}async function g(e=300){let t;try{c("=== Soompi /latest Load More + ì´ë¯¸ì§€ í¬ë¡¤ë§ ì‹œì‘ ==="),t=await n.default.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--single-process","--disable-gpu"]});let r=await t.newPage();c("https://www.soompi.com/latest ì ‘ì† ì‹œë„..."),await r.goto("https://www.soompi.com/latest",{waitUntil:"networkidle2",timeout:3e4}),c("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");let a=await r.title();c(`í˜ì´ì§€ ì œëª©: ${a}`);let i=[],o=0,l=Math.ceil(e/15);for(c(`Load More í¬ë¡¤ë§ ì‹œì‘: ëª©í‘œ ${e}ê°œ, ìµœëŒ€ ${l}ë²ˆ ì‹œë„`);o<l&&i.length<e;){o++;let t=await r.evaluate(()=>{let e=[];document.querySelectorAll('article, .post, .news-item, div[class*="post"], div[class*="article"]').forEach(t=>{let r=t.querySelector('a[href*="/article/"]');if(!r)return;let a=r.textContent?.trim()||t.querySelector("h1, h2, h3, h4, .title")?.textContent?.trim()||"",n=r.href;if(!a||a.length<=3)return;let i="",o=t.querySelector("img");o&&(i=o.src||o.getAttribute("data-src")||""),e.push({title:a,url:n,imageUrl:i})}),0===e.length&&document.querySelectorAll('a[href*="/article/"]').forEach(t=>{let r=t.textContent?.trim()||"",a=t.href;if(r.length>3){let n="",i=t.closest("div, article, section");if(i){let e=i.querySelector("img");e&&(n=e.src||e.getAttribute("data-src")||"")}e.push({title:r,url:a,imageUrl:n})}});let t=[];return e.forEach(e=>{t.some(t=>t.url===e.url)||t.push(e)}),t});for(let r of(c(`ì‹œë„ ${o}: í˜„ì¬ ${t.length}ê°œ ë‰´ìŠ¤ ë°ì´í„° ë°œê²¬`),t)){if(i.length>=e)break;if(!i.some(e=>e.articleUrl===r.url))try{let e=function(e,t,r,a,n,i){let o=new Date,l=e.toLowerCase().replace(/[^a-z0-9ê°€-í£\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,100),u=(0,s.createSafeImageUrl)(r);return{title:e.trim(),content:"",author:"Soompi Crawler",publishedAt:o,tags:["í¬ë¡¤ë§","General"].filter(Boolean),category:"General",slug:l||`news-${o.getTime()}`,featuredImage:u,articleUrl:t,source:"Soompi",status:"published",views:0,likes:0,createdAt:o,updatedAt:o,order:i||0,originalImageUrl:r}}(r.title,r.url,r.imageUrl,0,0,i.length);i.push(e);let t=r.imageUrl?"(ì´ë¯¸ì§€ ìˆìŒ)":"(ì´ë¯¸ì§€ ì—†ìŒ)";c(`ë‰´ìŠ¤ ë§í¬ ì¶”ê°€ ${t}: "${r.title}"`),r.imageUrl&&(c(`  ì›ë³¸ ì´ë¯¸ì§€: ${r.imageUrl}`),c(`  í”„ë¡ì‹œ ì´ë¯¸ì§€: ${e.featuredImage}`))}catch(e){c(`ë‰´ìŠ¤ ì•„ì´í…œ ìƒì„± ì‹¤íŒ¨: ${r.title} - ${e.message}`)}}if(c(`í˜„ì¬ê¹Œì§€ ìˆ˜ì§‘ëœ ë‰´ìŠ¤: ${i.length}ê°œ`),i.length>=e||o>=l){c(`ìˆ˜ì§‘ ì™„ë£Œ: ${i.length}ê°œ (ëª©í‘œ: ${e}ê°œ)`);break}await r.evaluate(()=>{window.scrollTo(0,document.body.scrollHeight)}),await new Promise(e=>setTimeout(e,2e3));let a=await r.evaluate(()=>{for(let e of Array.from(document.querySelectorAll('button, a, div[role="button"]'))){let t=e.textContent?.toLowerCase()||"";if((t.includes("load more")||t.includes("load")&&t.includes("more"))&&null!==e.offsetParent&&"none"!==e.style.display)return e.click(),`Load More í´ë¦­ ì„±ê³µ: "${e.textContent.trim()}"`}return!1});if(a){c(`ğŸ¯ ${a}`),await new Promise(e=>setTimeout(e,5e3));try{await r.waitForFunction(e=>document.querySelectorAll('a[href*="/article/"]').length>e,{timeout:1e4},t.length),c("âœ… ìƒˆ ì½˜í…ì¸  ë¡œë”© ì™„ë£Œ")}catch(e){c("â° ìƒˆ ì½˜í…ì¸  ë¡œë”© ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼")}}else{c("âŒ Load More ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ - í¬ë¡¤ë§ ì™„ë£Œ");break}}let u=i.filter(e=>e.originalImageUrl).length,d=i.length-u;if(c(`ì´ ${i.length}ê°œì˜ ë‰´ìŠ¤ í•­ëª©ì„ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤.`),c(`ì´ë¯¸ì§€ ìˆìŒ: ${u}ê°œ, ì´ë¯¸ì§€ ì—†ìŒ: ${d}ê°œ`),t)try{await t.close(),c("Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){c(`ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`)}return i}catch(e){if(c(`Puppeteer í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜: ${e.message}`),t)try{await t.close(),c("ì—ëŸ¬ ë°œìƒ ì‹œ Puppeteer ë¸Œë¼ìš°ì € ì¢…ë£Œ")}catch(e){c(`ì—ëŸ¬ ì‹œ ë¸Œë¼ìš°ì € ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜: ${e.message}`)}return[]}}async function m(e,t){if("POST"!==e.method)return t.status(405).json({error:"í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤."});try{c("=== ìƒˆë¡œìš´ Load More + ì´ë¯¸ì§€ í¬ë¡¤ëŸ¬ API í˜¸ì¶œ ===");let{maxItems:r=300}=e.body;if(c(`ìš”ì²­ëœ ìµœëŒ€ ì•„ì´í…œ ìˆ˜: ${r}`),!await d())return t.status(500).json({error:"MongoDB ì—°ê²° ì‹¤íŒ¨"});let a=await g(r);if(!a||0===a.length)return c("í¬ë¡¤ë§ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤."),t.status(200).json({message:"í¬ë¡¤ë§í•  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",newNewsCount:0,totalNews:0});c(`í¬ë¡¤ë§ ì™„ë£Œ: ${a.length}ê°œ ë‰´ìŠ¤ ìˆ˜ì§‘`);let n=0,i=0;for(let e of a)try{if(await l.default.findOne({$or:[{articleUrl:e.articleUrl},{title:e.title}]}))c(`ê¸°ì¡´ ë‰´ìŠ¤ ìŠ¤í‚µ: "${e.title}"`);else{let t=new l.default(e);await t.save(),n++,e.originalImageUrl&&i++;let r=e.originalImageUrl?"(ì´ë¯¸ì§€ í¬í•¨)":"";c(`ìƒˆ ë‰´ìŠ¤ ì €ì¥ ${r}: "${e.title}"`)}}catch(t){c(`ë‰´ìŠ¤ ì €ì¥ ì‹¤íŒ¨: "${e.title}" - ${t.message}`)}let o=await l.default.countDocuments();c(`=== í¬ë¡¤ë§ ì™„ë£Œ ===`),c(`ìˆ˜ì§‘ëœ ë‰´ìŠ¤: ${a.length}ê°œ`),c(`ìƒˆë¡œ ì €ì¥ëœ ë‰´ìŠ¤: ${n}ê°œ (ì´ë¯¸ì§€ í¬í•¨: ${i}ê°œ)`),c(`ì „ì²´ ë‰´ìŠ¤: ${o}ê°œ`),t.status(200).json({message:`í¬ë¡¤ë§ ì™„ë£Œ: ${a.length}ê°œ ë‰´ìŠ¤ ì¤‘ ${n}ê°œ ìƒˆ ë‰´ìŠ¤ ì¶”ê°€ (ì´ë¯¸ì§€ ${i}ê°œ í¬í•¨)`,scrapedCount:a.length,newNewsCount:n,newNewsWithImages:i,totalNews:o})}catch(e){c(`API í•¸ë“¤ëŸ¬ ì˜¤ë¥˜: ${e.message}`),t.status(500).json({error:"í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",details:e.message})}}n=(u.then?(await u)():u)[0],a()}catch(e){a(e)}})},20912:(e,t,r)=>{function a(e){return e?e.includes("/api/proxy/image")?e:(e.includes("soompi.io")||e.includes("soompi.com"),`/api/proxy/image?url=${encodeURIComponent(e)}`):""}function n(e){try{return new URL(e).pathname.split("/").pop()||"image"}catch(e){return"image"}}function i(e){let t=n(e).split(".");return t.length>1?t.pop().toLowerCase():"jpg"}function o(e,t="/images/default-news.jpg"){if(!e)return t;try{return a(e)}catch(e){return t}}r.r(t),r.d(t,{convertToProxyUrl:()=>a,createSafeImageUrl:()=>o,extractImageFilename:()=>n,getImageExtension:()=>i})},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=95190);module.exports=r})();