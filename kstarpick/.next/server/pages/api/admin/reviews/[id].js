"use strict";(()=>{var e={};e.id=2254,e.ids=[2254],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},76074:(e,t,s)=>{s.r(t),s.d(t,{config:()=>m,default:()=>l,routeModule:()=>f});var r={};s.r(r),s.d(r,{default:()=>d});var n=s(71802),a=s(47153),i=s(56249),o=s(35968),u=s(41649),c=s(38013);async function d(e,t){let s=await (0,u.getSession)({req:e});if(!s||s.user?.role!=="admin")return t.status(403).json({success:!1,message:"접근 권한이 없습니다."});let{id:r}=e.query;if(!r)return t.status(400).json({success:!1,message:"리뷰 ID가 필요합니다."});try{let s;let{db:n}=await (0,o.connectToDatabase)(),a=n.collection("reviews");try{s=new c.ObjectId(r)}catch(e){return t.status(400).json({success:!1,message:"유효하지 않은 리뷰 ID입니다."})}if("GET"===e.method){let e=await a.findOne({_id:s});if(!e)return t.status(404).json({success:!1,message:"리뷰를 찾을 수 없습니다."});let r=null;if(e.dramaId||e.tvfilmId){let t=e.dramaId||e.tvfilmId,s=e.dramaId?n.collection("dramas"):n.collection("tvfilms");try{let e="string"==typeof t?new c.ObjectId(t):t;r=await s.findOne({_id:e})}catch(e){}}return t.status(200).json({success:!0,review:e,contentInfo:r})}if("PUT"===e.method){let{title:r,content:n,rating:i,authorName:o,featured:u,approved:c,spoiler:d,tags:l}=e.body;if(!r||!n||!i||!o)return t.status(400).json({success:!1,message:"필수 필드가 누락되었습니다."});let m={title:r,content:n,rating:parseInt(i),authorName:o,featured:u||!1,approved:c||!1,spoiler:d||!1,tags:l||[],updatedAt:new Date},f=await a.updateOne({_id:s},{$set:m});if(0===f.matchedCount)return t.status(404).json({success:!1,message:"리뷰를 찾을 수 없습니다."});return t.status(200).json({success:!0,message:"리뷰가 성공적으로 업데이트되었습니다."})}if("DELETE"===e.method){let e=await a.deleteOne({_id:s});if(0===e.deletedCount)return t.status(404).json({success:!1,message:"리뷰를 찾을 수 없습니다."});return t.status(200).json({success:!0,message:"리뷰가 성공적으로 삭제되었습니다."})}return t.status(405).json({success:!1,message:"허용되지 않는 메서드입니다."})}catch(e){return t.status(500).json({success:!1,message:"서버 오류가 발생했습니다."})}}let l=(0,i.hoist)(r,"default"),m=(0,i.hoist)(r,"config"),f=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/admin/reviews/[id]",pathname:"/api/admin/reviews/[id]",bundlePath:"",filename:""},userland:r})},35968:(e,t,s)=>{let r;s.r(t),s.d(t,{connectToDatabase:()=>c,dbConnect:()=>d,default:()=>l});var n=s(38013),a=s(92048),i=s.n(a),o=s(55315),u=s.n(o);{let e=s(25142),t=u().resolve(process.cwd(),".env.production");i().existsSync(t)&&e.config({path:t}).error}async function c(){try{let e=await r,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}r=new n.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let d=c,l=r},47153:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},71802:(e,t,s)=>{e.exports=s(20145)}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=76074);module.exports=s})();