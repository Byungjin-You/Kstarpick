"use strict";(()=>{var e={};e.id=4015,e.ids=[4015],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},18759:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>c,routeModule:()=>d});var o={};r.r(o),r.d(o,{default:()=>l});var n=r(71802),a=r(47153),i=r(56249),s=r(35968);async function l(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{q:r,type:o="all",page:n=1,limit:a=12}=e.query;if(!r)return t.status(400).json({message:"Search query is required"});let{db:i}=await (0,s.connectToDatabase)(),l={news:[],dramas:[],movies:[],actors:[]},c=i.collection("news"),u=await c.find({title:{$regex:r,$options:"i"}}).limit(parseInt(a)).toArray();l.news=u;let d=i.collection("tvfilms"),m=await d.find({"cast.name":{$regex:r,$options:"i"}}).limit(parseInt(a)).toArray();l.dramas=m.filter(e=>"drama"===e.category),l.movies=m.filter(e=>"movie"===e.category);let p=i.collection("celebrities"),f=await p.find({$or:[{name:{$regex:r,$options:"i"}},{knownAs:{$regex:r,$options:"i"}},{alternateNames:{$regex:r,$options:"i"}}]}).limit(parseInt(a)).toArray();l.actors=f;let P=Object.values(l).reduce((e,t)=>e+t.length,0);return t.status(200).json({results:l,total:P,page:parseInt(n),totalPages:Math.ceil(P/parseInt(a))})}catch(e){return t.status(500).json({message:"Internal server error",error:e.message})}}let c=(0,i.hoist)(o,"default"),u=(0,i.hoist)(o,"config"),d=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/celebrity-search",pathname:"/api/celebrity-search",bundlePath:"",filename:""},userland:o})},35968:(e,t,r)=>{let o;r.r(t),r.d(t,{connectToDatabase:()=>c,dbConnect:()=>u,default:()=>d});var n=r(38013),a=r(92048),i=r.n(a),s=r(55315),l=r.n(s);{let e=r(25142),t=l().resolve(process.cwd(),".env.production");i().existsSync(t)&&e.config({path:t}).error}async function c(){try{let e=await o,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}o=new n.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let u=c,d=o},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=18759);module.exports=r})();