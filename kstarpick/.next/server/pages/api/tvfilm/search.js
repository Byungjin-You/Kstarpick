"use strict";(()=>{var e={};e.id=9681,e.ids=[9681],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},45616:e=>{e.exports=import("next-connect")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},32842:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>s,routeModule:()=>d});var a=r(71802),i=r(47153),o=r(56249),u=r(18014),l=e([u]);u=(l.then?(await l)():l)[0];let s=(0,o.hoist)(u,"default"),c=(0,o.hoist)(u,"config"),d=new a.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/tvfilm/search",pathname:"/api/tvfilm/search",bundlePath:"",filename:""},userland:u});n()}catch(e){n(e)}})},44756:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var n=r(11185),a=r.n(n);r(25142).config({path:".env.production"});let i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";i||(i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),i.includes("localhost")||(i.includes("mongodb://")&&!i.includes("authSource=")&&(i.includes("?")?i+="&authSource=admin":i+="?authSource=admin"),!i.includes("docdb.amazonaws.com")||i.includes("authMechanism=")||(i.includes("?")?i+="&authMechanism=SCRAM-SHA-1":i+="?authMechanism=SCRAM-SHA-1"));let o=i.includes("localhost")||i.includes("127.0.0.1"),u=global.mongoose;async function l(){if(u.conn&&1===a().connection.readyState)return u.conn;if(0===a().connection.readyState||3===a().connection.readyState){u.conn=null,u.promise=null;try{await a().connection.close()}catch(e){}}if(!u.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};o||(i.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),u.promise=a().connect(i,e).then(e=>(e.connection.on("error",e=>{u.conn=null,u.promise=null,setTimeout(()=>{l().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{u.conn=null,u.promise=null,setTimeout(()=>{l().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw u.promise=null,e})}try{return u.conn=await u.promise,u.conn}catch(e){throw u.promise=null,e}}u||(u=global.mongoose={conn:null,promise:null});let s=l},74053:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(11185),a=r.n(n);let i=new(a()).Schema({title:{type:String,required:[!0,"Please provide a title for this TV/Film"],maxlength:[200,"Title cannot be more than 200 characters"]},originalTitle:{type:String,required:!1},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this TV/Film"]},summary:{type:String,required:[!0,"Please provide a summary for this TV/Film"],maxlength:[1e3,"Summary cannot be more than 1000 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this TV/Film"]},bannerImage:{type:String,required:!1,default:""},trailerUrl:{type:String,required:!1,default:""},category:{type:String,required:[!0,"Please select a category for this TV/Film"],enum:["drama","movie","variety","documentary","other"]},status:{type:String,required:[!0,"Please select a status for this TV/Film"],enum:["ongoing","completed","upcoming","canceled"],default:"ongoing"},network:{type:String,required:!1},releaseDate:{type:Date,required:[!0,"Please provide a release date for this TV/Film"]},rating:{type:Number,required:!1,min:[0,"Rating cannot be less than 0"],max:[10,"Rating cannot be more than 10"],default:0},reviewRating:{type:Number,min:[0,"Review rating cannot be less than 0"],max:[10,"Review rating cannot be more than 10"],default:0},reviewCount:{type:Number,default:0},ratingDistribution:{type:[Number],default:[0,0,0,0,0,0,0,0,0,0],validate:{validator:function(e){return 10===e.length},message:"Rating distribution must have exactly 10 values"}},runtime:{type:String,required:!1},ageRating:{type:String,required:!1,enum:["ALL","12","15","18","R"]},director:{type:String,required:!1},country:{type:String,required:!1},tags:{type:[String],default:[]},genres:{type:[String],default:[]},cast:{type:[{name:{type:String,required:!0},role:{type:String},image:{type:String},order:{type:Number,default:0}}],default:[]},watchProviders:{type:[{name:{type:String,required:!0},logo:{type:String},type:{type:String,enum:["subscription","rental","purchase","free"],required:!0},price:{type:String},quality:[String],url:{type:String},order:{type:Number,default:0}}],default:[]},videos:{type:[{title:{type:String},type:{type:String,enum:["trailer","teaser","ad","making-of","clip","interview","other"],required:!0},url:{type:String,required:!0},order:{type:Number,default:0}}],default:[]},author:{type:a().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},orderNumber:{type:Number,default:0,index:!0},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"en"},translationOf:{type:a().Schema.Types.ObjectId,ref:"TVFilm",default:null},views:{type:Number,default:0},likes:{type:Number,default:0},dislikes:{type:Number,default:0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),o=a().models.TVFilm||a().model("TVFilm",i)},18014:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>s});var a=r(45616),i=r(44756),o=r(74053);r(11185);var u=e([a]);a=(u.then?(await u)():u)[0];let l=(0,a.default)();l.get(async(e,t)=>{try{await (0,i.default)();let{q:r,page:n=1,limit:a=10,category:u,genre:l,status:s,sort:c="createdAt",order:d="desc",fields:m}=e.query,p=parseInt(n),g=parseInt(a);if(isNaN(p)||p<1)return t.status(400).json({success:!1,message:"Invalid page number"});if(isNaN(g)||g<1||g>50)return t.status(400).json({success:!1,message:"Invalid limit (must be between 1 and 50)"});let y={};if(r){let e=RegExp(r,"i");y.$or=[{title:e},{alternativeTitle:e},{originalTitle:e},{description:e},{slug:e}]}if(u&&(y.category=u),l){let e=l.split(",").map(e=>e.trim());1===e.length?y.genres=l:y.genres={$in:e}}if(s){let e=s.split(",").map(e=>e.trim());1===e.length?y.status=s:y.status={$in:e}}let f={};m&&m.split(",").map(e=>e.trim()).forEach(e=>{f[e]=1});let h=(p-1)*g,S=["title","createdAt","updatedAt","releaseDate","rating"].includes(c)?c:"createdAt",v={};v[S]="asc"===d?1:-1;let b=await o.default.find(y,f).sort(v).skip(h).limit(g),q=await o.default.countDocuments(y);return t.status(200).json({success:!0,data:{tvfilms:b,pagination:{total:q,page:p,limit:g,pages:Math.ceil(q/g)},query:{searchTerm:r||null,category:u||null,genre:l||null,status:s||null,sort:S,order:d}}})}catch(e){return t.status(500).json({success:!1,message:"Server error during search",error:void 0})}});let s=l;n()}catch(e){n(e)}})},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=32842);module.exports=r})();