"use strict";(()=>{var e={};e.id=3019,e.ids=[3019],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},30868:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>m});var a={};r.r(a),r.d(a,{default:()=>c});var s=r(71802),n=r(47153),o=r(56249),i=r(35968);async function c(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{q:r}=e.query;if(!r||r.length<2)return t.status(400).json({message:"Search query must be at least 2 characters"});let{db:a}=await (0,i.connectToDatabase)(),s=r.split(/\s+/).filter(e=>e.length>1),n=s.length>1,o=Object.entries({news:{name:"news",fields:["title","summary","content","contentHtml","cast","actors","starring","director","castMembers","actorNames"],htmlFields:["content","contentHtml"]},dramas:{name:"dramas",fields:["title","summary","description","cast","actors","starring","director","cast.name","actors.name","castMembers","actorNames"],filter:{category:"drama"}},movies:{name:"dramas",fields:["title","summary","description","cast","actors","starring","director","cast.name","actors.name","castMembers","actorNames"],filter:{category:"movie"}},actors:{name:"celebrities",fields:["name","description","biography","knownAs","alternateNames","roles","filmography","filmography.title"]}}).map(async([e,t])=>{let o;let{name:i,fields:c,filter:l={},htmlFields:u}=t;if(n)o={$and:[...s.map(e=>{let t=c.map(t=>({[t]:{$regex:e,$options:"i"}}));return u&&u.length>0&&u.forEach(r=>{t.push({[r]:{$regex:`>([^<]*${e}[^<]*)`,$options:"i"}})}),{$or:t}}),l]};else{let e=c.map(e=>({[e]:{$regex:r,$options:"i"}}));u&&u.length>0&&u.forEach(t=>{e.push({[t]:{$regex:`>([^<]*${r}[^<]*)`,$options:"i"}})}),o={$and:[{$or:e},l]}}let m=await a.collection(i).find(o).sort({viewCount:-1,createdAt:-1}).limit(5).toArray();return{type:e,suggestions:m.map(e=>({id:e._id,title:e.title||e.name||"",count:e.viewCount||0,createdAt:e.createdAt,category:e.category}))}}),c=(await Promise.all(o)).flatMap(e=>e.suggestions.map(t=>({...t,type:e.type}))).sort((e,t)=>Math.abs(t.count-e.count)>10?t.count-e.count:new Date(t.createdAt||0)-new Date(e.createdAt||0)).slice(0,10);return t.status(200).json({suggestions:c})}catch(e){return t.status(500).json({message:"Internal server error",error:e.message})}}let l=(0,o.hoist)(a,"default"),u=(0,o.hoist)(a,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/search/suggestions",pathname:"/api/search/suggestions",bundlePath:"",filename:""},userland:a})},35968:(e,t,r)=>{let a;r.r(t),r.d(t,{connectToDatabase:()=>l,dbConnect:()=>u,default:()=>m});var s=r(38013),n=r(92048),o=r.n(n),i=r(55315),c=r.n(i);{let e=r(25142),t=c().resolve(process.cwd(),".env.production");o().existsSync(t)&&e.config({path:t}).error}async function l(){try{let e=await a,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}a=new s.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let u=l,m=a},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=30868);module.exports=r})();