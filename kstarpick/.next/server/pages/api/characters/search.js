"use strict";(()=>{var e={};e.id=3055,e.ids=[3055],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},45616:e=>{e.exports=import("next-connect")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},42398:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var n=r(71802),s=r(47153),i=r(56249),o=r(15729),c=e([o]);o=(c.then?(await c)():c)[0];let u=(0,i.hoist)(o,"default"),l=(0,i.hoist)(o,"config"),d=new n.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/characters/search",pathname:"/api/characters/search",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},15729:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>c});var n=r(45616),s=r(35968),i=e([n]);n=(i.then?(await i)():i)[0];let o=(0,n.default)();o.get(async(e,t)=>{try{let{db:r}=await (0,s.connectToDatabase)(),{q:a,page:n=1,limit:i=10,drama:o,actor:c,sort:u="createdAt",order:l="desc",fields:d}=e.query,p=parseInt(n),m=parseInt(i);if(isNaN(p)||p<1)return t.status(400).json({success:!1,message:"Invalid page number"});if(isNaN(m)||m<1||m>50)return t.status(400).json({success:!1,message:"Invalid limit (must be between 1 and 50)"});let f={};if(a){let e=RegExp(a,"i");f.$or=[{name:e},{description:e},{slug:e}]}if(o){let e=o.split(",").map(e=>e.trim());1===e.length?f.drama=o:f.drama={$in:e}}if(c){let e=c.split(",").map(e=>e.trim());1===e.length?f.actor=c:f.actor={$in:e}}let h={};d&&d.split(",").map(e=>e.trim()).forEach(e=>{h[e]=1});let P=(p-1)*m,g=["name","createdAt","updatedAt"].includes(u)?u:"createdAt",A={};A[g]="asc"===l?1:-1;let v=r.collection("characters"),y=await v.find(f,{projection:h}).sort(A).skip(P).limit(m).toArray(),b=await v.countDocuments(f);return t.status(200).json({success:!0,data:{characters:y,pagination:{total:b,page:p,limit:m,pages:Math.ceil(b/m)},query:{searchTerm:a||null,drama:o||null,actor:c||null,sort:g,order:l}}})}catch(e){return t.status(500).json({success:!1,message:"Server error during search",error:void 0})}});let c=o;a()}catch(e){a(e)}})},35968:(e,t,r)=>{let a;r.r(t),r.d(t,{connectToDatabase:()=>u,dbConnect:()=>l,default:()=>d});var n=r(38013),s=r(92048),i=r.n(s),o=r(55315),c=r.n(o);{let e=r(25142),t=c().resolve(process.cwd(),".env.production");i().existsSync(t)&&e.config({path:t}).error}async function u(){try{let e=await a,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}a=new n.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let l=u,d=a},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=42398);module.exports=r})();