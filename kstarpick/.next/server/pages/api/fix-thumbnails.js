"use strict";(()=>{var e={};e.id=791,e.ids=[791],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},62616:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>d});var n={};r.r(n),r.d(n,{default:()=>u});var o=r(71802),a=r(47153),i=r(56249),s=r(35968);async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{db:e}=await (0,s.connectToDatabase)(),r=e.collection("news"),n=await r.find({$or:[{thumbnailUrl:{$exists:!1}},{thumbnailUrl:""},{thumbnailUrl:null}],coverImage:{$exists:!0,$ne:""}}).toArray();if(0===n.length)return t.json({success:!0,message:"수정할 뉴스가 없습니다.",updated:0});let o=0;for(let e of n)try{await r.updateOne({_id:e._id},{$set:{thumbnailUrl:e.coverImage}}),o++}catch(e){}let a=await r.countDocuments({thumbnailUrl:{$exists:!0,$ne:""}});return t.json({success:!0,message:`${o}개 뉴스의 thumbnailUrl 업데이트 완료`,updated:o,totalWithThumbnail:a})}catch(e){return t.status(500).json({success:!1,error:"Internal server error",details:e.message})}}let l=(0,i.hoist)(n,"default"),c=(0,i.hoist)(n,"config"),d=new o.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/fix-thumbnails",pathname:"/api/fix-thumbnails",bundlePath:"",filename:""},userland:n})},35968:(e,t,r)=>{let n;r.r(t),r.d(t,{connectToDatabase:()=>l,dbConnect:()=>c,default:()=>d});var o=r(38013),a=r(92048),i=r.n(a),s=r(55315),u=r.n(s);{let e=r(25142),t=u().resolve(process.cwd(),".env.production");i().existsSync(t)&&e.config({path:t}).error}async function l(){try{let e=await n,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}n=new o.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let c=l,d=n},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=62616);module.exports=r})();