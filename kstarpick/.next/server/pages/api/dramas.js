"use strict";(()=>{var e={};e.id=992,e.ids=[992],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},65567:(e,t,r)=>{r.r(t),r.d(t,{config:()=>d,default:()=>c,routeModule:()=>l});var a={};r.r(a),r.d(a,{default:()=>u});var s=r(71802),n=r(47153),o=r(56249),i=r(35968);async function u(e,t){let{db:r}=await (0,i.connectToDatabase)();if("GET"===e.method)try{let{page:a=1,limit:s=10,sortBy:n="updatedAt",sortOrder:o="desc",title:i="",category:u="",status:c="",featured:d="",includeAllFields:l="false"}=e.query,m=parseInt(a),p=parseInt(s),f=(m-1)*p,g={};i&&(g.title={$regex:i,$options:"i"}),u&&"all"!==u&&(g.category=u),c&&"all"!==c&&(g.status=c),"true"===d?g.featured=!0:"false"===d&&(g.featured=!1);let P={};P[n]="asc"===o?1:-1,"orderNumber"===n&&(P.updatedAt=-1);let A={};"true"!==l&&(A={title:1,slug:1,category:1,status:1,mdlId:1,coverImage:1,network:1,featured:1,updatedAt:1,createdAt:1,genres:1,genre:1,rating:1,reviewRating:1,orderNumber:1,previousOrderNumber:1,description:1,summary:1});let h=await r.collection("dramas").find(g,{projection:A}).sort(P).skip(f).limit(p).toArray(),y=await r.collection("dramas").countDocuments(g);return t.status(200).json({success:!0,data:h,pagination:{total:y,page:m,limit:p,pages:Math.ceil(y/p)}})}catch(e){return t.status(500).json({success:!1,message:"드라마 조회 중 오류가 발생했습니다.",error:e.message})}else if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});else try{let a=e.body;if(!a||!a.title)return t.status(400).json({success:!1,message:"유효한 드라마 데이터가 필요합니다."});let s=new Date;if(a.createdAt=s,a.updatedAt=s,!a.slug){let e=a.title.toLowerCase().replace(/[^a-z0-9ㄱ-ㅎㅏ-ㅣ가-힣]+/g,"-").replace(/^-|-$/g,""),t=Date.now().toString().slice(-6);a.slug=`${e}-${t}`}let n=await r.collection("dramas").insertOne(a);return t.status(201).json({success:!0,message:"드라마가 성공적으로 생성되었습니다.",data:{_id:n.insertedId,...a}})}catch(e){return t.status(500).json({success:!1,message:"드라마 생성 중 오류가 발생했습니다.",error:e.message})}}r(41649),r(38013);let c=(0,o.hoist)(a,"default"),d=(0,o.hoist)(a,"config"),l=new s.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/dramas",pathname:"/api/dramas",bundlePath:"",filename:""},userland:a})},35968:(e,t,r)=>{let a;r.r(t),r.d(t,{connectToDatabase:()=>c,dbConnect:()=>d,default:()=>l});var s=r(38013),n=r(92048),o=r.n(n),i=r(55315),u=r.n(i);{let e=r(25142),t=u().resolve(process.cwd(),".env.production");o().existsSync(t)&&e.config({path:t}).error}async function c(){try{let e=await a,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}a=new s.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let d=c,l=a},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=65567);module.exports=r})();