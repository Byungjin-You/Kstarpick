"use strict";(()=>{var e={};e.id=6325,e.ids=[6325],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},73673:e=>{e.exports=require("slugify")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},31933:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>y,routeModule:()=>S});var n={};r.r(n),r.d(n,{default:()=>f});var a=r(71802),i=r(47153),o=r(56249),u=r(41649),s=r(44756),l=r(8807),d=r(73673),c=r.n(d),m=r(11185),p=r.n(m),g=r(69176);async function f(e,t){let r=await (0,u.getSession)({req:e});if(await (0,s.default)(),"GET"===e.method)try{let{page:r=1,limit:n=10,sort:a="createdAt",order:i="desc",contentType:o,featured:u,search:s,tags:d,genres:c}=e.query,m={};if(o&&(m.contentType=o),"true"===u&&(m.featured=!0),s&&(m.$or=[{title:{$regex:s,$options:"i"}},{originalTitle:{$regex:s,$options:"i"}},{summary:{$regex:s,$options:"i"}}]),d){let e=d.split(",").map(e=>e.trim());m.tags={$in:e}}if(c){let e=c.split(",").map(e=>e.trim());m.genres={$in:e}}let p=parseInt(r,10),g=parseInt(n,10),f=(p-1)*g,y="asc"===i.toLowerCase()?1:-1,h={};h[a]=y;let S=await l.default.find(m).select("title originalTitle slug contentType coverImage releaseDate reviewRating reviewCount featured genres tags status network createdAt updatedAt").sort(h).skip(f).limit(g),v=await l.default.countDocuments(m);return t.status(200).json({success:!0,data:S,pagination:{total:v,page:p,limit:g,pages:Math.ceil(v/g)}})}catch(e){return t.status(500).json({success:!1,message:e.message})}else if("POST"!==e.method)return t.setHeader("Allow",["GET","POST"]),t.status(405).json({success:!1,message:`Method ${e.method} not allowed`});else try{if(!r||r.user?.role!=="admin")return t.status(403).json({success:!1,message:"접근 권한이 없습니다."});let n=e.body;if(!n.title||!n.contentType||!n.summary||!n.content)return t.status(400).json({success:!1,message:"필수 정보가 누락되었습니다."});let a=n.slug;if(!a&&(a=c()(n.title,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g}),n.releaseDate)){let e=new Date(n.releaseDate).getFullYear();a=`${a}-${e}`}await l.default.findOne({slug:a})&&(a=`${a}-${Date.now().toString().substring(9)}`);let i=new l.default({...n,slug:a,reviewRating:0,reviewCount:0,createdAt:new Date,updatedAt:new Date}),o=await i.save();if(n.reviews&&n.reviews.length>0){let e=p().models.Review||p().model("Review",g.default),t=0,r=n.reviews.map(r=>{let a=new e({title:r.title,content:r.content,rating:r.rating,authorName:r.authorName,spoiler:r.spoiler||!1,tags:r.tags||[],approved:!0,featured:r.featured||!1,createdAt:new Date,updatedAt:new Date});return"drama"===n.contentType?a.dramaId=o._id:a.tvfilmId=o._id,t+=r.rating,a.save()});if(await Promise.all(r),n.reviews.length>0){let e=t/n.reviews.length;await l.default.findByIdAndUpdate(o._id,{reviewRating:e,reviewCount:n.reviews.length})}}return t.status(201).json({success:!0,message:"콘텐츠가 성공적으로 생성되었습니다.",contentId:o._id,slug:o.slug})}catch(e){return t.status(500).json({success:!1,message:"서버 오류가 발생했습니다."})}}let y=(0,o.hoist)(n,"default"),h=(0,o.hoist)(n,"config"),S=new a.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/content",pathname:"/api/content",bundlePath:"",filename:""},userland:n})},44756:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var n=r(11185),a=r.n(n);r(25142).config({path:".env.production"});let i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";i||(i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),i.includes("localhost")||(i.includes("mongodb://")&&!i.includes("authSource=")&&(i.includes("?")?i+="&authSource=admin":i+="?authSource=admin"),!i.includes("docdb.amazonaws.com")||i.includes("authMechanism=")||(i.includes("?")?i+="&authMechanism=SCRAM-SHA-1":i+="?authMechanism=SCRAM-SHA-1"));let o=i.includes("localhost")||i.includes("127.0.0.1"),u=global.mongoose;async function s(){if(u.conn&&1===a().connection.readyState)return u.conn;if(0===a().connection.readyState||3===a().connection.readyState){u.conn=null,u.promise=null;try{await a().connection.close()}catch(e){}}if(!u.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};o||(i.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),u.promise=a().connect(i,e).then(e=>(e.connection.on("error",e=>{u.conn=null,u.promise=null,setTimeout(()=>{s().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{u.conn=null,u.promise=null,setTimeout(()=>{s().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw u.promise=null,e})}try{return u.conn=await u.promise,u.conn}catch(e){throw u.promise=null,e}}u||(u=global.mongoose={conn:null,promise:null});let l=s},8807:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(11185),a=r.n(n);let i=new(a()).Schema({title:{type:String,required:[!0,"Please provide a title for this content"],maxlength:[200,"Title cannot be more than 200 characters"]},originalTitle:{type:String,required:!1},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this content"]},summary:{type:String,required:[!0,"Please provide a summary for this content"],maxlength:[1e3,"Summary cannot be more than 1000 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this content"]},bannerImage:{type:String,required:!1,default:""},trailerUrl:{type:String,required:!1,default:""},contentType:{type:String,required:[!0,"Please select a content type"],enum:["drama","movie","variety","documentary","other"]},status:{type:String,required:[!0,"Please select a status for this content"],enum:["ongoing","completed","upcoming","canceled"],default:"ongoing"},network:{type:String,required:!1},releaseDate:{type:Date,required:[!0,"Please provide a release date for this content"]},rating:{type:Number,required:!1,min:[0,"Rating cannot be less than 0"],max:[10,"Rating cannot be more than 10"],default:0},reviewRating:{type:Number,min:[0,"Review rating cannot be less than 0"],max:[10,"Review rating cannot be more than 10"],default:0},reviewCount:{type:Number,default:0},ratingDistribution:{type:[Number],default:[0,0,0,0,0,0,0,0,0,0],validate:{validator:function(e){return 10===e.length},message:"Rating distribution must have exactly 10 values"}},runtime:{type:String,required:!1},ageRating:{type:String,required:!1,enum:["ALL","12","15","18","R","PG-15","15세 이상"]},director:{type:String,required:!1},country:{type:String,required:!1},tags:{type:[String],default:[]},genres:{type:[String],default:[]},cast:{type:[{name:{type:String,required:!0},role:{type:String},image:{type:String},order:{type:Number,default:0}}],default:[]},watchProviders:{type:[{name:{type:String,required:!1},logo:{type:String},type:{type:String,enum:["subscription","rental","purchase","free"],required:!1},price:{type:String},quality:[String],url:{type:String},order:{type:Number,default:0}}],default:[]},videos:{type:[{title:{type:String},type:{type:String,enum:["trailer","teaser","ad","making-of","clip","interview","other"],required:!0},url:{type:String,required:!0},order:{type:Number,default:0}}],default:[]},author:{type:a().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},orderNumber:{type:Number,default:0,index:!0},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"ko"},translationOf:{type:a().Schema.Types.ObjectId,ref:"Content",default:null},views:{type:Number,default:0},likes:{type:Number,default:0},dislikes:{type:Number,default:0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.index({slug:1,lang:1},{unique:!0}),i.index({contentType:1}),i.index({featured:1}),i.index({releaseDate:-1}),i.index({createdAt:-1}),i.index({reviewRating:-1});let o=a().models.Content||a().model("Content",i)},69176:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(11185),a=r.n(n);let i=new(a()).Schema({reviewId:{type:String,required:!0,unique:!0},username:{type:String,required:!0},userProfileUrl:String,userImage:String,rating:{type:Number,default:0},title:{type:String,required:!0},reviewText:{type:String,required:!0},reviewHtml:String,reviewDate:String,helpfulCount:{type:Number,default:0},dramaId:{type:String,required:!0},sourceUrl:String,createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),o=a().models.Review||a().model("Review",i)},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=31933);module.exports=r})();