"use strict";(()=>{var e={};e.id=5194,e.ids=[5194],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},45616:e=>{e.exports=import("next-connect")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},29212:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var a=n(71802),r=n(47153),i=n(56249),s=n(42838),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,i.hoist)(s,"default"),u=(0,i.hoist)(s,"config"),d=new a.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/dramas/search",pathname:"/api/dramas/search",bundlePath:"",filename:""},userland:s});o()}catch(e){o(e)}})},44756:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var o=n(11185),a=n.n(o);n(25142).config({path:".env.production"});let r="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";r||(r="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),r.includes("localhost")||(r.includes("mongodb://")&&!r.includes("authSource=")&&(r.includes("?")?r+="&authSource=admin":r+="?authSource=admin"),!r.includes("docdb.amazonaws.com")||r.includes("authMechanism=")||(r.includes("?")?r+="&authMechanism=SCRAM-SHA-1":r+="?authMechanism=SCRAM-SHA-1"));let i=r.includes("localhost")||r.includes("127.0.0.1"),s=global.mongoose;async function c(){if(s.conn&&1===a().connection.readyState)return s.conn;if(0===a().connection.readyState||3===a().connection.readyState){s.conn=null,s.promise=null;try{await a().connection.close()}catch(e){}}if(!s.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};i||(r.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),s.promise=a().connect(r,e).then(e=>(e.connection.on("error",e=>{s.conn=null,s.promise=null,setTimeout(()=>{c().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{s.conn=null,s.promise=null,setTimeout(()=>{c().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw s.promise=null,e})}try{return s.conn=await s.promise,s.conn}catch(e){throw s.promise=null,e}}s||(s=global.mongoose={conn:null,promise:null});let l=c},42838:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{default:()=>c});var a=n(45616),r=n(44756);n(11185);var i=e([a]);a=(i.then?(await i)():i)[0];let s=(0,a.default)();s.get(async(e,t)=>{try{await (0,r.default)();let{q:n,page:o=1,limit:a=10,genre:i,status:s,sort:c="createdAt",order:l="desc",fields:u}=e.query,d=parseInt(o),m=parseInt(a);if(isNaN(d)||d<1)return t.status(400).json({success:!1,message:"Invalid page number"});if(isNaN(m)||m<1||m>50)return t.status(400).json({success:!1,message:"Invalid limit (must be between 1 and 50)"});let p={};if(n){let e=RegExp(n,"i");p.$or=[{title:e},{alternativeTitle:e},{originalTitle:e},{description:e},{slug:e}]}if(i){let e=i.split(",").map(e=>e.trim());1===e.length?p.genres=i:p.genres={$in:e}}if(s){let e=s.split(",").map(e=>e.trim());1===e.length?p.status=s:p.status={$in:e}}let h={};u&&u.split(",").map(e=>e.trim()).forEach(e=>{h[e]=1});let f=(d-1)*m,g=["title","createdAt","updatedAt","releaseDate","rating"].includes(c)?c:"createdAt",A={};A[g]="asc"===l?1:-1;let S=await Drama.find(p,h).sort(A).skip(f).limit(m),P=await Drama.countDocuments(p);return t.status(200).json({success:!0,data:{dramas:S,pagination:{total:P,page:d,limit:m,pages:Math.ceil(P/m)},query:{searchTerm:n||null,genre:i||null,status:s||null,sort:g,order:l}}})}catch(e){return t.status(500).json({success:!1,message:"Server error during search",error:void 0})}});let c=s;o()}catch(e){o(e)}})},47153:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},71802:(e,t,n)=>{e.exports=n(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=29212);module.exports=n})();