"use strict";(()=>{var e={};e.id=6206,e.ids=[6206],e.modules={84802:e=>{e.exports=require("cookie")},25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},44020:(e,t,r)=>{r.r(t),r.d(t,{config:()=>g,default:()=>y,routeModule:()=>f});var n={};r.r(n),r.d(n,{default:()=>p});var i=r(71802),a=r(47153),s=r(56249),o=r(41649),u=r(44756),d=r(81075),l=r(74053),c=r(84802),m=r.n(c);async function p(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,message:"Method not allowed"});try{let{contentId:r,type:n}=e.body;if(!r||!n)return t.status(400).json({success:!1,message:"Content ID and type are required"});let i=await (0,o.getSession)({req:e});if(!i)try{let n=e.headers.cookie?m().parse(e.headers.cookie):{},i={},a={};try{i=n.likes?JSON.parse(n.likes):{}}catch(e){i={}}try{a=n.dislikes?JSON.parse(n.dislikes):{}}catch(e){a={}}let s=!0===a[r];s?delete a[r]:(a[r]=!0,i[r]&&delete i[r]);let o=JSON.stringify(i),d=JSON.stringify(a);t.setHeader("Set-Cookie",[m().serialize("likes",o,{maxAge:2592e3,path:"/",httpOnly:!1}),m().serialize("dislikes",d,{maxAge:2592e3,path:"/",httpOnly:!1})]),await (0,u.default)();let c=await l.default.findById(r);if(!c)return t.status(404).json({success:!1,message:"Content not found"});return s?c.dislikesCount=Math.max((c.dislikesCount||0)-1,0):(c.dislikesCount=(c.dislikesCount||0)+1,void 0===i[r]&&n.likes&&!0===JSON.parse(n.likes)[r]&&(c.likesCount=Math.max((c.likesCount||0)-1,0))),await c.save(),t.status(200).json({success:!0,disliked:!s,message:s?"Dislike removed":"Content disliked"})}catch(e){return t.status(500).json({success:!1,message:"Error processing dislike"})}try{await (0,u.default)();let e=await d.default.findById(i.user.id),a=await l.default.findById(r);if(!e)return t.status(404).json({success:!1,message:"User not found"});if(!a)return t.status(404).json({success:!1,message:"Content not found"});e.likes||(e.likes=[]),e.dislikes||(e.dislikes=[]);let s=e.dislikes.findIndex(e=>e.contentId&&e.contentId.toString()===r&&e.contentType===n),o=-1!==s;if(o)e.dislikes.splice(s,1),a.dislikesCount=Math.max((a.dislikesCount||0)-1,0);else{e.dislikes.push({contentId:r,contentType:n}),a.dislikesCount=(a.dislikesCount||0)+1;let t=e.likes.findIndex(e=>e.contentId&&e.contentId.toString()===r&&e.contentType===n);-1!==t&&(e.likes.splice(t,1),a.likesCount=Math.max((a.likesCount||0)-1,0))}return await e.save(),await a.save(),t.status(200).json({success:!0,disliked:!o,message:o?"Dislike removed":"Content disliked"})}catch(e){return t.status(500).json({success:!1,message:"Database error"})}}catch(e){return t.status(500).json({success:!1,message:"Server error"})}}let y=(0,s.hoist)(n,"default"),g=(0,s.hoist)(n,"config"),f=new i.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/user/dislike",pathname:"/api/user/dislike",bundlePath:"",filename:""},userland:n})},44756:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var n=r(11185),i=r.n(n);r(25142).config({path:".env.production"});let a="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";a||(a="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),a.includes("localhost")||(a.includes("mongodb://")&&!a.includes("authSource=")&&(a.includes("?")?a+="&authSource=admin":a+="?authSource=admin"),!a.includes("docdb.amazonaws.com")||a.includes("authMechanism=")||(a.includes("?")?a+="&authMechanism=SCRAM-SHA-1":a+="?authMechanism=SCRAM-SHA-1"));let s=a.includes("localhost")||a.includes("127.0.0.1"),o=global.mongoose;async function u(){if(o.conn&&1===i().connection.readyState)return o.conn;if(0===i().connection.readyState||3===i().connection.readyState){o.conn=null,o.promise=null;try{await i().connection.close()}catch(e){}}if(!o.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};s||(a.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),o.promise=i().connect(a,e).then(e=>(e.connection.on("error",e=>{o.conn=null,o.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{o.conn=null,o.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw o.promise=null,e})}try{return o.conn=await o.promise,o.conn}catch(e){throw o.promise=null,e}}o||(o=global.mongoose={conn:null,promise:null});let d=u},74053:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var n=r(11185),i=r.n(n);let a=new(i()).Schema({title:{type:String,required:[!0,"Please provide a title for this TV/Film"],maxlength:[200,"Title cannot be more than 200 characters"]},originalTitle:{type:String,required:!1},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this TV/Film"]},summary:{type:String,required:[!0,"Please provide a summary for this TV/Film"],maxlength:[1e3,"Summary cannot be more than 1000 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this TV/Film"]},bannerImage:{type:String,required:!1,default:""},trailerUrl:{type:String,required:!1,default:""},category:{type:String,required:[!0,"Please select a category for this TV/Film"],enum:["drama","movie","variety","documentary","other"]},status:{type:String,required:[!0,"Please select a status for this TV/Film"],enum:["ongoing","completed","upcoming","canceled"],default:"ongoing"},network:{type:String,required:!1},releaseDate:{type:Date,required:[!0,"Please provide a release date for this TV/Film"]},rating:{type:Number,required:!1,min:[0,"Rating cannot be less than 0"],max:[10,"Rating cannot be more than 10"],default:0},reviewRating:{type:Number,min:[0,"Review rating cannot be less than 0"],max:[10,"Review rating cannot be more than 10"],default:0},reviewCount:{type:Number,default:0},ratingDistribution:{type:[Number],default:[0,0,0,0,0,0,0,0,0,0],validate:{validator:function(e){return 10===e.length},message:"Rating distribution must have exactly 10 values"}},runtime:{type:String,required:!1},ageRating:{type:String,required:!1,enum:["ALL","12","15","18","R"]},director:{type:String,required:!1},country:{type:String,required:!1},tags:{type:[String],default:[]},genres:{type:[String],default:[]},cast:{type:[{name:{type:String,required:!0},role:{type:String},image:{type:String},order:{type:Number,default:0}}],default:[]},watchProviders:{type:[{name:{type:String,required:!0},logo:{type:String},type:{type:String,enum:["subscription","rental","purchase","free"],required:!0},price:{type:String},quality:[String],url:{type:String},order:{type:Number,default:0}}],default:[]},videos:{type:[{title:{type:String},type:{type:String,enum:["trailer","teaser","ad","making-of","clip","interview","other"],required:!0},url:{type:String,required:!0},order:{type:Number,default:0}}],default:[]},author:{type:i().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},orderNumber:{type:Number,default:0,index:!0},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"en"},translationOf:{type:i().Schema.Types.ObjectId,ref:"TVFilm",default:null},views:{type:Number,default:0},likes:{type:Number,default:0},dislikes:{type:Number,default:0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),s=i().models.TVFilm||i().model("TVFilm",a)},81075:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var n=r(11185),i=r.n(n);let a=new(i()).Schema({name:{type:String,required:[!0,"Please provide a name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0},password:{type:String,required:[!0,"Please provide a password"]},image:{type:String,default:"/images/default-avatar.png"},role:{type:String,enum:["user","admin","editor"],default:"user"},likes:{type:[{contentId:{type:i().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},dislikes:{type:[{contentId:{type:i().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},bookmarks:{type:[{contentId:{type:i().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),s=i().models.User||i().model("User",a)},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=44020);module.exports=r})();