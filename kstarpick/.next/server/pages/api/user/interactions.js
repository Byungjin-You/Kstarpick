"use strict";(()=>{var e={};e.id=4259,e.ids=[4259],e.modules={84802:e=>{e.exports=require("cookie")},25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},11891:(e,t,n)=>{n.r(t),n.d(t,{config:()=>h,default:()=>f,routeModule:()=>y});var o={};n.r(o),n.d(o,{default:()=>k});var s=n(71802),a=n(47153),r=n(56249),i=n(41649),c=n(44756),u=n(81075),d=n(84802),l=n.n(d),m=n(11185),p=n.n(m);async function k(e,t){if("GET"!==e.method)return t.status(405).json({success:!1,message:"Method not allowed"});try{let{contentId:n,type:o}=e.query;if(!n||!o)return t.status(400).json({success:!1,message:"Content ID and type are required"});let s=await (0,i.getSession)({req:e});if(!s)try{let o=e.headers.cookie?l().parse(e.headers.cookie):{},s={},a={},r={};try{s=o.likes?JSON.parse(o.likes):{}}catch(e){s={}}try{a=o.dislikes?JSON.parse(o.dislikes):{}}catch(e){a={}}try{r=o.bookmarks?JSON.parse(o.bookmarks):{}}catch(e){r={}}let i=!0===s[n],c=!0===a[n],u=!0===r[n];return t.status(200).json({success:!0,liked:i,disliked:c,bookmarked:u})}catch(e){return t.status(200).json({success:!0,liked:!1,disliked:!1,bookmarked:!1})}try{let e=0,a=null;for(;e<3&&!a;)try{e++,a=await (0,c.default)()}catch(n){if(!(e<3))return t.status(200).json({success:!0,liked:!1,disliked:!1,bookmarked:!1,message:"Database connection failed, returning defaults"});await new Promise(e=>setTimeout(e,2e3))}if(1!==p().connection.readyState)return t.status(200).json({success:!0,liked:!1,disliked:!1,bookmarked:!1,message:"Database not connected, returning defaults"});let r=await u.default.findById(s.user.id);if(!r)return t.status(200).json({success:!0,liked:!1,disliked:!1,bookmarked:!1,message:"User not found, but request succeeded"});let i=(r.likes||[]).some(e=>e.contentId&&e.contentId.toString()===n&&e.contentType===o),d=(r.dislikes||[]).some(e=>e.contentId&&e.contentId.toString()===n&&e.contentType===o),l=(r.bookmarks||[]).some(e=>e.contentId&&e.contentId.toString()===n&&e.contentType===o);return t.status(200).json({success:!0,liked:i,disliked:d,bookmarked:l})}catch(o){try{let o=e.headers.cookie?l().parse(e.headers.cookie):{},s={},a={},r={};try{s=o.likes?JSON.parse(o.likes):{}}catch(e){s={}}try{a=o.dislikes?JSON.parse(o.dislikes):{}}catch(e){a={}}try{r=o.bookmarks?JSON.parse(o.bookmarks):{}}catch(e){r={}}let i=!0===s[n],c=!0===a[n],u=!0===r[n];return t.status(200).json({success:!0,liked:i,disliked:c,bookmarked:u,message:"Using cookie values due to database error"})}catch(e){return t.status(200).json({success:!0,liked:!1,disliked:!1,bookmarked:!1,message:"Error processing database and cookies, using defaults"})}}}catch(e){return t.status(500).json({success:!1,message:"Server error"})}}let f=(0,r.hoist)(o,"default"),h=(0,r.hoist)(o,"config"),y=new s.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/user/interactions",pathname:"/api/user/interactions",bundlePath:"",filename:""},userland:o})},44756:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var o=n(11185),s=n.n(o);n(25142).config({path:".env.production"});let a="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";a||(a="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),a.includes("localhost")||(a.includes("mongodb://")&&!a.includes("authSource=")&&(a.includes("?")?a+="&authSource=admin":a+="?authSource=admin"),!a.includes("docdb.amazonaws.com")||a.includes("authMechanism=")||(a.includes("?")?a+="&authMechanism=SCRAM-SHA-1":a+="?authMechanism=SCRAM-SHA-1"));let r=a.includes("localhost")||a.includes("127.0.0.1"),i=global.mongoose;async function c(){if(i.conn&&1===s().connection.readyState)return i.conn;if(0===s().connection.readyState||3===s().connection.readyState){i.conn=null,i.promise=null;try{await s().connection.close()}catch(e){}}if(!i.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};r||(a.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),i.promise=s().connect(a,e).then(e=>(e.connection.on("error",e=>{i.conn=null,i.promise=null,setTimeout(()=>{c().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{i.conn=null,i.promise=null,setTimeout(()=>{c().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw i.promise=null,e})}try{return i.conn=await i.promise,i.conn}catch(e){throw i.promise=null,e}}i||(i=global.mongoose={conn:null,promise:null});let u=c},81075:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var o=n(11185),s=n.n(o);let a=new(s()).Schema({name:{type:String,required:[!0,"Please provide a name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0},password:{type:String,required:[!0,"Please provide a password"]},image:{type:String,default:"/images/default-avatar.png"},role:{type:String,enum:["user","admin","editor"],default:"user"},likes:{type:[{contentId:{type:s().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},dislikes:{type:[{contentId:{type:s().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},bookmarks:{type:[{contentId:{type:s().Schema.Types.ObjectId,required:!0},contentType:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],default:[]},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),r=s().models.User||s().model("User",a)},47153:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},71802:(e,t,n)=>{e.exports=n(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=11891);module.exports=n})();