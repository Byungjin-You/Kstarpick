"use strict";(()=>{var e={};e.id=4835,e.ids=[4835],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},73673:e=>{e.exports=require("slugify")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},52946:(e,t,n)=>{n.r(t),n.d(t,{config:()=>S,default:()=>h,routeModule:()=>v});var r={};n.r(r),n.d(r,{default:()=>y});var a=n(71802),i=n(47153),s=n(56249),o=n(41649),u=n(44756),d=n(8807),c=n(11185),l=n.n(c);let m=new(l()).Schema({content:{type:l().Schema.Types.ObjectId,ref:"Content",required:[!0,"Content ID is required"]},author:{type:l().Schema.Types.ObjectId,ref:"User",required:[!0,"Author is required"]},authorName:{type:String,required:[!0,"Author name is required"]},rating:{type:Number,required:[!0,"Rating is required"],min:[1,"Rating must be at least 1"],max:[10,"Rating cannot be more than 10"]},title:{type:String,required:[!0,"Review title is required"],maxlength:[200,"Review title cannot be more than 200 characters"]},content:{type:String,required:[!0,"Review content is required"],maxlength:[5e3,"Review content cannot be more than 5000 characters"]},isCritic:{type:Boolean,default:!1},likes:{type:Number,default:0},dislikes:{type:Number,default:0},spoiler:{type:Boolean,default:!1},featured:{type:Boolean,default:!1},approved:{type:Boolean,default:!0},reportCount:{type:Number,default:0},tags:{type:[String],default:[]},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});m.index({content:1,author:1},{unique:!0}),m.index({content:1,featured:1}),m.index({content:1,createdAt:-1}),m.index({author:1,createdAt:-1}),m.index({approved:1}),m.index({isCritic:1});let p=l().models.ContentReview||l().model("ContentReview",m);var g=n(73673),f=n.n(g);async function y(e,t){let{id:n}=e.query,r=await (0,o.getSession)({req:e});if(await (0,u.default)(),!n)return t.status(400).json({success:!1,message:"Content ID is required"});if("GET"===e.method)try{let e;if(!(e=n.match(/^[0-9a-fA-F]{24}$/)?await d.default.findById(n):await d.default.findOne({slug:n})))return t.status(404).json({success:!1,message:"Content not found"});try{e.views+=1,e.ageRating&&!["ALL","12","15","18","R"].includes(e.ageRating)&&(e.ageRating="ALL"),e.watchProviders&&Array.isArray(e.watchProviders)&&(e.watchProviders=e.watchProviders.map(e=>(e.name||(e.name="Unknown"),e.type||(e.type="subscription"),e))),await d.default.findByIdAndUpdate(e._id,{views:e.views,ageRating:e.ageRating,watchProviders:e.watchProviders})}catch(e){}return t.status(200).json({success:!0,data:e})}catch(e){return t.status(500).json({success:!1,message:e.message})}else if("PUT"===e.method){if(!r||!r.user.role||!["admin","editor"].includes(r.user.role))return t.status(403).json({success:!1,message:"콘텐츠 수정 권한이 없습니다."});try{let r=await d.default.findById(n);if(!r)return t.status(404).json({success:!1,message:"Content not found"});let{title:a,originalTitle:i,contentType:s,content:o,summary:u,coverImage:c,releaseDate:l,status:m,network:p,director:g,country:y,runtime:h,ageRating:S,tags:v,genres:w,cast:b,featured:q,bannerImage:P,trailerUrl:A,watchProviders:R,videos:x}=e.body;if(!a)return t.status(400).json({success:!1,message:"제목은 필수입니다."});if(!s)return t.status(400).json({success:!1,message:"콘텐츠 타입은 필수입니다."});if(!o)return t.status(400).json({success:!1,message:"내용은 필수입니다."});if(!u)return t.status(400).json({success:!1,message:"요약은 필수입니다."});if(!c)return t.status(400).json({success:!1,message:"커버 이미지는 필수입니다."});if(!l)return t.status(400).json({success:!1,message:"출시일은 필수입니다."});let j=r.slug;a!==r.title&&(j=f()(a,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g}),await d.default.findOne({slug:j,_id:{$ne:n},lang:r.lang})&&(j=`${j}-${Date.now().toString().slice(-4)}`));let k=await d.default.findByIdAndUpdate(n,{title:a,originalTitle:i||"",slug:j,contentType:s,content:o,summary:u,coverImage:c,bannerImage:P||"",trailerUrl:A||"",releaseDate:l,status:m||"ongoing",network:p||"",director:g||"",country:y||"",runtime:h||"",ageRating:S||"",tags:v||[],genres:w||[],cast:b||[],watchProviders:R||[],videos:x||[],featured:!0===q,updatedAt:new Date},{new:!0});return t.status(200).json({success:!0,data:k})}catch(e){return t.status(500).json({success:!1,message:e.message})}}else if("DELETE"!==e.method)return t.setHeader("Allow",["GET","PUT","DELETE"]),t.status(405).json({success:!1,message:`Method ${e.method} not allowed`});else try{if(!await d.default.findById(n))return t.status(404).json({success:!1,message:"Content not found"});return await p.deleteMany({content:n}),await d.default.findByIdAndDelete(n),t.status(200).json({success:!0,message:"콘텐츠가 성공적으로 삭제되었습니다."})}catch(e){return t.status(500).json({success:!1,message:e.message})}}let h=(0,s.hoist)(r,"default"),S=(0,s.hoist)(r,"config"),v=new a.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/content/[id]",pathname:"/api/content/[id]",bundlePath:"",filename:""},userland:r})},44756:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(11185),a=n.n(r);n(25142).config({path:".env.production"});let i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";i||(i="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),i.includes("localhost")||(i.includes("mongodb://")&&!i.includes("authSource=")&&(i.includes("?")?i+="&authSource=admin":i+="?authSource=admin"),!i.includes("docdb.amazonaws.com")||i.includes("authMechanism=")||(i.includes("?")?i+="&authMechanism=SCRAM-SHA-1":i+="?authMechanism=SCRAM-SHA-1"));let s=i.includes("localhost")||i.includes("127.0.0.1"),o=global.mongoose;async function u(){if(o.conn&&1===a().connection.readyState)return o.conn;if(0===a().connection.readyState||3===a().connection.readyState){o.conn=null,o.promise=null;try{await a().connection.close()}catch(e){}}if(!o.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};s||(i.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),o.promise=a().connect(i,e).then(e=>(e.connection.on("error",e=>{o.conn=null,o.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{o.conn=null,o.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw o.promise=null,e})}try{return o.conn=await o.promise,o.conn}catch(e){throw o.promise=null,e}}o||(o=global.mongoose={conn:null,promise:null});let d=u},8807:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var r=n(11185),a=n.n(r);let i=new(a()).Schema({title:{type:String,required:[!0,"Please provide a title for this content"],maxlength:[200,"Title cannot be more than 200 characters"]},originalTitle:{type:String,required:!1},slug:{type:String,required:!0,unique:!0},content:{type:String,required:[!0,"Please provide content for this content"]},summary:{type:String,required:[!0,"Please provide a summary for this content"],maxlength:[1e3,"Summary cannot be more than 1000 characters"]},coverImage:{type:String,required:[!0,"Please provide a cover image for this content"]},bannerImage:{type:String,required:!1,default:""},trailerUrl:{type:String,required:!1,default:""},contentType:{type:String,required:[!0,"Please select a content type"],enum:["drama","movie","variety","documentary","other"]},status:{type:String,required:[!0,"Please select a status for this content"],enum:["ongoing","completed","upcoming","canceled"],default:"ongoing"},network:{type:String,required:!1},releaseDate:{type:Date,required:[!0,"Please provide a release date for this content"]},rating:{type:Number,required:!1,min:[0,"Rating cannot be less than 0"],max:[10,"Rating cannot be more than 10"],default:0},reviewRating:{type:Number,min:[0,"Review rating cannot be less than 0"],max:[10,"Review rating cannot be more than 10"],default:0},reviewCount:{type:Number,default:0},ratingDistribution:{type:[Number],default:[0,0,0,0,0,0,0,0,0,0],validate:{validator:function(e){return 10===e.length},message:"Rating distribution must have exactly 10 values"}},runtime:{type:String,required:!1},ageRating:{type:String,required:!1,enum:["ALL","12","15","18","R","PG-15","15세 이상"]},director:{type:String,required:!1},country:{type:String,required:!1},tags:{type:[String],default:[]},genres:{type:[String],default:[]},cast:{type:[{name:{type:String,required:!0},role:{type:String},image:{type:String},order:{type:Number,default:0}}],default:[]},watchProviders:{type:[{name:{type:String,required:!1},logo:{type:String},type:{type:String,enum:["subscription","rental","purchase","free"],required:!1},price:{type:String},quality:[String],url:{type:String},order:{type:Number,default:0}}],default:[]},videos:{type:[{title:{type:String},type:{type:String,enum:["trailer","teaser","ad","making-of","clip","interview","other"],required:!0},url:{type:String,required:!0},order:{type:Number,default:0}}],default:[]},author:{type:a().Schema.Types.ObjectId,ref:"User",required:!0},featured:{type:Boolean,default:!1},orderNumber:{type:Number,default:0,index:!0},lang:{type:String,required:!0,enum:["en","ko","ja","zh","es"],default:"ko"},translationOf:{type:a().Schema.Types.ObjectId,ref:"Content",default:null},views:{type:Number,default:0},likes:{type:Number,default:0},dislikes:{type:Number,default:0},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.index({slug:1,lang:1},{unique:!0}),i.index({contentType:1}),i.index({featured:1}),i.index({releaseDate:-1}),i.index({createdAt:-1}),i.index({reviewRating:-1});let s=a().models.Content||a().model("Content",i)},47153:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},71802:(e,t,n)=>{e.exports=n(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=52946);module.exports=n})();