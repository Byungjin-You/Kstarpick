"use strict";(()=>{var e={};e.id=6930,e.ids=[6930],e.modules={25142:e=>{e.exports=require("dotenv")},11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},73673:e=>{e.exports=require("slugify")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},80224:(e,t,i)=>{i.r(t),i.d(t,{config:()=>d,default:()=>p,routeModule:()=>m});var o={};i.r(o),i.d(o,{default:()=>c});var n=i(71802),s=i(47153),r=i(56249),a=i(44756),u=i(33151),l=i(1241);async function c(e,t){if("GET"!==e.method)return t.status(405).json({success:!1,message:"Method Not Allowed"});try{await (0,a.default)();let{limit:i=10}=e.query,o=parseInt(i),n=await u.default.find({status:"active"}).sort({position:1}).limit(o).lean();if(0===n.length){let e=await u.default.find({status:"active"}).sort({dailyViews:-1}).limit(o).lean();e.length>0&&(n=e.map((e,t)=>({...e,position:t+1,previousPosition:t+1})))}let s=n.map((e,t)=>{let i=(e,t=0)=>{if("number"==typeof e)return e;let i=parseInt(e);return isNaN(i)?t:i},o=i(e.dailyViews||e.dailyview||e.dailyView,Math.round(.02*i(e.views))),n=t+1;if(void 0!==e.position&&null!==e.position){let t=i(e.position,0);t>0&&t<=100&&(n=t)}let s=n;if(void 0!==e.previousPosition&&null!==e.previousPosition){let t=i(e.previousPosition,0);t>0&&t<=100&&(s=t)}return{_id:e._id,title:(0,l.decodeHtmlEntities)(e.title)||"",artist:(0,l.decodeHtmlEntities)(e.artist)||"",position:n,previousPosition:s,coverImage:e.coverImage||"",dailyViews:o,totalViews:i(e.views),releaseDate:e.releaseDate,slug:e.slug||"",youtubeUrl:e.musicVideo||"",album:e.album||""}}).sort((e,t)=>e.position-t.position);return t.status(200).json({success:!0,count:s.length,data:s})}catch(e){return t.status(500).json({success:!1,message:"서버 오류가 발생했습니다.",error:e.message})}}let p=(0,r.hoist)(o,"default"),d=(0,r.hoist)(o,"config"),m=new n.PagesAPIRouteModule({definition:{kind:s.RouteKind.PAGES_API,page:"/api/music/popular",pathname:"/api/music/popular",bundlePath:"",filename:""},userland:o})},44756:(e,t,i)=>{i.r(t),i.d(t,{default:()=>l});var o=i(11185),n=i.n(o);i(25142).config({path:".env.production"});let s="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1";s||(s="mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?authSource=admin"),s.includes("localhost")||(s.includes("mongodb://")&&!s.includes("authSource=")&&(s.includes("?")?s+="&authSource=admin":s+="?authSource=admin"),!s.includes("docdb.amazonaws.com")||s.includes("authMechanism=")||(s.includes("?")?s+="&authMechanism=SCRAM-SHA-1":s+="?authMechanism=SCRAM-SHA-1"));let r=s.includes("localhost")||s.includes("127.0.0.1"),a=global.mongoose;async function u(){if(a.conn&&1===n().connection.readyState)return a.conn;if(0===n().connection.readyState||3===n().connection.readyState){a.conn=null,a.promise=null;try{await n().connection.close()}catch(e){}}if(!a.promise){let e={maxPoolSize:10,serverSelectionTimeoutMS:1e4,socketTimeoutMS:45e3,connectTimeoutMS:1e4,family:4,heartbeatFrequencyMS:1e4};r||(s.includes("docdb.amazonaws.com")&&(e.tls=!1,e.tlsAllowInvalidCertificates=!0,e.tlsAllowInvalidHostnames=!0),e.authSource="admin"),a.promise=n().connect(s,e).then(e=>(e.connection.on("error",e=>{a.conn=null,a.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},5e3)}),e.connection.on("disconnected",()=>{a.conn=null,a.promise=null,setTimeout(()=>{u().catch(e=>console.error("[Mongoose] Reconnection failed:",e))},3e3)}),e)).catch(e=>{throw a.promise=null,e})}try{return a.conn=await a.promise,a.conn}catch(e){throw a.promise=null,e}}a||(a=global.mongoose={conn:null,promise:null});let l=u},33151:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var o=i(11185),n=i.n(o),s=i(73673),r=i.n(s);let a=new(n()).Schema({title:{type:String,required:[!0,"음악 제목을 입력해주세요."],trim:!0},slug:{type:String,unique:!0,index:!0},artist:{type:String,required:[!0,"아티스트 이름을 입력해주세요."],trim:!0},album:{type:String,trim:!0},releaseDate:{type:Date,required:[!0,"발매일을 입력해주세요."]},genre:{type:[String],required:[!0,"적어도 하나의 장르를 선택해주세요."],enum:["kpop","ballad","dance","hiphop","rnb","rock","indie","trot","ost"]},description:{type:String,trim:!0},lyrics:{type:String,trim:!0},coverImage:{type:String,required:[!0,"앨범 커버 이미지를 입력해주세요."]},audioUrl:{type:String},musicVideo:{type:String},position:{type:Number,default:99},previousPosition:{type:Number,default:99},featured:{type:Boolean,default:!1},likes:{type:Number,default:0},views:{type:Number,default:0},dailyViews:{type:Number,default:0},dailyview:{type:Number,default:0},dailyView:{type:Number,default:0},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});a.pre("save",function(e){(this.isModified("title")||!this.slug)&&(this.slug=r()(`${this.title}-${this.artist}`,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g})),e()}),a.pre("save",function(e){void 0===this.position||null===this.position||isNaN(this.position)?this.position=99:"number"!=typeof this.position&&(this.position=parseInt(this.position)||99),void 0===this.previousPosition||null===this.previousPosition||isNaN(this.previousPosition)?this.previousPosition=this.position:"number"!=typeof this.previousPosition&&(this.previousPosition=parseInt(this.previousPosition)||this.position),e()}),a.set("toJSON",{transform:function(e,t){return void 0===t.position||null===t.position||isNaN(t.position)?t.position=99:"number"!=typeof t.position&&(t.position=parseInt(t.position)||99),void 0===t.previousPosition||null===t.previousPosition||isNaN(t.previousPosition)?t.previousPosition=t.position:"number"!=typeof t.previousPosition&&(t.previousPosition=parseInt(t.previousPosition)||t.position),t}});let u=n().models.Music||n().model("Music",a)},1241:(e,t,i)=>{function o(e){if(!e)return"";if("undefined"==typeof document)return e.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");{let t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}i.r(t),i.d(t,{decodeHtmlEntities:()=>o})},47153:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},71802:(e,t,i)=>{e.exports=i(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=80224);module.exports=i})();