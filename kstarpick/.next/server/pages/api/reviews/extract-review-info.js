"use strict";(()=>{var e={};e.id=5516,e.ids=[5516],e.modules={41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},53956:(e,t,i)=>{i.r(t),i.d(t,{config:()=>d,default:()=>u,routeModule:()=>m});var s={};i.r(s),i.d(s,{default:()=>c,extractReviewInfo:()=>o});var r=i(71802),a=i(47153),n=i(56249),l=i(41649);async function c(e,t){try{{let i=await (0,l.getSession)({req:e});if(!i||"admin"!==i.user.role)return t.status(401).json({success:!1,message:"관리자 권한이 필요합니다."})}if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});let{rawText:i}=e.body;if(!i)return t.status(400).json({success:!1,message:"리뷰 텍스트가 필요합니다."});let s=o(i);return t.status(200).json({success:!0,message:"리뷰 정보를 추출했습니다.",data:s})}catch(e){return t.status(500).json({success:!1,message:"리뷰 정보 추출 중 오류가 발생했습니다.",error:e.message})}}function o(e){let t={username:"",userProfileUrl:"",rating:0,title:"",reviewText:"",storyRating:0,actingRating:0,musicRating:0,rewatchRating:0},i=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0),s=[...e.matchAll(/(\d+(\.\d+)?)\s*\/\s*10/g),...e.matchAll(/Rating:\s*(\d+(\.\d+)?)/gi),...e.matchAll(/Score:\s*(\d+(\.\d+)?)/gi),...e.matchAll(/rated\s+it\s+(\d+(\.\d+)?)/gi)];s.length>0&&(t.rating=parseFloat(s[0][1]));let r=e.match(/^([A-Za-z0-9_\-.]+)\s+rated\s+it/);if(r)t.username=r[1];else{let s=e.match(/Review\s+by\s+([A-Za-z0-9_\-.]+)/i);if(s)t.username=s[1];else if(i.length>0&&i[0].length<30){let e=i[0].split(/\s+/);e.length<=3&&e[0].match(/^[A-Za-z0-9_\-.]+$/)&&(t.username=e[0])}}let a=!1,n=[],l=-1;for(let e=0;e<i.length;e++){let t=!1,s=i[e].match(/(.*?)\b(?:Rating|Score|rated)(?:\s+it)?(?:\s*:\s*)(\d+(?:\.\d+)?)(?:\/(?:10|\d+))?(.*)$/i);if(s){let r=s[1]||"",a=s[3]||"";i[e]=(r+" "+a).trim(),t=!0}if(!t){let t=i[e].match(/(.*?)\bdeserves\b.*?(\d+(?:\.\d+)?)(?:\/(?:10|\d+))?(.*)$/i);if(t){let s=t[1]||"",r=t[3]||"";i[e]=(s+" "+r).trim()}}}for(let e=0;e<i.length;e++){if(i[e].match(/^\s*rating|^\s*score|^\s*overall|^\s*story|^\s*acting|^\s*music|^\s*rewatch/i)||i[e].match(/rated\s+it|review\s+by/i)||t.username&&i[e].startsWith(t.username))continue;let s=i[e].match(/^["'](.+)["']$/);if(s){t.title=s[1],a=!0,n=i.slice(e+1);break}if(-1===l&&(l=e,i[e].length<50&&!i[e].includes(".")&&i.length>e+1)){t.title=i[e],a=!0,n=i.slice(e+1);break}}if(!a&&-1!==l){let e=i[l],s=e.match(/^([^.!?]+[.!?])/);s?(t.title=s[1].trim(),n=[e.substring(s[0].length).trim(),...i.slice(l+1)]):(e.length>50?t.title=e.substring(0,47)+"...":t.title=e,n=i.slice(l+1))}if(n.length>0)n=n.filter(e=>!(e.match(/^\s*(overall|story|acting|music|rewatch|rating|score)/i)&&e.match(/\d+(\.\d+)?/))&&!e.match(/read more|show more|see more|continue reading/i)),t.reviewText=n.join("\n\n");else if(!a&&i.length>0){t.title="Review";let e=i.filter(e=>!(e.match(/^\s*(overall|story|acting|music|rewatch|rating|score)/i)&&e.match(/\d+(\.\d+)?/))&&!e.match(/read more|show more|see more|continue reading/i)&&!(t.username&&e.startsWith(t.username))&&!e.match(/rated\s+it|review\s+by/i));t.reviewText=e.join("\n\n")}let c=e.match(/Story:\s*(\d+(\.\d+)?)/i),o=e.match(/Acting[^:]*:\s*(\d+(\.\d+)?)/i),u=e.match(/Music:\s*(\d+(\.\d+)?)/i),d=e.match(/Rewatch[^:]*:\s*(\d+(\.\d+)?)/i);return c&&(t.storyRating=parseFloat(c[1])),o&&(t.actingRating=parseFloat(o[1])),u&&(t.musicRating=parseFloat(u[1])),d&&(t.rewatchRating=parseFloat(d[1])),t.username||(t.username="Unknown User"),0===t.rating&&(t.rating=5),t.title||(t.title="Review"),t.reviewText.length<10&&t.title.length>20&&(t.reviewText=t.title,t.title="Review"),t}let u=(0,n.hoist)(s,"default"),d=(0,n.hoist)(s,"config"),m=new r.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/reviews/extract-review-info",pathname:"/api/reviews/extract-review-info",bundlePath:"",filename:""},userland:s})},47153:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},71802:(e,t,i)=>{e.exports=i(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=53956);module.exports=i})();