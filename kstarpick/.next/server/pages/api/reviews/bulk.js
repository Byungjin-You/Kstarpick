"use strict";(()=>{var e={};e.id=9353,e.ids=[9353],e.modules={25142:e=>{e.exports=require("dotenv")},38013:e=>{e.exports=require("mongodb")},11185:e=>{e.exports=require("mongoose")},41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},56249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hoist",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},76547:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>m,routeModule:()=>g});var i={};r.r(i),r.d(i,{default:()=>p});var n=r(71802),a=r(47153),u=r(56249),s=r(35968),o=r(41649),d=r(11185),l=r.n(d),c=r(69176);async function p(e,t){if("POST"!==e.method)return t.status(405).json({success:!1,message:"허용되지 않는 메소드입니다."});try{{let r=await (0,o.getSession)({req:e});if(!r||"admin"!==r.user.role)return t.status(401).json({success:!1,message:"관리자만 접근할 수 있습니다."})}let{reviews:r}=e.body;if(!r||!Array.isArray(r)||0===r.length)return t.status(400).json({success:!1,message:"저장할 리뷰 데이터가 필요합니다."});if(await (0,s.connectToDatabase)(),!l().models.Review){let e=new(l()).Schema({reviewId:{type:String,required:!0,unique:!0},username:{type:String,required:!0},userProfileUrl:String,userImage:String,rating:{type:Number,default:0},title:{type:String,required:!0},reviewText:{type:String,required:!0},reviewHtml:String,reviewDate:String,helpfulCount:{type:Number,default:0},dramaId:{type:String,required:!0},sourceUrl:String,createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});l().model("Review",e)}let i={savedCount:0,skippedCount:0,errorCount:0,errors:[]};for(let e of r)try{if(!e.reviewId||!e.title||!e.reviewText||!e.dramaId){i.skippedCount++,i.errors.push(`필수 필드 누락: ${e.title||"제목 없음"}`);continue}let t=await c.default.updateOne({reviewId:e.reviewId},{$set:{...e,updatedAt:new Date}},{upsert:!0});t.upserted||t.modifiedCount>0?i.savedCount++:i.skippedCount++}catch(e){i.errorCount++,i.errors.push(`저장 오류: ${e.message}`)}return t.status(200).json({success:!0,message:`${i.savedCount}개 리뷰를 성공적으로 저장했습니다.`,...i})}catch(e){return t.status(500).json({success:!1,message:"리뷰 저장 중 오류가 발생했습니다.",error:e.message})}}let m=(0,u.hoist)(i,"default"),f=(0,u.hoist)(i,"config"),g=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/reviews/bulk",pathname:"/api/reviews/bulk",bundlePath:"",filename:""},userland:i})},69176:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var i=r(11185),n=r.n(i);let a=new(n()).Schema({reviewId:{type:String,required:!0,unique:!0},username:{type:String,required:!0},userProfileUrl:String,userImage:String,rating:{type:Number,default:0},title:{type:String,required:!0},reviewText:{type:String,required:!0},reviewHtml:String,reviewDate:String,helpfulCount:{type:Number,default:0},dramaId:{type:String,required:!0},sourceUrl:String,createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}}),u=n().models.Review||n().model("Review",a)},35968:(e,t,r)=>{let i;r.r(t),r.d(t,{connectToDatabase:()=>d,dbConnect:()=>l,default:()=>c});var n=r(38013),a=r(92048),u=r.n(a),s=r(55315),o=r.n(s);{let e=r(25142),t=o().resolve(process.cwd(),".env.production");u().existsSync(t)&&e.config({path:t}).error}async function d(){try{let e=await i,t=e.db("kstarpick");return{client:e,db:t}}catch(e){throw e}}i=new n.MongoClient("mongodb://kstarpick:zpdltmxkvlr0%212@kstarpick-mongodb-production.cluster-cjquemysifmm.ap-northeast-2.docdb.amazonaws.com:27017/kstarpick?retryWrites=false&authSource=admin&authMechanism=SCRAM-SHA-1",{tls:!1,tlsAllowInvalidCertificates:!0,tlsAllowInvalidHostnames:!0,retryWrites:!1,maxPoolSize:50,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,heartbeatFrequencyMS:1e4,maxIdleTimeMS:3e4}).connect();let l=d,c=i},47153:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouteKind",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=76547);module.exports=r})();