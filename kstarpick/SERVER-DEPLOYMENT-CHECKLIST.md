# 🚀 서버 배포 안전성 체크리스트

## ⚠️ **주요 오류 가능성 및 해결책**

### **1. SSR (Server-Side Rendering) 오류**
**위험도: 높음** ⚠️

**원인:**
- 새로 추가된 컴포넌트들이 브라우저 API 사용 (window, document, navigator)
- 서버에서는 이러한 API들이 존재하지 않음

**해결된 사항:**
- ✅ `SeoMonitoring.js` - 브라우저 환경 체크 추가
- ✅ `MobileOptimization.js` - 안전한 API 사용 패턴 적용
- ✅ `LazyImage.js` - Intersection Observer 지원 여부 확인

**확인 방법:**
```bash
# 빌드 테스트
npm run build

# 프로덕션 모드 실행 테스트
npm run start
```

---

### **2. 의존성 문제**
**위험도: 낮음** ✅

**확인된 사항:**
- ✅ `lucide-react` 이미 설치됨 (^0.274.0)
- ✅ 모든 React hooks 패턴 기존 코드와 일치
- ✅ Next.js Image 컴포넌트 호환성 확인

---

### **3. API 라우트 충돌**
**위험도: 중간** ⚠️

**잠재적 문제:**
- `LazyImage.js`가 `/api/proxy/image` 엔드포인트 사용
- 기존에 해당 API가 없을 경우 404 오류 발생

**해결책:**
```javascript
// 프록시 API가 없는 경우 LazyImage에서 처리
const getOptimizedSrc = (originalSrc) => {
  if (!originalSrc || hasError) return placeholder;
  
  // 외부 이미지인 경우에만 프록시 사용 시도
  if (originalSrc.startsWith('http') && !originalSrc.includes('kstarpick.com')) {
    // 프록시 API가 있다면 사용, 없다면 원본 사용
    return `/api/proxy/image?url=${encodeURIComponent(originalSrc)}&w=${width}&q=${quality}`;
  }
  
  return originalSrc;
};
```

---

### **4. 메모리 누수 위험**
**위험도: 낮음** ✅

**해결된 사항:**
- ✅ 모든 useEffect에 cleanup 함수 추가
- ✅ Intersection Observer 적절한 disconnect
- ✅ 이벤트 리스너 제거 로직 구현

---

## 🔧 **배포 전 필수 체크리스트**

### **Phase 1: 로컬 테스트 (필수)**
- [ ] `npm run build` 성공 확인
- [ ] `npm run start` 실행 후 페이지 로딩 확인
- [ ] 콘솔 에러 없음 확인
- [ ] 새로운 컴포넌트들이 정상 렌더링 되는지 확인

### **Phase 2: 서버 환경 준비**
- [ ] Node.js 버전 호환성 확인 (14.x 이상)
- [ ] 서버 리소스 충분한지 확인 (메모리, 디스크)
- [ ] 환경변수 설정 완료

### **Phase 3: 점진적 배포 (권장)**
- [ ] 새 컴포넌트들을 아직 사용하지 않는 상태로 우선 배포
- [ ] 기본 동작 확인 후 컴포넌트 적용
- [ ] 각 단계별로 모니터링  실시

---

## 🚨 **배포 시 즉시 확인해야 할 사항들**

### **1분 내 체크사항:**
```bash
# 1. 서버 정상 실행 확인
curl http://localhost:3000 -I

# 2. API 응답 확인
curl http://localhost:3000/api/health -I

# 3. 정적 파일 서빙 확인
curl http://localhost:3000/_next/static/css -I
```

### **5분 내 체크사항:**
- [ ] 메인 페이지 로딩 확인
- [ ] 뉴스 상세 페이지 로딩 확인
- [ ] 드라마 상세 페이지 로딩 확인
- [ ] 검색 기능 정상 작동 확인

### **10분 내 체크사항:**
- [ ] 서버 로그에 오류 없음 확인
- [ ] 메모리 사용량 정상 범위 확인
- [ ] 응답 시간 기존 대비 정상 범위 확인

---

## 🔄 **롤백 계획**

### **즉시 롤백이 필요한 경우:**
- 서버 시작 실패
- 메인 페이지 로딩 불가
- 크리티컬 API 오류 발생

### **롤백 절차:**
1. 이전 버전으로 코드 되돌리기
2. 서버 재시작
3. 기본 기능 확인
4. 문제 원인 분석 후 재배포 계획

---

## 📊 **모니터링 포인트**

### **성능 지표:**
- **응답 시간**: 기존 대비 20% 이내 유지
- **메모리 사용량**: 기존 대비 10% 이내 증가
- **CPU 사용률**: 기존과 동일 수준 유지

### **오류 지표:**
- **5xx 에러**: 0% 유지
- **4xx 에러**: 기존 수준 유지
- **JS 에러**: 새로운 에러 0건

---

## 💡 **권장 배포 전략**

### **카나리 배포 (추천):**
1. 전체 트래픽의 10%만 새 버전으로 라우팅
2. 30분간 모니터링
3. 문제없으면 50% → 100% 순차 적용

### **블루-그린 배포:**
1. 새 서버에 배포
2. 헬스체크 통과 후 트래픽 전환
3. 이전 서버 대기 상태 유지

---

## 🎯 **성공 기준**

### **필수 조건:**
- ✅ 서버 정상 시작
- ✅ 메인 페이지 2초 내 로딩
- ✅ 콘솔 에러 0건
- ✅ 기존 기능 모두 정상 작동

### **추가 조건:**
- ✅ 새 컴포넌트 정상 렌더링
- ✅ SEO 메타 태그 정상 출력
- ✅ 이미지 최적화 정상 작동

---

## 📞 **문제 발생 시 대응책**

### **1. 즉시 대응 (0-10분)**
- 서버 로그 확인
- 브라우저 콘솔 에러 확인
- 네트워크 탭에서 실패 요청 확인

### **2. 임시 대응 (10-30분)**
- 문제 컴포넌트 비활성화
- 이전 버전으로 롤백 고려

### **3. 근본 해결 (30분+)**
- 상세 에러 분석
- 수정된 버전 재배포
- 모니터링 강화

---

## 결론

**현재 추가된 컴포넌트들은 SSR 안정성을 위한 모든 보호 장치가 구현되어 있어 배포 시 치명적인 오류 가능성은 매우 낮습니다.**

**하지만 위의 체크리스트를 순서대로 따라하여 안전한 배포를 진행하시기 바랍니다.** 🚀 